---
title: "api.ts"
---

## High-level description
This code defines a function `makeApiClient` that creates and configures a `ChainlitAPI` instance for making API calls to a Chainlit server. It sets up error handling and authentication failure handling using toast notifications.

## Symbols

### `makeApiClient`
#### Description
This function creates and returns a new instance of `ChainlitAPI` with configured error handling and authentication failure handling.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| chainlitServer | string | The URL of the Chainlit server |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| (return value) | ChainlitAPI | Configured instance of ChainlitAPI |

#### Internal Logic
1. Sets the `httpEndpoint` to the provided `chainlitServer` URL.
2. Defines an `on401` function to handle unauthorized access (HTTP 401 errors).
3. Defines an `onError` function to handle general client errors.
4. Creates and returns a new `ChainlitAPI` instance with the configured parameters.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| sonner | Used for displaying toast notifications |
| @chainlit/react-client | Provides the ChainlitAPI class for API interactions |

## Error Handling
The code implements two error handling mechanisms:
1. `on401`: Handles unauthorized access by displaying an "Unauthorized" toast error.
2. `onError`: Handles general client errors by displaying the error message as a toast error.

## References
This code is referenced in the `AppWrapper` component (from the related code snippets) where it's used to create an API client instance:

```typescript
const apiClient = makeApiClient(widgetConfig.chainlitServer);
```

The created API client is then provided to the application through the `ChainlitContext.Provider`.

## Notes
- The `ChainlitAPI` class extends `APIBase` (from the related code snippets), which provides the core functionality for making HTTP requests.
- The `'copilot'` string passed to the `ChainlitAPI` constructor indicates the type of client being created, which may affect certain behaviors of the API client.
- Error messages are displayed using toast notifications, providing a user-friendly way to show errors in the UI.