---
title: "state.ts"
---

## High-level description
This code defines the state management and core functionality for a chat application using Recoil for state management. It includes atoms and selectors for managing various aspects of the chat, such as messages, user interactions, settings, and UI elements.

## Code Structure
The code is organized into several state atoms and selectors, each responsible for a specific aspect of the chat application. These states are interconnected and used throughout the application to manage the chat flow, user interactions, and UI updates.

## Symbols

### `threadIdToResumeState`
#### Description
An atom that stores the ID of a thread to be resumed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | undefined | Default value for the atom |

### `chatProfileState`
#### Description
An atom that stores the current chat profile.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | undefined | Default value for the atom |

### `sessionIdState`
#### Description
A selector that manages the session ID, generating a new UUID if not set.

#### Internal Logic
Uses `sessionIdAtom` to store the actual value and provides a getter and setter. The setter generates a new UUID if the value is reset.

### `sessionState`
#### Description
An atom that stores the current session information, including the socket connection.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | undefined | Default value for the atom |
| dangerouslyAllowMutability | boolean | Allows direct mutation of the atom's value |

### `actionState`
#### Description
An atom that stores the list of available actions.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | IAction[] | Default empty array for actions |

### `messagesState`
#### Description
An atom that stores the list of chat messages.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | IStep[] | Default empty array for messages |
| dangerouslyAllowMutability | boolean | Allows direct mutation of the atom's value |

### `tokenCountState`
#### Description
An atom that stores the token count.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | number | Default value of 0 for token count |

### `loadingState`
#### Description
An atom that indicates whether the chat is in a loading state.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | boolean | Default value of false for loading state |

### `askUserState`
#### Description
An atom that stores the current user prompt, if any.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | undefined | Default value for the atom |

### `callFnState`
#### Description
An atom that stores the current function call, if any.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | undefined | Default value for the atom |

### `chatSettingsInputsState`
#### Description
An atom that stores the chat settings inputs.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | any[] | Default empty array for chat settings inputs |

### `chatSettingsDefaultValueSelector`
#### Description
A selector that computes the default values for chat settings based on the inputs.

#### Internal Logic
Reduces the chat settings inputs to create an object with default values.

### `chatSettingsValueState`
#### Description
An atom that stores the current values of chat settings.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | selector | Uses the chatSettingsDefaultValueSelector as the default value |

### `elementState`
#### Description
An atom that stores the list of display elements.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | IMessageElement[] | Default empty array for display elements |

### `tasklistState`
#### Description
An atom that stores the list of tasklist elements.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | ITasklistElement[] | Default empty array for tasklist elements |

### `firstUserInteraction`
#### Description
An atom that stores the timestamp of the first user interaction.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | undefined | Default value for the atom |

### `accessTokenState`
#### Description
An atom that stores the current access token.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | undefined | Default value for the atom |

### `userState`
#### Description
An atom that stores the current user information.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | null | Default value for the atom |

### `configState`
#### Description
An atom that stores the Chainlit configuration.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | undefined | Default value for the atom |

### `authState`
#### Description
An atom that stores the authentication configuration.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | undefined | Default value for the atom |

### `threadHistoryState`
#### Description
An atom that stores the thread history, including threads, current thread ID, and time-grouped threads.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | object | Default object with undefined values for threads, currentThreadId, timeGroupedThreads, and pageInfo |

#### Internal Logic
Includes an effect that groups threads by date when the threads are updated.

### `sideViewState`
#### Description
An atom that stores the current side view element, if any.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | undefined | Default value for the atom |

### `currentThreadIdState`
#### Description
An atom that stores the ID of the current thread.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | Unique identifier for the atom |
| default | undefined | Default value for the atom |

## Dependencies
The code relies on several external libraries:
| Dependency | Purpose |
|:-----------|:--------|
| recoil | State management library |
| socket.io-client | WebSocket client for real-time communication |
| uuid | Generating unique identifiers |
| lodash | Utility functions, specifically `isEqual` |

## Configuration
The code defines several configuration options through the various atoms and selectors. These configurations control aspects such as chat settings, authentication, and UI elements.

## Error Handling
Error handling is not explicitly implemented in this file but is likely handled in the components that use these state atoms and selectors.

## Logging
No specific logging mechanisms are implemented in this file.

This code serves as the core state management for a chat application, providing a foundation for managing various aspects of the chat functionality and user interface.