---
title: "auth.ts"
---

## High-level description
This code defines a custom React hook called `useAuth` that manages authentication state and provides authentication-related functionality for a React application. It utilizes Recoil for state management and includes features such as user authentication, token handling, and logout functionality.

## Code Structure
The `useAuth` hook uses several Recoil atoms and selectors to manage authentication state. It also interacts with an API client (from `ChainlitContext`) to perform authentication-related operations. The hook returns an object with various authentication-related properties and functions.

## Symbols

### `useAuth`
#### Description
A custom React hook that manages authentication state and provides authentication-related functionality.

#### Inputs
This hook doesn't take any direct inputs, but it uses various Recoil states and the `ChainlitContext`.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| authConfig | IAuthConfig | Authentication configuration |
| user | IUser | Current user information |
| isReady | boolean | Indicates if the authentication is ready |
| isAuthenticated | boolean | Indicates if the user is authenticated |
| accessToken | string | The current access token |
| logout | function | Function to log out the user |
| setAccessToken | function | Function to set the access token |

#### Internal Logic
1. Fetches authentication configuration using the `useApi` hook.
2. Manages user state, access token, and authentication status.
3. Provides a `logout` function to clear user data and tokens.
4. Implements `saveAndSetToken` to handle token decoding and storage.
5. Initializes the token from local storage on component mount.

## Side Effects
- Modifies local storage to store and remove authentication tokens.
- Updates Recoil state for user information, access token, and thread history.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| jwt_decode | Decoding JWT tokens |
| react | React hooks and context |
| recoil | State management |
| src/context | ChainlitContext for API client |
| src/state | Recoil atoms for auth-related states |
| src/types | Type definitions |
| src/utils/token | Token management utilities |

## Error Handling
The hook includes basic error handling for invalid tokens, logging the error and clearing the token from local storage.

## Notes
- The hook provides different behavior based on the `requireLogin` setting in the auth configuration.
- It uses JWT for token management and decoding.
- The hook is designed to work with a Chainlit API client provided through context.