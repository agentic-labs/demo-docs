---
title: "message.ts"
---

## High-level description
This code provides utility functions for managing and manipulating messages in a chat-like application. It includes operations such as nesting messages, adding, updating, and deleting messages, as well as handling message content updates.

## Code Structure
The code defines several functions that operate on arrays of `IStep` objects, which represent messages or steps in a conversation. These functions are designed to work together to maintain the structure and state of the chat messages.

## Symbols

### `nestMessages`
#### Description
This function takes an array of `IStep` objects and nests them according to their relationships.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| messages | IStep[] | An array of message objects |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| nestedMessages | IStep[] | An array of nested message objects |

#### Internal Logic
Iterates through the input messages and uses the `addMessage` function to build a nested structure.

### `isLastMessage`
#### Description
Determines if a message is the last non-streaming message in the array.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| messages | IStep[] | An array of message objects |
| index | number | The index of the message to check |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| isLast | boolean | Whether the message is the last non-streaming message |

### `addMessage`
#### Description
Adds a new message to the existing array of messages, handling various scenarios such as updating existing messages, adding to parent messages, or handling indented messages.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| messages | IStep[] | The existing array of messages |
| message | IStep | The new message to add |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| updatedMessages | IStep[] | The updated array of messages |

### `addIndentMessage`
#### Description
Adds an indented message to the appropriate place in the message hierarchy.

### `addMessageToParent`
#### Description
Adds a message as a child to its parent message.

### `findMessageById`
#### Description
Recursively searches for a message with a specific ID in the message tree.

### `hasMessageById`
#### Description
Checks if a message with a specific ID exists in the message tree.

### `updateMessageById`
#### Description
Updates a message with a specific ID in the message tree.

### `deleteMessageById`
#### Description
Deletes a message with a specific ID from the message tree.

### `updateMessageContentById`
#### Description
Updates the content of a message with a specific ID, handling different types of content (input, output, or general content).

## Exports
The module exports several utility functions for message manipulation:
- `addMessageToParent`
- `addMessage`
- `deleteMessageById`
- `hasMessageById`
- `isLastMessage`
- `nestMessages`
- `updateMessageById`
- `updateMessageContentById`

These functions provide a comprehensive set of tools for managing the state and structure of messages in a chat-like application.