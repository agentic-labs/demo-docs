---
title: "spec.cy.ts"
---

## High-level description
This Cypress test suite, named 'Copilot', tests the functionality of a Copilot widget embedded in a web page. It sets up a test environment, mounts the Chainlit widget, and verifies the widget's behavior, including its visibility and response to user interactions.

## Code Structure
The test suite consists of a single describe block with a before hook for setup and one test case. The setup involves running a test server, injecting HTML and scripts, and configuring event listeners. The test case checks the embedding and interaction with the Copilot widget.

## References
This code references functions from '../../support/testUtils', specifically `runTestServer` and `submitMessageCopilot`.

## Symbols

### `describe('Copilot', ...)`
#### Description
This is the main test suite for the Copilot functionality. It contains the setup and test cases for the Copilot widget.

#### Internal Logic
1. Sets up the test environment in the `before` hook.
2. Defines a test case to verify the Copilot widget's functionality.

### `before(...)`
#### Description
This hook sets up the test environment before running the test cases.

#### Internal Logic
1. Runs the test server using `runTestServer()`.
2. Injects HTML content and loads the Copilot script.
3. Mounts the Chainlit widget and sets up event listeners.

### `it('should be able to embed the copilot', ...)`
#### Description
This test case verifies the embedding and functionality of the Copilot widget.

#### Internal Logic
1. Clicks the Copilot button and checks if the popover is visible.
2. Verifies the initial content of the Copilot popover.
3. Submits a message to the Copilot and checks the response.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| Cypress | Testing framework used for end-to-end testing |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| includeShadowDom | boolean | true | Enables querying within Shadow DOM elements |

## Error Handling
The code uses Cypress's built-in assertion mechanisms to handle test failures. If any assertion fails, the test will fail and provide detailed error information.

## Performance Considerations
The test includes several `cy.wait()` calls to ensure proper timing between actions. These waits might need adjustment based on the application's performance characteristics.

___