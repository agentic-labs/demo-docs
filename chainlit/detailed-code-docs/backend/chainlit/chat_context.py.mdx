---
title: "chat_context.py"
---

## High-level description
This code defines a `ChatContext` class and related functionality to manage chat contexts in a Chainlit application. It provides methods to get, add, remove, and clear messages in a chat context, as well as convert the context to OpenAI-compatible format.

## Code Structure
The main class `ChatContext` contains methods to manipulate the chat context. The global `chat_contexts` dictionary stores chat contexts for different sessions. The `chat_context` instance at the end of the file is used as a singleton to access the chat context functionality.

## Symbols

### `chat_contexts`
#### Description
A global dictionary that stores chat contexts for different sessions.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | Dict[str, List["Message"]] | A dictionary where keys are session IDs and values are lists of messages |

### `ChatContext`
#### Description
A class that provides methods to manage the chat context for a session.

#### Methods

### `get`
#### Description
Retrieves the chat context for the current session.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| messages | List["Message"] | A copy of the list of messages in the current chat context |

### `add`
#### Description
Adds a message to the chat context of the current session.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| message | "Message" | The message to be added to the chat context |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| message | "Message" | The added message |

### `remove`
#### Description
Removes a message from the chat context of the current session.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| message | "Message" | The message to be removed from the chat context |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| removed | bool | True if the message was successfully removed, False otherwise |

### `clear`
#### Description
Clears the chat context for the current session.

### `to_openai`
#### Description
Converts the chat context to OpenAI-compatible format.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| messages | List[Dict[str, str]] | A list of dictionaries representing messages in OpenAI format |

### `chat_context`
#### Description
A global instance of the `ChatContext` class, used as a singleton to access chat context functionality.

## Dependencies
This code relies on the following internal dependencies:
- `chainlit.context`: Provides the `context` object for accessing session information.
- `chainlit.message`: Contains the `Message` class used in the chat context.

## Error Handling
The code includes basic error handling, such as checking for the existence of a session and the presence of a chat context for the session. However, it does not raise explicit exceptions.

## Performance Considerations
The `get` method returns a copy of the chat context to prevent unintended modifications. This may have a slight performance impact for large chat contexts.