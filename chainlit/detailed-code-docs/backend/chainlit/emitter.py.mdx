---
title: "emitter.py"
---

Here's a comprehensive documentation for the `emitter.py` file:

## High-level description
The `emitter.py` file defines the `BaseChainlitEmitter` and `ChainlitEmitter` classes, which are responsible for handling communication between the backend and the user interface in the Chainlit application. These classes manage various operations such as sending messages, elements, and steps to the UI, handling user interactions, and managing the application's state.

## Code Structure
The main symbols in this code are:
1. `BaseChainlitEmitter`: A base class that provides stub methods for emitting events.
2. `ChainlitEmitter`: The main class that inherits from `BaseChainlitEmitter` and implements the actual emission logic.

The `ChainlitEmitter` class uses the `WebsocketSession` to communicate with the UI. It implements methods to send various types of data (elements, steps, messages) and handle user interactions (ask user, call functions).

## Symbols

### `BaseChainlitEmitter`
#### Description
A base class that provides stub methods for emitting events. This class is used for testing purposes and does nothing on function calls.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| session | BaseSession | The user session object |

#### Internal Logic
- Initializes with a `BaseSession` object.
- Provides stub methods for various emit operations.

### `ChainlitEmitter`
#### Description
The main emitter class that handles communication between the backend and the UI.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| session | WebsocketSession | The websocket session object |

#### Internal Logic
- Initializes with a `WebsocketSession` object.
- Implements methods to send elements, steps, messages, and handle user interactions.
- Uses the session's `emit` and `emit_call` methods to communicate with the UI.
- Manages the application's state, including thread creation and user interactions.

#### Methods

##### `send_element`
Sends an element to the UI.

##### `send_step`
Sends a step (message) to the UI.

##### `update_step`
Updates an existing step in the UI.

##### `delete_step`
Deletes a step from the UI.

##### `send_ask_user`
Sends a prompt to the UI and waits for a user response.

##### `send_call_fn`
Sends a call function event to the copilot and waits for a response.

##### `update_token_count`
Updates the token count displayed in the UI.

##### `task_start` and `task_end`
Signals the start and end of a task to the UI.

##### `stream_start`
Signals the start of a stream to the UI.

##### `send_token`
Sends a token to the UI during streaming.

##### `set_chat_settings`
Updates the chat settings.

##### `send_action_response`
Sends an action response to the UI.

## Dependencies
The code relies on several external modules and internal Chainlit components:
- `asyncio` for asynchronous operations
- `uuid` for generating unique identifiers
- `chainlit.chat_context` for managing chat context
- `chainlit.config` for accessing application configuration
- `chainlit.data` for data layer operations
- `chainlit.element` for handling UI elements
- `chainlit.logger` for logging
- `chainlit.message` for message handling
- `chainlit.step` for step management
- Various type definitions from `chainlit.types`

## Error Handling
The code includes basic error handling, primarily logging errors when they occur during data persistence operations.

## Logging
The code uses the `chainlit.logger` module for logging errors and warnings.

## TODOs
There are no explicit TODOs in the code.

This emitter module is central to the Chainlit application's functionality, managing the communication between the backend logic and the user interface. It handles various types of data and user interactions, making it a critical component of the application's architecture.