---
title: "auth.py"
---

Here's a detailed documentation of the `backend/chainlit/auth.py` file:

## High-level description
This file contains authentication-related functions and utilities for the Chainlit application. It handles JWT token creation, user authentication, and configuration for various authentication methods.

## Code Structure
The code defines several functions that work together to handle authentication:
- `get_jwt_secret()` and `ensure_jwt_secret()` manage the JWT secret.
- `is_oauth_enabled()` and `require_login()` determine if authentication is required.
- `get_configuration()` provides authentication configuration.
- `create_jwt()` generates JWT tokens.
- `authenticate_user()` and `get_current_user()` handle user authentication.

## Symbols

### `reuseable_oauth`
#### Description
An instance of OAuth2PasswordBearer for token-based authentication.

### `get_jwt_secret()`
#### Description
Retrieves the JWT secret from environment variables.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| JWT secret | str | The JWT secret used for token encoding/decoding |

### `ensure_jwt_secret()`
#### Description
Ensures that a JWT secret is provided when authentication is required.

#### Internal Logic
Raises a ValueError if authentication is required but no JWT secret is set.

### `is_oauth_enabled()`
#### Description
Checks if OAuth authentication is enabled.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| is_enabled | bool | True if OAuth is enabled, False otherwise |

### `require_login()`
#### Description
Determines if login is required based on the authentication configuration.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| login_required | bool | True if login is required, False otherwise |

### `get_configuration()`
#### Description
Returns the authentication configuration for the application.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| configuration | dict | Authentication configuration details |

### `create_jwt(data: User)`
#### Description
Creates a JWT token for a given user.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | User | User object to encode in the JWT |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| encoded_jwt | str | JWT token string |

### `authenticate_user(token: str = Depends(reuseable_oauth))`
#### Description
Authenticates a user based on the provided JWT token.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| token | str | JWT token to authenticate |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user | User | Authenticated user object |

#### Internal Logic
1. Decodes and verifies the JWT token.
2. Creates a User object from the decoded data.
3. If a data layer is available, retrieves or creates a persisted user.

### `get_current_user(token: str = Depends(reuseable_oauth))`
#### Description
Retrieves the current user based on the authentication token.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| token | str | JWT token to authenticate |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user | User or None | Current user object or None if login is not required |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| os | Accessing environment variables |
| datetime | Handling token expiration |
| jwt | JSON Web Token encoding and decoding |
| fastapi | FastAPI dependencies and HTTP exceptions |
| chainlit.config | Accessing application configuration |
| chainlit.data | Interacting with the data layer |
| chainlit.oauth_providers | Handling OAuth providers |
| chainlit.user | User object definition |

## Error Handling
The code uses FastAPI's HTTPException for handling authentication errors, such as invalid tokens or unauthorized access.