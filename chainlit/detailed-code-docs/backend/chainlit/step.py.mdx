---
title: "step.py"
---

Here's a high-level description and documentation of the `backend/chainlit/step.py` file:

## High-level description

This file defines the `Step` class, which represents a single step in a conversation or processing chain. It also includes utility functions for handling steps and a decorator for creating steps. The `Step` class is central to Chainlit's functionality, allowing for the creation, updating, and management of conversation steps with various attributes such as input, output, metadata, and associated elements.

## Code Structure

The main components of this file are:

1. Utility functions (`check_add_step_in_cot`, `stub_step`, `flatten_args_kwargs`)
2. The `step` decorator
3. The `Step` class

The `Step` class is the core of this file, with the other components supporting its functionality or providing convenient ways to create steps.

## Symbols

### `check_add_step_in_cot`
#### Description
Determines whether a step should be added to the chain of thought (CoT) based on its type and configuration settings.

### `stub_step`
#### Description
Creates a minimal representation of a step, used when full details are not needed.

### `flatten_args_kwargs`
#### Description
Flattens function arguments and keyword arguments into a single dictionary.

### `step`
#### Description
A decorator that wraps a function to create a `Step` object. It handles both synchronous and asynchronous functions.

### `Step`
#### Description
The main class representing a step in the conversation or processing chain. It includes methods for creating, updating, and managing step data.

#### Key Methods
- `__init__`: Initializes a new Step instance.
- `to_dict`: Converts the Step to a dictionary representation.
- `update`: Updates an existing step in the UI.
- `remove`: Removes a step from the UI.
- `send`: Sends a new step to the UI.
- `stream_token`: Streams tokens to the UI for real-time updates.

## Dependencies
The file relies on several Chainlit-specific modules and external libraries, including:
- `asyncio` for asynchronous operations
- `chainlit.config` for configuration settings
- `chainlit.context` for context management
- `chainlit.data` for data layer interactions
- `chainlit.telemetry` for event tracing
- `literalai` for generation-related functionality

## Error Handling
The code includes basic error handling, particularly in the `create_element`, `create_step`, and `update_step` methods, where errors during persistence are caught and logged.

## Performance Considerations
The file implements asynchronous operations for UI updates and data persistence, which helps in maintaining responsiveness, especially in high-load scenarios or when dealing with slow network connections.

This file is crucial for Chainlit's functionality, providing the foundation for creating, managing, and displaying conversation steps in the UI. It allows for flexible step creation through both direct instantiation and the use of a decorator, making it adaptable to various use cases within the Chainlit framework.