---
title: "test_user_session.py"
---

## High-level description
This file contains unit tests for the `UserSession` class in the Chainlit framework. It tests the functionality of setting and getting values in the user session, including session-specific values like ID, environment variables, and languages.

## Code Structure
The code defines fixtures and a test function to verify the behavior of the `UserSession` class. It uses pytest and pytest-asyncio for asynchronous testing.

## Symbols

### `create_chainlit_context`
#### Description
An asynchronous context manager that creates a mock ChainlitContext for testing purposes.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| context | ChainlitContext | A mock ChainlitContext object |

#### Internal Logic
1. Creates a mock WebsocketSession with predefined attributes.
2. Initializes a ChainlitContext with the mock session.
3. Sets the context in the context_var.
4. Yields the context for use in tests.
5. Resets the context_var after the test is complete.

### `mock_chainlit_context`
#### Description
A pytest fixture that provides the mock ChainlitContext for tests.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| context | AsyncContextManager[ChainlitContext] | An async context manager that yields a mock ChainlitContext |

### `user_session`
#### Description
A pytest fixture that provides a UserSession instance for testing.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user_session | UserSession | An instance of the UserSession class |

### `test_user_session_set_get`
#### Description
An asynchronous test function that verifies the functionality of the UserSession class.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mock_chainlit_context | AsyncContextManager[ChainlitContext] | The mock ChainlitContext fixture |
| user_session | UserSession | The UserSession fixture |

#### Internal Logic
1. Sets up the test environment using the mock_chainlit_context.
2. Tests setting and getting a custom key-value pair.
3. Tests getting a default value for a non-existent key.
4. Tests getting session-related values (id, env, languages).

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework |
| pytest_asyncio | Asynchronous testing support |
| unittest.mock | Mocking objects for testing |
| contextlib | Async context manager support |
| chainlit.user_session | UserSession class being tested |
| chainlit.context | ChainlitContext and context_var |
| chainlit.session | WebsocketSession class |

This test file ensures that the UserSession class correctly interacts with the ChainlitContext and provides the expected functionality for setting and retrieving session-specific data.