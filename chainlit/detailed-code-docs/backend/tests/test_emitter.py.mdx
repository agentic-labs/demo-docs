---
title: "test_emitter.py"
---

## High-level description
This file contains unit tests for the `ChainlitEmitter` class, which is responsible for sending various types of data and events to the UI in a Chainlit application. The tests cover different methods of the `ChainlitEmitter` class, ensuring that they correctly emit events and data to the UI.

## Code Structure
The test file is organized into several test functions, each focusing on a specific method of the `ChainlitEmitter` class. The tests use pytest fixtures to set up a mock session and create an instance of the `ChainlitEmitter` for testing.

## Symbols

### `mock_session` (fixture)
#### Description
Creates a mock session object with an `emit` method for testing purposes.

### `emitter` (fixture)
#### Description
Creates an instance of `ChainlitEmitter` using the mock session for testing.

### `test_send_element`
#### Description
Tests the `send_element` method of `ChainlitEmitter`.

#### Internal Logic
1. Creates a sample `ElementDict`.
2. Calls `emitter.send_element` with the sample dict.
3. Asserts that `mock_session.emit` was called with the correct event and data.

### `test_send_step`
#### Description
Tests the `send_step` method of `ChainlitEmitter`.

#### Internal Logic
1. Creates a sample `StepDict`.
2. Calls `emitter.send_step` with the sample dict.
3. Asserts that `mock_session.emit` was called with the correct event and data.

### `test_update_step`
#### Description
Tests the `update_step` method of `ChainlitEmitter`.

#### Internal Logic
Similar to `test_send_step`, but uses `update_step` method and "update_message" event.

### `test_delete_step`
#### Description
Tests the `delete_step` method of `ChainlitEmitter`.

#### Internal Logic
Similar to `test_send_step`, but uses `delete_step` method and "delete_message" event.

### `test_send_timeout`
#### Description
Tests the `send_timeout` method of `ChainlitEmitter`.

#### Internal Logic
Calls `emitter.send_timeout` and asserts that `mock_session.emit` was called with the correct event and empty data.

### `test_clear`
#### Description
Tests the `clear` method of `ChainlitEmitter`.

#### Internal Logic
Similar to `test_send_timeout`, but uses `clear` method and "clear_ask" event.

### `test_send_token`
#### Description
Tests the `send_token` method of `ChainlitEmitter`.

#### Internal Logic
Calls `emitter.send_token` with sample data and asserts that `mock_session.emit` was called with the correct event and token data.

### `test_set_chat_settings`
#### Description
Tests the `set_chat_settings` method of `ChainlitEmitter`.

#### Internal Logic
Calls `emitter.set_chat_settings` with sample settings and asserts that the settings are correctly set in the session.

### `test_send_action_response`
#### Description
Tests the `send_action_response` method of `ChainlitEmitter`.

#### Internal Logic
Calls `emitter.send_action_response` with sample data and asserts that `mock_session.emit` was called with the correct event and response data.

### `test_update_token_count`
#### Description
Tests the `update_token_count` method of `ChainlitEmitter`.

#### Internal Logic
Calls `emitter.update_token_count` with a sample count and asserts that `mock_session.emit` was called with the correct event and count.

### `test_task_start`
#### Description
Tests the `task_start` method of `ChainlitEmitter`.

#### Internal Logic
Calls `emitter.task_start` and asserts that `mock_session.emit` was called with the correct event and empty data.

### `test_task_end`
#### Description
Tests the `task_end` method of `ChainlitEmitter`.

#### Internal Logic
Similar to `test_task_start`, but uses `task_end` method.

### `test_stream_start`
#### Description
Tests the `stream_start` method of `ChainlitEmitter`.

#### Internal Logic
Calls `emitter.stream_start` with a sample `StepDict` and asserts that `mock_session.emit` was called with the correct event and step data.

## Dependencies
- pytest
- unittest.mock
- chainlit.emitter
- chainlit.element
- chainlit.step

This test file ensures that the `ChainlitEmitter` class correctly emits various events and data to the UI, which is crucial for the proper functioning of the Chainlit application's user interface.