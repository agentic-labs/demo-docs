---
title: "index.tsx"
---

## High-level description
This code implements the ThreadHistory component, which displays a list of chat threads in a sidebar. It manages the fetching, filtering, and rendering of thread history, including pagination and error handling.

## Code Structure
The main `ThreadHistory` component uses several React hooks and Recoil state management to handle the thread history data and user interactions. It renders a `Filters` component and a scrollable `ThreadList` component. The component fetches thread data, manages pagination, and handles user interactions like scrolling and filtering.

## References
- `ChainlitContext`: Used to access the API client.
- `threadHistoryState`, `accessTokenState`, `threadsFiltersState`: Recoil states for managing thread history, access token, and filters.
- `useChatMessages`: Custom hook for accessing chat messages and thread information.
- `ThreadList`: Component for rendering the list of threads.
- `Filters`: Component for rendering filter options.

## Symbols

### `ThreadHistory`
#### Description
The main component that manages and displays the thread history.

#### Internal Logic
1. Initializes states and fetches initial thread data.
2. Handles scrolling and pagination.
3. Fetches more threads when the user scrolls to the bottom.
4. Re-fetches threads when filters change.
5. Renders the `Filters` component and the `ThreadList` component.

### `fetchThreads`
#### Description
Asynchronous function to fetch thread data from the API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cursor | string \| number \| undefined | Pagination cursor |
| isLoadingMore | boolean \| undefined | Indicates if more threads are being loaded |

#### Internal Logic
1. Sets loading states.
2. Calls the API to fetch thread data.
3. Updates the thread history state with new data.
4. Handles errors and updates error state.

### `handleScroll`
#### Description
Function to handle scrolling events in the thread list.

#### Internal Logic
1. Checks if the user has scrolled to the bottom of the list.
2. Triggers loading of more threads if at the bottom.
3. Saves the current scroll position.

## Side Effects
- Fetches thread data from the API.
- Updates Recoil state for thread history.
- Navigates to a specific thread page when a new thread is created.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react | Core React library |
| recoil | State management |
| @mui/material | UI components |
| @chainlit/react-client | Chainlit-specific hooks and contexts |
| lodash | Utility functions |

## Performance Considerations
- Uses pagination to load threads in batches, improving performance for large thread histories.
- Implements scroll position preservation to maintain user's place in the list when new threads are loaded.