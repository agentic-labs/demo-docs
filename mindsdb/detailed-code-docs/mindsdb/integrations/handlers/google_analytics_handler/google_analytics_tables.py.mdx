---
title: "google_analytics_tables.py"
---

## High-level description
This code defines a `ConversionEventsTable` class that handles CRUD operations for conversion events in Google Analytics 4 properties. It implements methods to select, insert, update, and delete conversion events, interacting with the Google Analytics Admin API.

## Code Structure
The `ConversionEventsTable` class inherits from `APITable` and implements methods for SQL-like operations (select, insert, update, delete) on conversion events. It also includes helper methods for interacting with the Google Analytics Admin API and processing the data.

## Symbols

### `ConversionEventsTable`
#### Description
A class that handles operations on conversion events in Google Analytics 4 properties.

#### Methods

### `select`
#### Description
Retrieves conversion events based on the provided SQL-like query.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | ast.Select | SQL query to parse |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| events | pd.DataFrame | DataFrame containing the selected conversion events |

#### Internal Logic
1. Parses the query conditions and parameters
2. Retrieves conversion events from the Google Analytics Admin API
3. Processes and filters the results based on the query
4. Returns a DataFrame with the selected columns

### `insert`
#### Description
Inserts a new conversion event into the GA4 property.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | ast.Insert | SQL query to parse |

#### Internal Logic
1. Extracts event details from the query
2. Validates the input columns
3. Calls the Google Analytics Admin API to create the conversion event

### `update`
#### Description
Updates an existing conversion event in the GA4 property.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | ast.Update | SQL query to parse |

#### Internal Logic
1. Extracts update details from the query
2. Calls the Google Analytics Admin API to update the conversion event

### `delete`
#### Description
Deletes a conversion event from the GA4 property.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | ast.Delete | SQL query to parse |

#### Internal Logic
1. Extracts the event name from the query conditions
2. Calls the Google Analytics Admin API to delete the conversion event

### Helper Methods
- `get_conversion_events`: Retrieves conversion events from the GA4 property
- `create_conversion_event`: Creates a new conversion event
- `update_conversion_event`: Updates an existing conversion event
- `delete_conversion_event`: Deletes a conversion event
- `extract_conversion_events_data`: Processes conversion event data
- `concat_dataframes`: Concatenates DataFrames
- `get_columns`: Returns the list of columns for the conversion events table

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pandas | Data manipulation and analysis |
| google.analytics.admin_v1beta | Google Analytics Admin API client |
| mindsdb_sql | SQL parsing and utilities |
| mindsdb.integrations.libs.api_handler | Base APITable class |
| mindsdb.integrations.utilities.sql_utils | SQL utility functions |

## Error Handling
The code implements basic error handling, raising `NotImplementedError` for unsupported operations or conditions. It also includes input validation for insert operations.

## API/Interface Reference
The class interacts with the Google Analytics Admin API, using the following endpoints:
- List conversion events
- Create conversion event
- Update conversion event
- Delete conversion event

The class provides a SQL-like interface for interacting with conversion events, allowing users to perform CRUD operations using familiar SQL syntax.