---
title: "luma_handler.py"
---

## High-level description
This code implements a handler for the Luma API integration in MindsDB. It provides functionality to connect to the Luma API, execute queries, and manage events data through a custom table implementation.

## Code Structure
The main `LumaHandler` class inherits from `APIHandler` and sets up the connection to the Luma API. It registers a `LumaEventsTable` for handling event-related operations. The `LumaEventsTable` class, defined in a separate file, implements the logic for selecting and inserting event data.

## Symbols

### LumaHandler
#### Description
This class serves as the main handler for the Luma API integration. It manages the connection to the API and provides methods for connecting, checking the connection, and executing native queries.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | Name of the handler instance |
| **kwargs | dict | Additional keyword arguments, including connection data |

#### Internal Logic
1. Initializes the handler with the given name and connection data.
2. Creates an instance of `LumaEventsTable` and registers it as "events".
3. Provides methods for connecting to the Luma API and checking the connection status.
4. Implements a `native_query` method to handle raw SQL queries.

### LumaHandler.connect
#### Description
Establishes a connection to the Luma API using the provided API key.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| resp | StatusResponse | Connection status response |

#### Internal Logic
1. Creates a `LumaClient` instance using the API key from the connection data.
2. Sets the connection status and returns a `StatusResponse` object.

### LumaHandler.check_connection
#### Description
Checks the connection to the Luma API by attempting to connect.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| resp | StatusResponse | Connection status response |

### LumaHandler.native_query
#### Description
Processes a raw SQL query by parsing it and executing it through the query method.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | str | Raw SQL query string |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | StatusResponse | Query execution status and results |

#### Internal Logic
1. Parses the input SQL query using `parse_sql` function.
2. Calls the `query` method with the parsed AST.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| mindsdb_sql | For parsing SQL queries |
| mindsdb.integrations.handlers.luma_handler.luma_tables | Provides the LumaEventsTable implementation |
| mindsdb.integrations.handlers.luma_handler.luma | Provides the LumaClient for API interactions |
| mindsdb.integrations.libs.api_handler | Base class for API handlers |
| mindsdb.integrations.libs.response | For creating status response objects |

## References
The code references the `LumaEventsTable` class, which is implemented in the `luma_tables.py` file. This class provides the actual implementation for selecting and inserting event data through the Luma API.

The `LumaEventsTable` class includes methods for:
1. Selecting events data based on SQL queries.
2. Inserting new event data.
3. Parsing and formatting event data for API requests.

It uses utility classes like `SELECTQueryParser`, `SELECTQueryExecutor`, and `INSERTQueryParser` to handle SQL query parsing and execution.