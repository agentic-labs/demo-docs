---
title: "oilpriceapi_tables.py"
---

## High-level description
The code defines two classes, `OilPriceLatestTable` and `OilPricePastDayPriceTable`, both inheriting from `APITable`. These classes are responsible for fetching oil price data from the Oil Price API (https://docs.oilpriceapi.com/guide/#prices-latest) based on SQL SELECT queries and returning the results as Pandas DataFrames.

## Code Structure
Both `OilPriceLatestTable` and `OilPricePastDayPriceTable` classes have a similar structure. They both define a `select` method that parses the incoming SQL query, extracts relevant parameters, fetches data from the Oil Price API, and returns the filtered and formatted data. They also define a `get_columns` method that returns a list of available columns. The `SELECTQueryParser` and `SELECTQueryExecutor` classes from `mindsdb.integrations.utilities.handlers.query_utilities` are used for parsing and executing the SQL queries.

## References
This code references the following symbols from other parts of the codebase:
- `APITable` (from `mindsdb.integrations.libs.api_handler`)
- `SELECTQueryParser` (from `mindsdb.integrations.utilities.handlers.query_utilities`)
- `SELECTQueryExecutor` (from `mindsdb.integrations.utilities.handlers.query_utilities`)

## Symbols

### `OilPriceLatestTable`
#### Description
This class handles fetching the latest oil price data from the Oil Price API based on the provided SQL SELECT query.

#### Inputs
This class doesn't take any inputs during initialization.

#### Outputs
This class doesn't return any outputs during initialization.

#### Internal Logic
The `select` method of this class performs the following steps:
1. Parses the incoming SQL query using `SELECTQueryParser`.
2. Extracts search parameters (`by_type`, `by_code`) and filtering conditions from the parsed query.
3. Fetches the latest oil price data from the Oil Price API using the extracted search parameters.
4. Converts the API response to a Pandas DataFrame.
5. Applies filtering, ordering, and limiting based on the extracted conditions.
6. Returns the resulting DataFrame.

### `OilPricePastDayPriceTable`
#### Description
This class handles fetching the past day's oil price data from the Oil Price API based on the provided SQL SELECT query.

#### Inputs
This class doesn't take any inputs during initialization.

#### Outputs
This class doesn't return any outputs during initialization.

#### Internal Logic
The `select` method of this class performs the following steps:
1. Parses the incoming SQL query using `SELECTQueryParser`.
2. Extracts search parameters (`by_type`, `by_code`) and filtering conditions from the parsed query.
3. Fetches the past day's oil price data from the Oil Price API using the extracted search parameters.
4. Converts the API response to a Pandas DataFrame.
5. Applies filtering, ordering, and limiting based on the extracted conditions.
6. Returns the resulting DataFrame.

## Dependencies
This code depends on the following external libraries:
| Dependency | Purpose |
|:-----------|:--------|
| pandas | Data manipulation and analysis |
| mindsdb.integrations.libs.api_handler | Provides the `APITable` base class |
| mindsdb.integrations.utilities.handlers.query_utilities | Provides utilities for parsing and executing SQL queries |
| mindsdb.utilities | Provides logging functionality |
| mindsdb_sql.parser | Provides SQL parsing functionality |

## Error Handling
Both `OilPriceLatestTable` and `OilPricePastDayPriceTable` classes have a `check_res` method that checks the response code from the Oil Price API and raises an exception if it's not 200. They also raise `ValueError` if the query contains unsupported conditions or invalid values for search parameters.

## Logging
The code uses the `mindsdb.utilities.log` module for logging purposes.
