---
title: "stripe_handler.py"
---

## High-level description
The `StripeHandler` class is an implementation of the APIHandler for integrating Stripe's payment processing services with MindsDB. It provides functionality to connect to Stripe's API, check the connection status, and execute native queries on Stripe data.

## Code Structure
The `StripeHandler` class inherits from `APIHandler` and initializes various Stripe-related tables (customers, products, payment intents, payouts, and refunds) using corresponding table classes. It also implements methods for connecting to Stripe, checking the connection, and executing native queries.

## Symbols

### `StripeHandler`
#### Description
This class represents the main handler for Stripe integration in MindsDB. It sets up the connection to Stripe and provides methods to interact with Stripe data.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | Name of the particular handler instance |
| **kwargs | dict | Arbitrary keyword arguments, including connection_data |

#### Internal Logic
1. Initializes the handler with the given name and connection data.
2. Registers various Stripe-related tables (customers, products, payment intents, payouts, refunds).
3. Provides methods to connect to Stripe, check the connection, and execute native queries.

### `StripeHandler.connect()`
#### Description
Establishes a connection to the Stripe API using the provided API key.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connection | stripe.Stripe | The Stripe API connection object |

### `StripeHandler.check_connection()`
#### Description
Checks the connection to the Stripe API by attempting to retrieve the account information.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | StatusResponse | Object containing the success status and error message if any |

### `StripeHandler.native_query(query: str)`
#### Description
Executes a native SQL query on the Stripe data.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | str | The SQL query to be executed |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | StatusResponse | The result of the query execution |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| stripe | To interact with the Stripe API |
| mindsdb_sql | For parsing SQL queries |

## Error Handling
The `check_connection()` method implements error handling by catching exceptions that may occur during the connection attempt and returning a `StatusResponse` object with the error message.

Your response should not exceed 3000 words or 4000 tokens. Focus on providing clear, concise information that can be directly inferred from the code. Include optional sections only when they provide significant value for understanding the code.