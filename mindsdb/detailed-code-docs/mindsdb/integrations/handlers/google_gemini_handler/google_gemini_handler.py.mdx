---
title: "google_gemini_handler.py"
---

## High-level description
This code implements a handler for Google's Gemini AI model, providing functionality for text generation, embedding, and vision tasks. It integrates with MindsDB's BaseMLEngine and offers various modes of operation including default (text generation), embedding, and vision.

## Code Structure
The `GoogleGeminiHandler` class inherits from `BaseMLEngine` and implements methods for model creation, prediction, and description. It uses the Google GenerativeAI Python library to interact with Gemini models. The class supports different modes of operation and handles various input formats.

## Symbols

### GoogleGeminiHandler
#### Description
This class is the main handler for Google Gemini AI integration. It provides methods for creating, predicting, and describing models using Google's Gemini AI.

#### Inputs
The class is initialized with standard arguments passed to `BaseMLEngine`.

#### Internal Logic
- Initializes default models and settings.
- Implements methods for model creation, prediction, and description.
- Handles different modes of operation: default (text generation), embedding, and vision.
- Manages API key retrieval and configuration.

### create_validation
#### Description
Static method to validate the arguments provided for model creation.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| target | str | The target column name |
| args | dict | Dictionary of arguments for model creation |

#### Internal Logic
- Checks for required arguments in the `using` clause.
- Validates the presence and mutual exclusivity of certain argument combinations.
- Raises exceptions for invalid or unknown arguments.

### create
#### Description
Method to create a new model instance.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| target | str | The target column name |
| args | dict | Dictionary of arguments for model creation |

#### Internal Logic
- Stores the provided arguments in the model storage.

### predict
#### Description
Method to generate predictions using the Gemini model.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pd.DataFrame | Input data for prediction |
| args | dict | Additional arguments for prediction |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pred_df | pd.DataFrame | Dataframe containing predictions |

#### Internal Logic
- Handles different modes of operation (default, embedding, vision).
- Processes input data and generates prompts based on the specified template or format.
- Calls the appropriate Gemini model for prediction.
- Returns results in a pandas DataFrame.

### embedding_worker
#### Description
Helper method to generate embeddings using the Gemini model.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| args | dict | Arguments for embedding generation |
| df | pd.DataFrame | Input data for embedding |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pred_df | pd.DataFrame | Dataframe containing generated embeddings |

### vision_worker
#### Description
Helper method to process vision tasks using the Gemini model.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| args | dict | Arguments for vision task |
| df | pd.DataFrame | Input data containing image URLs and optional context |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pred_df | pd.DataFrame | Dataframe containing generated descriptions or answers |

### describe
#### Description
Method to provide metadata about the model or its arguments.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| attribute | str | Optional attribute to describe ('args' or 'metadata') |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pd.DataFrame | Dataframe containing the requested information |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| os | Operating system interfaces |
| typing | Type hinting |
| PIL | Image processing |
| requests | HTTP requests |
| numpy | Numerical operations |
| io | I/O operations |
| json | JSON parsing |
| textwrap | Text wrapping and filling |
| google.generativeai | Google's Generative AI library |
| pandas | Data manipulation and analysis |
| mindsdb.integrations.libs.base | Base class for ML engines |
| mindsdb.utilities | Logging and configuration utilities |
| mindsdb.integrations.libs.llm.utils | Utility functions for LLM operations |
| concurrent.futures | Asynchronous execution |

## Error Handling
The code implements various error checks and raises exceptions with descriptive messages for invalid inputs or configurations.

## Logging
The code uses MindsDB's logging utility to log information and errors.

This handler provides a comprehensive integration with Google's Gemini AI, supporting various modes of operation and handling different input formats. It's designed to work within the MindsDB framework, providing flexibility in model creation, prediction, and metadata retrieval.