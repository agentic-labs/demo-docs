---
title: "test_gmail_handler.py"
---

## High-level description
This code defines a unit test suite for the GmailHandler class, which is part of the MindsDB integration with Gmail. The tests verify the functionality of connecting to Gmail, executing queries, retrieving tables and columns, and ensuring the handler works as expected.

## Code Structure
The code defines a single test class `EmailsTableTest` that inherits from `unittest.TestCase`. It contains several test methods that check different aspects of the GmailHandler functionality.

## Symbols

### EmailsTableTest
#### Description
This class is a test suite for the GmailHandler, containing multiple test methods to verify its functionality.

#### Internal Logic
1. Sets up the test environment in the `setUpClass` method.
2. Defines test methods for checking connection, executing native queries, getting tables, and retrieving columns.

### setUpClass
#### Description
This class method sets up the test environment by initializing the GmailHandler with test credentials.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cls | class | The class object |

#### Internal Logic
1. Defines `kwargs` with connection data including a credentials file and required scopes.
2. Initializes a GmailHandler instance with the test configuration.

### test_0_check_connection
#### Description
Tests the connection to the Gmail service.

#### Internal Logic
Asserts that the `check_connection` method of the handler returns True.

### test_1_native_query_select
#### Description
Tests the execution of a native SQL query on the Gmail data.

#### Internal Logic
1. Defines a SQL query to select emails from Google.
2. Executes the query using the handler's `native_query` method.
3. Asserts that the result type is a TABLE response.

### test_2_get_tables
#### Description
Tests the retrieval of available tables from the Gmail handler.

#### Internal Logic
Calls the `get_tables` method and asserts that the result is not an ERROR response.

### test_3_get_columns
#### Description
Tests the retrieval of columns from the 'emails' table.

#### Internal Logic
1. Retrieves columns using the `get_columns` method of the 'emails' table.
2. Defines an expected list of columns.
3. Asserts that the retrieved columns match the expected columns.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest | Provides the testing framework |
| mindsdb.integrations.handlers.gmail_handler.gmail_handler | Imports the GmailHandler class |
| mindsdb.api.executor.data_types.response_type | Imports the RESPONSE_TYPE enum |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| credentials_file | string | "mindsdb/integrations/handlers/gmail_handler/credentials.json" | Path to the Gmail API credentials file |
| scopes | list | ['https://www.googleapis.com/auth/gmail.readonly'] | OAuth scopes required for Gmail API access |

## Error Handling
The test methods use assertions to check for expected behavior. If any assertion fails, the test will raise an AssertionError.