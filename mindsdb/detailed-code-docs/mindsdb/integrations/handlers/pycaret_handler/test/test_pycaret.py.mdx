---
title: "test_pycaret.py"
---

## High-level description
This file contains unit tests for the PyCaret integration in MindsDB. It tests various machine learning tasks such as classification, regression, anomaly detection, clustering, and time series forecasting using PyCaret models within the MindsDB framework.

## Code Structure
The main class `TestPyCaret` inherits from `BaseExecutorTest` and contains test methods for different machine learning tasks. Each test method follows a similar pattern: setting up mock data, creating a model, waiting for the model to complete, and then running predictions.

## Symbols

### TestPyCaret
#### Description
A test class that inherits from `BaseExecutorTest` and contains methods to test various PyCaret models within MindsDB.

#### Internal Logic
- Uses `@pytest.mark.skipif` to skip tests if PyCaret is not installed.
- Utilizes `patch` to mock the PostgreSQL handler for data input.
- Creates models using SQL commands and tests predictions.

### wait_predictor
#### Description
A method to wait for a predictor to be created and completed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project | str | The project name |
| name | str | The model name |

#### Internal Logic
- Polls the database for the model status.
- Raises an error if the model creation fails or times out.

### run_sql
#### Description
A method to execute SQL commands and return results as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL command to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | DataFrame | The result of the SQL query |

### test_classifier
#### Description
Tests the creation and prediction of a PyCaret classification model.

#### Internal Logic
- Sets up mock data for the Iris dataset.
- Creates a classification model using SQL commands.
- Tests predictions on the created model.

### test_regression
#### Description
Tests the creation and prediction of a PyCaret regression model.

#### Internal Logic
- Sets up mock data for an insurance dataset.
- Creates a regression model using SQL commands.
- Tests predictions on the created model.

### test_anomaly
#### Description
Tests the creation and prediction of a PyCaret anomaly detection model.

#### Internal Logic
- Sets up mock data for anomaly detection.
- Creates an anomaly detection model using SQL commands.
- Tests predictions on the created model.
- Note: This test is currently skipped due to a known issue.

### test_cluster
#### Description
Tests the creation and prediction of a PyCaret clustering model.

#### Internal Logic
- Sets up mock data for clustering.
- Creates a clustering model using SQL commands.
- Tests predictions on the created model.

### test_timeseries
#### Description
Tests the creation and prediction of a PyCaret time series forecasting model.

#### Internal Logic
- Sets up mock data for time series forecasting.
- Creates a time series model using SQL commands.
- Tests predictions on the created model.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework |
| unittest.mock | Mocking objects for testing |
| pandas | Data manipulation and analysis |
| mindsdb_sql | SQL parsing and execution |

## TODOs
- There is a TODO comment in the `test_anomaly` method regarding a workaround for the 'Anomaly' column recognition issue.

This test suite provides comprehensive coverage for the PyCaret integration in MindsDB, testing various machine learning tasks and ensuring that the models can be created, trained, and used for predictions within the MindsDB ecosystem.