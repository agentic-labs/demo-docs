---
title: "rocket_chat_handler.py"
---

## High-level description
This code defines a `RocketChatHandler` class that handles connections and interactions with the Rocket Chat API. It extends the `APIChatHandler` class and provides functionality to connect to Rocket Chat, perform API calls, and manage various Rocket Chat-related tables.

## Code Structure
The `RocketChatHandler` class is the main component, which initializes connection parameters, registers tables, and provides methods for connecting to the API, checking connections, and executing queries. It uses the `RocketChat` client from the `rocketchat_API` library to interact with the Rocket Chat API.

## Symbols

### `RocketChatHandler`
#### Description
This class handles connections and interactions with the Rocket Chat API. It initializes connection parameters, registers tables, and provides methods for API interactions.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | The handler name to use |
| connection_data | dict | Connection parameters including domain, token, user_id, username, and password |

#### Internal Logic
1. Initializes connection parameters from the provided arguments.
2. Validates the presence of required connection parameters.
3. Registers various Rocket Chat-related tables.
4. Provides methods for connecting to the API, checking connections, and executing queries.

### `RocketChatHandler.get_chat_config()`
#### Description
Returns the configuration for chat polling and message retrieval.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| params | dict | Configuration parameters for chat polling and message retrieval |

### `RocketChatHandler.get_my_user_name()`
#### Description
Retrieves the username of the authenticated user.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| username | str | The username of the authenticated user |

### `RocketChatHandler.connect()`
#### Description
Creates a new Rocket Chat API client if needed and sets it as the client to use for requests.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| client | RocketChat | The Rocket Chat API client |

### `RocketChatHandler.check_connection()`
#### Description
Checks the connection to the Rocket Chat API by sending a ping request.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | StatusResponse | Indicates whether the handler is connected |

### `RocketChatHandler.native_query()`
#### Description
Executes a native SQL query by parsing it and calling the `query` method.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | str | The SQL query to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | The result of the query execution |

### `RocketChatHandler.call_api()`
#### Description
Calls the Rocket Chat API method with the given parameters and returns the results as a JSON object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| method_name | str | The name of the API method to call |
| *args | Any | Positional arguments for the API method |
| **kwargs | Any | Keyword arguments for the API method |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | dict | The JSON response from the API call |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pandas | Data manipulation and analysis |
| rocketchat_API | Interacting with the Rocket Chat API |
| mindsdb_sql | SQL parsing and execution |

## Error Handling
The code implements basic error handling, particularly in the `check_connection` method, where exceptions are caught and logged. The `call_api` method also checks for successful API responses and raises an exception if the response is not okay.