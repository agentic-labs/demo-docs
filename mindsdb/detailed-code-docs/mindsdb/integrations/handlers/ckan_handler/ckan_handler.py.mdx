---
title: "ckan_handler.py"
---

## High-level description
The `CkanHandler` class is a database handler for connecting to and interacting with CKAN (Comprehensive Knowledge Archive Network) instances. It provides methods for establishing connections, executing queries, and retrieving data from CKAN data portals.

## Code Structure
The `CkanHandler` class inherits from `DatabaseHandler` and implements methods for connecting to CKAN, executing queries, and retrieving data. It uses the `ckanapi` library to interact with CKAN instances and `pandas` for data manipulation.

## Symbols

### `CkanHandler`
#### Description
This class handles the connection and interaction with CKAN data portals. It provides methods for connecting, querying, and retrieving data from CKAN instances.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | The name of the handler instance |
| kwargs | dict | Additional arguments, including connection data |

#### Internal Logic
- Initializes connection parameters and sets up the CKAN client.
- Implements methods for connecting, disconnecting, checking connection, and executing queries.
- Uses `ckanapi` to interact with CKAN and `pandas` for data manipulation.

### `connect`
#### Description
Establishes a connection to the CKAN instance using the provided URL.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | HandlerStatusResponse | Connection status response |

### `disconnect`
#### Description
Disconnects from the CKAN instance by setting `is_connected` to False.

### `check_connection`
#### Description
Checks the connection to the CKAN instance and verifies if the datastore extension is enabled.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | HandlerStatusResponse | Connection status response |

### `query`
#### Description
Executes a query on the CKAN instance using the provided AST node.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | ASTNode | The query represented as an AST node |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | HandlerResponse | Query execution response |

### `native_query`
#### Description
Executes a native SQL query on the CKAN instance.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query_str | str | The SQL query string to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | HandlerResponse | Query execution response |

### `get_tables`
#### Description
Retrieves the list of tables (resources) available in the CKAN instance.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | HandlerResponse | List of tables in the CKAN instance |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ckanapi | Interacting with CKAN API |
| pandas | Data manipulation and DataFrame creation |
| mindsdb.integrations.libs.base | Base classes for database handlers |
| mindsdb.integrations.libs.response | Response classes for handler operations |
| mindsdb_sql.parser.ast.base | AST node representation for SQL queries |
| mindsdb_sql.render.sqlalchemy_render | SQL rendering for queries |
| mindsdb.utilities | Logging utilities |

## Error Handling
The code implements basic error handling, catching exceptions during connection and query execution. Errors are logged using the `logger` object and returned as part of the `HandlerStatusResponse` or `HandlerResponse` objects.