---
title: "webz_handler.py"
---

## High-level description
This code defines a `WebzHandler` class that handles connections and interactions with the Webz API. It provides functionality to register tables, connect to the API, execute queries, and parse results into pandas DataFrames.

## Code Structure
The `WebzHandler` class inherits from `APIHandler` and implements methods for connecting to the Webz API, checking connections, and executing native queries. It also registers two tables: `WebzPostsTable` and `WebzReviewsTable`.

## Symbols

### WebzHandler
#### Description
A class for handling connections and interactions with the Webz API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | The handler name to use |
| connection_data | dict | Connection arguments |

#### Internal Logic
1. Initializes connection arguments and registers tables.
2. Implements methods for connecting to the API, checking connections, and executing queries.
3. Parses API responses into pandas DataFrames.

### WebzHandler.connect
#### Description
Sets up the connection to the Webz API.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| client | object | The connected Webz API client |

#### Internal Logic
1. Checks if already connected.
2. Configures the Webz API client with the provided token.
3. Sets the connection status and returns the client.

### WebzHandler.check_connection
#### Description
Checks the connection to the Webz API.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | StatusResponse | Connection status response |

#### Internal Logic
1. Attempts to connect and execute a simple query.
2. Returns a `StatusResponse` object indicating success or failure.

### WebzHandler.native_query
#### Description
Executes a native SQL query on the Webz API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | str | SQL query string |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | Query execution response |

#### Internal Logic
1. Parses the SQL query.
2. Calls the `query` method with the parsed AST.

### WebzHandler.call_webz_api
#### Description
Calls the Webz API with given parameters and returns results as a pandas DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| method_name | str | API method name to call |
| params | Dict | Parameters for the API call |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pd.DataFrame | Results as a pandas DataFrame |

#### Internal Logic
1. Connects to the API.
2. Executes API calls with pagination handling.
3. Parses results into a pandas DataFrame.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| webzio | Webz API client library |
| pandas | Data manipulation and analysis |
| mindsdb_sql | SQL parsing |

## Error Handling
The code implements basic error handling, mainly through try-except blocks in the `check_connection` method. It also raises `RuntimeError` for request timeouts and `NotImplementedError` for unsupported operations.

## Performance Considerations
The code implements pagination for API calls, limiting the execution time to 60 seconds per call to prevent long-running queries.