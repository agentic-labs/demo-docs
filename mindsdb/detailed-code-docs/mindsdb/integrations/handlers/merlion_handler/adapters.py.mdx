---
title: "adapters.py"
---

## High-level description
This code defines a set of adapter classes for integrating the Merlion time series forecasting and anomaly detection library with MindsDB. Each adapter class encapsulates a specific Merlion model and provides methods for training, prediction, and data transformation.

## Code Structure
The code defines a base class `BaseMerlionForecastAdapter` for common forecasting functionality, and two subclasses `DefaultForecasterAdapter` and `SarimaForecasterAdapter` for specific Merlion models. Similarly, it defines `BaseMerlineDetectorAdapter` for anomaly detection and subclasses for specific models. Each adapter interacts with a Merlion model, converting data between MindsDB and Merlion formats.

## References
This code references the `Merlion` library for time series analysis. It uses various classes like `ProphetDetector`, `IsolationForest`, `TimeSeries`, etc., from the `merlion` module.

## Symbols

### `MerlionArguments`
#### Description
An enumeration that defines the names of arguments used by the Merlion adapters.

### `BaseMerlionForecastAdapter`
#### Description
An abstract base class for Merlion forecasting adapters. It provides common functionality for data preprocessing, model training, and prediction.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kwargs | dict | Keyword arguments for configuring the adapter. |

#### Outputs
None

#### Internal Logic
- Initializes instance variables like `max_forecast_steps`, `max_backstep`, `maxiter`, and `model`.
- Defines methods like `to_bytes`, `initialize_model`, `to_train_dataframe`, `train`, `predict`, and `__prepare_forecast_return`.
- `to_train_dataframe` rearranges the input DataFrame to place the target column at a specific index.
- `train` converts the input DataFrame to a Merlion TimeSeries object and trains the underlying Merlion model.
- `predict` performs forecasting using the trained model and returns a DataFrame with predictions and confidence intervals.

### `DefaultForecasterAdapter`
#### Description
A concrete adapter class that uses the `DefaultForecaster` model from Merlion.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kwargs | dict | Keyword arguments passed to the parent class constructor. |

#### Outputs
None

#### Internal Logic
- Initializes the `model` attribute with a `DefaultForecaster` instance using the provided configuration.

### `SarimaForecasterAdapter`
#### Description
A concrete adapter class that uses the `AutoSarima` model from Merlion.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kwargs | dict | Keyword arguments passed to the parent class constructor. |

#### Outputs
None

#### Internal Logic
- Initializes the `model` attribute with an `AutoSarima` instance using the provided configuration.

### `ProphetForecasterAdapter`
#### Description
A concrete adapter class that uses the `AutoProphet` model from Merlion.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kwargs | dict | Keyword arguments passed to the parent class constructor. |

#### Outputs
None

#### Internal Logic
- Initializes the `model` attribute with an `AutoProphet` instance using the provided configuration.

### `MSESForecasterAdapter`
#### Description
A concrete adapter class that uses the `MSES` model from Merlion.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kwargs | dict | Keyword arguments passed to the parent class constructor. |

#### Outputs
None

#### Internal Logic
- Initializes the `model` attribute with an `MSES` instance using the provided configuration.

### `BaseMerlineDetectorAdapter`
#### Description
An abstract base class for Merlion anomaly detection adapters. It provides common functionality for data preprocessing, model training, and anomaly prediction.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kwargs | dict | Keyword arguments for configuring the adapter. |

#### Outputs
None

#### Internal Logic
- Initializes instance variables like `wind_sz`, `alm_threshold`, and `model`.
- Defines methods like `train` and `predict`.
- `train` converts the input DataFrame to a Merlion TimeSeries object and trains the underlying Merlion model.
- `predict` performs anomaly detection using the trained model and returns a DataFrame with anomaly scores.

### `DefaultDetectorAdapter`
#### Description
A concrete adapter class that uses the `DefaultDetector` model from Merlion.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kwargs | dict | Keyword arguments passed to the parent class constructor. |

#### Outputs
None

#### Internal Logic
- Initializes the `model` attribute with a `DefaultDetector` instance using the provided configuration.

### `IsolationForestDetectorAdapter`
#### Description
A concrete adapter class that uses the `IsolationForest` model from Merlion.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kwargs | dict | Keyword arguments passed to the parent class constructor. |

#### Outputs
None

#### Internal Logic
- Initializes the `model` attribute with an `IsolationForest` instance using the provided configuration.

### `WindStatsDetectorAdapter`
#### Description
A concrete adapter class that uses the `WindStats` model from Merlion.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kwargs | dict | Keyword arguments passed to the parent class constructor. |

#### Outputs
None

#### Internal Logic
- Initializes the `model` attribute with a `WindStats` instance using the provided configuration.

### `ProphetDetectorAdapter`
#### Description
A concrete adapter class that uses the `ProphetDetector` model from Merlion.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kwargs | dict | Keyword arguments passed to the parent class constructor. |

#### Outputs
None

#### Internal Logic
- Initializes the `model` attribute with a `ProphetDetector` instance using the provided configuration.

## Dependencies
This code depends on the following external libraries:
| Dependency | Purpose |
|:-----------|:--------|
| merlion | Provides time series forecasting and anomaly detection models. |
| pandas | Used for data manipulation and analysis. |
| scipy.stats.norm | Used for calculating quantiles of the normal distribution. |
| enum | Used for defining enumerations. |

