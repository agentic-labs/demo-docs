---
title: "stabilityai_handler.py"
---

## High-level description
This code implements a handler for the Stability AI API, allowing integration with MindsDB. It provides functionality for various image-related tasks such as text-to-image, image-to-image, image upscaling, and image masking using the Stability AI API.

## Code Structure
The main class `StabilityAIHandler` inherits from `BaseMLEngine` and implements methods for creating, validating, and executing predictions using the Stability AI API. It uses the `StabilityAPIClient` to interact with the API and process different types of image-related tasks.

## References
- `mindsdb.integrations.libs.base.BaseMLEngine`
- `mindsdb.utilities.log`
- `mindsdb.integrations.utilities.handler_utils.get_api_key`
- `mindsdb.integrations.handlers.stabilityai_handler.stabilityai.StabilityAPIClient`

## Symbols

### StabilityAIHandler
#### Description
This class handles the integration of Stability AI with MindsDB, providing methods for creating, validating, and executing predictions for various image-related tasks.

#### Inputs
N/A (Class definition)

#### Outputs
N/A (Class definition)

#### Internal Logic
The class implements several methods:
1. `create_validation`: Validates the input arguments for creating a model.
2. `create`: Sets up the model with the provided arguments.
3. `predict`: Processes the input data and generates predictions based on the specified task.
4. `describe`: Provides information about the available engines.

### create_validation
#### Description
Validates the input arguments for creating a Stability AI model.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| target | str | The target column name |
| args | dict | Dictionary containing model arguments |
| **kwargs | dict | Additional keyword arguments |

#### Internal Logic
1. Checks if the required arguments are present.
2. Validates the specified task against available tasks.
3. Verifies the engine ID if provided.

### create
#### Description
Sets up the Stability AI model with the provided arguments.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| target | str | The target column name |
| df | Optional[pd.DataFrame] | Input DataFrame (not used in this method) |
| args | Optional[Dict] | Dictionary containing model arguments |

#### Internal Logic
1. Checks if the 'using' clause is present in the arguments.
2. Sets the 'generative' flag to True.
3. Stores the arguments in the model storage.

### predict
#### Description
Processes the input data and generates predictions based on the specified task.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pd.DataFrame | Input DataFrame containing the data to process |
| args | Optional[Dict] | Additional arguments (not used in this method) |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result_df | pd.DataFrame | DataFrame containing the predictions |

#### Internal Logic
1. Retrieves the stored arguments.
2. Calls the appropriate processing method based on the specified task.
3. Creates a result DataFrame with the predictions.

### describe
#### Description
Provides information about the available engines for the Stability AI API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| attribute | Optional[str] | Not used in this method |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| DataFrame | pd.DataFrame | Information about the available engines |

#### Internal Logic
1. Retrieves the stored arguments.
2. Creates a StabilityAPIClient instance.
3. Gets information about the specified engines.
4. Returns the information as a DataFrame.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pandas | Data manipulation and analysis |
| mindsdb.integrations.libs.base | Base class for ML engines |
| mindsdb.utilities.log | Logging functionality |
| mindsdb.integrations.utilities.handler_utils | Utility functions for handlers |
| mindsdb.integrations.handlers.stabilityai_handler.stabilityai | Stability AI API client |

## Error Handling
The code implements basic error handling by raising exceptions with descriptive messages when required arguments are missing or invalid values are provided.