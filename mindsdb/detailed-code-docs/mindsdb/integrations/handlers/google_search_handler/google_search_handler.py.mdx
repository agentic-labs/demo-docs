---
title: "google_search_handler.py"
---

## High-level description
This code implements a handler for interacting with the Google Search Console API. It provides functionality to authenticate, connect, and perform various operations such as retrieving traffic data, managing sitemaps, and executing custom queries.

## Code Structure
The main class `GoogleSearchConsoleHandler` inherits from `APIHandler` and contains methods for connecting to the API, checking the connection, executing native queries, and performing specific API operations. It also registers two tables: `SearchAnalyticsTable` and `SiteMapsTable`.

## Symbols

### GoogleSearchConsoleHandler
#### Description
This class handles connections and interactions with the Google Search Console API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | Name of the handler |
| **kwargs | dict | Additional arguments including connection_data and file_storage |

#### Internal Logic
1. Initializes connection data, credentials, and API scopes.
2. Registers tables for analytics and sitemaps.
3. Implements methods for connecting, checking connection, and executing queries.

### connect
#### Description
Sets up the connection to the Google Search Console API.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| service | googleapiclient.discovery.Resource | The Google Search Console API service object |

#### Internal Logic
1. Checks if already connected.
2. Loads or refreshes credentials.
3. Builds and returns the API service.

### check_connection
#### Description
Checks the connection to the Google Search Console API.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | StatusResponse | Connection status response |

### native_query
#### Description
Executes a native query on the Google Search Console API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | str | The query to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | Query execution response |

#### Internal Logic
1. Parses the query string to extract method name and parameters.
2. Calls the appropriate API method.
3. Returns the result as a DataFrame.

### get_traffic_data
#### Description
Retrieves traffic data from the Google Search Console API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| params | dict | Query parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | DataFrame | Traffic data as a pandas DataFrame |

### get_sitemaps
#### Description
Retrieves sitemaps data from the Google Search Console API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| params | dict | Query parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | DataFrame | Sitemaps data as a pandas DataFrame |

### submit_sitemap
#### Description
Submits a sitemap to the Google Search Console API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| params | dict | Query parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | DataFrame | Submission response as a pandas DataFrame |

### delete_sitemap
#### Description
Deletes a sitemap from the Google Search Console API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| params | dict | Query parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | DataFrame | Deletion response as a pandas DataFrame |

### call_application_api
#### Description
Calls the appropriate Google Search Console API method based on the provided method name and parameters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| method_name | str | Name of the API method to call |
| params | dict | Query parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | DataFrame | API response as a pandas DataFrame |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pandas | Data manipulation and analysis |
| google.auth.transport.requests | Google authentication |
| google.oauth2.credentials | Google OAuth2 credentials |
| googleapiclient.discovery | Google API client library |
| mindsdb.api.executor.data_types.response_type | Response type definitions |
| mindsdb.integrations.libs.api_handler | Base API handler class |
| mindsdb.integrations.libs.response | Handler response classes |
| mindsdb.utilities | Logging utilities |

## Error Handling
The code implements basic error handling, particularly in the `check_connection` method, where exceptions are caught and logged. Other methods may raise exceptions that are not explicitly handled within this file.

## Logging
The code uses the `mindsdb.utilities.log` module for logging, primarily for error messages in the `check_connection` method.