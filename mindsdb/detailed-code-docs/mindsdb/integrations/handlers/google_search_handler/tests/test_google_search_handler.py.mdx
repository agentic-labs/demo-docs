---
title: "test_google_search_handler.py"
---

## High-level description
This code defines a unit test class `GoogleSearchConsoleHandlerTest` for testing the functionality of the `GoogleSearchConsoleHandler`. It includes tests for checking the connection, retrieving tables, and executing various types of queries (select, insert, delete) on the Google Search Console API.

## Code Structure
The `GoogleSearchConsoleHandlerTest` class contains several test methods that interact with the `GoogleSearchConsoleHandler`. Each test method focuses on a specific functionality of the handler.

## Symbols

### GoogleSearchConsoleHandlerTest
#### Description
A unittest.TestCase subclass that tests the functionality of the GoogleSearchConsoleHandler.

#### Internal Logic
1. Sets up a GoogleSearchConsoleHandler instance with test credentials in the `setUpClass` method.
2. Defines test methods for various operations:
   - Checking connection
   - Getting tables
   - Executing select queries for analytics and sitemaps
   - Executing insert and delete queries for sitemaps

### test_0_check_connection
#### Description
Tests the connection to the Google Search Console API.

#### Internal Logic
Calls the `check_connection` method of the handler and asserts that it returns True.

### test_1_get_tables
#### Description
Tests the retrieval of tables from the Google Search Console API.

#### Internal Logic
Calls the `get_tables` method of the handler and asserts that the response type is not an error.

### test_2_select_analytics_query
#### Description
Tests the execution of a select query on the Analytics table.

#### Internal Logic
1. Constructs a SQL-like query string for selecting clicks data.
2. Calls the `native_query` method of the handler with the query.
3. Asserts that the response type is a table.

### test_3_select_sitemaps_query
#### Description
Tests the execution of a select query on the Sitemaps table.

#### Internal Logic
1. Constructs a SQL-like query string for selecting sitemap type data.
2. Calls the `native_query` method of the handler with the query.
3. Asserts that the response type is a table.

### test_4_insert_sitemaps_query
#### Description
Tests the execution of an insert query on the Sitemaps table.

#### Internal Logic
1. Constructs a SQL-like query string for inserting a new sitemap.
2. Calls the `native_query` method of the handler with the query.
3. Asserts that the response type is a table.

### test_5_delete_sitemaps_query
#### Description
Tests the execution of a delete query on the Sitemaps table.

#### Internal Logic
1. Constructs a SQL-like query string for deleting a sitemap.
2. Calls the `native_query` method of the handler with the query.
3. Asserts that the response type is a table.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest | Provides the testing framework |
| mindsdb.integrations.handlers.google_search_handler.google_search_handler | Contains the GoogleSearchConsoleHandler class being tested |
| mindsdb.api.executor.data_types.response_type | Provides the RESPONSE_TYPE enum for checking response types |

## Notes
1. The tests assume that the GoogleSearchConsoleHandler is properly implemented and can connect to the Google Search Console API.
2. The test credentials and file paths are placeholders and would need to be replaced with valid values in a real testing environment.
3. The tests do not verify the actual content of the responses, only that they are of the expected type (table or not error).
4. The insert and delete tests may modify actual data in the Google Search Console, so care should be taken when running these tests against a production account.