---
title: "api.py"
---

## High-level description
This code defines a `PyPI` class that interacts with the PyPI Stats API to retrieve download statistics for Python packages. It provides methods to fetch data from different endpoints of the API and convert the JSON responses into pandas DataFrames.

## Code Structure
The `PyPI` class contains methods corresponding to different API endpoints (recent, overall, python_major, python_minor, system). These methods construct the appropriate URL, make API requests, and process the responses. The `__to_dataframe` static method is used internally to convert JSON data to pandas DataFrames.

## Symbols

### `PyPI`
#### Description
A class that provides an interface to interact with the PyPI Stats API for retrieving package download statistics.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | The name of the Python package to retrieve statistics for |
| limit | int | Optional. The maximum number of rows to return in the DataFrame |

#### Internal Logic
- Constructs API endpoint URLs based on the package name
- Makes HTTP requests to the PyPI Stats API
- Processes JSON responses and converts them to pandas DataFrames
- Applies filtering and limiting to the returned data based on method parameters

### `PyPI.recent`
#### Description
Retrieves recent download statistics for the specified package.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| period | str | Optional. The desired period ('day', 'week', or 'month') |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pd.DataFrame | DataFrame containing recent download statistics |

### `PyPI.overall`
#### Description
Retrieves overall download statistics for the specified package.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mirrors | bool | Optional. Filter by mirrors |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pd.DataFrame | DataFrame containing overall download statistics |

### `PyPI.python_major`
#### Description
Retrieves download statistics by Python major version for the specified package.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| version | str | Optional. Filter by major version number |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pd.DataFrame | DataFrame containing download statistics by Python major version |

### `PyPI.python_minor`
#### Description
Retrieves download statistics by Python minor version for the specified package.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| version | str | Optional. Filter by minor.patch version number |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pd.DataFrame | DataFrame containing download statistics by Python minor version |

### `PyPI.system`
#### Description
Retrieves download statistics by operating system for the specified package.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| os | str | Optional. Filter by operating system |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pd.DataFrame | DataFrame containing download statistics by operating system |

### `PyPI.__to_dataframe`
#### Description
Static method to convert JSON data to a pandas DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| json_data | Dict | The JSON data to convert |
| index | Collection | Optional. Desired index for the DataFrame |
| limit | int | Optional. Limit the output rows of the DataFrame |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pd.DataFrame | Converted and processed DataFrame |

### `PyPI.is_connected`
#### Description
Class method to check if the PyPI Stats API is accessible.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Dict | Dictionary containing connection status and error message if applicable |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| os | For path manipulation |
| typing | For type hinting |
| numpy | For data manipulation (used in DataFrame processing) |
| pandas | For creating and manipulating DataFrames |
| requests | For making HTTP requests to the PyPI Stats API |

## Error Handling
The code includes basic error handling in the `is_connected` method, catching `requests.exceptions.RequestException` and returning a status dictionary. Other methods do not implement explicit error handling.