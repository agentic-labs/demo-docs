---
title: "test_mongodb_handler.py"
---

## High-level description
This file contains unit tests for the MongoDB handler in MindsDB. It tests various functionalities of the MongoDB handler, including connection, querying, table and column operations, and disconnection.

## Code Structure
The code is structured as a series of test classes, each focusing on a specific aspect of the MongoDB handler. It uses pytest for test organization and execution.

## Symbols

### `seed_db()`
#### Description
Seeds the test database with data from a JSON file.

#### Internal Logic
1. Constructs a MongoDB connection URI using the test credentials.
2. Connects to the database.
3. Loads seed data from a JSON file.
4. Closes the connection.

### `handler` (pytest fixture)
#### Description
A pytest fixture that sets up a MongoDB handler for testing.

#### Internal Logic
1. Calls `seed_db()` to populate the test database.
2. Creates and returns a `MongoDBHandler` instance.

### `check_valid_response(res)`
#### Description
A helper function to validate the response from handler operations.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| res | HandlerResponse | The response object to validate |

#### Internal Logic
1. Checks if the response type is TABLE and has a non-None data frame.
2. Asserts that the error code is 0.
3. Asserts that the error message is None.

### `TestMongoDBConnection`
#### Description
A test class for MongoDB connection-related functionality.

### `TestMongoDBQuery`
#### Description
A test class for MongoDB querying functionality.

### `TestMongoDBTables`
#### Description
A test class for MongoDB table operations.

### `TestMongoDBColumns`
#### Description
A test class for MongoDB column operations.

### `TestMongoDBDisconnect`
#### Description
A test class for MongoDB disconnection functionality.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework |
| json | JSON parsing for seed data |
| pymongo | MongoDB client library |
| mindsdb_sql.parser.ast | SQL AST parsing |
| mindsdb.integrations.handlers.mongodb_handler.mongodb_handler | MongoDB handler |
| mindsdb.integrations.libs.response | Response handling |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| HANDLER_KWARGS | dict | - | MongoDB connection parameters |
| expected_columns | list | - | Expected columns in the test table |

## TODOs
There are two TODO comments in the code:
1. TODO - Subscribe (before TestMongoDBConnection class)
2. TODO - Subscribe (before TestMongoDBQuery class)

These TODOs suggest that there might be additional tests or functionality related to subscription that need to be implemented.