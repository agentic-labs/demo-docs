---
title: "test_elasticsearch_handler.py"
---

## High-level description
This code defines a test suite for the ElasticsearchHandler class, which is responsible for handling connections and executing queries on Elasticsearch. The tests cover basic functionality such as checking the connection, executing native queries, and retrieving table and column information.

## Code Structure
The code defines a single test class `ElasticsearchHandlerTest` that inherits from `unittest.TestCase`. It contains several test methods that each test a specific aspect of the `ElasticsearchHandler` class.

## Symbols

### ElasticsearchHandlerTest
#### Description
This class is a test suite for the ElasticsearchHandler. It sets up a handler instance and runs various tests on its functionality.

#### Internal Logic
The class uses the `unittest` framework to define and run tests. It sets up a handler instance in the `setUpClass` method and then defines individual test methods for different functionalities.

### setUpClass
#### Description
This class method sets up the test environment by creating an instance of the ElasticsearchHandler.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cls | class | The test class itself |

#### Internal Logic
- Defines `kwargs` with a `hosts` parameter set to 'localhost:9200'
- Creates an instance of `ElasticsearchHandler` with the name 'test_elasticsearch_handler' and the defined `kwargs`

### test_0_check_connection
#### Description
Tests the `check_connection` method of the ElasticsearchHandler.

#### Internal Logic
Asserts that the `check_connection` method returns True, indicating a successful connection.

### test_1_native_query_select
#### Description
Tests the `native_query` method of the ElasticsearchHandler with a SELECT query.

#### Internal Logic
- Defines a SELECT query
- Executes the query using the handler's `native_query` method
- Asserts that the result type is `RESPONSE_TYPE.TABLE`

### test_2_get_tables
#### Description
Tests the `get_tables` method of the ElasticsearchHandler.

#### Internal Logic
- Calls the `get_tables` method
- Asserts that the result type is not `RESPONSE_TYPE.ERROR`

### test_3_get_columns
#### Description
Tests the `get_columns` method of the ElasticsearchHandler.

#### Internal Logic
- Calls the `get_columns` method with the table name 'kibana_sample_data_ecommerce'
- Asserts that the result type is not `RESPONSE_TYPE.ERROR`

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest | Provides the testing framework |
| mindsdb.integrations.handlers.elasticsearch_handler.elasticsearch_handler | Contains the ElasticsearchHandler class being tested |
| mindsdb.api.executor.data_types.response_type | Provides the RESPONSE_TYPE enum for checking response types |

## Error Handling
The test methods use assertions to check for expected outcomes. If any assertion fails, the test will raise an AssertionError.

## TODOs
There are no explicit TODOs in this code.

This test suite provides basic coverage for the main functionalities of the ElasticsearchHandler. It checks the connection, query execution, and metadata retrieval methods. However, it relies on a local Elasticsearch instance being available at 'localhost:9200' and assumes the presence of a 'kibana_sample_data_ecommerce' index. For more robust testing, consider adding more comprehensive tests, error case handling, and possibly using mocking to avoid reliance on an actual Elasticsearch instance.