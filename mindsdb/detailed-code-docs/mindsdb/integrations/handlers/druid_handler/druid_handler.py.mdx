---
title: "druid_handler.py"
---

## High-level description
This code implements a handler for connecting MindsDB to Apache Druid, a real-time analytics database. It provides functionality to establish a connection, execute queries, and retrieve metadata about tables and columns in Druid.

## Code Structure
The `DruidHandler` class inherits from `DatabaseHandler` and implements methods for connecting to Druid, executing queries, and retrieving schema information. It uses the `pydruid` library to interact with Druid.

## Symbols

### `DruidHandler`
#### Description
This class handles the connection and execution of Apache Druid statements for MindsDB.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | Name of the handler instance |
| connection_data | Optional[dict] | Parameters for connecting to the database |

#### Internal Logic
- Initializes connection parameters and establishes a connection to Druid
- Implements methods for connecting, disconnecting, checking connection, executing queries, and retrieving schema information

### `DruidHandler.connect()`
#### Description
Establishes a connection to the Druid database using the provided connection parameters.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connection | pydruid.db.connect | Druid database connection object |

### `DruidHandler.disconnect()`
#### Description
Closes the existing connection to the Druid database.

### `DruidHandler.check_connection()`
#### Description
Checks if a connection can be established to the Druid database.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | StatusResponse | Connection status response |

### `DruidHandler.native_query()`
#### Description
Executes a raw SQL query on the Druid database and returns the result.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | str | SQL query to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | Query execution response |

### `DruidHandler.query()`
#### Description
Executes a query represented as an AST (Abstract Syntax Tree) on the Druid database.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | ASTNode | SQL query represented as an AST |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | StatusResponse | Query execution response |

### `DruidHandler.get_tables()`
#### Description
Retrieves a list of tables available in the Druid database.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | StatusResponse | List of tables |

### `DruidHandler.get_columns()`
#### Description
Retrieves the list of columns for a specified table in the Druid database.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| table_name | str | Name of the table |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | StatusResponse | List of columns |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pydruid | Python library for interacting with Apache Druid |
| pandas | Data manipulation and analysis library |
| mindsdb_sql | SQL parsing and rendering library |

## Error Handling
The code implements basic error handling, catching exceptions during connection and query execution. Errors are logged and returned as part of the response objects.

## Logging
The code uses the `log` module from `mindsdb.utilities` for logging error messages.