---
title: "api.py"
---

## High-level description
This code defines the `Lightdash` class, which provides a Python interface for interacting with the Lightdash API. It allows users to perform various operations related to Lightdash, such as checking connectivity, retrieving user and organization details, managing projects, spaces, charts, and schedulers.

## Code Structure
The `Lightdash` class encapsulates all the functionality for interacting with the Lightdash API. It uses the `requests` library to make HTTP requests to the API endpoints. The class methods are organized based on the specific API functionality they provide, such as getting user details, retrieving projects, or managing schedulers.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| requests | Used to make HTTP requests to the Lightdash API. |
| urllib.parse | Used for URL manipulation, specifically `urljoin` for constructing API endpoint URLs. |

## Symbols
### `Lightdash`
#### Description
This class provides a Python interface for interacting with the Lightdash API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| url | str | The base URL of the Lightdash instance. |
| api_key | str | The API key for authentication. |

#### Outputs
The class itself does not return any output. Its methods, however, return data retrieved from the Lightdash API or status codes indicating the success or failure of the API calls.

#### Internal Logic
The class initializes with the base URL and API key. It uses a private `_request` method to handle the HTTP requests to the API, taking care of authentication and data serialization. The remaining methods are wrappers around specific API endpoints, providing a more convenient way to interact with the API.

### `Lightdash._request`
#### Description
This private method handles the HTTP requests to the Lightdash API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| method | str | The HTTP method for the request (e.g., "get", "post"). |
| relative_endpoint | str | The relative endpoint URL for the API request. |
| data | optional, any | The data to be sent with the request body. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | requests.Response | The response object from the `requests` library containing the API response. |

#### Internal Logic
The method constructs the full API endpoint URL using `urljoin`, sets the authorization header with the API key, and makes the HTTP request using the `requests.request` method. It returns the response object received from the API.

### `Lightdash.is_connected`
#### Description
This method checks if the connection to the Lightdash API is successful.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connected | bool | True if the connection is successful, False otherwise. |

#### Internal Logic
The method calls the `get_user` method and checks if it returns a non-empty dictionary. If it does, it means the API call was successful, and the connection is established.

### `Lightdash.get_user`
#### Description
This method retrieves the details of the authenticated user.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user_details | dict | A dictionary containing the user's details, or an empty dictionary if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/user" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_org`
#### Description
This method retrieves the details of the user's organization.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| org_details | dict | A dictionary containing the organization's details, or an empty dictionary if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/org" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_projects`
#### Description
This method retrieves the details of all projects in the user's organization.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| projects | list | A list of dictionaries, where each dictionary represents a project, or an empty list if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/org/projects" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_org_members`
#### Description
This method retrieves the details of all members in the user's organization.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| members | list | A list of dictionaries, where each dictionary represents a member, or an empty list if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/org/users" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_project`
#### Description
This method retrieves the details of a specific project by its UUID.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project_uuid | str | The UUID of the project to retrieve. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project_details | dict | A dictionary containing the project's details, or an empty dictionary if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/projects/{project_uuid}" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_charts_in_project`
#### Description
This method retrieves a list of all charts in a specific project.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project_uuid | str | The UUID of the project. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| charts | list | A list of dictionaries, where each dictionary represents a chart, or an empty list if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/projects/{project_uuid}/charts" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_spaces_in_project`
#### Description
This method retrieves a list of all spaces in a specific project.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project_uuid | str | The UUID of the project. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| spaces | list | A list of dictionaries, where each dictionary represents a space, or an empty list if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/projects/{project_uuid}/spaces" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_project_access_list`
#### Description
This method retrieves the access list for a specific project, listing users with explicit access.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project_uuid | str | The UUID of the project. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| access_list | list | A list of dictionaries, where each dictionary represents a user with access, or an empty list if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/projects/{project_uuid}/access" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_validation_results`
#### Description
This method retrieves the validation results for a specific project.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project_uuid | str | The UUID of the project. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| validation_results | list | A list of dictionaries, where each dictionary represents a validation result, or an empty list if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/projects/{project_uuid}/validate" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_space`
#### Description
This method retrieves the details of a specific space within a project.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project_uuid | str | The UUID of the project. |
| space_uuid | str | The UUID of the space. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| space_details | dict | A dictionary containing the space's details, or an empty dictionary if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/projects/{project_uuid}/spaces/{space_uuid}" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_chart_version_history`
#### Description
This method retrieves the version history of a specific chart for the last 30 days.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| chart_uuid | str | The UUID of the chart. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| version_history | list | A list of dictionaries, where each dictionary represents a version in the chart's history, or an empty list if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/saved/{chart_uuid}/history" endpoint and returns the "history" field from the "results" field in the JSON response if the request is successful.

### `Lightdash.get_chart`
#### Description
This method retrieves the details of a specific chart version.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| chart_uuid | str | The UUID of the chart. |
| version_uuid | str | The UUID of the chart version. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| chart_details | dict | A dictionary containing the chart version's details, or an empty dictionary if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/saved/{chart_uuid}/version/{version_uuid}" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_scheduler_logs`
#### Description
This method retrieves the scheduled logs for a specific project.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project_uuid | str | The UUID of the project. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| scheduler_logs | dict | A dictionary containing the scheduler logs, or an empty dictionary if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/schedulers/{project_uuid}/logs" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_scheduler`
#### Description
This method retrieves the details of a specific scheduler.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| scheduler_uuid | str | The UUID of the scheduler. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| scheduler_details | dict | A dictionary containing the scheduler's details, or an empty dictionary if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/schedulers/{scheduler_uuid}" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_scheduler_jobs`
#### Description
This method retrieves the jobs scheduled by a specific scheduler.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| scheduler_uuid | str | The UUID of the scheduler. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| scheduled_jobs | list | A list of dictionaries, where each dictionary represents a scheduled job, or an empty list if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/schedulers/{scheduler_uuid}/jobs" endpoint and returns the "results" field from the JSON response if the request is successful.

### `Lightdash.get_scheduler_job_status`
#### Description
This method retrieves the status of a specific scheduler job.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| job_id | str | The ID of the scheduler job. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| job_status | dict |A dictionary containing the job status, or an empty dictionary if the request fails. |

#### Internal Logic
The method makes a GET request to the "/api/v1/schedulers/job/{job_id}/status" endpoint and returns the "results" field from the JSON response if the request is successful.

## Error Handling
The `Lightdash` class implements basic error handling by checking the `ok` status of the HTTP response. If the response is not successful, most methods return an empty dictionary or list, depending on the expected return type. This approach allows the calling code to handle errors gracefully without raising exceptions.

## Logging
The code does not implement any explicit logging mechanisms. However, it could be beneficial to add logging for failed API requests and other important events to aid in debugging and monitoring.

## API/Interface Reference
The `Lightdash` class serves as a Python interface to the Lightdash API. Each method corresponds to a specific API endpoint. Here's a summary of the available methods:

| Method | Description |
|:-------|:------------|
| is_connected() | Check if the connection to Lightdash is successful |
| get_user() | Retrieve authenticated user details |
| get_org() | Retrieve organization details |
| get_projects() | List all projects in the organization |
| get_org_members() | List all members in the organization |
| get_project(project_uuid) | Retrieve details of a specific project |
| get_charts_in_project(project_uuid) | List all charts in a project |
| get_spaces_in_project(project_uuid) | List all spaces in a project |
| get_project_access_list(project_uuid) | Get access list for a project |
| get_validation_results(project_uuid) | Get validation results for a project |
| get_space(project_uuid, space_uuid) | Get details of a specific space |
| get_chart_version_history(chart_uuid) | Get version history of a chart |
| get_chart(chart_uuid, version_uuid) | Get details of a specific chart version |
| get_scheduler_logs(project_uuid) | Get scheduler logs for a project |
| get_scheduler(scheduler_uuid) | Get details of a specific scheduler |
| get_scheduler_jobs(scheduler_uuid) | List jobs for a specific scheduler |
| get_scheduler_job_status(job_id) | Get status of a specific scheduler job |

All methods use the API key provided during initialization for authentication.

## Performance Considerations
The code makes individual API calls for each operation, which could lead to performance issues if many operations are performed in quick succession. Consider implementing batch operations or caching mechanisms for frequently accessed data to improve performance in high-volume scenarios.

## Side Effects
The code primarily performs read operations and does not modify any server-side data. However, it's worth noting that repeated API calls may impact rate limits or usage quotas on the Lightdash server.

## Configuration
The `Lightdash` class is configured through its constructor:

| Option | Type | Description |
|:-------|:-----|:------------|
| url | str | The base URL of the Lightdash instance |
| api_key | str | The API key for authentication |

These parameters are used to construct the base URL for API requests and set the authorization header for all requests.

In conclusion, this `Lightdash` class provides a comprehensive Python interface to interact with various aspects of a Lightdash instance, including user management, project management, chart and space operations, and scheduler functionality. It encapsulates the complexity of making HTTP requests and handling responses, providing a more convenient and Pythonic way to interact with the Lightdash API.