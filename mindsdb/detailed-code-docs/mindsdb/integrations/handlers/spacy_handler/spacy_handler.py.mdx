---
title: "spacy_handler.py"
---

## High-level description

The `spacy_handler.py` file implements a SpacyHandler class that integrates the spaCy Natural Language Processing (NLP) library with MindsDB. It provides various linguistic features such as named entity recognition, lemmatization, dependency parsing, part-of-speech tagging, and morphological analysis using spaCy's pre-trained models.

## Code Structure

The code is structured around the `SpacyHandler` class, which inherits from `BaseMLEngine`. It defines methods for creating and predicting with spaCy models. The file also includes several helper functions for different linguistic features, which are used within the `predict` method of the `SpacyHandler` class.

## Symbols

### SpacyHandler
#### Description
This class integrates spaCy with MindsDB, allowing users to perform various NLP tasks using spaCy models.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| *args | Any | Variable length argument list |
| **kwargs | Any | Arbitrary keyword arguments |

#### Internal Logic
- Initializes with default linguistic feature set to "ner" (Named Entity Recognition)
- Implements `create_validation`, `create`, and `predict` methods
- Uses spaCy models for NLP tasks
- Serializes and deserializes spaCy models for storage and retrieval

### named_entity_recognition
#### Description
Performs Named Entity Recognition on a spaCy document.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| doc | spacy.tokens.Doc | A spaCy document |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pred_whole | set | Set of tuples containing entity information |
| output | dict | Dictionary containing detailed entity information |

### lemmatization
#### Description
Performs lemmatization on a spaCy document.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| doc | spacy.tokens.Doc | A spaCy document |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pred_whole | set | Set of lemmas |
| output | dict | Dictionary containing lemmas |

### dependency_parsing
#### Description
Performs dependency parsing on a spaCy document.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| doc | spacy.tokens.Doc | A spaCy document |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pred_whole | set | Set of tuples containing dependency information |
| output | dict | Dictionary containing detailed dependency information |

### pos_tagging
#### Description
Performs part-of-speech tagging on a spaCy document.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| doc | spacy.tokens.Doc | A spaCy document |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pred_whole | set | Set of tuples containing POS information |
| output | dict | Dictionary containing detailed POS information |

### morphology
#### Description
Performs morphological analysis on a spaCy document.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| doc | spacy.tokens.Doc | A spaCy document |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pred_whole | set | Set of tuples containing morphological information |
| output | dict | Dictionary containing detailed morphological information |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| spacy | NLP library for linguistic analysis |
| pandas | Data manipulation and analysis |
| mindsdb.integrations.libs.base | Base class for ML engines in MindsDB |
| typing | Type hinting |

## Error Handling
The `create_validation` method implements basic error checking:
- Ensures that the 'using' clause is present in the arguments
- Checks for the presence of 'linguistic_feature' and 'target_column' in the arguments

## API/Interface Reference
The main interface is through the `SpacyHandler` class:

| Method | Description |
|:-------|:------------|
| create_validation | Validates input arguments for creating a model |
| create | Creates and serializes a spaCy model |
| predict | Performs linguistic analysis on input data using the specified feature |

The `predict` method is the primary interface for performing NLP tasks on input data.