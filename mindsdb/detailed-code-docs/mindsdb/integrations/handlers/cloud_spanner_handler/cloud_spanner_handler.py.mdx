---
title: "cloud_spanner_handler.py"
---

## High-level description
This code implements a handler for connecting to and interacting with Google Cloud Spanner databases in the MindsDB ecosystem. It provides functionality for executing SQL queries, managing connections, and retrieving database metadata.

## Code Structure
The main class `CloudSpannerHandler` inherits from `DatabaseHandler` and implements methods for connecting to Cloud Spanner, executing queries, and retrieving database information. It uses the Google Cloud Spanner API and SQLAlchemy for database operations.

## Symbols

### CloudSpannerHandler
#### Description
This class handles connections and executions of Cloud Spanner statements. It provides methods for connecting to the database, executing queries, and retrieving database metadata.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | The name of the handler |
| connection_data | dict | Connection details for the Cloud Spanner database |

#### Internal Logic
- Initializes the connection using the provided credentials
- Implements methods for connecting, disconnecting, and checking the connection
- Provides methods for executing native SQL queries and parsed AST queries
- Implements methods for retrieving table and column information

### connect
#### Description
Establishes a connection to the Cloud Spanner database using the provided credentials.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connection | Connection | The database connection object |

### disconnect
#### Description
Closes the database connection if it exists.

### check_connection
#### Description
Checks the connection to the Cloud Spanner database and returns a status response.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | StatusResponse | Connection success status and error message if applicable |

### native_query
#### Description
Executes a raw SQL query on the Cloud Spanner database.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | str | The SQL query to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | The query result or error message |

### query
#### Description
Renders and executes a parsed SQL query (AST) on the Cloud Spanner database.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | ASTNode | The parsed SQL query |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | The query result or error message |

### get_tables
#### Description
Retrieves a list of all tables in the connected Cloud Spanner database.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | A list of table names |

### get_columns
#### Description
Retrieves column information for a specified table in the Cloud Spanner database.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| table_name | str | The name of the table to retrieve column information for |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | Column details including name, type, and nullable status |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| google.oauth2 | For handling Google Cloud authentication |
| google.cloud.spanner_dbapi | For connecting to Cloud Spanner databases |
| google.cloud.sqlalchemy_spanner | For SQLAlchemy dialect specific to Cloud Spanner |
| pandas | For data manipulation and creating DataFrames |
| mindsdb_sql | For SQL parsing and rendering |

## Error Handling
The code implements error handling in various methods, catching exceptions and returning appropriate error responses. Errors are logged using the `logger` object.

## Logging
The code uses a logger object to log error messages, particularly when there are issues connecting to the database or executing queries.

___

This handler provides a comprehensive interface for interacting with Google Cloud Spanner databases within the MindsDB ecosystem, allowing for seamless integration and data manipulation.