---
title: "mssql_handler.py"
---

## High-level description
This code defines a `SqlServerHandler` class that handles connections and executions of Microsoft SQL Server statements. It provides methods for connecting to a SQL Server database, executing queries, and retrieving information about tables and columns.

## Code Structure
The `SqlServerHandler` class inherits from `DatabaseHandler` and implements various methods for database operations. It uses the `pymssql` library for connecting to and interacting with SQL Server databases. The class also utilizes `mindsdb_sql` for SQL parsing and rendering.

## Symbols

### SqlServerHandler
#### Description
This class handles connections and operations for Microsoft SQL Server databases.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | The name of the handler |
| **kwargs | dict | Additional arguments, including connection data |

#### Internal Logic
- Initializes connection parameters and sets up a SQL parser and renderer.
- Provides methods for connecting, disconnecting, checking connections, and executing queries.
- Implements methods for retrieving table and column information.

### connect
#### Description
Establishes a connection to the Microsoft SQL Server database.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connection | pymssql.Connection | A connection object to the SQL Server database |

#### Internal Logic
- Checks if already connected
- Validates required connection parameters
- Attempts to establish a connection using pymssql
- Sets the connection status

### disconnect
#### Description
Closes the connection to the Microsoft SQL Server database.

#### Internal Logic
- Checks if connected
- Closes the connection and updates the connection status

### check_connection
#### Description
Checks the status of the connection to the database.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | StatusResponse | An object containing the success status and error message if applicable |

#### Internal Logic
- Attempts to connect and execute a simple query
- Returns a StatusResponse object with the connection status

### native_query
#### Description
Executes a raw SQL query on the database.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | str | The SQL query to be executed |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | A response object containing the query result or error message |

#### Internal Logic
- Connects to the database
- Executes the query and fetches results
- Handles exceptions and creates an appropriate Response object

### query
#### Description
Executes a SQL query represented by an ASTNode.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | ASTNode | An ASTNode representing the SQL query |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | The response from executing the native query |

#### Internal Logic
- Renders the ASTNode to a SQL string
- Calls the native_query method with the rendered string

### get_tables
#### Description
Retrieves a list of all non-system tables and views in the current schema.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | A response object containing the list of tables and views |

#### Internal Logic
- Executes a SQL query to fetch table information from INFORMATION_SCHEMA.TABLES
- Returns the result as a Response object

### get_columns
#### Description
Retrieves column details for a specified table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| table_name | str | The name of the table for which to retrieve column information |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | A response object containing the column details |

#### Internal Logic
- Executes a SQL query to fetch column information from information_schema.columns
- Returns the result as a Response object

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pymssql | For connecting to and interacting with SQL Server databases |
| pandas | For data manipulation and creating DataFrames |
| mindsdb_sql | For SQL parsing and rendering |

## Error Handling
The class implements error handling in various methods, particularly in `connect`, `check_connection`, and `native_query`. Exceptions are caught, logged, and appropriate error responses are returned.

## Logging
The class uses a logger (from `mindsdb.utilities.log`) to log error messages and debug information.

This documentation provides a comprehensive overview of the `SqlServerHandler` class and its methods, focusing on their purpose, inputs, outputs, and internal logic. The class is designed to facilitate interactions with Microsoft SQL Server databases within the MindsDB framework.