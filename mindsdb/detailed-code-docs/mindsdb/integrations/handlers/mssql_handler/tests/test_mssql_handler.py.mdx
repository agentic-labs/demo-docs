---
title: "test_mssql_handler.py"
---

## High-level description
This file contains unit tests for the SqlServerHandler class, which is responsible for handling connections and executing queries on Microsoft SQL Server databases. The tests cover various functionalities such as connecting, disconnecting, querying tables, and executing native SQL queries.

## Code Structure
The code is organized into several test classes, each focusing on a specific aspect of the SqlServerHandler:
1. TestMSSQLHandlerConnect: Tests connection-related functionality
2. TestMSSQLHandlerDisconnect: Tests disconnection-related functionality
3. TestMSSQLHandlerTables: Tests table-related operations
4. TestMSSQLHandlerQuery: Tests query execution

Each class contains multiple test methods that verify different aspects of the handler's functionality.

## Symbols

### `seed_db()`
#### Description
This function seeds the test database with initial data using a SQL script.

#### Internal Logic
1. Connects to the 'master' database
2. Reads and executes SQL statements from a seed file
3. Closes the connection

### `check_valid_response(res)`
#### Description
Validates the response object returned by the handler methods.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| res | Response | The response object to validate |

#### Internal Logic
1. Checks if the response type is TABLE and contains data
2. Verifies that the error code is 0
3. Ensures that the error message is None

### `get_table_names(sql_server_handler)`
#### Description
Retrieves a list of table names from the database.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql_server_handler | SqlServerHandler | The handler instance to use for querying |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| table_names | list | A list of table names in the database |

#### Internal Logic
1. Calls the `get_tables()` method of the handler
2. Extracts the 'table_name' column from the response
3. Returns the list of table names

### `TestMSSQLHandlerConnect`
#### Description
Tests the connection functionality of the SqlServerHandler.

#### Internal Logic
1. Tests the `connect()` method
2. Verifies the `check_connection()` method

### `TestMSSQLHandlerDisconnect`
#### Description
Tests the disconnection functionality of the SqlServerHandler.

#### Internal Logic
1. Tests the `disconnect()` method
2. Verifies the `check_connection()` method after disconnection

### `TestMSSQLHandlerTables`
#### Description
Tests table-related operations of the SqlServerHandler.

#### Internal Logic
1. Tests `get_tables()` method
2. Tests `get_columns()` method
3. Tests table creation
4. Tests table deletion

### `TestMSSQLHandlerQuery`
#### Description
Tests query execution functionality of the SqlServerHandler.

#### Internal Logic
1. Tests `native_query()` method with a SELECT statement
2. Verifies the returned data against expected results

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework |
| pymssql | Microsoft SQL Server database driver |
| pandas | Data manipulation and analysis |
| mindsdb.integrations.handlers.mssql_handler.mssql_handler | SqlServerHandler class |
| mindsdb.integrations.libs.response | Response types and classes |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| MDB_TEST_MSSQL_HOST | str | "localhost" | Test database host |
| MDB_TEST_MSSQL_PORT | str | "1433" | Test database port |
| MDB_TEST_MSSQL_USER | str | "sa" | Test database user |
| MDB_TEST_MSSQL_PASSWORD | str | "admin5678@" | Test database password |
| MDB_TEST_MSSQL_DATABASE | str | "mdb_db_handler_test" | Test database name |

These configuration options are set as environment variables and used to establish a connection to the test database.

## TODOs
There are no explicit TODOs in the code.