---
title: "Overview"
---

## High-level description
This directory contains unit tests for the Confluence Handler, which is responsible for interacting with the Confluence API. The tests cover various functionalities such as connecting to Confluence, retrieving data (spaces and pages), and modifying data (inserting, updating, and deleting pages).

## What does it do?
The tests in this directory verify that the Confluence Handler can correctly:
1. Connect to a Confluence instance using provided credentials
2. Retrieve information about spaces and pages from Confluence
3. Insert new pages into Confluence (currently commented out due to an issue)
4. Update existing pages in Confluence
5. Delete pages from Confluence

These tests ensure that the Confluence Handler can perform all necessary operations to interact with a Confluence instance, allowing MindsDB to integrate with Confluence data effectively.

## Key Files
1. `test_confluence_handler.py`: This is the main file containing all the unit tests for the Confluence Handler. It includes a test class `ConfluenceHandlerTest` with various test methods, each focusing on a specific functionality of the Confluence Handler.

## Dependencies
The tests rely on the following dependencies:
1. `unittest`: Python's built-in unit testing framework, used to structure and run the tests.
2. `mindsdb.api.executor.data_types.response_type.RESPONSE_TYPE`: Used to check the type of responses from the handler.
3. Environment variables: The tests use environment variables for authentication and connection details to the Confluence instance.

## Configuration
The tests require the following environment variables to be set:
- Confluence connection details (likely including URL, username, and API token)

These environment variables are used to establish a connection to a Confluence instance for testing purposes.

## Additional Notes
1. Test Structure: Each test method in the `ConfluenceHandlerTest` class follows the arrange-act-assert pattern:
   - Arrange: Set up the necessary objects and data for the test.
   - Act: Call the method being tested.
   - Assert: Verify the expected outcome of the method call.

2. Test Coverage: The tests cover the following operations:
   - Connecting to Confluence
   - Retrieving spaces
   - Retrieving pages
   - Inserting pages (currently commented out)
   - Updating pages
   - Deleting pages

3. TODO: The `test_insert_page` method is currently commented out due to an issue with the `insert` native query. This test should be uncommented and fixed once the underlying issue is resolved.

4. Error Handling: The tests check for successful operations by verifying that the response type is not an error. This approach ensures that the Confluence Handler can handle various scenarios without raising exceptions.

5. Data Verification: Some tests, such as `test_get_pages`, not only check for successful execution but also verify the structure and content of the returned data. This ensures that the Confluence Handler is correctly parsing and returning the expected information from the Confluence API.

Here's an example of how a test method is structured:

```python
def test_get_spaces(self):
    result = self.handler.native_query("SELECT * FROM spaces")
    assert result.type != RESPONSE_TYPE.ERROR
```

This test method executes a native query to retrieve all spaces from Confluence and asserts that the response is not an error, indicating successful retrieval of spaces.

The test suite provides comprehensive coverage of the Confluence Handler's functionality, ensuring its reliability and correctness when interacting with Confluence instances. By maintaining and expanding these tests, developers can confidently make changes to the Confluence Handler while ensuring its continued functionality.