---
title: "google_books_handler.py"
---

## High-level description
The `GoogleBooksHandler` class is a handler for interacting with the Google Books API. It provides functionality to authenticate, connect, and retrieve data from Google Books, including bookshelves and volumes. The handler extends the `APIHandler` class and implements methods for connection, authentication, and data retrieval.

## Code Structure
The main class `GoogleBooksHandler` inherits from `APIHandler`. It initializes connection data, registers tables for bookshelves and volumes, and provides methods for connecting, checking connection, and executing queries. The class also includes methods for retrieving bookshelves and volumes data from the Google Books API.

## Symbols

### GoogleBooksHandler
#### Description
This class handles connections and interactions with the Google Books API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | Name of the handler |
| **kwargs | dict | Additional arguments, including connection data |

#### Internal Logic
1. Initializes connection data and credentials.
2. Sets up scopes for API access.
3. Registers tables for bookshelves and volumes.

### connect
#### Description
Sets up the connection to the Google Books API using the provided credentials.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| service | googleapiclient.discovery.Resource | Google Books API service object |

#### Internal Logic
1. Checks if already connected.
2. Loads or refreshes credentials.
3. Builds and returns the Google Books API service.

### check_connection
#### Description
Checks the connection to the Google Books API.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | StatusResponse | Connection status response |

#### Internal Logic
1. Attempts to connect to the API.
2. Returns a success or error status.

### native_query
#### Description
Executes a native query on the Google Books API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | str | Native query string |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| response | Response | Query response with data |

#### Internal Logic
1. Parses the query string to extract method name and parameters.
2. Calls the appropriate API method.
3. Returns the result as a DataFrame.

### get_bookshelves
#### Description
Retrieves bookshelves data from the Google Books API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| params | dict | Query parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | DataFrame | Bookshelves data |

#### Internal Logic
1. Connects to the API.
2. Retrieves bookshelves based on provided parameters.
3. Filters results if shelf range is specified.
4. Returns data as a DataFrame.

### get_volumes
#### Description
Retrieves volumes data from the Google Books API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| params | dict | Query parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | DataFrame | Volumes data |

#### Internal Logic
1. Connects to the API.
2. Retrieves volumes based on provided parameters.
3. Returns data as a DataFrame.

### call_application_api
#### Description
Calls the appropriate Google Books API method based on the provided method name.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| method_name | str | Name of the API method to call |
| params | dict | Query parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | DataFrame | API call result as a DataFrame |

#### Internal Logic
1. Calls either `get_bookshelves` or `get_volumes` based on the method name.
2. Raises an error for unknown methods.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| google.auth.transport.requests | For handling Google API requests |
| google.oauth2 | For Google OAuth2 authentication |
| googleapiclient.discovery | For building Google API service |
| pandas | For data manipulation and DataFrame creation |
| mindsdb.api.executor.data_types.response_type | For response type constants |
| mindsdb.integrations.libs.api_handler | For base API handler functionality |
| mindsdb.integrations.libs.response | For handler response types |
| mindsdb.utilities | For logging |

## Error Handling
The code implements basic error handling, primarily in the `check_connection` method, where exceptions are caught and logged. Other methods may raise exceptions that are not explicitly handled within this file.

## Logging
The code uses the `log` module from `mindsdb.utilities` for logging. It creates a logger instance for this module.