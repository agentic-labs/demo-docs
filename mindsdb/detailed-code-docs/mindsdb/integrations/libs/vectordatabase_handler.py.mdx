---
title: "vectordatabase_handler.py"
---

Here's a comprehensive documentation for the `VectorStoreHandler` class:

## High-level description
The `VectorStoreHandler` class is a base class for handlers associated with vector databases. It provides a common interface and implementation for various vector database operations, including creating tables, inserting data, querying, updating, and deleting records.

## Code Structure
The `VectorStoreHandler` class inherits from `BaseHandler` and defines several methods for interacting with vector databases. It uses a predefined schema for vector database tables and implements methods to handle SQL-like queries, translating them into vector database operations.

## Symbols

### VectorStoreHandler
#### Description
This class serves as a base for vector database handlers, providing common functionality and a standardized interface for vector database operations.

#### Internal Logic
- Defines a schema for vector database tables with fields for ID, content, embeddings, and metadata.
- Implements methods to handle various SQL-like operations (CREATE, INSERT, UPDATE, DELETE, SELECT) on vector databases.
- Provides utility methods for parsing and translating SQL conditions to vector database-specific filters.

### TableField (Enum)
#### Description
An enumeration defining the standard fields used in vector database tables.

#### Attributes
- ID: "id"
- CONTENT: "content"
- EMBEDDINGS: "embeddings"
- METADATA: "metadata"
- SEARCH_VECTOR: "search_vector"
- DISTANCE: "distance"

### _dispatch_create_table
#### Description
Handles the creation of a new table in the vector database.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | CreateTable | AST node representing the CREATE TABLE query |

#### Internal Logic
- Extracts table name and "if not exists" flag from the query.
- Calls the `create_table` method with the extracted parameters.

### _dispatch_drop_table
#### Description
Handles the dropping of a table from the vector database.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | DropTables | AST node representing the DROP TABLE query |

#### Internal Logic
- Extracts table name and "if exists" flag from the query.
- Calls the `drop_table` method with the extracted parameters.

### _dispatch_insert
#### Description
Handles the insertion of data into a vector database table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | Insert | AST node representing the INSERT query |

#### Internal Logic
- Extracts table name, columns, and values from the query.
- Validates the columns against the allowed schema.
- Processes the data, including content, IDs, embeddings, and metadata.
- Calls the `do_upsert` method with the processed data.

### _dispatch_update
#### Description
Handles the updating of data in a vector database table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | Update | AST node representing the UPDATE query |

#### Internal Logic
- Extracts table name, update columns, and conditions from the query.
- Processes the update data and conditions.
- Calls the `do_upsert` method with the processed data.

### _dispatch_delete
#### Description
Handles the deletion of data from a vector database table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | Delete | AST node representing the DELETE query |

#### Internal Logic
- Extracts table name and conditions from the query.
- Calls the `delete` method with the extracted parameters.

### _dispatch_select
#### Description
Handles the selection of data from a vector database table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | Select | AST node representing the SELECT query |

#### Internal Logic
- Extracts table name, columns, conditions, offset, and limit from the query.
- Validates the columns against the allowed schema.
- Calls the `select` method with the extracted parameters.

### do_upsert
#### Description
Performs an upsert operation (insert or update) on the vector database table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| table_name | str | Name of the table to upsert data into |
| df | pd.DataFrame | DataFrame containing the data to be upserted |

#### Internal Logic
- Generates IDs for rows without them.
- Removes duplicate IDs.
- Checks for existing IDs and splits the data into update and insert operations.
- Calls `update` and `insert` methods as needed.

## Dependencies
The class relies on several external libraries and modules:
- pandas
- mindsdb_sql
- mindsdb.integrations.libs.response
- mindsdb.utilities

## Error Handling
The class implements basic error handling, raising exceptions for unsupported operations or invalid inputs. It also uses a logging mechanism to record errors and important information.

## Performance Considerations
The class implements batching for insert operations, which can improve performance when dealing with large datasets. However, the performance of individual operations will largely depend on the specific vector database implementation in the subclasses.

This documentation provides a comprehensive overview of the `VectorStoreHandler` class, its methods, and its role in providing a standardized interface for vector database operations within the MindsDB framework.