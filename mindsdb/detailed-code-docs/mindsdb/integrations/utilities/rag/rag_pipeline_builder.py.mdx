---
title: "rag_pipeline_builder.py"
---

## High-level description
This code defines a RAG (Retrieval-Augmented Generation) pipeline builder for MindsDB. It provides functionality to create different types of RAG pipelines based on the specified retriever type, including vector store, auto retriever, and multi-retriever strategies.

## Code Structure
The main components of this code are:
1. A dictionary `_retriever_strategies` mapping retriever types to their respective creation functions.
2. Helper functions for creating different types of RAG pipelines.
3. A `RAG` class that encapsulates the pipeline creation and execution.

## Symbols

### `_retriever_strategies`
#### Description
A dictionary that maps `RetrieverType` enum values to their corresponding pipeline creation functions.

### `_create_pipeline_from_vector_store`
#### Description
Creates a LangChainRAGPipeline using a vector store retriever.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| config | RAGPipelineModel | Configuration for the RAG pipeline |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return | LangChainRAGPipeline | The created RAG pipeline |

### `_create_pipeline_from_auto_retriever`
#### Description
Creates a LangChainRAGPipeline using an auto retriever.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| config | RAGPipelineModel | Configuration for the RAG pipeline |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return | LangChainRAGPipeline | The created RAG pipeline |

### `_create_pipeline_from_multi_retriever`
#### Description
Creates a LangChainRAGPipeline using a multi-vector retriever.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| config | RAGPipelineModel | Configuration for the RAG pipeline |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return | LangChainRAGPipeline | The created RAG pipeline |

### `_process_documents_to_df`
#### Description
Converts documents to a pandas DataFrame with embeddings.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| config | RAGPipelineModel | Configuration for the RAG pipeline |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return | pd.DataFrame | DataFrame containing processed documents |

### `get_pipeline_from_retriever`
#### Description
Creates and returns a RAG pipeline based on the specified retriever type.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| config | RAGPipelineModel | Configuration for the RAG pipeline |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return | RunnableSerializable | The created RAG pipeline |

### `RAG`
#### Description
A class that encapsulates the RAG pipeline creation and execution.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| config | RAGPipelineModel | Configuration for the RAG pipeline |

#### Methods
##### `__call__`
###### Description
Processes a question using the RAG pipeline.

###### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| question | str | The question to be processed |

###### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return | dict | The result of the RAG pipeline, including answer and context |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pandas | Data manipulation and analysis |
| langchain | Various components for building the RAG pipeline |
| mindsdb.integrations.utilities.rag | Custom RAG pipeline components and utilities |
| mindsdb.utilities.log | Logging functionality |

## Error Handling
The code includes basic error handling in the `get_pipeline_from_retriever` function, raising a `ValueError` if an invalid retriever type is provided.

## Logging
The code uses MindsDB's logging utility to log information about the processed questions and retrieved context in the `RAG.__call__` method.

Your response should not exceed 3000 words or 4000 tokens. Focus on providing clear, concise information that can be directly inferred from the code. Include optional sections only when they provide significant value for understanding the code.