---
title: "2024-07-19_45eb2eb61f70_add_provider_to_agent.py"
---

## High-level description
This code represents an Alembic migration script for adding a 'provider' column to the 'agents' table in a database. It also includes logic to migrate existing 'provider' data from the 'params' JSON column to the new 'provider' column and ensures that the 'model_name' column is populated.

## Symbols

### `upgrade()`
#### Description
This function defines the database schema changes and data migrations to be applied when upgrading the database.

#### Internal Logic
1. Adds a new 'provider' column to the 'agents' table.
2. Migrates 'provider' data from the 'params' JSON column to the new 'provider' column.
3. Populates the 'model_name' column if it's None, using data from the 'params' column.

### `downgrade()`
#### Description
This function defines the database schema changes to be applied when downgrading the database.

#### Internal Logic
Drops the 'provider' column from the 'agents' table.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| alembic | Database migration tool |
| sqlalchemy | SQL toolkit and ORM |
| mindsdb.interfaces.storage.db | MindsDB storage interface (imported but not directly used in this script) |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| revision | string | '45eb2eb61f70' | Unique identifier for this migration |
| down_revision | string | 'bfc6f44f5bc9' | Identifier of the previous migration |
| branch_labels | None | None | Branch labels for this migration |
| depends_on | None | None | Dependencies for this migration |

## Side Effects
- Adds a new 'provider' column to the 'agents' table.
- Modifies existing data in the 'agents' table by populating the new 'provider' column and potentially updating the 'model_name' column.

## Performance Considerations
The migration performs a select and potentially multiple update operations on the 'agents' table. For large tables, this could be a time-consuming operation and might temporarily lock the table.