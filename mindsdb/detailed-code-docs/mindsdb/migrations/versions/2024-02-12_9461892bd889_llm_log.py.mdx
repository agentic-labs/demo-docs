---
title: "2024-02-12_9461892bd889_llm_log.py"
---

## High-level description
This code defines an Alembic migration script for creating a new table called 'llm_log' in a database. The table is designed to store logs related to Large Language Model (LLM) operations, including input, output, token usage, and timing information.

## Code Structure
The script contains two main functions: `upgrade()` and `downgrade()`. The `upgrade()` function creates the new table, while the `downgrade()` function removes it. These functions are used by Alembic to apply or revert the database changes.

## Symbols

### upgrade()
#### Description
This function creates the 'llm_log' table in the database using SQLAlchemy operations.

#### Internal Logic
1. Uses `op.create_table()` to create a new table named 'llm_log'.
2. Defines columns for the table, including:
   - id: Integer, primary key
   - company_id: Integer, nullable
   - api_key: String, nullable
   - model_id: Integer, not nullable
   - input: String, nullable
   - output: String, nullable
   - start_time: DateTime, not nullable
   - end_time: DateTime, nullable
   - prompt_tokens: Integer, nullable
   - completion_tokens: Integer, nullable
   - total_tokens: Integer, nullable
   - success: Boolean, not nullable

### downgrade()
#### Description
This function removes the 'llm_log' table from the database.

#### Internal Logic
Uses `op.drop_table()` to drop the 'llm_log' table.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| alembic | Used for database migrations |
| sqlalchemy | Used for defining database schema |
| mindsdb.interfaces.storage.db | Imported but not directly used in this script |

## Configuration
The script includes Alembic-specific configuration variables:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| revision | string | '9461892bd889' | Unique identifier for this migration |
| down_revision | string | '5a5c49313e52' | Identifier of the previous migration |
| branch_labels | None | None | Used for branching in migration history |
| depends_on | None | None | Dependencies on other migrations |

These variables are used by Alembic to manage the migration history and dependencies.