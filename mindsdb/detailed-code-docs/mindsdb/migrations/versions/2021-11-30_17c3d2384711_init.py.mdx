---
title: "2021-11-30_17c3d2384711_init.py"
---

## High-level description
This file contains an Alembic migration script for initializing the database schema for MindsDB. It defines several database models using SQLAlchemy ORM and provides an upgrade function to create the initial database structure.

## Code Structure
The code defines several SQLAlchemy models (Semaphor, Datasource, Predictor, AITable, Log, Integration, Stream) that represent different tables in the database. The `upgrade()` function uses Alembic to generate and execute a migration script based on the difference between the defined models and the current database state.

## Symbols

### Base
#### Description
A base class for SQLAlchemy models that allows unmapped attributes.

### Semaphor
#### Description
Represents a semaphore table in the database, used for tracking actions on entities.

### Datasource
#### Description
Represents a data source in the system, storing information about the data source and its analysis.

### Predictor
#### Description
Represents a predictor model in the system, storing information about the model, its configuration, and status.

### AITable
#### Description
Represents an AI table, which links integration queries with predictors.

### Log
#### Description
Represents a log entry in the system, storing various types of logs with timestamps.

### Integration
#### Description
Represents an integration in the system, storing connection information for external data sources.

### Stream
#### Description
Represents a stream in the system, linking input and output streams with predictors and integrations.

### upgrade()
#### Description
Generates and executes a migration script to create the initial database structure based on the defined models.

#### Internal Logic
1. Gets the current database context and metadata.
2. Generates a migration script by comparing the target metadata with the current database state.
3. Renders the migration script into Python code.
4. Executes the generated code to apply the changes to the database.

### downgrade()
#### Description
A placeholder function for downgrade operations, which is not implemented in this migration.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| alembic | Database migration tool |
| sqlalchemy | ORM and database toolkit |
| mindsdb.interfaces.storage.db | Custom database types (Json, Array) |
| mindsdb.utilities | Logging utility |

## Error Handling
The `upgrade()` function doesn't implement specific error handling. If an error occurs during the migration, it will likely be propagated up the call stack.

## Logging
The code uses a logger from `mindsdb.utilities.log` to log information about the database changes being performed.

## TODOs
- There is a TODO comment in the `Predictor` model to remove the `is_custom` column.

This migration script sets up the initial database schema for MindsDB, defining various tables for managing predictors, data sources, integrations, and other core components of the system. It uses Alembic to generate and apply the necessary database changes based on the defined SQLAlchemy models.