---
title: "2023-10-03_6cb02dfd7f61_query_context.py"
---

## High-level description
This code defines an Alembic migration script to create a new table called 'query_context' in the database. The migration adds a new feature to store and manage query contexts, which can be used to save and retrieve query-related information.

## Code Structure
The code consists of two main functions: `upgrade()` and `downgrade()`. The `upgrade()` function creates the new table, while the `downgrade()` function removes it. These functions are used by Alembic to apply or revert the database changes.

## Symbols

### upgrade()
#### Description
This function creates the 'query_context' table in the database using SQLAlchemy's `op.create_table()` method.

#### Internal Logic
1. Creates a new table named 'query_context' with the following columns:
   - id: Integer, primary key
   - company_id: Integer, nullable
   - query: String, not nullable
   - context_name: String, not nullable
   - values: JSON, nullable
   - updated_at: DateTime, nullable
   - created_at: DateTime, nullable

### downgrade()
#### Description
This function removes the 'query_context' table from the database using SQLAlchemy's `op.drop_table()` method.

#### Internal Logic
1. Drops the 'query_context' table from the database.

## Dependencies
The code relies on the following external libraries:
| Dependency | Purpose |
|:-----------|:--------|
| alembic | Database migration tool |
| sqlalchemy | SQL toolkit and Object-Relational Mapping (ORM) library |
| mindsdb.interfaces.storage.db | Custom MindsDB database interface (imported but not directly used in this file) |

## References
This migration script is part of a series of database migrations, as indicated by the revision identifiers:
- Revision ID: 6cb02dfd7f61
- Previous revision: b0382f5be48d

The `QueryContext` model defined in the related code snippet (mindsdb/interfaces/storage/db.py) corresponds to the table created in this migration script.