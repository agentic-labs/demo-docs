---
title: "2022-07-08_999bceb904df_integration_args.py"
---

## High-level description
This code represents an Alembic migration script for upgrading and downgrading a database schema related to the 'integration' table in MindsDB. It adds an 'engine' column to the table and reorganizes the data structure of existing integrations.

## Code Structure
The script defines two main functions: `upgrade()` and `downgrade()`. These functions contain the logic for modifying the database schema and data when migrating up or rolling back, respectively.

## Symbols

### upgrade()
#### Description
This function upgrades the database schema by adding an 'engine' column to the 'integration' table and reorganizing the data structure of existing integrations.

#### Internal Logic
1. Establishes a database connection and creates a session.
2. Adds the 'engine' column to the 'integration' table.
3. Fetches all existing integrations from the database.
4. For each integration:
   - Parses the JSON data.
   - Removes specific keys from the data.
   - Determines the integration type.
   - Updates the integration record with the new engine and modified data.
5. Commits the session.

### downgrade()
#### Description
This function reverts the changes made by the upgrade function, removing the 'engine' column and restoring the previous data structure.

#### Internal Logic
1. Establishes a database connection and creates a session.
2. Fetches all integrations from the database.
3. For each integration:
   - Parses the JSON data.
   - Adds the 'engine' value back into the data as 'type'.
   - Updates the integration record with the modified data.
4. Removes the 'engine' column from the 'integration' table.
5. Commits the session.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| json | For parsing and serializing JSON data |
| alembic | For database migration operations |
| sqlalchemy | For database operations and ORM functionality |
| mindsdb.interfaces.storage.db | Imported but not directly used in the script |

## Error Handling
The script includes basic error handling for JSON parsing, using a try-except block to handle potential exceptions when loading JSON data.

## Performance Considerations
The script processes all existing integrations in the database, which could potentially be a time-consuming operation for databases with a large number of integrations.