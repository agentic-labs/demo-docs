---
title: "env.py"
---

## High-level description
This file, `env.py`, is part of the Alembic migration system for MindsDB. It sets up the environment for database migrations, configures the database connection, and defines functions to run migrations in both offline and online modes.

## Code Structure
The code initializes the Alembic configuration, sets up the database connection, and defines two main functions: `run_migrations_offline()` and `run_migrations_online()`. These functions are called based on whether the context is in offline or online mode.

## References
- `mindsdb.interfaces.storage.db`
- `mindsdb.utilities.config.Config`

## Symbols

### Configuration Setup
#### Description
This section initializes the Alembic configuration and sets up the database connection.

#### Internal Logic
1. Imports necessary modules and classes.
2. Initializes the Alembic config object.
3. Sets up the MindsDB configuration.
4. Initializes the database connection.
5. Sets the SQLAlchemy URL in the Alembic config.

### `run_migrations_offline()`
#### Description
Runs database migrations in 'offline' mode, which doesn't require a live database connection.

#### Internal Logic
1. Retrieves the database URL from the config.
2. Configures the migration context with the URL and metadata.
3. Executes the migrations within a transaction.

### `run_migrations_online()`
#### Description
Runs database migrations in 'online' mode, which requires a live database connection.

#### Internal Logic
1. Creates a database engine from the configuration.
2. Establishes a connection to the database.
3. Configures the migration context with the connection and metadata.
4. Executes the migrations within a transaction.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| alembic | Provides database migration functionality |
| sqlalchemy | Used for database operations and connection management |
| mindsdb.interfaces.storage | Provides database initialization and metadata |
| mindsdb.utilities.config | Handles MindsDB configuration |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| MINDSDB_CONFIG_PATH | string | "absent" | Path to the MindsDB configuration file |
| MINDSDB_DB_CON | string | N/A | Database connection string |

## Error Handling
The code doesn't implement explicit error handling beyond what's provided by Alembic and SQLAlchemy.

## API/Interface Reference
This file doesn't expose a public API. It's meant to be used internally by Alembic for managing database migrations.