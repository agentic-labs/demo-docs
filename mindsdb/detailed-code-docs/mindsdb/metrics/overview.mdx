---
title: "Overview"
---

## High-level description
This directory contains the metrics-related functionality for MindsDB. It includes modules for defining, tracking, and exposing various performance and usage metrics using Prometheus, as well as setting up a metrics endpoint for a Flask application.

## What does it do?
The metrics functionality in this directory serves several purposes:

1. It defines and tracks performance metrics for MindsDB's API, including:
   - Query execution time for integration handlers
   - Response size (number of rows) for integration handler queries
   - Latency of REST API requests

2. It provides a decorator (`api_endpoint_metrics`) to automatically measure and record the execution time of API endpoints.

3. It sets up a Prometheus metrics endpoint for a Flask application, allowing for the collection and exposure of these metrics in a standardized format.

This enables monitoring and analysis of MindsDB's performance and usage patterns, which can be crucial for optimization, troubleshooting, and capacity planning.

## Key Files

### metrics.py
This file defines the core metrics and decorators used throughout MindsDB. Key components include:

1. `INTEGRATION_HANDLER_QUERY_TIME`: Measures the time taken for integration handlers to process queries.
2. `INTEGRATION_HANDLER_RESPONSE_SIZE`: Tracks the number of rows returned by integration handler queries.
3. `_REST_API_LATENCY`: Measures the latency of REST API requests.
4. `api_endpoint_metrics`: A decorator that automatically measures and records the execution time of API endpoints.

These metrics are implemented using Prometheus client library, allowing for efficient collection and aggregation of performance data.

### server.py
This file is responsible for setting up the metrics endpoint in a Flask application. Key functionalities include:

1. `init_metrics`: Initializes Prometheus metrics collection for a Flask app, setting up a multiprocess collector and adding a '/metrics' route.
2. `metrics`: A route handler for the '/metrics' endpoint that generates and returns the latest metrics data in Prometheus format.

This setup allows for easy integration of metrics collection into the MindsDB server, providing a standardized way to expose collected metrics for monitoring tools.

## Dependencies
- `prometheus_client`: Used for creating and managing Prometheus metrics.
- `flask`: For creating the Flask application and response objects in the metrics server.
- `mindsdb.utilities`: For logging functionality.

## Configuration
The metrics functionality relies on the following configuration:

- `PROMETHEUS_MULTIPROC_DIR`: An environment variable specifying the directory for Prometheus multiprocess mode. This is crucial for proper metrics collection in a multi-process environment.

If this environment variable is not set, the metrics initialization will log a message and exit without setting up the metrics endpoint.

## Error Handling
The `api_endpoint_metrics` decorator in `metrics.py` includes error handling to catch and record any exceptions that occur during the execution of wrapped endpoint functions. These exceptions are recorded with an INTERNAL_SERVER_ERROR status in the `_REST_API_LATENCY` metric, ensuring that even failed requests are properly tracked and can be analyzed.

In conclusion, this metrics directory provides a comprehensive solution for tracking, collecting, and exposing performance metrics for MindsDB. It enables detailed monitoring of API performance and usage patterns, which is essential for maintaining and improving the system's efficiency and reliability.