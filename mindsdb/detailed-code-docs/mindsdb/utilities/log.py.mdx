---
title: "log.py"
---

## High-level description
This code defines a custom logging configuration for the MindsDB project. It includes a color-coded formatter for console output and a function to configure logging with specific levels for different modules. The code also provides a custom `getLogger` function to ensure logging is properly initialized before use.

## Code Structure
The code consists of three main components:
1. `ColorFormatter`: A custom logging formatter that adds color to log messages based on their level.
2. `configure_logging()`: A function that sets up the logging configuration for the MindsDB project.
3. `getLogger()`: A custom function that ensures logging is configured before returning a logger instance.

## Symbols

### ColorFormatter
#### Description
A custom logging formatter that adds color-coding to log messages based on their severity level.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| record | logging.LogRecord | The log record to be formatted |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| formatted_message | str | The color-coded formatted log message |

#### Internal Logic
- Defines color codes for different log levels
- Specifies a format string for log messages
- Creates a dictionary mapping log levels to their corresponding colored formatters
- Overrides the `format` method to apply the appropriate color formatter based on the log level

### configure_logging()
#### Description
Configures the logging system for the MindsDB project with specific handlers, formatters, and log levels.

#### Internal Logic
- Retrieves the MindsDB log level from the environment variable or defaults to INFO
- Defines a logging configuration dictionary with:
  - A console handler using the ColorFormatter
  - Root logger set to WARNING level
  - Specific loggers for "__main__", "mindsdb", and "alembic" set to the MindsDB log level
- Applies the configuration using `dictConfig`

### getLogger(name=None)
#### Description
A custom function that ensures logging is configured before returning a logger instance.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | Optional name for the logger |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| logger | logging.Logger | Configured logger instance |

#### Internal Logic
- Checks if logging has been initialized
- If not, calls `configure_logging()` and sets the `logging_initialized` flag
- Returns a logger instance using `logging.getLogger(name)`

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| logging | Python's built-in logging module for log management |
| os | Used to access environment variables |
| logging.config.dictConfig | Function to configure logging using a dictionary |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| MINDSDB_LOG_LEVEL | str | INFO | Environment variable to set the log level for MindsDB loggers |

## Logging
This code implements a custom logging setup for the MindsDB project:
- Uses color-coded console output for different log levels
- Configures specific log levels for different modules
- Provides a centralized way to initialize and retrieve loggers

## TODOs
The code includes a comment explaining the rationale behind using a custom `getLogger` function:
```python
# I would prefer to leave code to use logging.getLogger(), but there are a lot of complicated situations
# in MindsDB with processes being spawned that require logging to be configured again in a lot of cases.
# Using a custom logger-getter like this lets us do that logic here, once.
```
This suggests that the custom `getLogger` function is a workaround for handling logging in complex multi-process scenarios within MindsDB.