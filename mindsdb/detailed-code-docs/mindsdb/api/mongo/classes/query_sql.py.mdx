---
title: "query_sql.py"
---

## High-level description
This code defines a function `run_sql_command` that executes SQL commands in a MindsDB environment. It creates a SQL session, sets up the database, executes the command, and returns the result data.

## Code Structure
The main function `run_sql_command` uses `SessionController` to create a session and `ExecuteCommands` to execute the SQL command. It handles errors and formats the result data.

## Symbols

### run_sql_command
#### Description
Executes a SQL command in the MindsDB environment.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| request_env | dict | Environment variables for the request |
| ast_query | ASTNode | Abstract Syntax Tree representation of the SQL query |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | list | List of records returned by the SQL command |

#### Internal Logic
1. Creates a SQL session using `SessionController`
2. Sets the database for the session
3. Creates an `ExecuteCommands` object
4. Executes the command using `execute_command`
5. Handles errors by raising exceptions
6. Returns the result data as a list of records

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| mindsdb.api.executor.controllers | Provides SessionController for managing SQL sessions |
| mindsdb.api.executor.command_executor | Provides ExecuteCommands for executing SQL commands |

## Error Handling
The function raises an exception if the execution results in an error, using the error message from the execution result.

## Side Effects
The function may modify the database state depending on the executed SQL command.