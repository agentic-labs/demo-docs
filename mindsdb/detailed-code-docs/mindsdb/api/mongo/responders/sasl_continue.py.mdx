---
title: "sasl_continue.py"
---

## High-level description
This code defines a responder class `Responce` for handling the `saslContinue` operation in a MongoDB-compatible API. It processes the SASL (Simple Authentication and Security Layer) authentication continuation step, which is part of the SCRAM (Salted Challenge Response Authentication Mechanism) authentication process.

## Code Structure
The main symbol in this code is the `Responce` class, which inherits from the `Responder` class. It defines the conditions for when it should be used and the logic for handling the `saslContinue` operation. The `responder` variable at the end instantiates this class for use in the API.

## References
This code references:
- `mindsdb.api.mongo.classes.Responder`
- `mindsdb.api.mongo.functions` (as `helpers`)

## Symbols

### Responce
#### Description
A responder class for handling the `saslContinue` operation in the SCRAM authentication process.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | dict | The query containing the SASL payload |
| request_env | dict | Request environment variables |
| mindsdb_env | dict | MindsDB environment variables |
| session | object | The current session object |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| res | dict | The response containing the SASL continuation result |

#### Internal Logic
1. Decodes the payload from the query.
2. If the payload is not empty:
   - Processes the client's second message using the session's SCRAM object.
   - Encodes the response.
   - Sets `done` to `False`.
3. If the payload is empty:
   - Sets the response to `None`.
   - Sets `done` to `True`.
4. Constructs and returns the response dictionary.
5. If an exception occurs, returns an error response.

## Side Effects
This code interacts with the session's SCRAM object, potentially modifying its state as part of the authentication process.

### `when`
#### Description
A class attribute that defines when this responder should be used. It uses the `helpers.is_true` function to check if the `saslContinue` key in the query is true.

### `result`
#### Description
The main method that processes the `saslContinue` operation and returns the appropriate response.

## Error Handling
The code uses a try-except block to catch any exceptions that might occur during the processing of the SASL continuation. If an exception is caught, it returns an error response with the exception message.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| mindsdb.api.mongo.classes.Responder | Base class for the responder |
| mindsdb.api.mongo.functions | Provides helper functions (specifically `is_true`) |

Note: The code assumes the existence of a `scram` object on the `session`, which is not defined in this file but is likely set up elsewhere in the authentication process.