---
title: "union_step.py"
---

Here's a detailed documentation of the `UnionStepCall` class in the target file:

## High-level description
The `UnionStepCall` class is responsible for executing a UNION operation between two result sets in a SQL query. It combines the rows from two input result sets, optionally removing duplicates if the UNION is specified as DISTINCT.

## Code Structure
The `UnionStepCall` class inherits from `BaseStepCall` and is bound to the `UnionStep` from the SQL planner. It implements the `call` method to perform the UNION operation.

## Symbols

### UnionStepCall
#### Description
This class executes a UNION operation between two result sets in a SQL query.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| step | UnionStep | The UNION step object containing information about the operation |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | ResultSet | The combined result set after the UNION operation |

#### Internal Logic
1. Retrieves the left and right result sets from the `steps_data` dictionary.
2. Checks if the number of columns in both result sets match, raising a `WrongArgumentError` if they don't.
3. Creates a new `ResultSet` object and adds columns from the left result set.
4. Initializes an empty list to store record hashes for duplicate checking (if UNION DISTINCT).
5. Processes rows from the left result set:
   - If UNION DISTINCT, checks for duplicates using SHA256 hashes.
   - Adds non-duplicate rows to the result set.
6. Processes rows from the right result set:
   - If UNION DISTINCT, checks for duplicates using SHA256 hashes.
   - Adds non-duplicate rows to the result set.
7. Returns the combined result set.

## Side Effects
- Modifies the `steps_data` dictionary by adding the combined result set.

## Dependencies
- `hashlib`: Used for creating SHA256 hashes of rows for duplicate checking.
- `mindsdb_sql.planner.steps.UnionStep`: The step class this call is bound to.
- `mindsdb.api.executor.sql_query.result_set.ResultSet`: Used to create and manipulate result sets.
- `mindsdb.api.executor.exceptions.WrongArgumentError`: Used for raising errors on column count mismatch.

## TODOs
There is a commented-out section for type checking between columns, which may be implemented in the future:
```python
# TODO: return checking type later
# for i, left_col in enumerate(left_result.columns):
#     right_col = right_result.columns[i]
#     type1, type2 = left_col.type, right_col.type
#     if type1 is not None and type2 is not None:
#         if type1 != type2:
#             raise ErSqlWrongArguments(f'UNION types mismatch: {type1} != {type2}')
```

This documentation provides a comprehensive overview of the `UnionStepCall` class, its functionality, and its role in executing UNION operations in SQL queries within the MindsDB system.