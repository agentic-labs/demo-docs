---
title: "callback_handlers.py"
---

## High-level description
This file defines two callback handler classes, `ContextCaptureCallback` and `LogCallbackHandler`, for use with LangChain's agent and chain executions. These handlers capture context and log various stages of the execution process, providing debugging and monitoring capabilities for LLM-based applications.

## Symbols

### `ContextCaptureCallback`
#### Description
A callback handler that captures context from retriever operations.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | N/A | This class doesn't take any inputs upon initialization |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| context | List[Dict] | List of dictionaries containing page content and metadata |

#### Internal Logic
- Initializes with an empty `context` attribute
- Captures documents from retriever operations in the `on_retriever_end` method
- Provides a `get_contexts` method to retrieve the captured context

### `LogCallbackHandler`
#### Description
A callback handler that logs various stages of LLM, chain, and agent executions.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| logger | logging.Logger | Logger object to use for logging |

#### Internal Logic
- Initializes with a logger and sets its level to 'DEBUG'
- Keeps track of the number of running chains
- Implements various callback methods to log different stages of execution:
  - LLM start and end
  - Chat model start
  - Chain start and end
  - Agent actions and finish
- Logs errors encountered during LLM and chain executions

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| typing | Type hinting |
| logging | Logging functionality |
| langchain.schema.output | LLMResult type |
| langchain_core.agents | AgentAction and AgentFinish types |
| langchain_core.callbacks.base | BaseCallbackHandler base class |
| langchain_core.messages.base | BaseMessage type |

## Logging
The `LogCallbackHandler` implements extensive logging mechanisms:
- Debug level logging for LLM prompts, responses, and chat model messages
- Info level logging for chain start and end events
- Error level logging for LLM and chain errors
- Debug level logging for agent actions and results

Note: The actual logging output depends on the logger's configuration passed to the `LogCallbackHandler`.

This file provides crucial debugging and monitoring capabilities for LangChain-based applications, allowing developers to track the execution flow and capture important context information during retrieval operations.