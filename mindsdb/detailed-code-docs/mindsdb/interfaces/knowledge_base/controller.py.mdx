---
title: "controller.py"
---

## High-level description
This code defines the `KnowledgeBaseController` and `KnowledgeBaseTable` classes, which manage knowledge bases in MindsDB. The controller handles operations like adding, deleting, and listing knowledge bases, while the table interface handles queries to the knowledge base, including select, update, delete, and insert operations.

## Code Structure
The main symbols in the code are `KnowledgeBaseController` and `KnowledgeBaseTable`. The controller manages knowledge bases at a higher level, while the table interface interacts with the underlying vector database. The controller uses the table interface to perform operations on the knowledge base data.

## Symbols

### KnowledgeBaseController
#### Description
This class manages knowledge bases, including operations like adding, deleting, and listing knowledge bases.

#### Methods

##### add
###### Description
Adds a new knowledge base to the database.

###### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | Name of the knowledge base |
| project_name | str | Name of the project |
| embedding_model | Identifier | Embedding model identifier |
| storage | Identifier | Storage identifier |
| params | dict | Additional parameters |
| if_not_exists | bool | Flag to ignore if the knowledge base already exists |

###### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kb | db.KnowledgeBase | Created knowledge base object |

##### delete
###### Description
Deletes a knowledge base from the database.

###### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | Name of the knowledge base |
| project_name | str | Name of the project |
| if_exists | bool | Flag to ignore if the knowledge base doesn't exist |

##### get
###### Description
Retrieves a knowledge base from the database.

###### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | Name of the knowledge base |
| project_id | int | ID of the project |

###### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kb | db.KnowledgeBase | Retrieved knowledge base object |

##### get_table
###### Description
Returns a KnowledgeBaseTable object for the specified knowledge base.

###### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | str | Name of the knowledge base |
| project_id | int | ID of the project |

###### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kb_table | KnowledgeBaseTable | Knowledge base table object |

##### list
###### Description
Lists all knowledge bases from the database belonging to a project.

###### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project_name | str | Optional name of the project to filter by |

###### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | List[dict] | List of knowledge base information dictionaries |

### KnowledgeBaseTable
#### Description
This class handles requests to the knowledge base table and modifies data in the linked vector database table.

#### Methods

##### select_query
###### Description
Handles SELECT queries on the knowledge base table.

###### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | Select | SQL SELECT query object |

###### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | pd.DataFrame | DataFrame containing the query results |

##### update_query
###### Description
Handles UPDATE queries on the knowledge base table.

###### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | Update | SQL UPDATE query object |

##### delete_query
###### Description
Handles DELETE queries on the knowledge base table.

###### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | Delete | SQL DELETE query object |

##### clear
###### Description
Clears all data in the knowledge base table.

##### insert
###### Description
Inserts data into the knowledge base table.

###### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pd.DataFrame | DataFrame containing the data to insert |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pandas | Data manipulation and analysis |
| mindsdb_sql | SQL parsing and query handling |
| mindsdb.integrations.libs.vectordatabase_handler | Vector database operations |
| mindsdb.interfaces.database.projects | Project management |
| mindsdb.interfaces.model.functions | Model-related functions |
| mindsdb.utilities.exception | Custom exception handling |

## Error Handling
The code uses custom exceptions like `EntityExistsError` and `EntityNotExistsError` for handling errors related to knowledge base operations. It also includes checks for required parameters and data validation.

## Logging
The code uses the `mindsdb.utilities.log` module for logging, primarily for debugging and error reporting purposes.

## TODOs
- Implement the `update` method in the `KnowledgeBaseController` class.
- Handle the OR case in the `_extract_conditions` method of `KnowledgeBaseTable`.

This code provides a comprehensive interface for managing knowledge bases in MindsDB, including creation, deletion, querying, and data manipulation operations.