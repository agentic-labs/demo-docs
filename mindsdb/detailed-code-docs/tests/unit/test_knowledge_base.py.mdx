---
title: "test_knowledge_base.py"
---

## High-level description
This file contains unit tests for the KnowledgeBase functionality in MindsDB. It tests various operations such as creating, dropping, querying, inserting, and deleting from knowledge bases, as well as testing different parameters and configurations for knowledge bases.

## Code Structure
The main class `TestKnowledgeBase` inherits from `BaseExecutorTest` and contains multiple test methods. Each test method focuses on a specific aspect of knowledge base operations. The class also includes helper methods for running SQL queries and waiting for predictors to complete.

## Symbols

### TestKnowledgeBase
#### Description
A test class that contains various unit tests for knowledge base functionality in MindsDB.

#### Internal Logic
The class sets up a test environment with a vector database and an embedding model. It then runs various tests on knowledge base operations.

### run_sql
#### Description
A helper method that executes SQL commands and returns the result as a pandas DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL command to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | pandas.DataFrame | The result of the SQL query |

### wait_predictor
#### Description
A helper method that waits for a predictor to complete its training.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project | str | The project name |
| name | str | The predictor name |

### setup_method
#### Description
Sets up the test environment by creating a vector database, mocking data, and creating an embedding model.

### teardown_method
#### Description
Cleans up the test environment by dropping the vector database.

### test_create_kb
#### Description
Tests the creation of knowledge bases with various configurations.

### test_drop_kb
#### Description
Tests dropping a knowledge base.

### test_select_from_kb
#### Description
Tests querying data from a knowledge base with different filters.

### test_insert_into_kb
#### Description
Tests inserting data into a knowledge base using both VALUES and SELECT statements.

### test_delete_from_kb
#### Description
Tests deleting data from a knowledge base with different filters.

### test_show_knowledge_bases
#### Description
Tests the SHOW KNOWLEDGE BASES command.

### test_kb_params
#### Description
Tests different parameters for creating knowledge bases, such as content columns, metadata columns, and ID columns.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| tempfile | For creating temporary directories |
| time | For adding delays in wait_predictor method |
| unittest.mock | For mocking the Postgres handler |
| pandas | For working with DataFrames |
| pytest | For test assertions and decorators |
| mindsdb_sql | For parsing SQL queries |
| mindsdb.interfaces.storage.db | For accessing the KnowledgeBase model |

## Error Handling
The tests use pytest's assertion mechanisms and raise exceptions for expected error cases, such as creating knowledge bases with invalid model or storage names.

This test suite provides comprehensive coverage of the knowledge base functionality in MindsDB, ensuring that various operations and configurations work as expected.