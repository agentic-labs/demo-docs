---
title: "test_mssql.py"
---

## High-level description
This file contains unit tests for the MSSQL (Microsoft SQL Server) handler in the MindsDB project. It extends the `BaseDatabaseHandlerTest` class and uses the `unittest` framework to test the functionality of the `SqlServerHandler` class.

## Code Structure
The `TestMSSQLHandler` class inherits from both `BaseDatabaseHandlerTest` and `unittest.TestCase`. It defines several properties and methods that are used to set up and run tests for the MSSQL handler.

## Symbols

### TestMSSQLHandler
#### Description
This class contains the unit tests for the MSSQL handler. It sets up the test environment, defines test data, and specifies queries for testing.

#### Internal Logic
The class overrides several properties and methods from the `BaseDatabaseHandlerTest` class to provide MSSQL-specific test configurations:

1. `dummy_connection_data`: Defines a mock connection configuration for MSSQL.
2. `err_to_raise_on_connect_failure`: Specifies the error to be raised when a connection fails.
3. `get_tables_query`: Defines the SQL query to retrieve table information.
4. `get_columns_query`: Defines the SQL query to retrieve column information for a specific table.
5. `create_handler`: Creates an instance of the `SqlServerHandler` for testing.
6. `create_patcher`: Creates a patch for the `pymssql.connect` function to mock the database connection.

### dummy_connection_data
#### Description
This property returns an OrderedDict containing mock connection details for the MSSQL database.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | OrderedDict | Mock connection details including host, port, user, password, and database |

### err_to_raise_on_connect_failure
#### Description
This property returns the exception to be raised when a connection failure is simulated.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | pymssql.OperationalError | Exception instance with the message "Connection Failed" |

### get_tables_query
#### Description
This property returns a SQL query string to retrieve table information from the MSSQL database.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | str | SQL query to get table information |

### get_columns_query
#### Description
This property returns a SQL query string to retrieve column information for a specific table from the MSSQL database.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | str | SQL query to get column information for a specific table |

### create_handler
#### Description
This method creates and returns an instance of the `SqlServerHandler` for testing.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | SqlServerHandler | An instance of the SqlServerHandler with mock connection data |

### create_patcher
#### Description
This method creates and returns a patcher for the `pymssql.connect` function to mock the database connection.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | unittest.mock.patch | A patcher for the pymssql.connect function |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest | Provides the testing framework |
| unittest.mock | Used for mocking objects in tests |
| pymssql | MSSQL database adapter for Python |
| collections.OrderedDict | Used to create an ordered dictionary for connection data |
| base_handler_test.BaseDatabaseHandlerTest | Base class for database handler tests |
| mindsdb.integrations.handlers.mssql_handler.mssql_handler.SqlServerHandler | The MSSQL handler class being tested |

## Notes
1. This test file is designed to work with the `unittest` framework and can be run standalone using `python -m unittest tests/unit/handlers/test_mssql.py`.
2. The test class inherits from both `BaseDatabaseHandlerTest` and `unittest.TestCase`, suggesting that common database handler tests are defined in the base class, while MSSQL-specific tests can be added to this class.
3. The actual test methods are not visible in this file, indicating that they are likely defined in the `BaseDatabaseHandlerTest` class.
4. The `create_patcher` method suggests that the tests use mocking to avoid actual database connections during unit testing.