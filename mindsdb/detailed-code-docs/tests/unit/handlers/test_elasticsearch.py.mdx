---
title: "test_elasticsearch.py"
---

## High-level description
This code defines a unit test class `TestElasticsearchHandler` for testing the `ElasticsearchHandler` class. It extends both `BaseDatabaseHandlerTest` and `unittest.TestCase`, providing a structured approach to testing the Elasticsearch handler's functionality, including connection, query execution, and error handling.

## Code Structure
The `TestElasticsearchHandler` class inherits from `BaseDatabaseHandlerTest` and `unittest.TestCase`. It implements abstract properties and methods from the base classes and adds a specific test method for native query execution.

## Symbols

### TestElasticsearchHandler
#### Description
A test class for the ElasticsearchHandler, providing test cases for various handler functionalities.

#### Internal Logic
1. Implements abstract properties from the base class.
2. Defines methods for creating the handler and patcher.
3. Includes a test method for native query execution.

### dummy_connection_data
#### Description
A property that returns a dummy connection data dictionary for testing purposes.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | OrderedDict | A dictionary containing dummy connection credentials |

### err_to_raise_on_connect_failure
#### Description
A property that returns the exception to be raised when a connection failure is simulated.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | elasticsearch.exceptions.AuthenticationException | An exception instance for connection failure |

### get_tables_query
#### Description
A property that returns the SQL query string for retrieving tables.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | str | SQL query string for showing tables |

### get_columns_query
#### Description
A property that returns the SQL query string for describing a table's columns.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | str | SQL query string for describing table columns |

### create_handler
#### Description
Creates and returns an instance of the ElasticsearchHandler for testing.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | ElasticsearchHandler | An instance of the ElasticsearchHandler |

### create_patcher
#### Description
Creates and returns a patcher for mocking the Elasticsearch client.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | unittest.mock.patch | A patcher for the Elasticsearch client |

### test_native_query
#### Description
Tests the `native_query` method of the ElasticsearchHandler.

#### Internal Logic
1. Mocks the connection and SQL query execution.
2. Calls the `native_query` method with a test query.
3. Asserts that the mock was called correctly and the result is a Response object.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest | Provides the testing framework |
| unittest.mock | Used for mocking objects in tests |
| elasticsearch | The Elasticsearch client library |
| base_handler_test | Provides base classes for handler testing |
| mindsdb.integrations.handlers.elasticsearch_handler.elasticsearch_handler | The handler being tested |
| mindsdb.integrations.libs.response | Provides response classes used in the handler |

## Error Handling
The test class inherits error handling mechanisms from its base classes. The `err_to_raise_on_connect_failure` property defines a specific exception for simulating connection failures.