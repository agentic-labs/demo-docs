---
title: "test_dynamodb.py"
---

## High-level description
This file contains unit tests for the DynamoDBHandler class, which is responsible for handling interactions with Amazon DynamoDB. The tests cover various aspects of the handler, including connection establishment, query execution, and data retrieval operations.

## Code Structure
The main class `TestDynamoDBHandler` inherits from `BaseHandlerTestSetup` and `unittest.TestCase`. It contains multiple test methods that verify different functionalities of the DynamoDBHandler. The tests use mocking to simulate DynamoDB responses and test the handler's behavior in various scenarios.

## Symbols

### TestDynamoDBHandler
#### Description
This class contains unit tests for the DynamoDBHandler. It sets up a mock environment for testing DynamoDB operations and verifies the handler's behavior in different scenarios.

#### Internal Logic
The class uses the `unittest.mock` module to patch the `boto3.client` and simulate DynamoDB responses. It tests various methods of the DynamoDBHandler, including connection establishment, query execution, and data retrieval.

### dummy_connection_data
#### Description
A property that returns a dummy connection data dictionary for testing purposes.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| dummy_connection_data | OrderedDict | Contains mock AWS credentials and region |

### create_handler
#### Description
Creates and returns a DynamoDBHandler instance with dummy connection data.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| handler | DynamoDBHandler | An instance of DynamoDBHandler |

### create_patcher
#### Description
Creates and returns a patcher for the `boto3.client` method.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| patcher | unittest.mock.patch | A patcher for boto3.client |

### test_connect_failure_with_missing_connection_data
#### Description
Tests if the `connect` method raises a ValueError when required connection parameters are missing.

### test_connect_success
#### Description
Tests if the `connect` method successfully establishes a connection and sets the `is_connected` flag to True.

### test_check_connection_failure_with_incorrect_credentials
#### Description
Tests if the `check_connection` method returns a StatusResponse object with a failure status when incorrect credentials are provided.

### test_check_connection_success
#### Description
Tests if the `check_connection` method returns a StatusResponse object with a success status when the connection is successful.

### test_query_select_success
#### Description
Tests if the `query` method returns a Response object with a data frame containing the query result for a SELECT query.

### test_query_select_failure_with_unsupported_clause
#### Description
Tests if the `query` method raises a ValueError when a SELECT query contains an unsupported clause.

### test_query_insert_failure
#### Description
Tests if the `query` method raises a ValueError for an INSERT query, which is not supported by the handler.

### test_get_tables
#### Description
Tests if the `get_tables` method returns a Response object with a list of tables.

### test_get_columns
#### Description
Tests if the `get_columns` method returns a Response object with a list of columns for a given table.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest | Provides testing framework |
| collections | Used for OrderedDict |
| botocore.client | Used for ClientError exception |
| unittest.mock | Used for mocking and patching |
| mindsdb_sql.parser | Used for parsing SQL queries |
| base_handler_test | Provides BaseHandlerTestSetup |
| mindsdb.integrations.libs.response | Provides response classes |
| mindsdb.integrations.handlers.dynamodb_handler.dynamodb_handler | Provides DynamoDBHandler |

## Error Handling
The tests check for various error scenarios, such as missing connection data, incorrect credentials, and unsupported query types. They use assertions and exception checks to verify that the handler responds correctly to these error conditions.