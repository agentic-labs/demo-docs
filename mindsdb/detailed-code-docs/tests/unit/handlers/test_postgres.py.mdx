---
title: "test_postgres.py"
---

## High-level description
This code defines a unit test class `TestPostgresHandler` for testing the PostgresHandler. It extends the `BaseDatabaseHandlerTest` and `unittest.TestCase` classes, providing specific implementations and tests for PostgreSQL database connections and queries.

## Code Structure
The `TestPostgresHandler` class inherits from `BaseDatabaseHandlerTest` and `unittest.TestCase`. It implements abstract properties and methods from the base class and adds a specific test for the `native_query` method of the PostgresHandler.

## Symbols

### TestPostgresHandler
#### Description
A test class for the PostgresHandler, providing specific implementations for PostgreSQL database testing.

#### Internal Logic
The class overrides abstract properties and methods from the base class, providing PostgreSQL-specific implementations. It also includes a test method for the `native_query` functionality.

### dummy_connection_data
#### Description
A property that returns a dictionary with dummy connection data for PostgreSQL.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| dummy_connection_data | OrderedDict | Contains connection parameters for PostgreSQL |

### err_to_raise_on_connect_failure
#### Description
A property that returns the exception to be raised when a connection fails.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| err_to_raise_on_connect_failure | psycopg.Error | Exception for connection failure |

### get_tables_query
#### Description
A property that returns the SQL query to fetch table information from PostgreSQL.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| get_tables_query | str | SQL query to get table information |

### get_columns_query
#### Description
A property that returns the SQL query to fetch column information for a specific table from PostgreSQL.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| get_columns_query | str | SQL query to get column information |

### create_handler
#### Description
Creates and returns an instance of the PostgresHandler.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| handler | PostgresHandler | An instance of PostgresHandler |

### create_patcher
#### Description
Creates and returns a patcher for the `psycopg.connect` function.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| patcher | unittest.mock.patch | A patcher for psycopg.connect |

### test_native_query
#### Description
Tests the `native_query` method of the PostgresHandler.

#### Internal Logic
1. Mocks the connection and cursor objects.
2. Calls the `native_query` method with a test query.
3. Asserts that the method returns a Response object without errors.
4. Checks if the cursor's `execute` method was called with the correct query.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest | Provides testing framework |
| unittest.mock | Provides mocking capabilities for testing |
| psycopg | PostgreSQL database adapter for Python |
| base_handler_test | Provides base classes for handler testing |
| mindsdb.integrations.handlers.postgres_handler | Contains the PostgresHandler class |
| mindsdb.integrations.libs.response | Contains response classes used in the handler |

## TODOs
There is a TODO comment in the `test_native_query` method suggesting to consider handling the ExecStatus scenario via the base class, as it is specific to Postgres.