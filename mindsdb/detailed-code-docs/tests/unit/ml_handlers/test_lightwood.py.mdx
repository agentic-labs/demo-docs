---
title: "test_lightwood.py"
---

## High-level description
This file contains unit tests for the Lightwood machine learning handler in MindsDB. It tests various functionalities including creating and using predictors, handling time series data, and querying model information.

## Code Structure
The main class `TestLW` inherits from `BaseExecutorTest`. It contains helper methods and test cases that set up test data, create predictors, and verify their functionality.

## Symbols

### TestLW
#### Description
A test class that inherits from `BaseExecutorTest`. It contains methods to test the Lightwood handler's functionality in MindsDB.

#### Internal Logic
The class sets up test data, creates predictors, and verifies their functionality through various test methods.

### wait_predictor
#### Description
A helper method that waits for a predictor to be created and checks its status.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project | str | The project name |
| name | str | The predictor name |

#### Internal Logic
It repeatedly queries the predictor's status until it's complete or an error occurs, with a timeout mechanism.

### run_sql
#### Description
A helper method that executes SQL queries and returns the result as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL query to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | DataFrame | The query result as a pandas DataFrame |

### test_simple
#### Description
A test method that creates a simple predictor, runs predictions, and checks the results.

#### Internal Logic
1. Sets up mock data
2. Creates a project and a predictor
3. Runs predictions and verifies the results
4. Tests various 'describe' queries on the model

### test_ts
#### Description
A test method that creates a time series predictor and verifies its functionality.

#### Internal Logic
1. Sets up mock time series data
2. Creates a project and a time series predictor
3. Runs predictions on future data points

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest.mock | For mocking the Postgres handler |
| pandas | For data manipulation and analysis |
| mindsdb_sql | For parsing SQL queries |

## Error Handling
The tests use assertions to check for expected outcomes. If any assertion fails, the test will raise an AssertionError.

## TODOs
There is a TODO comment in the `test_ts` method regarding the expected output of the time series prediction.

```python
# TODO: the result is [37, 36, 33]
# assert map(round, list(ret.x)) == [42, 43, 44]
```
This suggests that the current output doesn't match the expected values, and further investigation or adjustment may be needed.