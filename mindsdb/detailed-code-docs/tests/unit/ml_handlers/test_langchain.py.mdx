---
title: "test_langchain.py"
---

## High-level description
This file contains unit tests for the Langchain integration in MindsDB. It tests various language model providers (OpenAI, Anthropic, Ollama, Anyscale) and their functionality within the MindsDB ecosystem, including model creation, prediction, and description.

## Code Structure
The main class `TestLangchain` inherits from `BaseExecutorTest` and contains multiple test methods, each focusing on a specific aspect of the Langchain integration. The tests create models using different providers, execute predictions, and verify the results.

## Symbols

### `ollama_model_exists`
#### Description
Checks if a specific Ollama model exists locally.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| model_name | str | The name of the Ollama model to check |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| exists | bool | True if the model exists, False otherwise |

#### Internal Logic
Uses the `ollama.show()` function to check if the model exists, catching any exceptions if it doesn't.

### `TestLangchain`
#### Description
A test class for Langchain integration testing in MindsDB.

#### Internal Logic
- Sets up a test environment by creating a project database.
- Contains multiple test methods, each focusing on a specific provider or functionality.
- Uses pytest fixtures and markers to manage test setup and execution conditions.

### `TestLangchain.setup_method`
#### Description
Sets up the test environment before each test method.

#### Internal Logic
Calls the parent class's setup method and creates a new database named "proj".

### `TestLangchain.test_default_provider`
#### Description
Tests the default provider (OpenAI) for Langchain integration.

#### Internal Logic
1. Creates a model using the Langchain engine and OpenAI provider.
2. Waits for the predictor to be ready.
3. Executes a prediction query.
4. Asserts that the answer contains the expected result.

### `TestLangchain.test_anthropic_provider`
#### Description
Tests the Anthropic provider for Langchain integration.

#### Internal Logic
Similar to `test_default_provider`, but uses the Anthropic API and the Claude 2.1 model.

### `TestLangchain.test_ollama_provider`
#### Description
Tests the Ollama provider for Langchain integration.

#### Internal Logic
Similar to other provider tests, but uses a locally installed Ollama model (Mistral).

### `TestLangchain.test_anyscale_provider`
#### Description
Tests the Anyscale provider for Langchain integration.

#### Internal Logic
Similar to other provider tests, but uses the Anyscale API and a specific Meta-Llama model.

### `TestLangchain.test_describe`
#### Description
Tests the DESCRIBE SQL command on a Langchain model.

#### Internal Logic
Creates a model and verifies that the DESCRIBE command returns a non-empty result.

### `TestLangchain.test_prompt_template_args`
#### Description
Tests the use of additional arguments in the prompt template.

#### Internal Logic
Creates a model with a prompt template that includes a 'name' parameter, then verifies that the parameter is correctly used in the model's response.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework |
| ollama | Interaction with Ollama models |
| os | Environment variable access |

## Error Handling
The code uses pytest's `skipif` decorators to skip tests when necessary API keys or models are not available, preventing test failures due to missing dependencies.

## TODOs
There are no explicit TODOs in the code.