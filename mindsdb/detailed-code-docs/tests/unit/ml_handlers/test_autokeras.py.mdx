---
title: "test_autokeras.py"
---

## High-level description
This file contains unit tests for the AutoKeras integration in MindsDB. It tests various scenarios of creating and using machine learning models with AutoKeras, including regression and classification tasks, handling of categorical and numerical data, and error handling.

## Code Structure
The file consists of a standalone test function `test_format_categorical_preds` and a test class `TestAutokeras` that inherits from `BaseExecutorTest`. The class contains multiple test methods that cover different aspects of the AutoKeras integration.

## Symbols

### `test_format_categorical_preds`
#### Description
This function tests the `format_categorical_preds` helper function, which formats categorical predictions into the correct output format.

#### Internal Logic
1. Creates mock prediction data and original labels
2. Calls `format_categorical_preds` with the mock data
3. Asserts that the output matches the expected format

### `TestAutokeras`
#### Description
This class contains multiple test methods for the AutoKeras integration in MindsDB.

#### Internal Logic
The class sets up a mock PostgreSQL handler and defines helper methods for waiting for predictor completion and running SQL queries. It then tests various scenarios:

1. Regression with numerical training data
2. Regression with categorical training data
3. Regression with null values in training data
4. Regression with bulk predict queries
5. Error handling for missing columns in predict queries
6. Classification with numerical training data

Each test method follows a similar pattern:
1. Set up mock data
2. Create a project and model using SQL commands
3. Wait for the predictor to complete
4. Run prediction queries
5. Assert that the results are as expected

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest.mock | For mocking the PostgreSQL handler |
| pandas | For data manipulation and analysis |
| numpy | For numerical operations |
| mindsdb_sql | For parsing SQL queries |
| mindsdb.integrations.handlers.autokeras_handler | For the AutoKeras integration |
| tests.unit.executor_test_base | For the base test class |

## Error Handling
The tests include error handling checks, such as testing for missing columns in predict queries (test_regression_error_on_predict_query_missing_cols).

## Performance Considerations
The tests use a very short training time (0.01) to speed up the test execution. This is not representative of real-world usage but is sufficient for testing the integration's functionality.

## TODOs
There are no explicit TODOs in the code, but it might be beneficial to add more diverse test cases, such as:
1. Testing with larger datasets
2. Testing with more complex model architectures
3. Testing edge cases and error conditions
4. Testing model persistence and loading