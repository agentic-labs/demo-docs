---
title: "test_huggingface.py"
---

## High-level description
This file contains unit tests for the Hugging Face integration in MindsDB. It tests various natural language processing tasks using Hugging Face models, including text classification, zero-shot classification, summarization, translation, and text generation. The tests also cover fine-tuning capabilities for some of these tasks.

## Code Structure
The main class `TestHuggingface` inherits from `BaseExecutorTest`. It contains multiple test methods, each focusing on a specific NLP task or functionality. The tests follow a similar pattern: creating a predictor, running predictions, and in some cases, fine-tuning the model.

## Symbols

### TestHuggingface
#### Description
A test class that contains various test methods for Hugging Face integration in MindsDB.

#### Internal Logic
1. Sets up test data using a pandas DataFrame.
2. Creates predictors using SQL commands.
3. Runs predictions using the created predictors.
4. Checks for successful execution of commands.
5. For some tests, performs fine-tuning on the models.

### run_sql
#### Description
A helper method to execute SQL commands and return the results as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL command to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | DataFrame | The result of the SQL command execution |

### hf_test_run
#### Description
A helper method to run a complete test cycle for a Hugging Face model, including creation, prediction, and waiting for completion.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mock_handler | MagicMock | A mocked handler for the database |
| model_name | str | The name of the model to create and test |
| create_sql | str | SQL command to create the predictor |
| predict_sql | str | SQL command to run predictions |

### test_hf_classification_bin
#### Description
Tests binary text classification using a Hugging Face model.

### test_hf_classification_multy
#### Description
Tests multi-class text classification using a Hugging Face model.

### test_hf_zero_shot
#### Description
Tests zero-shot classification using a Hugging Face model.

### test_summarization
#### Description
Tests text summarization using a Hugging Face model.

### test_hf_translation
#### Description
Tests text translation using a Hugging Face model.

### test_hf_text2text
#### Description
Tests text-to-text generation using a Hugging Face model.

### test_hf_text_classification_finetune
#### Description
Tests fine-tuning a text classification model.

### test_hf_zero_shot_classification_finetune
#### Description
Tests fine-tuning a zero-shot classification model.

### test_hf_translation_finetune
#### Description
Tests fine-tuning a translation model.

### test_hf_summarization_finetune
#### Description
Tests fine-tuning a summarization model.

## Dependencies
The test file relies on several external libraries and modules:
- unittest.mock
- pandas
- mindsdb_sql
- BaseExecutorTest (from a parent test module)

## Configuration
The tests use a mocked PostgreSQL handler and various Hugging Face models. The configuration for each model is specified in the SQL commands within each test method.

## Error Handling
The tests use assertions to check for successful execution of SQL commands and predictor creation. If any errors occur during the process, the test will fail.

## Performance Considerations
These tests involve downloading and using large language models, which can be time-consuming and resource-intensive. The `wait_predictor` method is used to handle the asynchronous nature of model creation and training.