---
title: "test_langchain_embedding.py"
---

## High-level description
This file contains unit tests for the LangChain embedding functionality in MindsDB. It tests various scenarios of creating and using embedding models, including dummy embeddings, multiple input columns, OpenAI embeddings, and error cases.

## Code Structure
The main class `TestLangchainEmbedding` inherits from `BaseExecutorTest` and contains multiple test methods. Each test method focuses on a specific aspect of the embedding functionality, such as creating models, making predictions, and handling different input configurations.

## Symbols

### TestLangchainEmbedding
#### Description
A test class that inherits from `BaseExecutorTest` and contains various test methods for LangChain embedding functionality.

#### Internal Logic
The class uses helper methods `wait_predictor` and `run_sql` to interact with the MindsDB SQL interface. It creates embedding models, makes predictions, and verifies the results.

### wait_predictor
#### Description
A helper method that waits for a predictor to be created and ready.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project | str | The project name |
| name | str | The predictor name |

#### Internal Logic
Polls the status of the predictor every 0.5 seconds for up to 100 seconds. Raises a `RuntimeError` if the predictor is not created within the timeout.

### run_sql
#### Description
A helper method that executes SQL commands and returns the result as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL command to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | DataFrame | The result of the SQL command |

### test_dummy_embedding
#### Description
Tests the creation and usage of a dummy embedding model with a single input column.

#### Internal Logic
1. Creates a database and a dummy embedding model.
2. Tests single-line and multiple-line predictions.
3. Verifies the output shape and content.

### test_embed_multiple_columns
#### Description
Tests the creation and usage of a dummy embedding model with multiple input columns.

#### Internal Logic
1. Creates a model with multiple input columns.
2. Tests single-line and multiple-line predictions.
3. Verifies error handling for missing input columns.

### test_no_input_columns
#### Description
Tests the behavior of embedding models when no input columns are specified.

#### Internal Logic
1. Creates models without specifying input columns.
2. Tests predictions with all available columns.
3. Verifies error handling for missing required columns.

### test_openai_embedding
#### Description
Tests the creation and usage of an OpenAI embedding model.

#### Internal Logic
1. Creates an OpenAI embedding model.
2. Tests single-line and multiple-line predictions.
3. Verifies the output shape and content.

### test_missing_class_name, test_wrong_class_name, test_wrong_arguments
#### Description
These methods test error handling for various invalid model configurations.

#### Internal Logic
Attempts to create models with missing or incorrect parameters and verifies that appropriate exceptions are raised.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| os | Accessing environment variables |
| time | Implementing wait functionality |
| unittest.mock | Mocking database handlers |
| pandas | Data manipulation and testing |
| pytest | Test framework and decorators |
| mindsdb_sql | SQL parsing |

## Error Handling
The code uses `pytest.raises` to test for expected exceptions in error cases. It also implements custom error handling in the `wait_predictor` method.

## TODOs
The `test_huggingface_embedding` method is left empty, indicating that it needs to be implemented in the future.