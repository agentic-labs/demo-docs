---
title: "test_time_series_utils.py"
---

## High-level description
This file contains unit tests for the time series utility functions used in MindsDB's integration with statistical forecasting libraries. It tests various functions related to data transformation, frequency inference, model selection, and hierarchical forecasting.

## Code Structure
The file defines several test functions, each focusing on a specific aspect of the time series utilities. These tests use mock data and assert expected outcomes to ensure the correctness of the utility functions.

## Symbols

### `create_mock_df(freq="Q-DEC")`
#### Description
Creates a mock DataFrame with time series data for testing purposes.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| freq | str | Frequency of the time series data (default: "Q-DEC") |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| df | pandas.DataFrame | Mock DataFrame with time series data |

#### Internal Logic
1. Creates two DataFrames with date ranges and target values
2. Adds group columns to each DataFrame
3. Concatenates the DataFrames and resets the index

### `test_infer_frequency()`
#### Description
Tests the `infer_frequency` function from the time series utilities.

#### Internal Logic
1. Creates mock DataFrames with different frequencies
2. Asserts that the inferred frequency matches the expected frequency
3. Tests with string dates and unordered dates

### `test_statsforecast_df_transformations()`
#### Description
Tests the transformation functions for StatsForecast DataFrame format.

#### Internal Logic
1. Creates a mock DataFrame and settings dictionary
2. Tests transformation for single and multiple group-by columns
3. Tests reversing the transformation
4. Tests with exogenous variables

### `test_get_best_model_from_results_df()`
#### Description
Tests the function for selecting the best model from a results DataFrame.

#### Internal Logic
1. Creates a mock results DataFrame with multiple models
2. Asserts that the best model is correctly identified

### `test_spec_hierarchy_from_list()`
#### Description
Tests the function for creating a hierarchy specification from a list of columns.

#### Internal Logic
1. Defines a list of hierarchy columns
2. Asserts that the generated hierarchy specification is correct

### `test_get_hierarchy_from_df()`
#### Description
Tests the function for extracting hierarchy information from a DataFrame.

#### Internal Logic
1. Creates a mock DataFrame and model arguments
2. Calls the `get_hierarchy_from_df` function
3. Asserts that the returned training DataFrame, hierarchy DataFrame, and hierarchy dictionary are correct

### `test_reconcile_forecasts()`
#### Description
Tests the function for reconciling forecasts according to a hierarchy.

#### Internal Logic
1. Creates mock DataFrames for training data and forecasts
2. Calls the `reconcile_forecasts` function
3. Asserts that the reconciled results are as expected

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pandas | Data manipulation and analysis |
| statsforecast.utils | Provides sample data (AirPassengersDF) |
| mindsdb.integrations.utilities.time_series_utils | Contains the functions being tested |

## Error Handling
The tests use assertions to check for expected outcomes. If any assertion fails, it will raise an AssertionError, indicating a test failure.

## TODOs
There are no explicit TODOs in the code.

This test file ensures that the time series utility functions in MindsDB are working correctly, covering various scenarios and edge cases related to time series forecasting and hierarchical reconciliation.