---
title: "test_lightfm.py"
---

## High-level description
This file contains unit tests for the LightFM collaborative filtering model in MindsDB. It tests various recommendation scenarios including user-item, item-item, and user-user recommendations, as well as hybrid recommendations.

## Code Structure
The `TestLightFM` class inherits from `BaseExecutorTest` and contains multiple test methods for different recommendation scenarios. It uses mocking to simulate a PostgreSQL database and tests the creation and execution of LightFM models.

## Symbols

### TestLightFM
#### Description
A test class for the LightFM collaborative filtering model in MindsDB.

### wait_predictor
#### Description
Waits for a predictor to be created and checks its status.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| project | str | The project name |
| name | str | The predictor name |

#### Internal Logic
1. Repeatedly checks the status of the predictor.
2. If the status is "complete", it returns.
3. If the status is "error", it raises a RuntimeError.
4. If the predictor isn't created within 200 attempts, it raises a RuntimeError.

### run_sql
#### Description
Executes SQL commands and returns the result as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL command to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | DataFrame | The result of the SQL execution |

### test_collaborative_filter_user_item_recommendation_light_fm_handler
#### Description
Tests the user-item recommendation scenario using LightFM.

#### Internal Logic
1. Sets up a mock PostgreSQL handler with interaction data.
2. Creates a project and a LightFM model.
3. Waits for the predictor to be created.
4. Executes a SQL query to get recommendations.
5. Asserts that the result has the expected shape.

### test_collaborative_filter_item_item_recommendation_light_fm_handler
#### Description
Tests the item-item recommendation scenario using LightFM.

#### Internal Logic
Similar to the user-item test, but for item-item recommendations.

### test_collaborative_filter_user_user_recommendation_light_fm_handler_with_item_data
#### Description
This test method is not implemented (empty).

### test_hybrid_user_item_recommendation_light_fm_handler
#### Description
This test method is not implemented (empty).

### test_hybrid_item_item_recommendation_light_fm_handler
#### Description
This test method is not implemented (empty).

### test_hybrid_user_user_recommendation_light_fm_handler
#### Description
This test method is not implemented (empty).

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest.mock | For mocking the PostgreSQL handler |
| mindsdb_sql | For parsing SQL queries |
| unit.executor_test_base | Base class for executor tests |

## TODOs
- Implement the empty test methods for user-user recommendations and hybrid recommendations.