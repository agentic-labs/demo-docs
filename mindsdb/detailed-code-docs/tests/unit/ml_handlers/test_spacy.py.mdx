---
title: "test_spacy.py"
---

## High-level description
This file contains unit tests for the Spacy integration in MindsDB. It tests various linguistic features provided by Spacy, including Named Entity Recognition (NER), lemmatization, dependency parsing, part-of-speech tagging, and morphological analysis.

## Code Structure
The code defines a single test class `TestSpacy` that inherits from `BaseExecutorTest`. This class contains multiple test methods, each focusing on a specific Spacy linguistic feature. The tests follow a similar pattern: creating a database, setting up mock data, creating a Spacy model, and then querying the model to verify the results.

## Symbols

### TestSpacy
#### Description
A test class that inherits from `BaseExecutorTest` and contains methods to test various Spacy linguistic features.

#### Internal Logic
The class uses the `run_sql` method to execute SQL commands and the `set_handler` method to mock a PostgreSQL database handler. Each test method follows a similar structure:
1. Create a database
2. Set up mock data
3. Create a Spacy model using SQL
4. Query the model
5. Assert the expected output

### run_sql
#### Description
A method that executes SQL commands and returns the result as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL command to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | DataFrame | The result of the SQL query |

### test_spacy_ner
#### Description
Tests the Named Entity Recognition (NER) feature of Spacy.

#### Internal Logic
1. Creates a database and sets up mock data
2. Creates a Spacy NER model
3. Queries the model with sample text
4. Asserts that the expected named entities are recognized

### test_spacy_lemmatization
#### Description
Tests the lemmatization feature of Spacy.

#### Internal Logic
1. Creates a database and sets up mock data
2. Creates a Spacy lemmatization model
3. Queries the model with sample text
4. Asserts that the expected lemmas are produced

### test_spacy_dependency_parsing
#### Description
Tests the dependency parsing feature of Spacy.

#### Internal Logic
1. Creates a database and sets up mock data
2. Creates a Spacy dependency parsing model
3. Queries the model with sample text
4. Asserts that the expected dependency structure is produced

### test_spacy_pos_tagging
#### Description
Tests the part-of-speech (POS) tagging feature of Spacy.

#### Internal Logic
1. Creates a database and sets up mock data
2. Creates a Spacy POS tagging model
3. Queries the model with sample text
4. Asserts that the expected POS tags are assigned

### test_spacy_morphology
#### Description
Tests the morphological analysis feature of Spacy.

#### Internal Logic
1. Creates a database and sets up mock data
2. Creates a Spacy morphology model
3. Queries the model with sample text
4. Asserts that the expected morphological features are identified

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest.mock | Used for mocking the PostgreSQL handler |
| pandas | Used for creating and manipulating DataFrames |
| mindsdb_sql | Used for parsing SQL queries |
| tests.unit.executor_test_base | Provides the base test class `BaseExecutorTest` |

## Notes
- The tests use mocking to simulate a PostgreSQL database handler.
- Each test creates a separate Spacy model for a specific linguistic feature.
- The tests use a common sample text: "Apple is looking at buying U.K. startup for $1 billion".
- The assertions check for specific expected outputs in the recognition results.