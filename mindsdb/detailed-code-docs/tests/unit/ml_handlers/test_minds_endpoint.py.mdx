---
title: "test_minds_endpoint.py"
---

## High-level description
This file contains unit tests for the Minds Endpoint handler in MindsDB. It tests various aspects of the handler, including model creation validation, prediction functionality for different tasks (sentiment analysis, question answering, and embeddings), and error handling for invalid inputs.

## Code Structure
The code defines a `TestMindsEndpoint` class that inherits from `unittest.TestCase`. It contains several test methods that mock different components of the MindsEndpoint handler and test its functionality. The tests cover the `create_validation`, `create`, and `predict` methods of the handler.

## Symbols

### TestMindsEndpoint
#### Description
This class contains unit tests for the MindsEndpoint handler. It sets up a mock environment for testing and includes various test methods to validate the handler's functionality.

#### Internal Logic
1. Sets up mock objects for model storage and engine storage in the `setUp` method.
2. Defines test methods for different scenarios:
   - Validation of model creation
   - Error handling for invalid inputs
   - Prediction functionality for different tasks (sentiment analysis, question answering, embeddings)

### test_create_validation_raises_exception_without_using_clause
#### Description
Tests if model creation raises an exception when the USING clause is missing.

#### Internal Logic
1. Calls `create_validation` method without a USING clause.
2. Asserts that an exception is raised with a specific error message.

### test_create_validation_raises_exception_with_invalid_api_key
#### Description
Tests if model creation raises an exception when an invalid API key is provided.

#### Internal Logic
1. Calls `create_validation` method with an empty USING clause.
2. Asserts that an exception is raised.

### test_create_validation_with_valid_arguments
#### Description
Tests if model creation validation passes with valid arguments.

#### Internal Logic
1. Mocks the OpenAI client and its `models.retrieve` method.
2. Calls `create_validation` method with valid arguments.
3. Implicitly asserts that no exception is raised.

### test_create_raises_exception_with_invalid_mode
#### Description
Tests if model creation raises an exception when an invalid operation mode is provided.

#### Internal Logic
1. Mocks the OpenAI client and its `models.list` method.
2. Calls `create` method with an invalid mode.
3. Asserts that an exception is raised with a specific error message.

### test_create_raises_exception_with_unsupported_model
#### Description
Tests if model creation raises an exception when an unsupported model name is provided.

#### Internal Logic
1. Mocks the OpenAI client and its `models.list` method.
2. Calls `create` method with an unsupported model name.
3. Asserts that an exception is raised with a specific error message.

### test_create_runs_no_errors_with_valid_arguments
#### Description
Tests if model creation runs without errors when valid arguments are provided.

#### Internal Logic
1. Mocks the OpenAI client and its `models.list` method.
2. Calls `create` method with valid arguments.
3. Implicitly asserts that no exception is raised.

### test_predict_runs_no_errors_on_chat_completion_prompt_completion
#### Description
Tests if model prediction returns the expected result for a sentiment analysis task.

#### Internal Logic
1. Mocks necessary components and methods.
2. Sets up a test dataframe with input text.
3. Calls the `predict` method.
4. Asserts that the result is a DataFrame with the expected structure and content.

### test_predict_runs_no_errors_on_chat_completion_question_answering
#### Description
Tests if model prediction returns the expected result for a question answering task.

#### Internal Logic
1. Mocks necessary components and methods.
2. Sets up a test dataframe with a question.
3. Calls the `predict` method.
4. Asserts that the result is a DataFrame with the expected structure and content.

### test_predict_runs_no_errors_on_embeddings_completion
#### Description
Tests if model prediction returns the expected result for an embeddings task.

#### Internal Logic
1. Mocks necessary components and methods.
2. Sets up a test dataframe with input text.
3. Calls the `predict` method.
4. Asserts that the result is a DataFrame with the expected structure and content.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pandas | Data manipulation and testing |
| unittest | Test framework |
| unittest.mock | Mocking objects for testing |
| mindsdb.integrations.handlers.minds_endpoint_handler.minds_endpoint_handler | The handler being tested |

## TODOs
- Figure out how to remove duplicate code in create tests
- Figure out how to remove duplicate code in predict tests