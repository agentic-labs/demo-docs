---
title: "test_base_queires.py"
---

Here's a comprehensive documentation for the target file `tests/unit/executor/test_base_queires.py`:

## High-level description
This file contains unit tests for the SQL query execution functionality in MindsDB, specifically focusing on various types of SELECT queries, joins, and data manipulation operations. It uses a mock database setup to test the behavior of the SQL executor.

## Code Structure
The file defines two main test classes: `TestSelect` and `TestDML`, both inheriting from `BaseExecutorDummyML`. These classes contain multiple test methods that cover different aspects of SQL query execution, including view creation, complex joins, aggregations, and data manipulation.

## Symbols

### `TestSelect`
#### Description
A test class that focuses on testing various SELECT queries and related operations.

#### Internal Logic
This class contains multiple test methods, each testing a specific aspect of SELECT queries or related operations:

1. `test_view`: Tests the creation and querying of a view.
2. `test_complex_joins`: Tests complex join operations between tables and views.
3. `test_complex_queries`: Tests various complex queries including unions, aggregations, and window functions.
4. `test_last`: Tests the 'last' functionality in queries and views.
5. `test_interval`: Tests interval operations in queries.
6. `test_duplicated_cols`: Tests handling of duplicated column names in joins.
7. `test_system_vars`: Tests system variables in queries.

### `TestDML`
#### Description
A test class that focuses on testing Data Manipulation Language (DML) operations.

#### Internal Logic
This class contains two test methods:

1. `test_create_empty_table`: Tests the creation of an empty table.
2. `test_delete_from_table`: Tests the deletion of rows from a table.

### `test_view`
#### Description
Tests the creation of a view and its usage with a machine learning model.

#### Internal Logic
1. Creates a sample DataFrame and saves it as a file.
2. Creates a view based on the saved file.
3. Creates a machine learning model using the view.
4. Queries the model joined with the view.
5. Asserts the expected results.

### `test_complex_joins`
#### Description
Tests complex join operations between tables, views, and predictors.

#### Internal Logic
1. Sets up sample data in two DataFrames.
2. Creates a predictor model.
3. Creates a view.
4. Executes and tests various complex join queries.
5. Asserts the expected results for each query.

### `test_complex_queries`
#### Description
Tests a wide range of complex SQL queries including unions, aggregations, and window functions.

#### Internal Logic
1. Sets up sample data for stores and regions.
2. Creates views and models based on the sample data.
3. Executes and tests various complex queries including joins, conditions, unions, aggregations, and window functions.
4. Asserts the expected results for each query.

### `test_last`
#### Description
Tests the 'last' functionality in queries and views, which is used for incremental data processing.

#### Internal Logic
1. Sets up sample data.
2. Tests queries with 'last' condition on tables and views.
3. Tests the behavior when new data is added.
4. Tests the 'last' functionality with models.

### `test_interval`
#### Description
Tests interval operations in queries.

#### Internal Logic
1. Sets up a sample DataFrame with a date column.
2. Executes a query with an interval operation.
3. Asserts the expected result.

### `test_duplicated_cols`
#### Description
Tests handling of duplicated column names in joins.

#### Internal Logic
1. Sets up two DataFrames with overlapping column names.
2. Executes a join query.
3. Asserts that the result contains all columns without conflicts.

### `test_system_vars`
#### Description
Tests system variables in queries.

#### Internal Logic
1. Executes a query selecting system variables.
2. Asserts the expected values for these variables.

### `test_create_empty_table`
#### Description
Tests the creation of an empty table.

#### Internal Logic
1. Executes a CREATE TABLE SQL statement.
2. Asserts that the correct SQL was passed to the handler.

### `test_delete_from_table`
#### Description
Tests the deletion of rows from a table.

#### Internal Logic
1. Sets up a sample DataFrame.
2. Executes a DELETE SQL statement.

## Dependencies
This file depends on various Python libraries and MindsDB modules:
- unittest.mock
- datetime
- pytest
- pandas
- mindsdb_sql
- BaseExecutorDummyML (from tests.unit.executor_test_base)

## Configuration
The tests use a mock database setup provided by the `BaseExecutorDummyML` class. This setup includes:
- A temporary database file
- A mock file controller
- A mock model controller (in some cases)
- A command executor for running SQL queries

## Error Handling
The tests use assertions to verify the expected behavior. If any assertion fails, the test will raise an AssertionError.

## Logging
No explicit logging is implemented in this file, but the underlying MindsDB framework may log operations and errors.

## TODOs
There is one TODO comment in the file:
```python
# TODO Correlated subqueries (not implemented)
```
This indicates that testing for correlated subqueries is not yet implemented.

This documentation provides a comprehensive overview of the test file, its structure, and the functionality it tests within the MindsDB SQL execution framework.