---
title: "test_mongodb_server.py"
---

Here's a comprehensive documentation for the target file `tests/unit/executor/test_mongodb_server.py`:

## High-level description
This file contains unit tests for the MongoDB server implementation in MindsDB. It tests various MongoDB operations and their corresponding SQL translations, including querying, creating predictors, and managing ML engines.

## Code Structure
The main class `TestMongoDBServer` inherits from `BaseUnitTest`. It contains multiple test methods, each prefixed with `t_`, testing different aspects of the MongoDB server functionality. The `test_mongo_server` method sets up the test environment and runs all the `t_` prefixed methods.

## Symbols

### TestMongoDBServer
#### Description
A test class that contains unit tests for the MongoDB server implementation in MindsDB.

#### Internal Logic
1. Sets up a mock environment for testing MongoDB server operations.
2. Runs individual test methods prefixed with `t_`.
3. Cleans up the test environment after all tests are completed.

### test_mongo_server
#### Description
The main test method that sets up the MongoDB server and runs all individual test methods.

#### Internal Logic
1. Mocks the `ExecuteCommands.execute_command` method.
2. Configures and starts a MongoDB server in a separate thread.
3. Connects a MongoDB client to the server.
4. Runs all test methods prefixed with `t_`.
5. Cleans up the server and client after tests are completed.

### t_single_row
#### Description
Tests a simple MongoDB query and its SQL translation.

#### Internal Logic
1. Mocks the executor response.
2. Executes a MongoDB find operation.
3. Verifies the resulting SQL query.

### t_single_join
#### Description
Tests a MongoDB query involving a join operation and its SQL translation.

#### Internal Logic
1. Executes a MongoDB find operation with a join.
2. Verifies the resulting SQL query with a JOIN clause.

### t_join_ts
#### Description
Tests a MongoDB query involving a time series join operation and its SQL translation.

#### Internal Logic
1. Executes a MongoDB find operation with time series data and modifiers.
2. Verifies the resulting SQL query with a JOIN clause and WHERE conditions.

### t_datetime
#### Description
Tests a MongoDB query with a datetime condition and its SQL translation.

#### Internal Logic
1. Executes a MongoDB find operation with a datetime condition.
2. Verifies the resulting SQL query with a datetime comparison.

### t_create_predictor
#### Description
Tests the creation of a predictor using MongoDB operations and its SQL translation.

#### Internal Logic
1. Inserts a document to create a predictor with various options.
2. Verifies the resulting SQL query for creating a predictor.

### t_delete_model
#### Description
Tests the deletion of a model using MongoDB operations and its SQL translation.

#### Internal Logic
1. Executes MongoDB delete operations on models and predictors.
2. Verifies the resulting SQL queries for dropping predictors.

### t_delete_model_version
#### Description
Tests the deletion of a specific model version using MongoDB operations and its SQL translation.

#### Internal Logic
1. Executes a MongoDB delete operation with version specification.
2. Verifies the resulting SQL query for dropping a specific model version.

### t_create_ml_engine
#### Description
Tests the creation of an ML engine using MongoDB operations and its SQL translation.

#### Internal Logic
1. Inserts a document to create an ML engine.
2. Verifies the resulting SQL query for creating an ML engine.

### t_list_ml_engines
#### Description
Tests listing ML engines using MongoDB operations and its SQL translation.

#### Internal Logic
1. Executes a MongoDB find operation to list ML engines.
2. Verifies the resulting SQL query for showing ML engines.

### t_drop_ml_engine
#### Description
Tests dropping an ML engine using MongoDB operations and its SQL translation.

#### Internal Logic
1. Executes a MongoDB delete operation to drop an ML engine.
2. Verifies the resulting SQL query for dropping an ML engine.

## Dependencies
- `mindsdb_sql`: For parsing SQL queries.
- `mindsdb.api.executor`: For executing commands and handling results.
- `pymongo`: For MongoDB client operations.
- `unittest.mock`: For mocking and patching.

## Error Handling
The test methods use assertions to verify the correctness of SQL translations and results. Any discrepancies will raise assertion errors.

## Notes
- The tests mock the `ExecuteCommands.execute_command` method to isolate the MongoDB server functionality.
- The MongoDB server is started in a separate thread for testing purposes.
- Some tests are marked with TODOs, indicating areas for future improvement or additional testing.

This documentation provides a comprehensive overview of the test file structure, its main components, and the functionality being tested. It should help developers understand the purpose and implementation of each test case in the MongoDB server testing suite.