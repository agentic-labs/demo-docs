---
title: "test_home_rental_prices_tutorial.py"
---

## High-level description
This file contains integration tests for a home rental prices prediction tutorial using MindsDB. It tests the process of creating a database, training a model, making predictions, and fine-tuning the model using SQL queries via HTTP requests.

## Code Structure
The code is structured around a main test class `TestHomeRentalPrices` that inherits from `HTTPHelperMixin`. It uses a `QueryStorage` class to store SQL queries and a pytest fixture `mindsdb_app` for setup.

## Symbols

### `QueryStorage`
#### Description
A class that stores SQL queries as class attributes for use in the tests.

#### Internal Logic
Defines SQL queries for:
1. Creating a database
2. Checking if the database was created
3. Creating a model
4. Checking model status
5. Making a prediction
6. Making bulk predictions
7. Fine-tuning the model

### `TestHomeRentalPrices`
#### Description
A test class that inherits from `HTTPHelperMixin` and uses pytest fixtures. It contains methods to test various stages of the home rental prices prediction workflow.

#### Internal Logic
1. Sets up the class with configuration data
2. Tests database creation and verification
3. Tests model creation and training
4. Tests single and bulk predictions
5. Tests model fine-tuning

#### Methods

### `setup_class`
#### Description
Class method to set up the test environment.

#### Internal Logic
1. Loads configuration from a JSON file
2. Stores initial integration names

### `test_create_db`
#### Description
Tests the creation of a database.

#### Internal Logic
Executes the create database SQL query and expects an OK response.

### `test_db_created`
#### Description
Verifies that the database was created successfully.

#### Internal Logic
Executes a query to fetch 10 rows from the created database and asserts that the response contains 10 rows.

### `test_create_model`
#### Description
Tests the creation of a prediction model.

#### Internal Logic
1. Executes the create model SQL query
2. Asserts that the response contains one row
3. Checks if the model status is 'generating'

### `test_wait_training_complete`
#### Description
Waits for the model training to complete.

#### Internal Logic
Calls the `await_model` method with a timeout of 600 seconds.

### `test_prediction`
#### Description
Tests a single prediction using the trained model.

#### Internal Logic
Executes a prediction query and asserts that the response contains one row.

### `test_bulk_prediciton`
#### Description
Tests bulk predictions using the trained model.

#### Internal Logic
Executes a bulk prediction query and asserts that the response contains 100 rows.

### `test_finetune_model`
#### Description
Tests the fine-tuning of the trained model.

#### Internal Logic
1. Executes the fine-tune model SQL query
2. Asserts that the response contains one row
3. Checks if the model status is 'complete'

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework |
| mindsdb | Main library being tested |
| requests | Used by HTTPHelperMixin for HTTP requests |

## Configuration
The test uses an `OVERRIDE_CONFIG` dictionary to set up the test environment:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| integrations | dict | {} | Empty dictionary for integrations |
| API_LIST | list | ["http"] | List of APIs to be used |

## Error Handling
The test class inherits from `HTTPHelperMixin`, which handles HTTP-related errors. Assertions are used throughout the tests to check for expected responses and data.

## API/Interface Reference
The tests interact with MindsDB's SQL API via HTTP. The main endpoints used are:

| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| /sql/query | POST | SQL query | JSON response | Executes SQL queries against MindsDB |

The `HTTPHelperMixin` class provides methods to interact with this API, particularly the `sql_via_http` method.