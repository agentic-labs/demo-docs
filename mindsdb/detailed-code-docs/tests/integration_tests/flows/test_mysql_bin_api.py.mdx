---
title: "test_mysql_bin_api.py"
---

## High-level description
This code defines a test class `TestMySqlBinApi` that inherits from `TestMySqlApi`. It tests MindsDB's MySQL API using binary mode of the MySQL protocol. The class overrides the `query` method to use MySQL Connector/Python for executing queries and includes a specific test for Tableau queries.

## Code Structure
The main class `TestMySqlBinApi` inherits from `TestMySqlApi`. It overrides the `query` method to use MySQL Connector/Python instead of the Docker-based approach used in the parent class. The class also includes a specific test method `test_tableau_queries` to test various SQL queries that might be used by Tableau.

## Symbols

### `TestMySqlBinApi`
#### Description
A test class that inherits from `TestMySqlApi` and is designed to test MindsDB's MySQL API using the binary mode of the MySQL protocol.

#### Internal Logic
- Overrides the `query` method to use MySQL Connector/Python for executing queries.
- Includes a `test_tableau_queries` method to test various SQL queries.

### `query`
#### Description
A method that executes SQL queries using MySQL Connector/Python in binary mode.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| _query | str | The SQL query to be executed |
| encoding | str | The encoding to use (default is 'utf-8') |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| res | Dlist or dict | The query results as a list of dictionaries or an empty dictionary |

#### Internal Logic
1. Establishes a connection to the MindsDB MySQL server using configuration details.
2. Creates a cursor with prepared statements enabled.
3. Executes each subquery in the input query string.
4. If the query returns results, fetches all rows and column names.
5. Converts the results to a list of dictionaries (Dlist) or an empty dictionary.

### `test_tableau_queries`
#### Description
A test method that executes a series of SQL queries typically used by Tableau to interact with MindsDB.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| subtests | pytest.SubTest | Pytest subtests fixture for running multiple sub-tests |

#### Internal Logic
1. Defines a list of SQL queries covering various operations like SELECT, SHOW, and JOIN.
2. Iterates through the queries, executing each one using the `query` method.
3. Uses pytest subtests to run each query as a separate sub-test.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| mysql.connector | Used to connect to and interact with MySQL databases |
| pytest | Testing framework used for writing and running tests |

## Configuration
The class uses configuration options inherited from the parent class `TestMySqlApi`, including database connection details and authentication information.

## Error Handling
The code doesn't implement specific error handling mechanisms beyond what's provided by MySQL Connector/Python and pytest.

This documentation provides a comprehensive overview of the `TestMySqlBinApi` class and its main components, focusing on the key aspects of its functionality and structure.