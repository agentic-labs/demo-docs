---
title: "test_predict_text_sentiment_openai_tutorial.py"
---

## High-level description
This file contains integration tests for a text sentiment prediction workflow using OpenAI's GPT-3 model. It tests the process of creating a database, setting up an OpenAI engine, creating a sentiment classifier model, and making predictions using the model.

## Code Structure
The code is structured as a pytest test class `TestPredictTextSentimentOpenAI` with several test methods. It uses a `QueryStorage` class to store SQL queries used in the tests. The class inherits from `HTTPHelperMixin` for HTTP-related test utilities.

## Symbols

### `QueryStorage`
#### Description
A class that stores SQL queries as class attributes for use in the test methods.

#### Internal Logic
Defines various SQL queries for:
1. Creating a MySQL database
2. Checking if the database was created
3. Creating an OpenAI engine
4. Creating a sentiment classifier model
5. Checking the model status
6. Making a single prediction
7. Making bulk predictions

### `TestPredictTextSentimentOpenAI`
#### Description
A test class that inherits from `HTTPHelperMixin` and uses pytest fixtures. It contains methods to test the entire workflow of setting up and using a sentiment classifier model.

#### Internal Logic
1. Sets up the class by loading configuration
2. Tests creating a database
3. Verifies the database creation
4. Creates an OpenAI engine
5. Creates a sentiment classifier model
6. Waits for the model training to complete
7. Tests a single prediction
8. Tests bulk predictions

#### Test Methods

### `test_create_db`
#### Description
Tests the creation of a MySQL database.

#### Internal Logic
Executes the `create_db` SQL query and expects an OK response.

### `test_db_created`
#### Description
Verifies that the database was created successfully.

#### Internal Logic
Executes the `check_db_created` SQL query and asserts that at least 3 rows are returned.

### `test_create_engine`
#### Description
Tests the creation of an OpenAI engine.

#### Internal Logic
Executes the `create_engine` SQL query with the OpenAI API key and expects an OK response.

### `test_create_model`
#### Description
Tests the creation of a sentiment classifier model.

#### Internal Logic
Executes the `create_model` SQL query and asserts that the model status is 'generating'.

### `test_wait_training_complete`
#### Description
Waits for the model training to complete.

#### Internal Logic
Polls the model status using the `check_status` query and asserts that the final status is 'complete'.

### `test_prediction`
#### Description
Tests a single prediction using the trained model.

#### Internal Logic
Executes the `prediction` SQL query and asserts that one row of data is returned.

### `test_bulk_prediciton`
#### Description
Tests bulk predictions using the trained model.

#### Internal Logic
Executes the `bulk_prediction` SQL query and asserts that five rows of data are returned.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework |
| mindsdb | Main library being tested |
| os | For environment variable access |
| pathlib | For file path handling |
| json | For JSON parsing |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| OVERRIDE_CONFIG | dict | {'integrations': {}} | Configuration override for MindsDB |
| API_LIST | list | ["http"] | List of APIs to be tested |
| OPENAI_API_KEY | str | os.environ.get("OPENAI_API_KEY") | OpenAI API key for authentication |

## Error Handling
The code relies on pytest's built-in error handling and assertion mechanisms. No specific error handling is implemented within the test methods.

## Logging
No explicit logging is implemented in this test file. Pytest handles test result logging.

## Notes
- The tests are designed to run sequentially, with each test depending on the success of the previous ones.
- The OpenAI API key is expected to be set as an environment variable.
- The tests use HTTP requests to interact with the MindsDB API, as indicated by the use of `HTTPHelperMixin` and the `sql_via_http` method.
- The `mindsdb_app` fixture is used but not defined in this file, suggesting it's defined in a conftest.py file.