---
title: "test_symbl_handler.py"
---

## High-level description
This file contains unit tests for the Symbl API Handler in MindsDB. It tests various SQL queries that interact with the Symbl API, focusing on retrieving different types of data from conversations.

## Code Structure
The main class `TestSymblAPIHandler` inherits from `BaseExecutorTest`. It sets up a Symbl database connection and tests different SQL queries to fetch various types of conversation data.

## Symbols

### TestSymblAPIHandler
#### Description
A test class for the Symbl API Handler, which inherits from BaseExecutorTest. It sets up a Symbl database connection and tests various SQL queries to retrieve different types of conversation data.

#### Internal Logic
1. The class is decorated with `@pytest.mark.skipif` to skip the tests if the Symbl package is not installed.
2. In the `setup_method`, it creates a Symbl database connection using environment variables for authentication.
3. The `test_basic_select_from` method tests various SQL queries to fetch different types of conversation data.

### run_sql
#### Description
A helper method that executes SQL queries and returns the result as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL query to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | DataFrame | The result of the SQL query as a pandas DataFrame |

#### Internal Logic
1. Parses the SQL query using `parse_sql` with the "mindsdb" dialect.
2. Executes the command using the `command_executor`.
3. Asserts that there is no error in the execution.
4. Returns the result as a DataFrame if data is available.

### setup_method
#### Description
Sets up the test environment by creating a Symbl database connection.

#### Internal Logic
1. Calls the parent class's `setup_method`.
2. Retrieves Symbl API credentials from environment variables.
3. Executes an SQL query to create a Symbl database connection with the provided credentials.

### test_basic_select_from
#### Description
Tests various SQL queries to fetch different types of conversation data from the Symbl API.

#### Internal Logic
1. Sets a conversation ID for testing.
2. Executes SQL queries to fetch different types of data:
   - Messages
   - Topics
   - Questions
   - Analytics
   - Action Items
   - Follow-ups
3. Each query is executed using the `run_sql` method.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| importlib | Used to check if the Symbl package is installed |
| os | Used to access environment variables |
| pytest | Testing framework |
| mindsdb_sql | Used for parsing SQL queries |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| SYMBL_APP_ID | str | None | Symbl API application ID |
| SYMBL_APP_SECRET | str | None | Symbl API application secret |

Note: These configuration options are expected to be set as environment variables.

## Error Handling
The `run_sql` method includes basic error handling by asserting that the `error_code` is None after executing a command. If an error occurs, an AssertionError will be raised.

This test file is designed to verify the functionality of the Symbl API Handler in MindsDB, ensuring that it can correctly execute SQL queries to retrieve various types of conversation data from the Symbl API.