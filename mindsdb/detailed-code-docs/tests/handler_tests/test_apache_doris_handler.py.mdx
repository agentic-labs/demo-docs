---
title: "test_apache_doris_handler.py"
---

## High-level description
This file contains unit tests for the ApacheDorisHandler class, which is responsible for handling connections and executing statements for Apache Doris databases. The tests cover various functionalities such as connecting to the database, querying tables, and performing CRUD operations.

## Code Structure
The code defines a TestMySQLHandler class that contains multiple test methods, each testing a specific functionality of the ApacheDorisHandler. It also includes helper methods for checking responses and retrieving table names.

## References
- ApacheDorisHandler from mindsdb.integrations.handlers.apache_doris_handler.apache_doris_handler
- RESPONSE_TYPE from mindsdb.api.executor.data_types.response_type

## Symbols

### TestMySQLHandler
#### Description
This class contains unit tests for the ApacheDorisHandler. It tests various database operations and checks the responses for correctness.

#### Internal Logic
The class uses pytest fixtures to set up the handler and contains multiple test methods, each focusing on a specific functionality of the ApacheDorisHandler.

### check_valid_response
#### Description
A helper method to validate the response from the handler.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| res | Response | The response object from the handler |

#### Internal Logic
- Checks if the response type is TABLE and the data frame is not None
- Verifies that the error code is 0
- Ensures that the error message is None

### get_table_names
#### Description
A helper method to retrieve table names from the database.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| handler | ApacheDorisHandler | The handler instance |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| table_names | list | A list of table names in the database |

#### Internal Logic
- Calls the get_tables method of the handler
- Verifies that the response contains a 'table_name' column
- Returns a list of table names

### test_connect
#### Description
Tests the connection to the Apache Doris database.

#### Internal Logic
- Calls the connect method of the handler
- Asserts that the connection is successful

### test_check_connection
#### Description
Tests the check_connection method of the handler.

#### Internal Logic
- Calls the check_connection method
- Asserts that the connection check is successful

### test_native_query_show_dbs
#### Description
Tests the native_query method by executing a "SHOW DATABASES" query.

#### Internal Logic
- Executes a "SHOW DATABASES" query
- Verifies that the response contains the expected database

### test_get_tables
#### Description
Tests the get_tables method of the handler.

#### Internal Logic
- Retrieves table names using the get_table_names helper method
- Asserts that the 'example_tbl' table is present in the database

### test_describe_table
#### Description
Tests the get_columns method of the handler.

#### Internal Logic
- Calls the get_columns method for the 'example_tbl' table
- Verifies that the response contains the expected columns

### test_create_table
#### Description
Tests the creation of a new table using a native query.

#### Internal Logic
- Executes a CREATE TABLE query
- Verifies that the new table is present in the database

### test_drop_table
#### Description
Tests the dropping of a table using a native query.

#### Internal Logic
- Executes a DROP TABLE query
- Verifies that the dropped table is no longer present in the database

### test_select_query
#### Description
Tests a simple SELECT query with a LIMIT clause.

#### Internal Logic
- Executes a SELECT query with a LIMIT of 3
- Verifies that the response contains the expected number of rows

### test_select_where_query
#### Description
Tests a SELECT query with a WHERE clause.

#### Internal Logic
- Executes a SELECT query with a WHERE condition
- Verifies that the response contains the expected number of rows

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework used for writing and running the tests |
| mindsdb.integrations.handlers.apache_doris_handler.apache_doris_handler | Provides the ApacheDorisHandler class being tested |
| mindsdb.api.executor.data_types.response_type | Provides the RESPONSE_TYPE enum for checking response types |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| HANDLER_KWARGS | dict | - | Connection data for the Apache Doris database |
| HANDLER_NAME | str | 'test_doris_handler' | Name of the handler instance |

## Error Handling
The tests use assertions to check for expected behavior and raise AssertionErrors if the conditions are not met. The check_valid_response method is used to validate the responses from the handler and ensure that no errors occurred during the operations.