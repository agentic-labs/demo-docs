---
title: "test_lightdash_handler.py"
---

## High-level description
This file contains unit tests for the Lightdash handler in MindsDB. It tests various SQL queries against a Lightdash database, ensuring that the handler can correctly execute these queries and retrieve data from different tables in the Lightdash system.

## Code Structure
The main class `TestLightdashHandler` inherits from `BaseExecutorTest` and contains multiple test methods. Each test method executes SQL queries against different tables in the Lightdash database.

## Symbols

### TestLightdashHandler
#### Description
A test class that verifies the functionality of the Lightdash handler in MindsDB. It sets up a Lightdash database connection and runs various SQL queries to test data retrieval from different tables.

#### Internal Logic
1. Sets up the Lightdash database connection using environment variables.
2. Executes a series of SQL queries to test data retrieval from various Lightdash tables.
3. Performs basic assertions on the query results.

### run_sql
#### Description
A helper method that executes SQL queries and returns the result as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL query to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| DataFrame | pandas.DataFrame | The result of the SQL query as a DataFrame |

#### Internal Logic
1. Parses the input SQL query.
2. Executes the query using the command executor.
3. Checks for errors in the execution.
4. Returns the result as a DataFrame if data is available.

### setup_method
#### Description
Sets up the test environment by creating a Lightdash database connection using environment variables.

#### Internal Logic
1. Retrieves Lightdash-related environment variables.
2. Executes an SQL query to create a Lightdash database connection.

### test_basic_select_from
#### Description
Tests basic SELECT queries on various Lightdash tables.

#### Internal Logic
Executes a series of SQL queries to retrieve data from different Lightdash tables, including user, org, project, chart, space, and scheduler-related tables.

### test_complex_select
#### Description
Tests more complex SELECT queries with specific column selections and assertions on the result shape.

#### Internal Logic
1. Executes a SELECT query on the user table, selecting specific columns.
2. Asserts that the result has the expected number of columns.
3. Executes a SELECT query on the project_table, selecting a specific column.
4. Asserts that the result has the expected number of columns.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| importlib | Used to check if the 'requests' module is installed |
| os | Used to retrieve environment variables |
| pytest | Testing framework |
| mindsdb_sql | Used to parse SQL queries |

## Configuration
The test class uses several environment variables for configuration:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| LIGHTDASH_API_KEY | str | None | API key for Lightdash authentication |
| LIGHTDASH_BASE_URL | str | None | Base URL for Lightdash API |
| LIGHTDASH_PROJECT_UUID | str | None | UUID of the Lightdash project |
| LIGHTDASH_SPACE_UUID | str | None | UUID of the Lightdash space |
| LIGHTDASH_CHART_UUID | str | None | UUID of a Lightdash chart |
| LIGHTDASH_CHART_VERSION_UUID | str | None | UUID of a specific chart version |
| LIGHTDASH_SCHEDULER_UUID | str | None | UUID of a Lightdash scheduler |
| LIGHTDASH_JOB_ID | str | None | ID of a Lightdash job |

## Error Handling
The `run_sql` method includes basic error handling by asserting that the `error_code` is None after executing a query.