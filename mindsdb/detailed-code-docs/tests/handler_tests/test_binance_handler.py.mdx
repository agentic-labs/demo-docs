---
title: "test_binance_handler.py"
---

## High-level description
This file contains unit tests for the BinanceAggregatedTradesTable class, which is part of the Binance integration handler in MindsDB. The tests verify the functionality of retrieving columns and selecting data from the Binance aggregated trades table.

## Symbols

### BinanceAggregatedTradesTableTest
#### Description
This is a test class that inherits from `unittest.TestCase`. It contains three test methods to verify the functionality of the `BinanceAggregatedTradesTable` class.

#### Internal Logic
The class uses the `unittest` framework to define and run tests. It mocks the `BinanceHandler` to simulate API responses and tests the behavior of the `BinanceAggregatedTradesTable` class.

### test_get_columns_returns_all_columns
#### Description
This test method verifies that the `get_columns()` method of `BinanceAggregatedTradesTable` returns the expected list of column names in the correct order.

#### Internal Logic
1. Create a mock `BinanceHandler`.
2. Instantiate a `BinanceAggregatedTradesTable` with the mock handler.
3. Define the expected list of column names.
4. Assert that the `get_columns()` method returns the expected list.

### test_select_returns_all_columns
#### Description
This test method checks if the `select()` method of `BinanceAggregatedTradesTable` returns all columns when a SELECT * query is executed.

#### Internal Logic
1. Create a mock `BinanceHandler` and set up its `call_binance_api` method to return a sample DataFrame.
2. Instantiate a `BinanceAggregatedTradesTable` with the mock handler.
3. Create an AST `Select` object representing a SELECT * query.
4. Call the `select()` method with the query.
5. Assert that the returned DataFrame has the correct number of columns and values.

### test_select_returns_only_selected_columns
#### Description
This test method verifies that the `select()` method of `BinanceAggregatedTradesTable` returns only the specified columns when a SELECT query with specific columns is executed.

#### Internal Logic
1. Create a mock `BinanceHandler` and set up its `call_binance_api` method to return a sample DataFrame.
2. Instantiate a `BinanceAggregatedTradesTable` with the mock handler.
3. Create an AST `Select` object representing a query that selects only 'open_time' and 'close_time' columns.
4. Call the `select()` method with the query.
5. Assert that the returned DataFrame has only the two specified columns with correct values.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest | Provides the testing framework |
| unittest.mock | Used to create mock objects for testing |
| pandas | Used for handling DataFrame operations |
| mindsdb_sql.parser | Used for parsing SQL queries into AST objects |
| mindsdb.integrations.handlers.binance_handler | Contains the classes being tested |

This test file ensures that the `BinanceAggregatedTradesTable` class correctly handles column retrieval and data selection operations, both for all columns and specific column selections. It uses mocking to simulate the Binance API responses and focuses on testing the table's ability to process SQL-like queries and return appropriate results.