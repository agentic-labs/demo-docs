---
title: "test_pinecone_handler.py"
---

Here's a comprehensive documentation for the `TestPineconeHandler` class in the target file:

## High-level description
This class contains unit tests for the Pinecone handler in MindsDB. It tests various SQL operations like CREATE, SELECT, INSERT, and DELETE on a Pinecone database integration.

## Code Structure
The `TestPineconeHandler` class inherits from `BaseExecutorTest`. It uses the `run_sql` method to execute SQL queries and the `set_handler` method to mock the Postgres handler for testing purposes.

## Symbols

### TestPineconeHandler
#### Description
A test class for the Pinecone handler, containing various test methods for different SQL operations.

#### Internal Logic
- Uses `pytest.mark.skipif` to skip tests if the Pinecone client is not installed.
- Sets up a test Pinecone database in the `setup_method`.
- Mocks the Postgres handler to simulate data for testing.
- Executes SQL queries using the `run_sql` method inherited from `BaseExecutorTest`.

### run_sql
#### Description
Executes a SQL query and returns the result as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL query to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | pd.DataFrame | The result of the SQL query |

### setup_method
#### Description
Sets up the test environment before each test method is run.

#### Internal Logic
- Calls the parent `setup_method`.
- Creates a test Pinecone database using environment variables for API key and environment.

### test_create_with_select
#### Description
Tests creating a Pinecone table using a SELECT statement from a mocked Postgres table.

#### Internal Logic
- Mocks a Postgres table with test data.
- Executes a CREATE TABLE statement with a SELECT query.

### test_select_from
#### Description
Tests various SELECT queries on a Pinecone table.

#### Internal Logic
- Creates a test table with mocked data.
- Tests SELECT queries with different conditions (by id, search vector, metadata filter).

### test_insert_into
#### Description
Tests INSERT operations on a Pinecone table.

#### Internal Logic
- Creates a test table with mocked data.
- Performs INSERT operations and verifies the results.

### test_delete
#### Description
Tests DELETE operations on a Pinecone table.

#### Internal Logic
- Creates a test table with mocked data.
- Performs DELETE operations with different conditions and verifies the results.

### test_update
#### Description
Tests UPDATE operations on a Pinecone table (currently expected to fail).

#### Internal Logic
- Attempts to execute an UPDATE statement, which is expected to raise an exception.

### test_create_table
#### Description
Tests CREATE TABLE operations for Pinecone (currently expected to fail).

#### Internal Logic
- Attempts to create tables with different syntaxes, expecting failures.

### test_drop_table
#### Description
Tests DROP TABLE operations for Pinecone (currently expected to fail).

#### Internal Logic
- Attempts to drop tables, expecting failures.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework |
| pandas | Data manipulation and analysis |
| mindsdb_sql | SQL parsing and execution |
| unittest.mock | Mocking objects for testing |

## Error Handling
The tests use `pytest.raises` to check for expected exceptions in certain scenarios, such as unsupported operations.

## Notes
- Some tests are marked with `@pytest.mark.xfail`, indicating that they are expected to fail due to unimplemented or unsupported features in the Pinecone handler.
- The tests rely on environment variables `PINECONE_API_KEY` and `PINECONE_ENV` for authentication with Pinecone.
- The class is skipped entirely if the Pinecone client is not installed.

This documentation provides a comprehensive overview of the `TestPineconeHandler` class and its test methods, explaining the purpose and internal logic of each test case.