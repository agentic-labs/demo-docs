---
title: "test_instatus_handler.py"
---

## High-level description
This file contains unit tests for the InstatusHandler class, which is responsible for interacting with the Instatus API. The tests cover various operations such as checking connections, retrieving data, and performing CRUD operations on status pages and components.

## Code Structure
The code defines a single test class `InstatusHandlerTest` that inherits from `unittest.TestCase`. It contains multiple test methods that verify different functionalities of the `InstatusHandler` class.

## Symbols

### InstatusHandlerTest
#### Description
This class contains unit tests for the InstatusHandler. It sets up the handler with an API key and performs various tests on its methods.

#### Internal Logic
1. Sets up the InstatusHandler with an API key in the `setUpClass` method.
2. Initializes `pageId` and `componentId` in the `setUp` method for use in subsequent tests.
3. Contains multiple test methods that check different functionalities of the handler.

### test_0_check_connection
#### Description
Tests the connection to the Instatus API.

#### Internal Logic
Asserts that the `check_connection` method of the handler returns True.

### test_1_call_instatus_api
#### Description
Tests the `call_instatus_api` method of the handler.

#### Internal Logic
Asserts that the method returns a pandas DataFrame when called with the '/v2/pages' endpoint.

### test_2_get_tables
#### Description
Tests the `get_tables` method of the handler.

#### Internal Logic
Asserts that the returned value is not an error response.

### test_3_get_columns
#### Description
Tests the `get_columns` method of the handler for both 'status_pages' and 'components' tables.

#### Internal Logic
Asserts that the returned column information for both tables is not an error response.

### test_4_select_status_pages
#### Description
Tests selecting all columns from the status_pages table.

#### Internal Logic
Executes a SELECT query and asserts that it returns True.

### test_5_select_status_pages_by_conditions
#### Description
Tests selecting specific columns from the status_pages table with a WHERE condition.

#### Internal Logic
Executes a SELECT query with conditions and asserts that it returns True.

### test_6_insert_status_pages
#### Description
Tests inserting a new status page.

#### Internal Logic
Executes an INSERT query and asserts that it returns True. Handles the case where the subdomain is already taken.

### test_7_update_status_pages
#### Description
Tests updating an existing status page.

#### Internal Logic
Executes an UPDATE query with multiple fields and asserts that it returns True.

### test_8_select_components
#### Description
Tests selecting all components for a specific page.

#### Internal Logic
Executes a SELECT query for components and asserts that it returns True.

### test_9_select_components_by_conditions
#### Description
Tests selecting a specific component for a page.

#### Internal Logic
Executes a SELECT query with conditions for both page_id and component_id and asserts that it returns True.

### test_10_insert_components
#### Description
Tests inserting a new component.

#### Internal Logic
Executes an INSERT query for a component and asserts that it returns True.

### test_11_update_components
#### Description
Tests updating an existing component.

#### Internal Logic
Executes an UPDATE query for a component with multiple fields and asserts that it returns True.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest | Provides the testing framework |
| mindsdb.integrations.handlers.instatus_handler.instatus_handler | Contains the InstatusHandler class being tested |
| mindsdb.api.executor.data_types.response_type | Provides the RESPONSE_TYPE enum |
| pandas | Used for DataFrame operations |
| os | Used to access environment variables |

## Error Handling
The code includes basic error handling in the `test_6_insert_status_pages` method, where it catches an exception if the subdomain is already taken and prints a message.

## Configuration
The tests rely on environment variables for configuration:
| Option | Type | Description |
|:-------|:-----|:------------|
| INSTATUS_API_KEY | string | API key for authenticating with the Instatus API |
| EMAIL_ID | string | Email ID used for creating a new status page |

Note: These environment variables should be set before running the tests.