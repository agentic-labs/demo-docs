---
title: "test_oilpriceapi_handler.py"
---

## High-level description
This file contains unit tests for the OilPriceAPI handler in MindsDB. It tests the basic functionality of querying oil price data through the OilPriceAPI integration.

## Code Structure
The main class `TestOilPriceAPIHandler` inherits from `BaseExecutorTest`. It sets up the OilPriceAPI integration and tests various SQL queries against it.

## Symbols

### TestOilPriceAPIHandler
#### Description
A test class for the OilPriceAPI handler, which inherits from BaseExecutorTest. It sets up the OilPriceAPI integration and tests SQL queries against it.

#### Internal Logic
1. Checks if the 'requests' package is installed.
2. Sets up the OilPriceAPI integration using an API key from environment variables.
3. Tests basic and complex SELECT queries against the OilPriceAPI integration.

### run_sql
#### Description
A helper method that executes SQL queries and returns the result as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL query to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | DataFrame | The result of the SQL query as a pandas DataFrame |

#### Internal Logic
1. Executes the SQL command using the command executor.
2. Asserts that there is no error in the execution.
3. Returns the result as a DataFrame if data is available.

### setup_method
#### Description
Sets up the test environment by creating the OilPriceAPI database integration.

#### Internal Logic
1. Calls the parent class's setup_method.
2. Retrieves the API key from environment variables.
3. Executes SQL to create the OilPriceAPI database integration with the API key.

### test_basic_select_from
#### Description
Tests basic SELECT queries against the OilPriceAPI integration.

#### Internal Logic
1. Executes a SELECT query on the 'latest_price' table and asserts that it returns one row.
2. Executes a SELECT query on the 'past_day_price' table and asserts that it returns 20 rows.

### test_complex_select
#### Description
Tests more complex SELECT queries against the OilPriceAPI integration.

#### Internal Logic
1. Executes a SELECT query with WHERE conditions on the 'latest_price' table and asserts that it returns one column.
2. Executes a SELECT query with a LIMIT clause on the 'past_day_price' table and asserts that it returns one row.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| importlib | Used to check if the 'requests' package is installed |
| os | Used to retrieve environment variables |
| pytest | Testing framework |
| mindsdb_sql | Used to parse SQL queries |
| BaseExecutorTest | Base class for the test, providing common functionality |

## Error Handling
The code uses assertions to check for expected results and error conditions. If an assertion fails, the test will fail and report the error.

## Notes
- The tests are skipped if the 'requests' package is not installed.
- The OilPriceAPI key is expected to be set in the environment variable "OILPRICEAPI_KEY".
- The tests assume that the OilPriceAPI integration is working correctly and returning expected data.