---
title: "test_aqicn_handler.py"
---

## High-level description
This file contains unit tests for the AQICN (Air Quality Index China) handler in MindsDB. It tests the basic functionality of querying air quality data from the AQICN API using SQL-like syntax through MindsDB's interface.

## Code Structure
The main class `TestAQICNHandler` inherits from `BaseExecutorTest` and contains setup methods and test cases for different SQL queries to the AQICN handler.

## Symbols

### TestAQICNHandler
#### Description
A test class for the AQICN handler, containing methods to set up the test environment and run test cases for various SQL queries.

#### Internal Logic
1. Sets up the test environment by creating a MindsDB database with the AQICN engine.
2. Runs test cases for basic and complex SELECT queries on different AQICN tables.

### run_sql
#### Description
A method to execute SQL queries and return the results as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | The SQL query to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| DataFrame | pandas.DataFrame | The result of the SQL query |

#### Internal Logic
1. Executes the SQL command using the command executor.
2. Checks for errors and raises an assertion if any occur.
3. Returns the result as a DataFrame if data is available.

### setup_method
#### Description
Sets up the test environment before each test method is run.

#### Internal Logic
1. Calls the parent class's setup method.
2. Retrieves the AQICN API key from environment variables.
3. Creates a MindsDB database with the AQICN engine and the API key.

### test_basic_select_from
#### Description
Tests basic SELECT queries for different AQICN tables.

#### Internal Logic
1. Queries air quality data for Bangalore city.
2. Queries air quality data for specific latitude and longitude.
3. Queries air quality data for the user's location.
4. Asserts that each query returns one row of data.

### test_complex_select
#### Description
Tests more complex SELECT queries with specific column selections and limits.

#### Internal Logic
1. Queries specific columns (URL and name) for a given latitude and longitude.
2. Queries all columns from the user location table with a LIMIT clause.
3. Asserts the expected number of columns and rows in the results.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| importlib | For dynamically importing modules |
| os | For accessing environment variables |
| pytest | For test annotations and skipping tests |
| mindsdb_sql | For parsing SQL queries |
| requests | For making HTTP requests (checked for installation) |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| AQICN_KEY | str | None | API key for AQICN, retrieved from environment variables |

## Error Handling
The code uses assertions to check for errors in SQL execution and to verify the expected shape of result DataFrames.

## Notes
- The test class is skipped if the `requests` package is not installed.
- The AQICN API key is expected to be set in the environment variables.
- The tests cover basic functionality of querying air quality data using SQL through MindsDB's AQICN handler.