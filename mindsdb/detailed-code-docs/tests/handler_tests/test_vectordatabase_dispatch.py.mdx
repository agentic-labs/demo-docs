---
title: "test_vectordatabase_dispatch.py"
---

## High-level description
This file contains unit tests for the `VectorStoreHandler` class, specifically testing the parsing and dispatching of SQL queries for vector database operations. It covers various SQL operations like CREATE TABLE, DROP TABLE, INSERT, SELECT, and DELETE, ensuring that the handler correctly interprets and executes these operations on a vector database.

## Code Structure
The main test function `test_vectordatabase_parsing` tests different SQL operations by parsing SQL queries and calling the `_dispatch` method of the `VectorStoreHandler`. It then asserts that the correct handler methods are called with the expected arguments. The `test_unsupported_ops` function tests error handling for unsupported operations or columns.

## Symbols

### `vector_store_handler`
#### Description
A pytest fixture that creates a mock `VectorStoreHandler` object with mocked execute methods for testing.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| vector_store_handler | VectorStoreHandler | A mocked VectorStoreHandler object |

### `test_vectordatabase_parsing`
#### Description
Tests the parsing and dispatching of various SQL operations for vector databases.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| vector_store_handler | VectorStoreHandler | The mocked VectorStoreHandler fixture |

#### Internal Logic
1. Tests CREATE TABLE operation
2. Tests DROP TABLE operation
3. Tests INSERT operation
4. Tests SELECT operations with various conditions and filters
5. Tests DELETE operation

### `test_unsupported_ops`
#### Description
Tests error handling for unsupported operations or columns in SQL queries.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| vector_store_handler | VectorStoreHandler | The mocked VectorStoreHandler fixture |

#### Internal Logic
1. Tests selecting unsupported columns
2. Tests inserting unsupported columns
3. Tests unsupported filters in SELECT queries

### `test_unimplemented_yet`
#### Description
Tests for operations that are not yet implemented, such as SELECT COUNT(*).

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| vector_store_handler | VectorStoreHandler | The mocked VectorStoreHandler fixture |

#### Internal Logic
Attempts to execute a SELECT COUNT(*) query and expects it to raise an exception.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest.mock | For creating mock objects |
| pandas | For data manipulation and testing |
| pytest | For test framework and assertions |
| mindsdb_sql | For SQL parsing |
| mindsdb.integrations.libs.vectordatabase_handler | For VectorStoreHandler and related classes |

## Error Handling
The test cases include assertions to check for expected exceptions when dealing with unsupported operations or columns. For example, it checks if an exception is raised when trying to select or insert unsupported columns.

## TODOs
The `test_unimplemented_yet` function is marked with `@pytest.mark.xfail`, indicating that the SELECT COUNT(*) operation is not implemented yet and is expected to fail.