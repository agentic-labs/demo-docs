---
title: "test_coinbase_handler.py"
---

## High-level description
This file contains unit tests for the CoinBaseAggregatedTradesTable class, which is part of the Coinbase integration handler in MindsDB. The tests verify the functionality of column retrieval and data selection from the Coinbase API, ensuring that the handler correctly processes and returns trade data.

## Code Structure
The main class being tested is `CoinBaseAggregatedTradesTable`. The tests use the `unittest` framework and mock objects to simulate the behavior of the `CoinBaseHandler`.

## Symbols

### CoinBaseAggregatedTradesTableTest
#### Description
This is a test class that inherits from `unittest.TestCase`. It contains three test methods to verify the functionality of the `CoinBaseAggregatedTradesTable` class.

#### Internal Logic
The class sets up mock objects for the `CoinBaseHandler` and uses them to test the `CoinBaseAggregatedTradesTable` methods.

### test_get_columns_returns_all_columns
#### Description
This test method verifies that the `get_columns()` method of `CoinBaseAggregatedTradesTable` returns the expected list of column names.

#### Internal Logic
1. Create a mock `CoinBaseHandler` object.
2. Instantiate a `CoinBaseAggregatedTradesTable` with the mock handler.
3. Define the expected list of column names.
4. Assert that the `get_columns()` method returns the expected list.

### test_select_returns_all_columns
#### Description
This test method checks if the `select()` method of `CoinBaseAggregatedTradesTable` returns all columns when a SELECT * query is executed.

#### Internal Logic
1. Create a mock `CoinBaseHandler` object and set its `call_coinbase_api` method to return a sample DataFrame.
2. Instantiate a `CoinBaseAggregatedTradesTable` with the mock handler.
3. Create an AST `Select` object representing a SELECT * query.
4. Call the `select()` method with the query.
5. Assert that the returned DataFrame has the expected shape and values.

### test_select_returns_only_selected_columns
#### Description
This test method verifies that the `select()` method of `CoinBaseAggregatedTradesTable` returns only the specified columns when a SELECT query with specific columns is executed.

#### Internal Logic
1. Create a mock `CoinBaseHandler` object and set its `call_coinbase_api` method to return a sample DataFrame.
2. Instantiate a `CoinBaseAggregatedTradesTable` with the mock handler.
3. Create an AST `Select` object representing a query for specific columns (open and close).
4. Call the `select()` method with the query.
5. Assert that the returned DataFrame has the expected shape and contains only the specified columns.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| unittest | Provides the testing framework |
| unittest.mock | Used to create mock objects for testing |
| pandas | Used for data manipulation and analysis |
| mindsdb_sql.parser | Used for parsing SQL queries |
| mindsdb.integrations.handlers.coinbase_handler | Contains the classes being tested |

## Error Handling
The tests do not explicitly handle errors but rely on the `unittest` framework to catch and report any assertion failures or exceptions raised during test execution.

Your response should not exceed 3000 words or 4000 tokens. Focus on providing clear, concise information that can be directly inferred from the code. Include optional sections only when they provide significant value for understanding the code.