---
title: "test_weaviate_handler.py"
---

## High-level description
This file contains unit tests for the Weaviate handler in MindsDB. It tests various SQL operations (CREATE, INSERT, SELECT, DELETE) on a Weaviate database, focusing on vector database functionality.

## Code Structure
The main class `TestWeaviateHandler` inherits from `BaseExecutorTest` and contains multiple test methods, each testing different SQL operations. The class uses pytest for test organization and execution.

## Symbols

### `TestWeaviateHandler`
#### Description
A test class for the Weaviate handler, containing methods to test various SQL operations on a Weaviate database.

#### Internal Logic
1. Sets up a temporary Weaviate database connection for each test.
2. Executes SQL commands using the `run_sql` method.
3. Tests different SQL operations (CREATE, INSERT, SELECT, DELETE) with various scenarios.
4. Uses mock data and patched PostgreSQL handler for testing.

### `run_sql`
#### Description
A helper method to execute SQL commands and return the result as a pandas DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | SQL command to execute |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | pandas.DataFrame | Result of the SQL command execution |

### `setup_method`
#### Description
Sets up the test environment by creating a temporary Weaviate database connection.

### `teardown_class`
#### Description
Cleans up the test environment by killing any orphan Weaviate processes.

### `test_create_table`
#### Description
Tests the creation of tables in the Weaviate database.

### `test_create_with_select`
#### Description
Tests creating a table using a SELECT statement.

### `test_drop_table`
#### Description
Tests dropping tables from the Weaviate database.

### `test_insert_into`
#### Description
Tests inserting data into Weaviate tables using various methods.

### `test_select_from`
#### Description
Tests selecting data from Weaviate tables with different filters and conditions.

### `test_update`
#### Description
Tests updating data in Weaviate tables (currently marked as expected to fail).

### `test_delete`
#### Description
Tests deleting data from Weaviate tables using different conditions.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Test framework |
| pandas | Data manipulation and analysis |
| mindsdb_sql | SQL parsing |
| psutil | Process and system utilities |
| unittest.mock | Mocking for tests |
| importlib | Dynamic import of modules |
| tempfile | Temporary file and directory creation |

## Error Handling
The tests use pytest's assertion mechanisms and exception raising to handle and verify error cases. For example, some operations are expected to raise exceptions, which are caught and verified using `pytest.raises`.

## Notes
1. Some tests are marked with `@pytest.mark.xfail`, indicating that they are expected to fail due to known issues or unimplemented features.
2. The code uses mocking to simulate a PostgreSQL handler for some tests.
3. The tests cover various edge cases and error scenarios, such as inserting data with mismatched dimensions or attempting to perform unsupported operations.