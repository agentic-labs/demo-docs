---
title: "test_mariadb_handler.py"
---

## High-level description
This file contains unit tests for the MariaDBHandler class, which is responsible for handling connections and operations with MariaDB databases. The tests cover various functionalities such as connecting to the database, executing queries, and managing tables, both with and without SSL encryption.

## Code Structure
The code is structured as a pytest test suite with a fixture that sets up a Docker container running MariaDB for testing purposes. The main test class, `TestMariaDBHandler`, contains multiple test methods that exercise different aspects of the MariaDBHandler functionality.

## References
- `mindsdb.integrations.handlers.mariadb_handler.mariadb_handler.MariaDBHandler`
- `mindsdb.api.executor.data_types.response_type.RESPONSE_TYPE`
- `mindsdb.utilities.fs.safe_extract`

## Symbols

### `get_certs()`
#### Description
Retrieves SSL certificate file paths for MariaDB connection.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| certs | dict | Dictionary containing paths to SSL certificate files |

### `get_certificates(container)`
#### Description
Extracts SSL certificates from a Docker container and updates the `HANDLER_KWARGS` with the certificate paths.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| container | docker.Container | Docker container object |

### `waitReadiness(container, timeout=30)`
#### Description
Waits for the MariaDB container to be ready for connections.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| container | docker.Container | Docker container object |
| timeout | int | Maximum wait time in seconds |

### `handler(request)`
#### Description
Pytest fixture that sets up a MariaDB Docker container and returns a MariaDBHandler instance for testing.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| request | pytest.FixtureRequest | Pytest request object |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| handler | MariaDBHandler | Configured MariaDBHandler instance |

### `TestMariaDBHandler`
#### Description
Test class containing various test methods for the MariaDBHandler.

#### Internal Logic
The class includes test methods for:
1. Connecting to the database
2. Checking connection
3. Executing native queries
4. Getting tables
5. Describing tables
6. Creating tables
7. Dropping tables
8. Executing SELECT queries

Each test method verifies the expected behavior of the corresponding MariaDBHandler functionality.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework |
| docker | Managing Docker containers for testing |
| time | Handling timeouts |
| os | File and directory operations |
| shutil | High-level file operations |
| tarfile | Working with tar archives |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| HANDLER_KWARGS | dict | - | Configuration for MariaDBHandler |
| CERTS_ARCHIVE | str | "certs.tar" | Name of the SSL certificates archive |
| CERTS_DIR | str | "mysql" | Directory name for SSL certificates |

## Error Handling
The code implements basic error handling through assertions in test methods and exception handling in the fixture setup and teardown.

## API/Interface Reference
The test suite exercises the following MariaDBHandler methods:
| Method | Description |
|:-------|:------------|
| connect() | Establishes a connection to the database |
| check_connection() | Verifies the database connection |
| native_query(query) | Executes a native SQL query |
| get_tables() | Retrieves a list of tables in the database |
| get_columns(table) | Describes the columns of a specified table |
| query(query) | Executes a SELECT query |

The tests verify the correctness of these methods' outputs and behavior.