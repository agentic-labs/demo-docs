---
title: "test_luma_handler.py"
---

## High-level description
This file contains unit tests for the Luma handler in MindsDB. It tests the basic functionality of querying events from the Luma API using SQL-like syntax through MindsDB's SQL parser and executor.

## Code Structure
The main class `TestLumaHandler` inherits from `BaseExecutorTest` and contains setup methods and test cases for the Luma handler.

## Symbols

### TestLumaHandler
#### Description
A test class for the Luma handler, which sets up a connection to the Luma API and tests basic SQL queries.

#### Internal Logic
1. Checks if the `requests` library is installed.
2. Sets up a connection to the Luma API using an environment variable for the API key.
3. Executes SQL queries to test the functionality of the Luma handler.

### run_sql
#### Description
A helper method that executes SQL commands and returns the result as a DataFrame.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sql | str | SQL query to be executed |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| DataFrame | pandas.DataFrame | Result of the SQL query |

#### Internal Logic
1. Parses the SQL query using MindsDB's SQL parser.
2. Executes the command using the command executor.
3. Checks for errors and returns the result as a DataFrame.

### setup_method
#### Description
Sets up the test environment by creating a connection to the Luma API.

#### Internal Logic
1. Calls the superclass setup method.
2. Retrieves the Luma API key from environment variables.
3. Executes an SQL command to create a database connection to Luma.

### test_basic_select_from
#### Description
Tests basic SELECT queries on the Luma events table.

#### Internal Logic
1. Executes a SELECT * query on the events table.
2. Executes a SELECT query with a WHERE clause to fetch a specific event.
3. Asserts that the second query returns exactly one row.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| importlib | Used to check if the `requests` library is installed |
| os | Used to retrieve environment variables |
| pytest | Testing framework |
| mindsdb_sql | SQL parsing library |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| LUMA_API_KEY | str | None | API key for authenticating with the Luma API |

## Error Handling
The code checks for the presence of the `requests` library and skips the tests if it's not installed. It also asserts that the SQL execution doesn't return any error codes.