---
title: "models_test.py"
---

## High-level description
This file contains unit tests for the HTTP API endpoints related to model management in MindsDB. It tests various functionalities such as creating, retrieving, and deleting models, as well as handling error cases.

## Code Structure
The code is structured as a series of pytest test functions, with two fixtures (`app` and `client`) used to set up the testing environment. The tests cover different scenarios for model creation, retrieval, and deletion, as well as error handling for invalid inputs or non-existent resources.

## Symbols

### `app`
#### Description
A pytest fixture that initializes the Flask application for testing, sets up a temporary database, and creates an example integration database.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| app | Flask | The initialized Flask application |

#### Internal Logic
1. Sets up a temporary directory for the database
2. Initializes the database and runs migrations
3. Creates the Flask app using `initialize_app`
4. Creates an example integration database
5. Yields the app for testing
6. Cleans up the environment after tests

### `client`
#### Description
A pytest fixture that creates a test client for the Flask application.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| app | Flask | The Flask application |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| client | FlaskClient | A test client for the Flask application |

### `test_train_model`
#### Description
Tests the creation of a new model using the API.

#### Internal Logic
1. Sends a POST request to create a new model
2. Asserts that the response status is 201 (Created)
3. Compares the created model details with expected values

### `test_train_model_no_query_aborts`
#### Description
Tests that attempting to create a model without a query results in a 400 error.

### `test_train_model_no_project_aborts`
#### Description
Tests that attempting to create a model in a non-existent project results in a 404 error.

### `test_train_model_invalid_query_aborts`
#### Description
Tests that attempting to create a model with an invalid query results in a 400 error.

### `test_train_model_no_create_query_aborts`
#### Description
Tests that attempting to create a model without a CREATE query results in a 400 error.

### `test_train_model_already_exists_aborts`
#### Description
Tests that attempting to create a model with a name that already exists results in a 409 error.

### `test_train_model_no_ml_handler_aborts`
#### Description
Tests that attempting to create a model with a non-existent ML engine results in a 404 error.

### `test_get_model_by_version`
#### Description
Tests retrieving a model by its version and comparing it with the active version.

### `test_get_model_no_project_aborts`
#### Description
Tests that attempting to retrieve a model from a non-existent project results in a 404 error.

### `test_predict_model_no_project_aborts`
#### Description
Tests that attempting to make a prediction with a non-existent project results in a 404 error.

### `test_predict_model_no_model_aborts`
#### Description
Tests that attempting to make a prediction with a non-existent model results in a 404 error.

### `test_describe_model_no_project_aborts`
#### Description
Tests that attempting to describe a model in a non-existent project results in a 404 error.

### `test_describe_model_no_model_aborts`
#### Description
Tests that attempting to describe a non-existent model results in a 404 error.

### `test_delete_model`
#### Description
Tests the deletion of a model using the API.

#### Internal Logic
1. Creates a new model
2. Deletes the model
3. Asserts that the deletion was successful (204 status)
4. Attempts to retrieve the deleted model and asserts it results in a 404 error

### `test_delete_model_no_project_aborts`
#### Description
Tests that attempting to delete a model from a non-existent project results in a 404 error.

### `test_delete_model_no_model_aborts`
#### Description
Tests that attempting to delete a non-existent model results in a 404 error.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework |
| Flask | Web application framework |
| mindsdb | Main MindsDB library |

## Configuration
The tests use a temporary SQLite database for testing, configured through environment variables and the `Config` object from MindsDB.

## Error Handling
The tests cover various error scenarios, including:
- Missing or invalid queries
- Non-existent projects or models
- Duplicate model names
- Invalid ML engines

These scenarios are tested to ensure the API returns appropriate HTTP status codes and error messages.