---
title: "test-release.yml"
---

## High-level description
This GitHub Actions workflow, named "Test release", is designed to test and potentially release a new version of a software package. It retrieves the latest release tags, validates upgrades across different warehouse types, and optionally bumps the version number if all tests pass successfully.

## Code Structure
The workflow consists of four main jobs: `get-latest-release-tags`, `validate-upgrade-cli`, `recommendation`, and `bump-version`. These jobs work together to test the release process and provide recommendations for version upgrades.

## Symbols

### Job: get-latest-release-tags
#### Description
This job retrieves the latest release tags for both the current repository and a related dbt-data-reliability repository. It also calculates the next version numbers for both.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| py | string | Latest Python package version tag |
| py-number | string | Latest Python package version number (without 'v' prefix) |
| dbt | string | Latest dbt-data-reliability package version tag |
| py-bumped-number | string | Next Python package version number |
| dbt-bumped | string | Next dbt-data-reliability package version tag |
| py-bumped | string | Next Python package version tag |

#### Internal Logic
1. Retrieves latest release tags using GitHub API
2. Extracts version numbers and calculates next versions
3. Outputs the retrieved and calculated version information

### Job: validate-upgrade-cli
#### Description
This job runs tests for different warehouse types to validate the upgrade process.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| warehouse-type | string | Type of warehouse to test |
| dbt-data-reliability-ref | string | Reference to the dbt-data-reliability package version |

#### Internal Logic
1. Uses a matrix strategy to test multiple warehouse types
2. Calls a reusable workflow `test-warehouse.yml` for each warehouse type
3. Passes the dbt-data-reliability reference from the previous job

### Job: recommendation
#### Description
This job provides recommendations based on the test results.

#### Internal Logic
1. If all tests pass, it recommends bumping the version
2. If any test fails, it suggests keeping backward compatibility or updating the minor version

### Job: bump-version
#### Description
This job bumps the version numbers if specified in the workflow input.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| should-bump-on-success | boolean | Whether to bump the version on successful tests |

#### Internal Logic
1. Only runs if `should-bump-on-success` is true
2. Uses a reusable workflow `bump-version.yml` to update version numbers

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| actions/github-script@v6 | Used for setting failure message in the recommendation job |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| should-bump-on-success | boolean | false | Determines whether to bump the version after successful tests |

## Error Handling
The workflow uses a `fail-fast: false` strategy in the `validate-upgrade-cli` job to continue testing all warehouse types even if one fails. The `recommendation` job provides different outputs based on the success or failure of the tests.