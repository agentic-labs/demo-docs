---
title: "test_alert_filters.py"
---

## High-level description
This code defines unit tests for alert filtering functionality in the Elementary monitoring system. It tests various filter functions that operate on different types of alerts (test, model, and source freshness) based on criteria such as tags, owners, models, statuses, and resource types.

## Code Structure
The code is structured as a series of test functions, each focusing on a specific aspect of alert filtering. These functions use a common set of sample alerts defined in the `initial_alerts()` function. The main filtering function `filter_alerts()` is tested indirectly through the individual filter functions.

## Symbols

### `initial_alerts()`
#### Description
This function creates and returns sample alerts for testing purposes.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| test_alerts | List[PendingAlertSchema] | A list of sample test alerts |
| model_alerts | List[PendingAlertSchema] | A list of sample model alerts |
| source_freshness_alerts | List[PendingAlertSchema] | A list of sample source freshness alerts |

### `test_find_common_alerts()`
#### Description
Tests the `_find_common_alerts()` function, which finds alerts common to two lists of alerts.

#### Internal Logic
1. Creates two sets of alerts with some overlap
2. Calls `_find_common_alerts()` with these sets
3. Asserts that the correct common alerts are returned

### `test_filter_alerts_by_tags()`
#### Description
Tests the `_filter_alerts_by_tags()` function, which filters alerts based on their tags.

#### Internal Logic
1. Creates various tag filters
2. Applies these filters to the sample alerts
3. Asserts that the correct alerts are returned for each filter

### `test_filter_alerts_by_owners()`
#### Description
Tests the `_filter_alerts_by_owners()` function, which filters alerts based on their owners.

#### Internal Logic
1. Creates owner filters for "jeff" and "john"
2. Applies these filters to the sample alerts
3. Asserts that the correct alerts are returned for each filter

### `test_filter_alerts_by_model()`
#### Description
Tests the `_filter_alerts_by_models()` function, which filters alerts based on their associated models.

#### Internal Logic
1. Creates model filters for "model_id_1" and "model_id_2"
2. Applies these filters to the sample alerts
3. Asserts that the correct alerts are returned for each filter

### `test_filter_alerts_by_node_names()`
#### Description
Tests the `_filter_alerts_by_node_names()` function, which filters alerts based on their node names.

#### Internal Logic
1. Creates node name filters
2. Applies these filters to the sample alerts
3. Asserts that the correct alerts are returned for each filter

### `test_filter_alerts_by_statuses()`
#### Description
Tests the `_filter_alerts_by_statuses()` function, which filters alerts based on their statuses.

#### Internal Logic
1. Creates status filters for WARN, ERROR, SKIPPED, FAIL, and RUNTIME_ERROR
2. Applies these filters to the sample alerts
3. Asserts that the correct alerts are returned for each filter

### `test_filter_alerts_by_resource_types()`
#### Description
Tests the `_filter_alerts_by_resource_types()` function, which filters alerts based on their resource types.

#### Internal Logic
1. Creates resource type filters for TEST and MODEL
2. Applies these filters to the sample alerts
3. Asserts that the correct alerts are returned for each filter

### `test_filter_alerts()`
#### Description
Tests the main `filter_alerts()` function, which combines all the individual filters.

#### Internal Logic
1. Tests with an empty filter (should return all alerts except skipped)
2. Tests with no filter (should return all alerts except skipped)
3. Tests with an unsupported selector (should return no alerts)

### `test_multi_filters()`
#### Description
Tests the `filter_alerts()` function with multiple filters applied simultaneously.

#### Internal Logic
1. Creates filters combining tags, owners, and statuses
2. Applies these filters to the sample alerts
3. Asserts that the correct alerts are returned for each combination of filters

## Dependencies
The code relies on the following internal modules:
- `elementary.monitor.api.alerts.alert_filters`
- `elementary.monitor.data_monitoring.schema`
- `elementary.monitor.fetchers.alerts.schema.pending_alerts`

These modules provide the necessary data structures and filtering functions that are being tested.