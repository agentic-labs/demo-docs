---
title: "test_tests_api.py"
---

## High-level description
This file contains unit tests for the `TestsAPI` class, specifically focusing on the `_get_test_metadata_from_test_result_db_row` method. The tests verify that the method correctly extracts and formats test metadata from both Elementary and dbt test result database rows.

## Symbols

### `test_get_test_metadata_from_test_result_db_row`
#### Description
This function tests the `_get_test_metadata_from_test_result_db_row` method of the `MockTestsAPI` class. It verifies that the method correctly extracts and formats test metadata from both Elementary and dbt test result database rows.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| tests_api_mock | MockTestsAPI | An instance of the MockTestsAPI class |

#### Internal Logic
1. Retrieves all test result database rows from the mock tests fetcher.
2. Extracts the first row (Elementary test) and the last row (dbt test) for testing.
3. Calls `_get_test_metadata_from_test_result_db_row` for both Elementary and dbt test rows.
4. Asserts that the generated metadata for the Elementary test contains the correct configuration:
   - test_name
   - timestamp_column
   - testing_timeframe
   - anomaly_threshold
5. Asserts that the generated metadata for the dbt test contains the correct configuration:
   - test_name
   - test_params

### `tests_api_mock`
#### Description
This is a pytest fixture that creates and returns an instance of the `MockTestsAPI` class.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| tests_api_mock | MockTestsAPI | An instance of the MockTestsAPI class |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework used for writing and running the tests |
| tests.mocks.api.tests_api_mock.MockTestsAPI | Mock class for TestsAPI used in testing |

## References
The test file references the following components from other parts of the codebase:
- `MockTestsAPI`: A mock implementation of the `TestsAPI` class used for testing purposes.
- `TestResultDBRowSchema`: A schema representing the structure of a test result database row.

## Notes
- The test assumes that the `MockTestsAPI` class and its dependencies (`MockDbtRunner`, `MockTestsFetcher`) are correctly implemented and return the expected data.
- The test focuses on verifying the correct extraction and formatting of metadata from test result database rows, both for Elementary tests and dbt tests.
- The `testing_timeframe` is hardcoded to "1 hour" in the test, which might be a specific implementation detail of the `_get_test_metadata_from_test_result_db_row` method.