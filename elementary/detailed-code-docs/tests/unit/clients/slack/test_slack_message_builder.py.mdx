---
title: "test_slack_message_builder.py"
---

## High-level description
This file contains unit tests for the `SlackMessageBuilder` class, which is responsible for creating various Slack message components such as blocks, sections, and attachments. The tests ensure that the methods in `SlackMessageBuilder` correctly generate the expected JSON structures for different Slack message elements.

## Symbols

### `test_create_divider_block`
#### Description
Tests the `create_divider_block` method of `SlackMessageBuilder`.

#### Internal Logic
1. Calls `SlackMessageBuilder.create_divider_block()`
2. Asserts that the returned JSON matches the expected divider block structure

### `test_create_fields_section_block`
#### Description
Tests the `create_fields_section_block` method of `SlackMessageBuilder` with one and two section messages.

#### Internal Logic
1. Tests with a single section message
2. Tests with two section messages
3. Asserts that the returned JSON matches the expected fields section block structure for both cases

### `test_create_text_section_block`
#### Description
Tests the `create_text_section_block` method of `SlackMessageBuilder` with different input messages.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| section_message | str | The message to be included in the text section block |

#### Internal Logic
1. Calls `SlackMessageBuilder.create_text_section_block(section_message)`
2. Asserts that the returned JSON matches the expected text section block structure

### `test_create_empty_section_block`
#### Description
Tests the `create_empty_section_block` method of `SlackMessageBuilder`.

#### Internal Logic
1. Calls `SlackMessageBuilder.create_empty_section_block()`
2. Asserts that the returned JSON matches the expected empty section block structure

### `test_create_context_block`
#### Description
Tests the `create_context_block` method of `SlackMessageBuilder` with one and two context messages.

#### Internal Logic
1. Tests with a single context message
2. Tests with two context messages
3. Asserts that the returned JSON matches the expected context block structure for both cases

### `test_create_header_block`
#### Description
Tests the `create_header_block` method of `SlackMessageBuilder` with different input messages.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| message | str | The message to be included in the header block |

#### Internal Logic
1. Calls `SlackMessageBuilder.create_header_block(message)`
2. Asserts that the returned JSON matches the expected header block structure

### `test_create_compacted_sections_blocks`
#### Description
Tests the `create_compacted_sections_blocks` method of `SlackMessageBuilder` with various numbers of section messages.

#### Internal Logic
1. Tests with no sections
2. Tests with an even number of sections
3. Tests with an odd number of sections
4. Asserts that the returned JSON matches the expected compacted sections block structure for all cases

### `test_get_slack_message`
#### Description
Tests the `get_slack_message` method of `SlackMessageBuilder`.

#### Internal Logic
1. Creates a `SlackMessageBuilder` instance
2. Calls `get_slack_message()`
3. Asserts that the returned object is an instance of `SlackMessageSchema`
4. Asserts that the returned JSON matches the expected initial slack message structure

### `test_add_blocks_as_attachments`
#### Description
Tests the `_add_blocks_as_attachments` method of `SlackMessageBuilder`.

#### Internal Logic
1. Creates a `SlackMessageBuilder` instance
2. Adds two different blocks as attachments
3. Asserts that the returned JSON matches the expected structure with the added blocks

### `test_add_always_displayed_blocks`
#### Description
Tests the `_add_always_displayed_blocks` method of `SlackMessageBuilder`.

#### Internal Logic
1. Creates a `SlackMessageBuilder` instance
2. Adds two different blocks as always displayed blocks
3. Asserts that the returned JSON matches the expected structure with the added blocks

### `test_get_limited_markdown_msg`
#### Description
Tests the `get_limited_markdown_msg` method of `SlackMessageBuilder`.

#### Internal Logic
1. Tests with a short message
2. Tests with a long message
3. Asserts that the short message is returned unchanged
4. Asserts that the long message is truncated to the maximum length and ends with "...age"

### `test_create_button_action_block`
#### Description
Tests the `create_button_action_block` method of `SlackMessageBuilder`.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| text | str | The text to be displayed on the button |
| url | str | The URL the button should link to |

#### Internal Logic
1. Calls `SlackMessageBuilder.create_button_action_block(text, url)`
2. Asserts that the returned JSON matches the expected button action block structure

### `test_slack_message_attachments_limit`
#### Description
Tests the attachment limit validation in `SlackMessageSchema`.

#### Internal Logic
1. Tests with fewer attachments than the limit
2. Tests with exactly the maximum number of attachments
3. Tests with more attachments than the limit
4. Asserts that the attachments are handled correctly in each case

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pytest | Testing framework used for all test cases |
| json | Used for JSON serialization and comparison |
| slack_sdk.models.blocks | Used for `SectionBlock` in `test_get_limited_markdown_msg` |
| elementary.clients.slack.schema | Provides `SlackMessageSchema` |
| elementary.clients.slack.slack_message_builder | Provides `SlackMessageBuilder` class being tested |

This test file ensures that the `SlackMessageBuilder` class correctly generates various Slack message components and adheres to Slack's message structure requirements.