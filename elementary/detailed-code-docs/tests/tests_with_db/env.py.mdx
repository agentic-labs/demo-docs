---
title: "env.py"
---

## High-level description
This code defines an environment setup for running tests with a database. It provides functionality to initialize and clear the test environment using a dbt runner. The main purpose is to ensure a clean and consistent state for each test run.

## Code Structure
The code consists of two main components: the `init` function and the `Environment` class. The `init` function creates an `Environment` instance and calls its methods to clear and initialize the environment. The `Environment` class encapsulates the logic for clearing and initializing the test environment using a dbt runner.

## Symbols

### `init`
#### Description
This function initializes the test environment using a provided dbt runner.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| dbt_runner | SubprocessDbtRunner | An instance of SubprocessDbtRunner used to execute dbt commands |

#### Internal Logic
1. Creates an `Environment` instance with the provided `dbt_runner`.
2. Calls the `clear` method to clean up the existing environment.
3. Calls the `init` method to set up the initial state of the environment.

### `Environment`
#### Description
This class represents the test environment and provides methods to clear and initialize it.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| dbt_runner | SubprocessDbtRunner | An instance of SubprocessDbtRunner used to execute dbt commands |

### `Environment.clear`
#### Description
Clears the test environment by running a specific dbt operation.

#### Internal Logic
Executes the dbt operation "elementary_tests.clear_env" using the dbt runner.

### `Environment.init`
#### Description
Initializes the test environment by running specific dbt commands.

#### Internal Logic
1. Runs the dbt command with the selector "init".
2. Runs the dbt command to select and execute the "elementary" models.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| elementary.clients.dbt.subprocess_dbt_runner.SubprocessDbtRunner | Used to execute dbt commands in a subprocess |

## References
The code references the `SubprocessDbtRunner` class from the `elementary.clients.dbt.subprocess_dbt_runner` module. This class is used to execute dbt commands and is crucial for the functioning of the `Environment` class.

The related code snippet from `tests/tests_with_db/conftest.py` shows how this environment setup is used in the context of pytest fixtures. The `init_tests_env` fixture uses the `init` function defined in this file to set up the test environment before running tests.