---
title: "slack_message_builder.py"
---

## High-level description
The `slack_message_builder.py` file defines a `SlackMessageBuilder` class that provides methods for constructing and formatting Slack messages. It includes utilities for creating various types of Slack blocks, handling message limitations, and building complex message structures for alerts and reports.

## Code Structure
The main class `SlackMessageBuilder` contains methods for creating different types of Slack blocks (e.g., header, section, context) and utilities for managing message structure. It also includes constants for Slack-specific limitations and formatting options.

## Symbols

### `SlackMessageBuilder`
#### Description
A class that provides methods for building and formatting Slack messages, including various block types and message structure management.

#### Internal Logic
- Initializes with an empty Slack message structure
- Provides methods for creating different types of Slack blocks (e.g., header, section, context)
- Handles message text limitations and formatting
- Manages the overall structure of the Slack message, including blocks and attachments

### `SlackMessageBuilder.get_limited_markdown_msg`
#### Description
Limits the length of a markdown message to fit within Slack's text limitations.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| section_msg | str | The original markdown message |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| limited_msg | str | The truncated message if necessary |

#### Internal Logic
- Checks if the message length exceeds Slack's limit
- If it does, truncates the message and adds a continuation symbol

### `SlackMessageBuilder.create_fields_section_block`
#### Description
Creates a Slack section block with multiple fields.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| section_msgs | list | List of messages to be included as fields |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| block | dict | A Slack section block with fields |

#### Internal Logic
- Iterates through the input messages
- Creates a field for each message, applying length limitations
- Returns a dictionary representing the Slack section block

### `SlackMessageBuilder.create_compacted_sections_blocks`
#### Description
Creates compacted section blocks for a list of messages.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| section_msgs | list | List of messages to be compacted into sections |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| attachments | List[dict] | List of compacted section blocks |

#### Internal Logic
- Groups messages into sections based on a maximum size constant
- Creates section blocks for each group of messages
- Returns a list of section blocks as attachments

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| enum | For defining enumeration classes |
| typing | For type hinting |
| pydantic | For data validation and settings management |
| slack_sdk.models.blocks | For Slack block types |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| _MAX_SLACK_SECTION_SIZE | int | 2 | Maximum number of fields in a section |
| _MAX_ALERT_PREVIEW_BLOCKS | int | 5 | Maximum number of preview blocks in an alert |
| _MAX_AMOUNT_OF_ATTACHMENTS | int | 50 | Maximum number of attachments in a message |

## Error Handling
The code doesn't implement specific error handling beyond basic exception raising. It relies on the caller to handle any exceptions that might occur during message building.

This documentation provides an overview of the main functionalities and structure of the `SlackMessageBuilder` class. The class is designed to be flexible and can be used to create various types of Slack messages, particularly for alerts and reports in the context of data monitoring and testing.