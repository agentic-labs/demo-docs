---
title: "Overview"
---

## High-level description
This directory contains the implementation of the InvocationsAPI, which is responsible for fetching and managing dbt invocation data. The main functionality is encapsulated in the `InvocationsAPI` class, which provides methods to retrieve invocations based on various criteria such as type, time, and ID. It also offers functionality to fetch test invocations and the latest invocations for models.

## What does it do?
The InvocationsAPI acts as an interface for retrieving and managing dbt invocation data. It allows users to:

1. Fetch the last invocation of a specific type (currently only supporting "test" type).
2. Retrieve invocations by their maximum time or ID.
3. Get test invocations based on custom filter criteria.
4. Fetch the latest invocations data for models.
5. Retrieve the most recent invocation for models.

This API simplifies the process of accessing and analyzing dbt invocation data, which can be crucial for monitoring and debugging dbt workflows.

## Key Files

### invocations.py
This file contains the core implementation of the `InvocationsAPI` class. It defines the following key methods:

1. `get_last_invocation`: Retrieves the last invocation of a specified type.
2. `get_invocation_by_time`: Fetches an invocation by its maximum time.
3. `get_invocation_by_id`: Retrieves an invocation by its ID.
4. `get_test_invocation_from_filter`: Gets a test invocation based on provided filter criteria.
5. `get_models_latest_invocations_data`: Retrieves the latest invocations data for models.
6. `get_models_latest_invocation`: Fetches the most recent invocation for models.

The `InvocationsAPI` class uses an `InvocationsFetcher` instance to interact with the underlying data storage and retrieval mechanisms.

## Dependencies
The InvocationsAPI relies on several external dependencies and internal modules:

1. `elementary.clients.api.api_client`: Provides the base `APIClient` class.
2. `elementary.clients.dbt.base_dbt_runner`: Offers the `BaseDbtRunner` class for executing dbt commands.
3. `elementary.monitor.data_monitoring.schema`: Provides the `SelectorFilterSchema` for filtering invocations.
4. `elementary.monitor.fetchers.invocations.invocations`: Contains the `InvocationsFetcher` class for fetching invocation data.
5. `elementary.monitor.fetchers.invocations.schema`: Defines the `DbtInvocationSchema` for structuring invocation data.
6. `elementary.utils.log`: Provides logging functionality.

These dependencies are crucial for the proper functioning of the InvocationsAPI, allowing it to interact with dbt, fetch and structure data, and apply filters to the invocations.

## Configuration
The InvocationsAPI does not appear to use any specific configuration files or environment variables. However, it does require an instance of `BaseDbtRunner` to be passed during initialization, which may have its own configuration requirements.

## Error Handling
The `InvocationsAPI` class implements basic error handling by raising a `NotImplementedError` for unsupported invocation types in the `get_last_invocation`, `get_invocation_by_time`, and `get_invocation_by_id` methods. This ensures that users are immediately notified if they attempt to use an unsupported invocation type.

In conclusion, the InvocationsAPI provides a robust and flexible interface for managing dbt invocation data, allowing users to easily retrieve and analyze information about their dbt runs. This can be particularly useful for monitoring, debugging, and optimizing dbt workflows in data engineering and analytics environments.