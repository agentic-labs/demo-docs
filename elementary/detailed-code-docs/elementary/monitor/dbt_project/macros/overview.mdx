---
title: "Overview"
---

## High-level description
The `elementary/monitor/dbt_project/macros` directory contains a collection of SQL macros and utility functions used in the Elementary data monitoring framework. These macros provide functionality for retrieving and processing data related to dbt models, tests, sources, and alerts. They form the core of Elementary's data quality monitoring and reporting capabilities.

## What does it do?
This directory contains macros that:
1. Retrieve and process information about dbt models, tests, sources, and exposures.
2. Manage and update alerts for data quality issues.
3. Fetch and analyze test results, including source freshness tests.
4. Provide utility functions for data processing and database operations.
5. Implement custom materializations and tests for dbt.
6. Handle connection testing and artifact uploading.

These macros work together to enable comprehensive data quality monitoring, alerting, and reporting within a dbt project using the Elementary framework.

## Entry points
The main entry points for this directory are:

1. `alerts/`: Contains macros for managing the lifecycle of alerts, including fetching, populating, and updating alert statuses.
2. `base_queries/`: Houses macros for extracting and processing data from various dbt and Elementary tables.
3. `get_models.sql`, `get_sources.sql`, `get_exposures.sql`: Macros for retrieving information about dbt models, sources, and exposures.
4. `get_test_results.sql`: Retrieves and processes test results.
5. `materializations/`: Contains custom materializations for dbt.
6. `tests/`: Includes custom test implementations.

## Key Files
1. `get_models_runs.sql`: Retrieves and processes data about model runs.
2. `get_source_freshness_results.sql`: Fetches and processes source freshness test results.
3. `get_test_results.sql`: Retrieves and processes general test results.
4. `upload_source_freshness.sql`: Handles uploading source freshness results to a specified table.
5. `test_conn.sql`: Provides functionality for testing database connections.
6. `get_elementary_database_and_schema.sql`: Retrieves the database and schema name for the current target in dbt.

## Dependencies
The macros in this directory rely on the following main dependencies:

1. dbt (data build tool): The underlying framework on which these macros are built and executed.
2. elementary: A custom package that provides utility functions for various operations such as table creation, data type casting, time manipulation, and query execution.
3. elementary_cli: Used for generating alert objects, normalizing alert statuses, and getting alert time limits.

## Configuration
The macros use several configuration options, including:

1. `days_back`: Number of days to look back for various data retrieval operations (default varies by macro).
2. `invocations_per_test`: Maximum number of test invocations to return per test (default: 720).
3. `disable_passed_test_metrics`: Flag to exclude passed tests from results (default: false).
4. Various database and schema configuration options, often retrieved dynamically using utility functions.

In conclusion, the `macros` directory contains a comprehensive set of SQL macros and utility functions that form the core of the Elementary data monitoring framework. These macros work together to provide robust data quality monitoring, alerting, and reporting capabilities within dbt projects.