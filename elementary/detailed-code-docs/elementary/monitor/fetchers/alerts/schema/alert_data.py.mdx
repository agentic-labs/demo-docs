---
title: "alert_data.py"
---

Here's a comprehensive documentation for the target file `elementary/monitor/fetchers/alerts/schema/alert_data.py`:

## High-level description
This file defines data schemas for different types of alerts in the Elementary monitoring system. It includes base classes and specific implementations for test alerts, model alerts, and source freshness alerts. These schemas are used to structure and validate alert data throughout the Elementary system.

## Code Structure
The file defines a base class `BaseAlertDataSchema` and three derived classes: `TestAlertDataSchema`, `ModelAlertDataSchema`, and `SourceFreshnessAlertDataSchema`. These classes use Pydantic for data validation and serialization. The file also includes several utility functions for data manipulation and validation.

## References
This code references other parts of the Elementary codebase, including:
- `elementary.monitor.alerts.*` for alert models
- `elementary.monitor.data_monitoring.schema` for resource types
- `elementary.utils.*` for various utility functions

## Symbols

### `BaseAlertDataSchema`
#### Description
A base class for all alert data schemas, providing common fields and methods.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| id | str | Unique identifier for the alert |
| alert_class_id | str | Identifier for the alert class |
| model_unique_id | Optional[str] | Unique identifier for the associated model |
| detected_at | datetime | Timestamp when the alert was detected |
| database_name | Optional[str] | Name of the database |
| schema_name | str | Name of the schema |
| tags | Optional[List[str]] | List of tags associated with the alert |
| owners | Optional[List[str]] | List of owners associated with the alert |
| model_meta | Optional[Dict] | Metadata associated with the model |
| status | str | Current status of the alert |

#### Internal Logic
- Provides properties for accessing unified metadata, flattened metadata, and various alert attributes.
- Implements methods for validating and processing input data.
- Defines a method `format_alert` to be implemented by subclasses.

### `TestAlertDataSchema`
#### Description
A schema for test-related alerts, extending `BaseAlertDataSchema`.

#### Inputs
(Includes all inputs from `BaseAlertDataSchema`, plus:)
| Name | Type | Description |
|:-----|:-----|:------------|
| test_unique_id | str | Unique identifier for the test |
| table_name | Optional[str] | Name of the table being tested |
| column_name | Optional[str] | Name of the column being tested |
| test_type | str | Type of the test |
| test_sub_type | str | Sub-type of the test |
| test_results_description | Optional[str] | Description of the test results |
| test_results_query | Optional[str] | Query used for the test |
| test_rows_sample | Optional[List[Dict]] | Sample of rows from the test results |
| other | Optional[Dict] | Additional test-related data |
| test_name | str | Name of the test |
| test_short_name | str | Short name of the test |
| test_params | Optional[Dict] | Parameters for the test |
| severity | str | Severity level of the alert |
| test_meta | Optional[Dict] | Metadata associated with the test |
| elementary_unique_id | str | Unique identifier used by Elementary |

#### Internal Logic
- Implements `format_alert` method to create a `TestAlertModel`.
- Provides additional validation and processing for test-specific fields.

### `ModelAlertDataSchema`
#### Description
A schema for model-related alerts, extending `BaseAlertDataSchema`.

#### Inputs
(Includes all inputs from `BaseAlertDataSchema`, plus:)
| Name | Type | Description |
|:-----|:-----|:------------|
| alias | str | Alias of the model |
| path | str | Path to the model file |
| original_path | str | Original path of the model file |
| materialization | str | Materialization type of the model |
| full_refresh | bool | Whether the model requires full refresh |
| message | Optional[str] | Additional message for the alert |

#### Internal Logic
- Implements `format_alert` method to create a `ModelAlertModel`.

### `SourceFreshnessAlertDataSchema`
#### Description
A schema for source freshness alerts, extending `BaseAlertDataSchema`.

#### Inputs
(Includes all inputs from `BaseAlertDataSchema`, plus:)
| Name | Type | Description |
|:-----|:-----|:------------|
| source_freshness_execution_id | str | Execution ID for the source freshness check |
| snapshotted_at | Optional[datetime] | Timestamp of when the snapshot was taken |
| max_loaded_at | Optional[datetime] | Timestamp of the most recent data load |
| max_loaded_at_time_ago_in_s | Optional[int] | Time since the most recent data load in seconds |
| source_name | str | Name of the source |
| identifier | str | Identifier for the source |
| error_after | Optional[str] | Time after which an error is reported |
| warn_after | Optional[str] | Time after which a warning is reported |
| filter | Optional[str] | Filter applied to the source freshness check |
| original_status | str | Original status of the source freshness check |
| path | str | Path to the source definition file |
| error | Optional[str] | Error message, if any |
| freshness_description | Optional[str] | Description of the freshness status |

#### Internal Logic
- Implements `format_alert` method to create a `SourceFreshnessAlertModel`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| datetime | For handling date and time operations |
| typing | For type hinting |
| elementary.monitor.alerts.* | For alert model classes |
| elementary.monitor.data_monitoring.schema | For ResourceType enum |
| elementary.utils.dicts | For dictionary manipulation utilities |
| elementary.utils.json_utils | For JSON-related utilities |
| elementary.utils.pydantic_shim | For Pydantic-based data validation |

## Error Handling
The code uses Pydantic's built-in validation system to handle input errors. It also includes custom validators for specific fields to ensure data integrity.

## API/Interface Reference
The main interfaces exposed by this file are the `TestAlertDataSchema`, `ModelAlertDataSchema`, and `SourceFreshnessAlertDataSchema` classes. These are used to create structured alert data objects throughout the Elementary system.