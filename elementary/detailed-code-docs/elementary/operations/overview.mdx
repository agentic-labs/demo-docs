---
title: "Overview"
---

## High-level description
This directory contains the implementation of Elementary operations, specifically focusing on the upload of dbt source freshness results to Elementary's schema. The main functionality is encapsulated in the `UploadSourceFreshnessOperation` class, which is exposed through a command-line interface.

## What does it do?
The code in this directory enables users to upload the results of dbt's source freshness checks to Elementary's schema. This process allows Elementary to monitor the freshness of data sources and potentially generate alerts based on these results. The workflow is as follows:

1. A user runs the `upload-source-freshness` command through the CLI.
2. The command reads the source freshness results from a JSON file generated by dbt.
3. It then uploads these results to Elementary's schema in chunks.
4. The upload process includes adding metadata to each result and using dbt operations to perform the actual upload.
5. The system checks for existing uploads to avoid duplicates and provides progress feedback during the upload process.

This functionality is crucial for maintaining data quality and timeliness in data pipelines monitored by Elementary.

## Entry points
The main entry point for this functionality is the `cli.py` file, which defines the command-line interface. The `upload_source_freshness` command in this file serves as the primary way to initiate the upload process.

The actual implementation of the upload process is contained in the `upload_source_freshness.py` file, which defines the `UploadSourceFreshnessOperation` class. This class is instantiated and used by the CLI command to perform the upload.

The data flow starts from the CLI command, which creates a configuration object and passes it to the `UploadSourceFreshnessOperation`. This operation then reads the source freshness results from a file and uploads them to Elementary's schema using dbt operations.

## Dependencies
The code relies on several external libraries and frameworks:

1. Click (version not specified): Used for creating the command-line interface.
2. alive-progress (version not specified): Provides a progress bar for the upload process.
3. dbt (version not specified): Used for executing dbt operations and interacting with the data warehouse.

These dependencies were likely chosen for the following reasons:
- Click: It's a popular and user-friendly library for creating command-line interfaces in Python.
- alive-progress: It provides a visually appealing way to show progress during long-running operations like data uploads.
- dbt: As the core tool for data transformation, it's essential for interacting with the data warehouse and performing the actual upload operations.

## Configuration
The code uses a `Config` class (from `elementary.config.config`) to manage configuration settings. Key configuration elements include:

- `project_dir`: Path to the dbt project directory.
- `profile_target`: Target to load for the dbt profile.
- `profiles_dir`: Path to the dbt profiles directory.
- `target_path`: Absolute target path for saving Elementary files.

Environment variables are also used, particularly `DBT_TARGET_PATH` for determining the target path if not specified otherwise.

The `upload_source_freshness` command accepts several configuration options as command-line arguments, including:

```python
@click.option("--project-dir", type=click.Path(exists=True), default=None)
@click.option("--profile-target", type=str, default=None)
@click.option("--profiles-dir", type=click.Path(), default=None)
@click.option("--target-path", type=str, default=None)
@click.option("--rows-per-insert", type=int, default=1000)
```

These options allow users to customize the behavior of the upload process, such as specifying the project directory, profile target, and the number of rows to insert per SQL statement.

The code also checks for a `sources.json` file, which is expected to contain the source freshness results generated by dbt. The location of this file is determined based on the configured target path.

Overall, this directory provides a flexible and configurable way to upload source freshness results to Elementary's schema, enabling better monitoring and alerting capabilities for data pipelines.