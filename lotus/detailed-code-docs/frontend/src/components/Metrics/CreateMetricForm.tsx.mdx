---
title: "CreateMetricForm.tsx"
---

## High-level description
This code defines a React component called `CreateMetricForm` that allows users to create and configure metrics for tracking various types of events and data. It provides a form interface with various input fields and options for specifying metric details, such as event type, aggregation method, filters, and more.

## Code Structure
The main component `CreateMetricForm` uses several React hooks (useState, useEffect, useRef) and Ant Design components to create a dynamic form. It also imports various types and utility functions from other files in the project. The component is structured with several nested functions and conditional rendering based on the selected metric type and other form states.

## Symbols

### CreateMetricForm
#### Description
This is the main functional component that renders the metric creation form.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props | object | Contains state, visible, onSave, and onCancel properties |

#### Internal Logic
1. Initializes form and state variables
2. Defines helper functions for form logic and validation
3. Renders a modal with form fields based on the selected metric type
4. Handles form submission and validation

### handleCreateMetricTypeChange
#### Description
Updates the form state when the metric type is changed.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| createMetricType | MetricCategory | The new metric type selected |

### changeFormPreset
#### Description
Updates the form with predefined values based on the selected preset.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| preset | string | The selected preset option |

### formatSQL
#### Description
Formats the custom SQL input using the sql-formatter library.

### handleGranularityChange
#### Description
Updates the form state when the granularity is changed for gauge metrics.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| value | TimePeriodType | The selected granularity value |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react | Core React library |
| antd | UI component library |
| @tanstack/react-query | Data fetching and state management |
| react-ace | Code editor for custom SQL input |
| sql-formatter | SQL code formatting |
| react-toastify | Toast notifications |

## Configuration
The component uses various configuration options defined in the form fields, such as metric types, event types, and time periods. These are likely defined in the imported type files.

## Error Handling
The component implements form validation and displays error messages using Ant Design's form validation features and custom error state management.

## API/Interface Reference
The component interacts with the backend API through the `onSave` prop, which is called with the form data when the form is submitted successfully.

This component is a complex form with multiple interconnected parts and conditional rendering based on user input. It provides a comprehensive interface for creating and configuring various types of metrics within the application.