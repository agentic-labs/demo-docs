---
title: "CustomerDetail.tsx"
---

## High-level description
The `CustomerDetail` component displays detailed information about a specific customer, including their details, subscriptions, invoices, and credits. It allows users to manage customer subscriptions, such as creating new subscriptions, canceling existing ones, switching plans, and attaching add-ons.

## Code Structure
The `CustomerDetail` component uses React hooks to manage state and data fetching. It utilizes the `react-query` library for data fetching and caching, and the `antd` library for UI components. The component fetches data for plans, pricing units, and customer details using `useQuery` hooks. It also defines several `useMutation` hooks for actions like creating subscriptions, canceling subscriptions, and deleting customers. The component renders different tabs for displaying customer details, subscriptions, invoices, and credits.

## References
- `Customer` API: Used for fetching and managing customer data, subscriptions, and invoices.
- `Plan` API: Used for fetching plan data.
- `PricingUnits` API: Used for fetching pricing unit data.
- `react-query`: Used for data fetching and caching.
- `antd`: Used for UI components.
- `react-router-dom`: Used for navigation and accessing route parameters.

## Symbols

### `CustomerDetail`
#### Description
This functional component displays detailed information about a specific customer and allows users to manage their subscriptions.

#### Inputs
This component does not have explicit input props. It retrieves the `customerId` from the route parameters using `useParams`.

#### Outputs
This component renders the customer details view, including tabs for details, subscriptions, invoices, and credits.

#### Internal Logic
1. **Fetch Data:** The component fetches data for plans, pricing units, and customer details using `useQuery` hooks from `react-query`.
2. **Render Tabs:** It uses the `Tabs` component from `antd` to render different tabs for displaying customer details, subscriptions, invoices, and credits.
3. **Subscription Management:** The component defines several `useMutation` hooks for actions like creating subscriptions, canceling subscriptions, switching plans, and attaching add-ons.
4. **Customer Deletion:** It defines a `deleteCustomerMutation` hook for deleting the customer.
5. **Data Refetcing:** The component uses `refetch` functions from `useQuery` hooks and `queryClient.invalidateQueries` to refetch data after mutations.
6. **Modal Handling:** It uses state variables and `Modal` components from `antd` to handle modals for creating subscriptions, canceling subscriptions, and deleting customers.

## Side Effects
- Modifies the query cache using `queryClient.invalidateQueries` after mutations.
- Navigates to different routes using `useNavigate`.
- Displays toast notifications using `react-toastify`.

## Dependencies
- `react`: Used for building the component.
- `@tanstack/react-query`: Used for data fetching and caching.
- `antd`: Used for UI components.
- `react-router-dom`: Used for navigation and accessing route parameters.
- `dayjs`: Used for date formatting.
- `react-toastify`: Used for displaying toast notifications.

## Error Handling
The component handles errors from `useMutation` hooks by displaying error toast notifications using `react-toastify`.

## Logging
The component logs the customer data to the console using `console.log`.
