---
title: "CustomerSubscriptionView.tsx"
---

Here's a high-level description and documentation of the `CustomerSubscriptionView.tsx` file:

## High-level description
This component displays and manages customer subscriptions, including active, upcoming, and Stripe subscriptions. It allows users to view, add, modify, and cancel subscriptions, as well as attach add-ons to existing subscriptions.

## Code Structure
The main component `SubscriptionView` renders subscription information and handles various subscription-related actions. It uses several sub-components and hooks to manage state and UI elements. The component interacts with the backend API through React Query mutations and queries.

## Symbols

### SubscriptionView
#### Description
The main functional component that renders the subscription view for a customer.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| customer_id | string | The ID of the customer |
| subscriptions | SubscriptionType[] | Array of customer subscriptions |
| upcomingSubscriptions | SubscriptionType[] | Array of upcoming subscriptions |
| stripeSubscriptions | StripeSubscriptionRecord[] | Array of Stripe subscriptions |
| plans | PlanType[] | Array of available plans |
| onAutoRenewOff | function | Callback to turn off auto-renewal |
| onCancel | function | Callback to cancel a subscription |
| onPlanChange | function | Callback to change a subscription plan |
| onCreate | function | Callback to create a new subscription |

#### Internal Logic
1. Manages state for pagination, modals, and form inputs
2. Renders subscription cards for active, upcoming, and Stripe subscriptions
3. Handles subscription actions like adding, canceling, and modifying subscriptions
4. Manages add-ons for subscriptions

### AddPlanModal
#### Description
A modal component for adding a new plan to a customer's subscriptions.

### SubscriptionItem
#### Description
Renders an individual subscription item card.

### StripeSubscriptionItem
#### Description
Renders an individual Stripe subscription item card.

### RenderSubscriptions
#### Description
Renders the list of subscriptions, including pagination and search functionality.

## Dependencies
- React and various hooks (useState, useEffect, useCallback, useRef)
- Ant Design components (Form, Button, InputNumber, Typography, Select, Modal, DatePicker, Input)
- React Query hooks (useMutation, useQuery, useQueryClient)
- React Router (useNavigate)
- Dayjs for date manipulation
- Custom components and types from the project

## Error Handling
The component uses toast notifications to display errors and success messages for various operations.

## Performance Considerations
- Uses React Query for efficient data fetching and caching
- Implements pagination to handle large numbers of subscriptions
- Uses memoization (React.memo) for some sub-components to optimize rendering

This component is complex and handles multiple responsibilities related to subscription management. Consider breaking it down into smaller, more focused components for better maintainability and testability.