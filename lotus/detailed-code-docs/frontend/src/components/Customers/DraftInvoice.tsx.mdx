---
title: "DraftInvoice.tsx"
---

## High-level description
This code defines a React component called `DraftInvoice` that displays draft invoice information for a specific customer. It fetches draft invoice data using React Query and renders it in a structured format, including customer details and line items.

## Code Structure
The main `DraftInvoice` component uses the `useQuery` hook to fetch draft invoice data. It then maps over the invoice data to render individual invoice sections, which include customer information and a table of line items. The component also utilizes several sub-components and utility functions to structure and display the data.

## Symbols

### DraftInvoice
#### Description
The main component that fetches and displays draft invoice information for a customer.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| customer_id | string | The ID of the customer for which to fetch draft invoice data |

#### Internal Logic
1. Fetches draft invoice data using React Query
2. Maps over the invoice data to render individual invoice sections
3. Renders customer information using `CustomerCard` component
4. Renders line items using Ant Design's `Table` component
5. Implements an expandable row feature to show sub-items for each line item

### addKeysToLineItems
#### Description
A utility function that adds unique keys to line items for React rendering.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| lineItems | ExternalLineItem[] | An array of line items |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| lineItemsWithKeys | ExternalLineItem[] | An array of line items with added 'key' property |

### expandedRowRender
#### Description
A function that returns a render function for expanded rows in the line items table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| invoice | IndividualDraftInvoiceType | The invoice data for the current row |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| renderFunction | Function | A function that renders the expanded row content |

## Dependencies
- React
- @tanstack/react-query
- antd
- dayjs
- Invoices (from "../../api/api")
- CustomerCard (from "./Card/CustomerCard")
- Various types from "../../types/invoice-type"

## Error Handling
The component doesn't implement explicit error handling for the API call. It relies on React Query's built-in error handling.

## Performance Considerations
The component uses `refetchInterval: 10000` in the `useQuery` hook, which means it will refetch the draft invoice data every 10 seconds. This might need to be adjusted based on the specific requirements and server load considerations.