---
title: "PlanDetails.tsx"
---

## High-level description
This code defines a React component called `PlanDetails` that displays detailed information about a specific plan. It fetches plan data, handles external link creation and deletion, and renders different views for plan versions and custom plans.

## Code Structure
The main `PlanDetails` component uses various hooks (useState, useRef, useParams, useNavigate) and react-query hooks (useMutation, useQuery) to manage state and data fetching. It renders a `PageLayout` component with tabs for "Versions" and "Custom Plans", each containing specific components for displaying plan details.

## Symbols

### PlanDetails
#### Description
The main functional component that renders the plan details page.

#### Internal Logic
1. Fetches plan data using react-query's `useQuery` hook.
2. Manages state for custom plans and selected custom plan.
3. Handles tab changes between "Versions" and "Custom Plans".
4. Renders loading spinner, error message, or plan details based on query state.
5. Provides functions for creating and deleting external links.

### createExternalLinkMutation
#### Description
A mutation hook for creating external links for a plan.

#### Internal Logic
1. Uses optimistic updates to immediately reflect changes in the UI.
2. Handles success and error cases with toast notifications.
3. Invalidates relevant queries on completion.

### deleteExternalLinkMutation
#### Description
A mutation hook for deleting external links from a plan.

#### Internal Logic
Similar to createExternalLinkMutation, but for deletion operations.

### optimisticMutateCreateHandler
#### Description
Handles optimistic updates when creating an external link.

#### Internal Logic
1. Cancels outgoing queries to prevent overwrites.
2. Updates the query cache with the new external link.

### optimisticMutateDeleteHandler
#### Description
Handles optimistic updates when deleting an external link.

#### Internal Logic
1. Cancels outgoing queries to prevent overwrites.
2. Updates the query cache by removing the deleted external link.

### createPlanExternalLink
#### Description
Function to create a new external link for the plan.

#### Internal Logic
1. Checks for duplicate links.
2. Prepares data and calls the createExternalLinkMutation.

### deletePlanExternalLink
#### Description
Function to delete an external link from the plan.

#### Internal Logic
Prepares data and calls the deleteExternalLinkMutation.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react | Core React library |
| react-router-dom | Routing functionality |
| @tanstack/react-query | Data fetching and state management |
| antd | UI components (Button, Tabs, Select) |
| react-toastify | Toast notifications |

## Error Handling
The component handles errors in data fetching and mutations by displaying error messages using toast notifications and providing a "Go Back" button when plan data cannot be loaded.

## API/Interface Reference
| Endpoint | Method | Description |
|:---------|:-------|:------------|
| getPlan | GET | Fetches plan details |
| createExternalLinks | POST | Creates external links for a plan |
| deleteExternalLinks | DELETE | Deletes external links from a plan |

Note: The actual API calls are abstracted through the `Plan` object, which is likely defined in a separate API file.