---
title: "PlanComponent.tsx"
---

## High-level description
The `PlanComponents` component displays a list of components added to a plan, along with their pricing tiers and alert settings. It allows users to set alerts for counter metrics and provides a modal for creating and updating alerts.

## Code Structure
The `PlanComponents` component uses several helper functions to render the component details and handle alert creation and deletion. It also uses the `useMutation` hook from `@tanstack/react-query` to interact with the API for creating and deleting alerts.

## References
- `Plan.createAlert`: API function to create a new alert.
- `Plan.deleteAlert`: API function to delete an existing alert.
- `findAlertForComponent`: Helper function to find an alert associated with a component.
- `renderCost`: Helper function to render the cost of a tier based on its type.
- `returnInvoicingIntervalText`: Helper function to render the invoicing interval text.

## Symbols

### `PlanComponents`
#### Description
This functional component displays a list of components added to a plan, along with their pricing tiers and alert settings. It allows users to set alerts for counter metrics and provides a modal for creating and updating alerts.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| components | `components["schemas"]["PlanDetail"]["versions"][0]["components"]` | An array of components associated with the plan version. |
| plan | `components["schemas"]["PlanDetail"]` | The plan details. |
| refetch | `VoidFunction` | A function to refetch the plan details. |
| alerts | `components["schemas"]["PlanDetail"]["versions"][0]["alerts"]` | An array of alerts associated with the plan version. |
| plan_version_id | `string` | The ID of the plan version. |

#### Outputs
A React element representing the plan components section.

#### Internal Logic
- The component first checks if there are any components added to the plan. If not, it displays a message indicating that no components have been added.
- If components are present, it iterates through them and renders their details, including the billable metric name, invoicing interval, and pricing tiers.
- For each component, it also renders a button to set an alert if the billable metric is of type "counter".
- Clicking the "Set Alert" button opens a modal where users can create or update an alert for the selected component.
- The modal allows users to input a threshold value for the alert.
- The `createAlertMutation` and `deleteAlertMutation` hooks are used to interact with the API for creating and deleting alerts, respectively.
- The `findAlertForComponent` helper function is used to find an alert associated with a component.
- The `renderCost` helper function renders the cost of a tier based on its type.
- The `returnInvoicingIntervalText` helper function renders the invoicing interval text.

## Side Effects
- The component modifies the global state by updating the alerts associated with the plan version when an alert is created or deleted.
- It also triggers a refetch of the plan details after an alert is created or deleted.

## Dependencies
- `react`: For creating React components.
- `antd`: For UI components.
- `@ant-design/icons`: For icons.
- `dayjs`: For date formatting.
- `@tanstack/react-query`: For data fetching and mutations.
- `react-toastify`: For displaying toast notifications.
- `CurrencyType`: Type definition for currency.
- `createShortenedText`: Helper function to shorten text.
- `DropdownComponent`: Custom dropdown component.
- `PlansTags`: Component to display plan tags.
- `LinkExternalIds`: Component to link external IDs.
- `capitalize`: Helper function to capitalize text.
- `CopyText`: Component to copy text to clipboard.
- `Badge`: Custom badge component.
- `useMediaQuery`: Hook to get window width.
- `createTags`: Helper function to create tags.
- `useGlobalStore`: Global state management hook.
- `createPlanTagsList`: Helper function to create a list of plan tags.
- `AlertType`: Type definition for alerts.
- `CreateAlertType`: Type definition for creating alerts.
- `Plan`: API functions for interacting with plans.
- `components`: Type definitions from generated API client.
- `StateTabs`: Component to display state tabs.

## Error Handling
- The component displays error messages using toast notifications if there is an error creating or deleting an alert.
- It also validates the alert threshold input and displays an error message if the input is not a number.

## Logging
The component does not implement any specific logging mechanisms.
