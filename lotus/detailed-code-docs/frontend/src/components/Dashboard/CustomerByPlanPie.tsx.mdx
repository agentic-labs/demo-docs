---
title: "CustomerByPlanPie.tsx"
---

## High-level description
The `CustomerByPlanPie` component displays a pie chart showing the distribution of customers across different subscription plans. It fetches data from the backend API and visualizes it using the Ant Design Charts library.

## Code Structure
The `CustomerByPlanPie` component uses the `useQuery` hook from `@tanstack/react-query` to fetch data from the `PlansByCustomer.getPlansByCustomer` API call. The fetched data is then used to configure the `Pie` component from `@ant-design/plots`. The component also uses the `Paper` component for styling and the `LoadingSpinner` component while data is being fetched.

## References
- `PlansByCustomer.getPlansByCustomer`: API call to fetch data for the pie chart.
- `Pie`: Ant Design Charts component used to render the pie chart.
- `Paper`: Custom component used for styling.
- `LoadingSpinner`: Custom component used to display a loading indicator.

## Symbols
### `CustomerByPlanPie`
#### Description
This functional component fetches data about the number of customers subscribed to each plan and renders a pie chart visualizing this data.

#### Inputs
This component does not take any props.

#### Outputs
This component renders a `Paper` component containing either a loading spinner or a pie chart with a title.

#### Internal Logic
1. **Fetch data:** It uses the `useQuery` hook from `@tanstack/react-query` to fetch data from the `PlansByCustomer.getPlansByCustomer` API call. The query key is set to `["customer_by_plan_pie"]`.
2. **Handle loading state:** While the data is being fetched (`isLoading` is true), it renders a `LoadingSpinner` component.
3. **Prepare chart configuration:** Once the data is fetched, it creates a configuration object (`config`) for the `Pie` component. This object defines the chart's data source (`data?.results`), appearance (colors, labels, legend), and interactions.
4. **Render pie chart:** It renders a `Pie` component from `@ant-design/plots` using the prepared `config` object. The chart visualizes the number of customers (`angleField: "num_customers"`) for each subscription plan (`colorField: "plan_name"`).

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react | Core library for building UI components |
| @ant-design/plots | Library for data visualization, used for the pie chart |
| @tanstack/react-query | Library for fetching, caching, and managing asynchronous data |
| Paper | Custom component for styling |
| PlansByCustomer | API client for interacting with the backend |
| LoadingSpinner | Custom component for displaying a loading indicator |

## Error Handling
The component relies on the error handling provided by `useQuery`. If the API call fails, `useQuery` will handle the error and potentially retry the request.

## Logging
The code does not implement any specific logging mechanisms.
