---
title: "MetricBarGraph.tsx"
---

## High-level description
The `MetricBarGraph` component displays a bar graph of metric usage data over a specified date range. It allows users to select a specific metric from a dropdown list and visualizes the daily usage for each customer associated with that metric.

## Code Structure
The `MetricBarGraph` component uses the `useQuery` hook from `@tanstack/react-query` to fetch metric usage data. It then transforms this data to fit the format required by the `Column` component from `@ant-design/plots` for rendering the bar graph. The component also uses the `Select` component from `antd` to provide a dropdown for metric selection.

## References
- `MetricUsage` from "../../types/metric-type"
- `Metrics` from "../../api/api"
- `Paper` from "../base/Paper"
- `LoadingSpinner` from "../LoadingSpinner"

## Symbols

### `MetricBarGraph`
#### Description
A functional React component that fetches, processes, and displays metric usage data in a bar graph format.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props.range | any | An array representing the start and end dates of the date range for which to display metric usage data. |

#### Outputs
JSX.Element representing a bar graph of metric usage data.

#### Internal Logic
1. **State Initialization:**
   - `selectedMetric`: Stores the currently selected metric from the dropdown.
   - `metricList`: Stores the list of available metrics fetched from the API.
   - `chartData`: Stores the processed metric usage data in a format suitable for the `Column` chart component.

2. **Data Fetching:**
   - Uses the `useQuery` hook from `@tanstack/react-query` to fetch metric usage data from the `Metrics.getMetricUsage` API.
   - The query key is based on the `props.range` to ensure data is refetched when the date range changes.

3. **Metric Selection Handling:**
   - The `changeMetric` function updates the `selectedMetric` state and processes the fetched data to display the usage for the selected metric.
   - It iterates through the daily usage data and creates a new array (`compressedArray`) that groups usage by customer and date.

4. **Data Transformation and Chart Rendering:**
   - The `useEffect` hook updates the `metricList`, `selectedMetric`, and `chartData` states when the fetched data (`data`) changes.
   - The `config` object defines the configuration for the `Column` chart component, including data mapping, styling, and legend options.

5. **Loading and Error Handling:**
   - If the data is still loading (`isLoading` is true) or if no data is available (`data` is undefined), a loading spinner and a "No Usage Data" message are displayed.

6. **Rendering:**
   - The component renders a `Paper` component that wraps the entire graph.
   - A header with the title "Metric Usage" and a dropdown (`Select` component) for metric selection are displayed.
   - The `Column` chart component from `@ant-design/plots` is rendered with the processed `chartData` and the defined `config`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @ant-design/plots | Provides the `Column` component for rendering the bar graph. |
| @tanstack/react-query | Provides the `useQuery` hook for fetching and managing asynchronous data. |
| antd | Provides the `Select` component for the metric dropdown. |
| react | Core library for building the React component. |

## Error Handling
The component handles loading and data absence by displaying a loading spinner and a "No Usage Data" message. However, it doesn't explicitly handle API errors.
