---
title: "App.tsx"
---

## High-level description
This code represents the main App component of a React application. It handles authentication, routing, and global state management. The component uses React Query for data fetching, React Router for navigation, and a custom global store for state management. It also includes telemetry tracking using PostHog for the cloud version.

## Code Structure
The main `App` component is defined, which conditionally renders either authenticated or public routes based on the user's authentication status. It uses various hooks and API calls to manage the application state and handle user sessions.

## Symbols

### `App`
#### Description
The main component that serves as the entry point for the application. It handles authentication, routing, and global state management.

#### Internal Logic
1. Initializes PostHog for telemetry if the app is running in the cloud version.
2. Defines public routes that don't require authentication.
3. Uses React Query to fetch session information and organization data.
4. Manages authentication state and redirects users if necessary.
5. Renders either authenticated routes (AppRoutes) or public routes (ExternalRoutes) based on the authentication status.
6. Wraps the authenticated routes with a PlanProvider for context.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @tanstack/react-query | Handles data fetching and caching |
| react-toastify | Displays toast notifications |
| react-router-dom | Manages routing |
| posthog-js | Tracks telemetry data |
| @tremor/react | UI components library |

## Configuration
The application uses environment variables for configuration:
| Option | Type | Description |
|:-------|:-----|:------------|
| VITE_API_URL | string | API URL for the backend |
| VITE_POSTHOG_KEY | string | PostHog API key for telemetry |

## Error Handling
The component includes basic error handling for authentication failures, redirecting users to the login page if their session is invalid.

## Logging
The component uses console.log for debugging purposes, logging any errors that occur during data fetching.

## API/Interface Reference
The component interacts with the following API endpoints:
| Endpoint | Method | Description |
|:---------|:-------|:------------|
| /app/session/ | GET | Fetches the current user session |
| /app/organization/ | GET | Retrieves organization information |

Your response should not exceed 3000 words or 4000 tokens. Focus on providing clear, concise information that can be directly inferred from the code. Include optional sections only when they provide significant value for understanding the code.