---
title: "Login.tsx"
---

## High-level description
The `Login` component handles user authentication for the application. It provides a form for users to enter their username and password, and uses the `Authentication` API to authenticate the user. Upon successful login, it sets the authentication token in cookies, updates the global store with user information, and redirects the user to the appropriate page.

## Code Structure
The `Login` component uses the `useMutation` hook from `@tanstack/react-query` to handle the asynchronous login request. It also uses the `useNavigate` and `useLocation` hooks from `react-router-dom` to handle redirection after login. The component conditionally renders a login form or a loading spinner based on the authentication status.

## References
- `Authentication.login`: API function to authenticate user credentials.
- `Authentication.demo_login`: API function to authenticate demo user.
- `useGlobalStore`: Global store to manage application state.
- `LoadingSpinner`: Component to display a loading spinner.

## Symbols

### `Login`
#### Description
A functional component that renders a login form and handles user authentication.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| username | string | Optional. Pre-filled username for the login form. |
| password | string | Optional. Pre-filled password for the login form. |

#### Outputs
This component doesn't directly return a value, it renders the UI.

#### Internal Logic
1. **Initialization:**
   - Sets up state variables for username, password, error message, and authentication status.
   - Initializes the `useQueryClient`, `useNavigate`, and `useLocation` hooks.
   - Defines a mutation using `useMutation` to handle the login request.
2. **Form Handling:**
   - Updates username and password state variables on input change.
   - Defines `handleLogin` function to initiate the login process on form submission.
3. **Login Process:**
   - `handleLogin` calls the `mutate` function of the login mutation with username and password.
   - The mutation conditionally calls either `Authentication.login` or `Authentication.demo_login` based on the `isDemo` flag.
4. **Success Handling:**
   - On successful login, sets `isAuthenticated` to `true`.
   - Stores the authentication token in cookies.
   - Sets the authorization header in the axios instance.
   - Updates the global store with the user's username.
   - Redirects the user to the appropriate page based on the `redirectTo` value in the location state.
5. **Error Handling:**
   - On error, displays an error message using `toast`.
   - If the error status is 403, reloads the page.
6. **Rendering:**
   - Conditionally renders either the login form or a loading spinner based on the `isAuthenticated` and `isLoading` states.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react | Core React library. |
| react-router-dom | For routing and navigation. |
| @tanstack/react-query | For managing asynchronous operations and caching. |
| antd | UI library for form elements and layout. |
| react-toastify | For displaying toast notifications. |
| universal-cookie | For managing cookies. |
| posthog-js | For user analytics. |
| ./Login.css | Styles for the login component. |
| ../components/LoadingSpinner | Loading spinner component. |
| ../types/error-response-types | Error response types. |
| ../stores/useGlobalstore | Global store hook. |

## Error Handling
The component uses the `onError` callback of the `useMutation` hook to handle errors during the login process. It displays error messages using `toast` and reloads the page if the error status is 403.

## Logging
The component uses `posthog-js` to log user events and properties for analytics purposes. 
