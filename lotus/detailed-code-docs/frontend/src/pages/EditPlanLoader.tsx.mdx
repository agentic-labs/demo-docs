---
title: "EditPlanLoader.tsx"
---

## High-level description
The `EditPlanLoader` component is responsible for loading and displaying the appropriate plan data for editing, based on the provided `type` prop. It handles loading states, errors, and renders the `EditPlan` component with the fetched plan data.

## Code Structure
The `EditPlanLoader` component uses the `useParams` hook to retrieve the `planId` and `versionId` from the URL. It then uses the `useQuery` hook from `@tanstack/react-query` to fetch the plan details from the API. The `useEffect` hook updates the `versionIndex` state based on the `type` prop and the fetched plan data. Finally, the component conditionally renders a loading spinner, an error message, or the `EditPlan` component based on the loading and error states and the availability of the plan data.

## References
- `Plan` from `../api/api`: Used to fetch plan details from the API.
- `usePlanState` from `../context/PlanContext`: Used to access the `replacementPlanVersion` from the plan context.
- `EditPlan` from `./EditPlan`: The component responsible for displaying and handling the plan editing form.

## Symbols

### `EditPlanLoader`
#### Description
This functional component is responsible for loading and displaying the appropriate plan data for editing based on the provided `type` prop.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| type | "backtest" \| "version" \| "custom" \| "currency" | Determines the type of plan being edited and influences which plan version is loaded. |

#### Outputs
Renders the `EditPlan` component with the loaded plan data, a loading spinner while fetching data, or an error message if an error occurs.

#### Internal Logic
1. **Retrieves URL parameters:** Uses `useParams` to get `planId` and `versionId`.
2. **Fetches plan data:** Uses `useQuery` to fetch plan details using the `Plan.getPlan` API call.
3. **Determines version index:** Uses `useEffect` to find the index of the appropriate plan version to edit based on the `type` prop and the fetched plan data.
4. **Handles loading and error states:** Renders a loading spinner while `isLoading` is true, an error message if `isError` is true, or the `EditPlan` component with the fetched plan data and calculated `versionIndex` when both are available.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react | Provides the necessary React hooks and components. |
| react-router-dom | Provides routing functionality for retrieving URL parameters and navigation. |
| @tanstack/react-query | Provides data fetching and caching functionality. |
| antd | Provides UI components like `Button` and layout elements. |
| ../api/api | Provides API functions for interacting with the backend. |
| ../types/plan-type | Provides TypeScript types for plan data. |
| ../components/LoadingSpinner | Provides a loading spinner component. |
| ../context/PlanContext | Provides access to the plan context. |
| ./EditPlan | The component responsible for displaying and handling the plan editing form. |

## Error Handling
The component handles errors during plan data fetching by displaying an error message and a "Go Back" button to navigate back to the previous page.
