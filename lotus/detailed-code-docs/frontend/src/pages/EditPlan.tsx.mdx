---
title: "EditPlan.tsx"
---

## High-level description
The `EditPlan` component is responsible for handling the creation and editing of pricing plans, including backtest plans, new plan versions, custom plans, and adding currencies to existing plans. It provides a multi-step form for configuring plan details, version information, charges, features, and discounts.

## Code Structure
The `EditPlan` component uses a multi-step form approach, with each step represented by an object in the `STEPS` array. Each step object defines the title, slug, component to render, and validation function for that step. The component uses the `currentStep` state variable to track the current step and renders the corresponding component. It also uses several modal components for adding and editing components, features, and recurring charges.

## References
- `Plan` API: Used for fetching plan details, creating new plans and versions, and managing external links.
- `Customer` API: Used for fetching customer data for target customer selection.
- `Organization` API: Used for fetching available currencies.
- `usePlanUpdater` hook: Used for managing plan state in the context.

## Symbols

### `EditPlan`
#### Description
This function component handles the creation and editing of pricing plans. It provides a multi-step form for configuring plan details, version information, charges, features, and discounts.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| type | "backtest" | "version" | "custom" | "currency" |  Indicates the type of plan being created or edited. |
| plan | `PlanDetailType` | The details of the plan being edited. |
| versionIndex | `number` | The index of the version being edited within the plan's versions array. |

#### Outputs
Renders the multi-step form for creating or editing a pricing plan.

#### Internal Logic
The component uses a multi-step form approach, with each step represented by an object in the `STEPS` array. Each step object defines the title, slug, component to render, and validation function for that step. The component uses the `currentStep` state variable to track the current step and renders the corresponding component. It also uses several modal components for adding and editing components, features, and recurring charges.

The component handles form submission based on the `type` prop. For backtest plans, it creates a new plan with the "experimental" status. For new versions, custom plans, and currency additions, it creates a new version of the existing plan with the appropriate settings.

## Side Effects
- Updates the plan state in the context using the `usePlanUpdater` hook.
- Navigates to different pages based on the plan creation or editing outcome.
- Displays toast notifications for success or error messages.

## Dependencies
- `antd`: UI library for form elements, modals, and other components.
- `react-router-dom`: For navigation.
- `@tanstack/react-query`: For data fetching and caching.
- `react-toastify`: For displaying toast notifications.
- `lodash`: For utility functions.

## Error Handling
The component uses basic exception handling for catching errors during form submission and API calls. It displays error messages using toast notifications.

## TODOs
None.
