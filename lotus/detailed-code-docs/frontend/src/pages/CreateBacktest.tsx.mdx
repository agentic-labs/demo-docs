---
title: "CreateBacktest.tsx"
---

## High-level description
The `CreateBacktest.tsx` file defines a React component for creating new backtests in the application. It provides a form for users to specify backtest parameters, including the test name, date range, KPIs, and plan variations to compare. The component handles user input, validation, and submission of the backtest creation request to the backend API.

## Code Structure
The `CreateBacktest` component utilizes several React hooks and Ant Design components to manage its state and UI. It fetches data for plans and plan details using `useQuery` hooks and updates the UI based on user selections. The component uses a `useMutation` hook to handle the backtest creation request and provides feedback to the user upon success or failure. Two modals, controlled by state variables, allow users to select existing plans to replace and new plans for comparison in the backtest.

## References
- `Plan` - API module for interacting with plan-related endpoints.
- `Backtests` - API module for interacting with backtest-related endpoints.
- `PageLayout` - Base layout component for pages.
- `usePlanState` - Hook to access the shared plan context state.
- `usePlanUpdater` - Hook to update the shared plan context state.

## Symbols

### `CreateBacktest`
#### Description
A functional React component that renders a form for creating new backtests.

#### Inputs
This component does not accept any props.

#### Outputs
JSX code representing the backtest creation form.

#### Internal Logic
1. **Initialization:**
   - Sets up state variables for managing form data, modals, and UI elements.
   - Fetches a list of available plans using the `useQuery` hook.
   - Fetches details of the selected plan using the `useQuery` hook.
   - Initializes the `useMutation` hook for handling backtest creation requests.
2. **Form Handling:**
   - Uses Ant Design's `Form` component to manage form input and validation.
   - Provides input fields for backtest name, date range, and KPI selection.
   - Renders modals for selecting plans to replace and new plans for comparison.
   - Updates the shared plan context state based on user selections.
3. **Backtest Creation:**
   - When the form is submitted:
     - Validates form data.
     - Constructs a `CreateBacktestType` object with the backtest parameters.
     - Calls the `Backtests.createBacktest` API function to submit the request.
     - Displays a success message and navigates to the experiments page upon successful creation.
     - Displays an error message if the creation fails.
4. **Modal Management:**
   - Provides two modals for selecting plans:
     - "Choose Plans To Replace" modal: Allows selecting an existing plan and version to replace.
     - "Create Experiment Plan" modal: Allows selecting an existing plan as a starting point for creating a new plan version for comparison.
   - Updates the UI and shared plan context state based on user selections in the modals.

## Side Effects
- Modifies the shared plan context state using the `usePlanUpdater` hook.
- Makes API requests to fetch plans, plan details, and create backtests.
- Navigates to different pages using the `useNavigate` hook.
- Displays toast notifications using the `toast` library.

## Dependencies
- `react`
- `@tanstack/react-query`
- `react-router-dom`
- `antd`
- `react-toastify`
- `dayjs`
- `../types/plan-type`
- `../types/experiment-type`
- `../api/api`
- `../components/base/PageLayout`
- `../context/PlanContext`

