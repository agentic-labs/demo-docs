---
title: "reducer.ts"
---

## High-level description
This code defines a reducer function for managing the state of a plan context in a React application. It handles various actions to update different aspects of the plan state, such as current and replacement plans, their versions, experiment name, date range, and a substitution callback.

## Code Structure
The `planReducer` function is the main symbol in this file. It takes the current state and an action as inputs and returns a new state based on the action type. The reducer uses a switch statement to handle different action types defined in the `ActionTypes` enum.

## References
This code references the `State`, `Actions`, and `ActionTypes` types from the "./types" file.

## Symbols

### `planReducer`
#### Description
This function is a reducer that manages the state of a plan context. It handles various actions to update different parts of the state.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| state | State | The current state of the plan context |
| action | Actions | The action object containing the type and payload |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| newState | State | The updated state based on the action |

#### Internal Logic
The function uses a switch statement to handle different action types:
1. `SET_CURRENT`: Updates the `currentPlan` in the state.
2. `SET_REPLACEMENT`: Updates the `replacementPlan` in the state.
3. `VERSION_CURRENT`: Updates the `currentPlanVersion` in the state.
4. `VERSION_REPLACEMENT`: Updates the `replacementPlanVersion` in the state.
5. `SET_SUBSTITUTION_CALLBACK`: Updates the `onSubstitutionChange` callback in the state.
6. `INIT`: Initializes the state (currently just returns the current state).
7. `SET_NAME`: Updates the `experimentName` in the state.
8. `SET_RANGE`: Updates the `dateRange` in the state.

For each action, the function returns a new state object with the updated values, preserving the rest of the state using the spread operator.

If an unhandled action type is received, the function throws an error.

## Side Effects
This reducer function does not have any side effects. It only computes and returns a new state based on the input state and action.

## Performance Considerations
The reducer uses the spread operator to create new state objects, which is generally efficient for small to medium-sized state objects. However, for very large state objects, this approach might cause performance issues due to shallow copying of nested objects.

## Error Handling
The reducer throws an error for unhandled action types, which helps in identifying and debugging issues related to incorrect action dispatches.

## TODOs
There is a note in the `INIT` case suggesting that persisted data, such as from localStorage, could be handled there in the future.