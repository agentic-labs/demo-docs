---
title: "experiment_serializers.py"
---

Here's a comprehensive documentation of the target file:

## High-level description
This file contains serializer classes for various models related to experiments, such as backtests and analyses. These serializers are used to convert complex data types to and from Python native datatypes, which can then be easily rendered into JSON or other content types.

## Code Structure
The file defines several serializer classes that inherit from Django Rest Framework's serializers. These classes are used to represent different aspects of experiments, such as backtest creation, backtest results, analysis summaries, and analysis details.

## Symbols

### BacktestSubstitutionMultiSerializer
#### Description
Serializer for handling multiple backtest substitutions.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| new_plan | SlugRelatedFieldWithOrganization | The new plan version to substitute |
| original_plans | SlugRelatedFieldWithOrganization | The original plan versions to be substituted |

### BacktestCreateSerializer
#### Description
Serializer for creating a new backtest.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| start_date | DateField | The start date of the backtest |
| end_date | DateField | The end date of the backtest |
| substitutions | ListSerializer | List of substitutions for the backtest |
| kpis | ListSerializer | List of KPIs to be calculated |
| backtest_name | CharField | Name of the backtest |

#### Internal Logic
The `create` method handles the creation of the backtest object and its associated substitutions.

### BacktestSummarySerializer
#### Description
Serializer for providing a summary of a backtest.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| backtest_name | CharField | Name of the backtest |
| start_date | DateField | Start date of the backtest |
| end_date | DateField | End date of the backtest |
| time_created | DateTimeField | Time when the backtest was created |
| kpis | ListField | List of KPIs calculated |
| status | CharField | Status of the backtest |
| backtest_id | BacktestUUIDField | Unique identifier for the backtest |

### BacktestSubstitutionSerializer
#### Description
Serializer for individual backtest substitutions.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| new_plan | PlanVersionDetailSerializer | The new plan version |
| original_plan | PlanVersionDetailSerializer | The original plan version |

### PlanRepresentationSerializer
#### Description
Serializer for representing a plan in backtest results.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| plan_name | CharField | Name of the plan |
| plan_id | CharField | Unique identifier for the plan |
| plan_revenue | FloatField | Revenue generated by the plan |

### RevenueDateSerializer
#### Description
Serializer for representing revenue on a specific date.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| date | DateField | The date |
| original_plan_revenue | FloatField | Revenue from the original plan |
| new_plan_revenue | FloatField | Revenue from the new plan |

### MetricRevenueSerializer
#### Description
Serializer for representing revenue for a specific metric.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| metric_name | CharField | Name of the metric |
| original_plan_revenue | FloatField | Revenue from the original plan |
| new_plan_revenue | FloatField | Revenue from the new plan |

### SingleCustomerValueSerializer
#### Description
Serializer for representing a single customer's value.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| customer | LightweightCustomerSerializer | Customer details |
| value | DecimalField | Value associated with the customer |

### TopCustomersSerializer
#### Description
Serializer for representing top customers in various categories.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| original_plan_revenue | ListField | Top customers by original plan revenue |
| new_plan_revenue | ListField | Top customers by new plan revenue |
| biggest_pct_increase | ListField | Customers with the biggest percentage increase |
| biggest_pct_decrease | ListField | Customers with the biggest percentage decrease |

### SingleSubstitutionResultsSerializer
#### Description
Serializer for representing results of a single substitution.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| cumulative_revenue | ListField | Cumulative revenue over time |
| revenue_by_metric | ListField | Revenue breakdown by metric |
| top_customers | TopCustomersSerializer | Top customers in various categories |

### SingleSubstitutionSerializer
#### Description
Serializer for representing a single substitution and its results.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| substitution_name | CharField | Name of the substitution |
| original_plan | PlanRepresentationSerializer | Original plan details |
| new_plan | PlanRepresentationSerializer | New plan details |
| pct_revenue_change | FloatField | Percentage change in revenue |
| results | SingleSubstitutionResultsSerializer | Detailed results of the substitution |

### AllSubstitutionResultsSerializer
#### Description
Serializer for representing results of all substitutions in a backtest.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| substitution_results | ListField | Results of individual substitutions |
| original_plans_revenue | FloatField | Total revenue from original plans |
| new_plans_revenue | FloatField | Total revenue from new plans |
| pct_revenue_change | FloatField | Overall percentage change in revenue |

### BacktestDetailSerializer
#### Description
Serializer for providing detailed information about a backtest.

#### Fields
Inherits all fields from BacktestSummarySerializer and adds:
| Name | Type | Description |
|:-----|:-----|:------------|
| backtest_results | AllSubstitutionResultsSerializer | Detailed results of the backtest |
| backtest_substitutions | BacktestSubstitutionSerializer | Details of the substitutions made |

### AnalysisSummarySerializer
#### Description
Serializer for providing a summary of an analysis.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| analysis_name | CharField | Name of the analysis |
| start_date | DateField | Start date of the analysis |
| end_date | DateField | End date of the analysis |
| time_created | DateTimeField | Time when the analysis was created |
| kpis | ListField | List of KPIs calculated |
| status | CharField | Status of the analysis |
| analysis_id | AnalysisUUIDField | Unique identifier for the analysis |

### SingleKPISerializer
#### Description
Serializer for representing a single KPI and its value.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| kpi | ChoiceField | The KPI being measured |
| value | DecimalField | The value of the KPI |

### SinglePlanAnalysisSerializer
#### Description
Serializer for representing the analysis of a single plan.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| plan | LightweightPlanVersionSerializer | Details of the plan version |
| kpis | SingleKPISerializer | KPIs calculated for the plan |

### PerPlanPerDaySerializer
#### Description
Serializer for representing revenue per plan per day.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| plan | LightweightPlanVersionSerializer | Details of the plan version |
| revenue | DecimalField | Revenue for the plan on a specific day |

### RevenuePerDaySerializer
#### Description
Serializer for representing total revenue per day across all plans.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| date | DateField | The date |
| revenue_per_plan | PerPlanPerDaySerializer | Revenue breakdown per plan |

### RevenueByMetricSerializer
#### Description
Serializer for representing revenue by metric.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| metric | LightweightMetricSerializer | Details of the metric |
| revenue | DecimalField | Revenue generated by the metric |

### RevenueByPlanMetricSerializer
#### Description
Serializer for representing revenue by plan and metric.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| plan | LightweightPlanVersionSerializer | Details of the plan version |
| by_metric | RevenueByMetricSerializer | Revenue breakdown by metric |

### TopCustomersPerPlanAnalysisSerializer
#### Description
Serializer for representing top customers for a specific plan.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| top_customers_by_revenue | ListField | Top customers by total revenue |
| top_customers_by_average_revenue | ListField | Top customers by average revenue |
| plan | LightweightPlanVersionSerializer | Details of the plan version |

### AnalysisResultsSerializer
#### Description
Serializer for representing the overall results of an analysis.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| analysis_summary | SinglePlanAnalysisSerializer | Summary of the analysis for each plan |
| revenue_per_day_graph | RevenuePerDaySerializer | Revenue per day data for graphing |
| revenue_by_metric_graph | RevenueByPlanMetricSerializer | Revenue by metric data for graphing |
| top_customers_by_plan | TopCustomersPerPlanAnalysisSerializer | Top customers for each plan |

### AnalysisDetailSerializer
#### Description
Serializer for providing detailed information about an analysis.

#### Fields
Inherits all fields from AnalysisSummarySerializer and adds:
| Name | Type | Description |
|:-----|:-----|:------------|
| analysis_results | AnalysisResultsSerializer | Detailed results of the analysis |

#### Internal Logic
The `get_analysis_results` method validates and returns the analysis results.

## Dependencies
This file depends on various Django and Django Rest Framework modules, as well as custom utility modules like `serializer_utils` for custom field types.

## Notes
- The file uses custom UUID fields (e.g., `BacktestUUIDField`, `AnalysisUUIDField`) for unique identifiers.
- Many serializers use nested serializers to represent complex data structures.
- The serializers make use of `TimezoneFieldMixin` for handling timezone-aware datetime fields.