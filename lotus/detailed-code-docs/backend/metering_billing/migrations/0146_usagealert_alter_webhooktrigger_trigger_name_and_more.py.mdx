---
title: "0146_usagealert_alter_webhooktrigger_trigger_name_and_more.py"
---

## High-level description
This migration file creates two new models, `UsageAlert` and `UsageAlertResult`, and modifies the `WebhookTrigger` model. It also adds constraints to ensure uniqueness of certain fields within these models.

## Code Structure
The migration file defines three main operations:
1. Creating the `UsageAlert` model
2. Modifying the `WebhookTrigger` model
3. Creating the `UsageAlertResult` model

Each operation is defined using Django's migration framework, specifying the fields, relationships, and constraints for the models.

## Symbols

### Migration
#### Description
This is a Django migration class that defines changes to be applied to the database schema.

#### Internal Logic
The migration performs the following operations:
1. Creates the `UsageAlert` model
2. Modifies the `WebhookTrigger` model
3. Creates the `UsageAlertResult` model
4. Adds constraints to both new models

### UsageAlert
#### Description
A model representing usage alerts for metrics in a plan version.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| usage_alert_id | SlugField | Unique identifier for the usage alert |
| threshold | DecimalField | The threshold value for triggering the alert |
| metric | ForeignKey | Reference to the associated Metric |
| organization | ForeignKey | Reference to the associated Organization |
| plan_version | ForeignKey | Reference to the associated PlanVersion |

### WebhookTrigger
#### Description
Modifies the existing WebhookTrigger model to include a new trigger event.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| trigger_name | CharField | Name of the trigger event, including the new 'usage_alert.triggered' option |

### UsageAlertResult
#### Description
A model representing the results of usage alert checks.

#### Fields
| Name | Type | Description |
|:-----|:-----|:------------|
| last_run_value | DecimalField | The value at the last check |
| last_run_timestamp | DateTimeField | Timestamp of the last check |
| triggered_count | PositiveIntegerField | Number of times the alert has been triggered |
| alert | ForeignKey | Reference to the associated UsageAlert |
| organization | ForeignKey | Reference to the associated Organization |
| subscription_record | ForeignKey | Reference to the associated SubscriptionRecord |

## Dependencies
This migration depends on the previous migration '0145_remove_historicalorganizationsetting_setting_value_and_more'.

## Constraints
1. Unique constraint on (organization, alert, subscription_record) for UsageAlertResult
2. Unique constraint on (organization, usage_alert_id) for UsageAlert

These constraints ensure that there are no duplicate entries for usage alerts and their results within an organization.