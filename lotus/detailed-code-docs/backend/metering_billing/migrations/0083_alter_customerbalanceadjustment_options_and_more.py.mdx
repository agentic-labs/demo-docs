---
title: "0083_alter_customerbalanceadjustment_options_and_more.py"
---

## High-level description
This migration file (0083_alter_customerbalanceadjustment_options_and_more.py) introduces changes to the CustomerBalanceAdjustment model and PricingUnit model in the metering_billing application. It adds new fields, alters existing fields, and modifies model options to enhance functionality related to customer balance adjustments and pricing units.

## Code Structure
The migration file defines a single Migration class with dependencies and operations. The operations modify the CustomerBalanceAdjustment and PricingUnit models.

## Symbols

### Migration
#### Description
This class defines the migration operations to be applied to the database schema.

#### Internal Logic
1. Alters the options for CustomerBalanceAdjustment model.
2. Adds new fields to CustomerBalanceAdjustment model.
3. Modifies the PricingUnit model.
4. Sets unique constraints for the PricingUnit model.

### Operations
#### Description
A list of operations to be performed in this migration.

#### Internal Logic
1. `AlterModelOptions`: Changes the ordering of CustomerBalanceAdjustment to be by '-created'.
2. `AddField`: Adds 'adjustment_id', 'organization', 'parent_adjustment', and 'status' fields to CustomerBalanceAdjustment.
3. `AlterField`: Modifies the 'code' field of PricingUnit.
4. `AlterUniqueTogether`: Sets a unique constraint on PricingUnit for 'organization' and 'code' fields.

## Dependencies
This migration depends on the previous migration '0082_customer_default_currency_and_more'.

## Configuration
The migration uses the following configuration options:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| CUSTOMER_BALANCE_ADJUSTMENT_STATUS | Enum | N/A | Defines status choices for CustomerBalanceAdjustment |

## Notes
- The migration introduces a new field 'adjustment_id' with a default value generated by a custom function `metering_billing.utils.utils.customer_balance_adjustment_uuid`.
- The 'organization' field in CustomerBalanceAdjustment is set to allow null values and uses CASCADE on delete.
- The 'parent_adjustment' field allows for hierarchical relationships between balance adjustments.
- The 'status' field is added with choices defined by CUSTOMER_BALANCE_ADJUSTMENT_STATUS enum.
- The 'code' field in PricingUnit is modified to have a maximum length of 10 characters.
- A unique constraint is added to PricingUnit for the combination of 'organization' and 'code' fields.

This migration enhances the CustomerBalanceAdjustment model with new fields for better tracking and management of balance adjustments, while also refining the PricingUnit model for improved organization-specific pricing codes.