---
title: "0095_historicalsubscriptionrecord_subscriptionrecord_and_more.py"
---

## High-level description
This Django migration script introduces the `SubscriptionRecord` model and its historical counterpart, `HistoricalSubscriptionRecord`, to replace the existing `Subscription` model. This change likely aims to improve subscription management and tracking within the metering and billing system.

## Code Structure
This migration script primarily focuses on creating two new models: `SubscriptionRecord` and `HistoricalSubscriptionRecord`. It also modifies existing models like `Invoice` and `HistoricalInvoice` to reference the new `SubscriptionRecord` model. The script ensures data integrity by migrating data from the old `Subscription` model to the new `SubscriptionRecord` model and updating foreign key relationships accordingly.

## References
This migration script references several other models within the `metering_billing` app, including:
- `Customer`
- `Organization`
- `PlanVersion`
- `CategoricalFilter`
- `Invoice`
- `HistoricalInvoice`
- `PricingUnit`
- `StripeOrganizationIntegration`
- `BraintreeOrganizationIntegration`
- `StripeCustomerIntegration`
- `BraintreeCustomerIntegration`
- `UnifiedCRMCustomerIntegration`

It also utilizes the `simple_history` library for historical record keeping.

## Symbols

### `Migration`
#### Description
This class defines a Django migration that introduces the `SubscriptionRecord` model and replaces the existing `Subscription` model.

#### Inputs
N/A - This is a Django migration script, not a function.

#### Outputs
N/A - This is a Django migration script, not a function.

#### Internal Logic
The migration performs the following operations:

1. **Create `HistoricalSubscriptionRecord` model:** This model will store historical data for each `SubscriptionRecord` instance.
2. **Create `SubscriptionRecord` model:** This model replaces the existing `Subscription` model and stores detailed information about each subscription.
3. **Migrate data from `Subscription` to `SubscriptionRecord`:** This step ensures existing subscription data is transferred to the new model.
4. **Update foreign key relationships:** Models like `Invoice` and `HistoricalInvoice` are updated to reference `SubscriptionRecord` instead of `Subscription`.
5. **Delete `Subscription` and `HistoricalSubscription` models:** The old models are removed after successful data migration.

## Dependencies
This migration script depends on the following external libraries:

| Dependency | Purpose |
|:-----------|:--------|
| django.db.models | Provides database model functionality |
| simple_history.models | Enables historical record keeping for models |
| metering_billing.utils.utils | Provides utility functions for the metering and billing system |

### Configuration
N/A - This migration script does not define any specific configuration options.

## Error Handling
This migration script relies on Django's built-in error handling mechanisms for database operations and model interactions.

## Logging
This migration script does not implement any specific logging mechanisms.

## API/Interface Reference
N/A - This migration script does not expose any API endpoints or public interfaces.
