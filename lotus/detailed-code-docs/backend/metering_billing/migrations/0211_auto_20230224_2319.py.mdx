---
title: "0211_auto_20230224_2319.py"
---

## High-level description
This Django migration script updates the `active_from` and `active_to` fields for `Plan` and `PlanVersion` models in the metering_billing app. It sets the `active_from` field to the `created_on` date and calculates the `active_to` field based on the plan's status.

## References
This migration references the following symbols:
- `metering_billing.utils.now_utc`: A function that returns the current UTC datetime.

## Symbols
### `set_not_before(apps, schema_editor)`
#### Description
This function sets the `active_from` field for all `Plan` and `PlanVersion` instances to their respective `created_on` date.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| apps | django.db.migrations.state.StateApps |  A registry of models and their configurations. |
| schema_editor | django.db.backends.base.schema.BaseDatabaseSchemaEditor | An object for managing database schema changes. |

#### Outputs
This function does not return any value.

#### Side Effects
- Modifies the `active_from` field of all `Plan` and `PlanVersion` instances in the database.

### `set_not_after(apps, schema_editor)`
#### Description
This function sets the `active_to` field for all `Plan` and `PlanVersion` instances based on their status. For active plans/versions, it sets `active_to` to `None`. For archived plans/versions, it sets `active_to` to the current UTC datetime and also sets the `deleted` field to the current UTC datetime.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| apps | django.db.migrations.state.StateApps | A registry of models and their configurations. |
| schema_editor | django.db.backends.base.schema.BaseDatabaseSchemaEditor | An object for managing database schema changes. |

#### Outputs
This function does not return any value.

#### Side Effects
- Modifies the `active_to` and `deleted` fields of all `Plan` and `PlanVersion` instances in the database.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| django.db | Database access and migration framework. |
| metering_billing.utils | Utility functions used within the migration. |

## Error Handling
This migration does not implement specific error handling beyond basic exception raising.
