---
title: "0022_remove_plancomponent_cost_per_metric_and_more.py"
---

## High-level description
This Django migration file removes fields related to cost-per-metric pricing from the `PlanComponent` model and introduces fields for cost-per-batch pricing. It also adds a new `Feature` model and establishes a many-to-many relationship between `BillingPlan` and `Feature`.

## Code Structure
This migration file primarily modifies the `PlanComponent` model by removing existing fields and adding new ones. It also introduces a new `Feature` model and links it to the `BillingPlan` model.

## Symbols

### `Migration`
#### Description
This class defines the database migration operations to be applied.

#### Inputs
None

#### Outputs
None

#### Internal Logic
- **`dependencies`**: Specifies a list of previous migrations that this migration depends on.
- **`operations`**: Defines a sequence of operations to be performed during the migration. These operations include:
    - Removing fields related to cost-per-metric pricing from the `PlanComponent` model (`cost_per_metric`, `cost_per_metric_currency`, `max_amount`, `metric_amount_per_cost`).
    - Adding fields for cost-per-batch pricing to the `PlanComponent` model (`cost_per_batch`, `cost_per_batch_currency`, `max_metric_units`, `metric_units_per_batch`).
    - Modifying the `free_metric_quantity` field in the `PlanComponent` model to have a default value of 0.0.
    - Creating a new `Feature` model with fields for `feature_name`, `feature_description`, and a foreign key to `Organization`.
    - Adding a many-to-many relationship between `BillingPlan` and `Feature` through the `features` field.

## Side Effects
This migration will modify the database schema by altering the `PlanComponent` table and creating a new `Feature` table. It will also create a new table to manage the many-to-many relationship between `BillingPlan` and `Feature`.
