---
title: "0118_alter_pricingunit_unique_together_and_more.py"
---

## High-level description
This migration file (0118_alter_pricingunit_unique_together_and_more.py) contains database schema changes for the metering_billing application. It modifies the PricingUnit model, adds fields to the Organization and HistoricalOrganization models, and updates the Invoice model's foreign key relationships.

## Code Structure
The migration file defines a single Migration class with dependencies and operations. The operations list contains the specific database changes to be applied.

## Symbols

### Migration
#### Description
This class defines the migration operations to be applied to the database schema.

#### Internal Logic
1. Removes the unique_together constraint from the PricingUnit model.
2. Adds a 'currencies_provisioned' field to both Organization and HistoricalOrganization models.
3. Modifies the 'customer', 'organization', and 'subscription' fields in the Invoice model to allow null values and sets the on_delete behavior to CASCADE.
4. Adds two new constraints to the PricingUnit model to ensure uniqueness of 'code' and 'name' per organization.

## Dependencies
This migration depends on the previous migration "0117_auto_20221213_0529".

## Symbols

### AlterUniqueTogether
#### Description
Removes the unique_together constraint from the PricingUnit model.

### AddField
#### Description
Adds the 'currencies_provisioned' field to both Organization and HistoricalOrganization models.

#### Inputs
- model_name: The name of the model to modify
- name: The name of the new field
- field: The field definition

### AlterField
#### Description
Modifies the 'customer', 'organization', and 'subscription' fields in the Invoice model.

#### Inputs
- model_name: The name of the model to modify
- name: The name of the field to alter
- field: The new field definition

### AddConstraint
#### Description
Adds new constraints to the PricingUnit model for uniqueness of 'code' and 'name' per organization.

#### Inputs
- model_name: The name of the model to modify
- constraint: The constraint definition

## Side Effects
This migration will modify the database schema, potentially affecting existing data and application behavior. It's important to test thoroughly and consider data migration if necessary.

## Performance Considerations
Adding new constraints to the PricingUnit model may impact insert and update operations on that table. The new field additions should have minimal performance impact.