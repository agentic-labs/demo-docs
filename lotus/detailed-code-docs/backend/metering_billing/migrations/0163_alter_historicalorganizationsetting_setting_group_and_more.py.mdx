---
title: "0163_alter_historicalorganizationsetting_setting_group_and_more.py"
---

## High-level description
This migration file (0163_alter_historicalorganizationsetting_setting_group_and_more.py) is a Django migration that modifies the OrganizationSetting model and its historical records. It updates field choices, renames some setting names, and applies these changes to both the main and historical tables.

## Code Structure
The migration consists of a data migration function `change_organization_setting_names` and a `Migration` class with several operations. The operations alter fields in both the `HistoricalOrganizationSetting` and `OrganizationSetting` models, and run the data migration function.

## Symbols

### `change_organization_setting_names`
#### Description
This function updates existing OrganizationSetting records, changing specific setting names.

#### Internal Logic
1. Retrieves all OrganizationSetting objects.
2. For each setting:
   - If the setting_name is "subscription_filters", changes it to "subscription_filter_keys".
   - If the setting_name is "invoice_grace_period", changes it to "payment_grace_period".
3. Saves the updated settings.

### `Migration`
#### Description
Defines the migration operations to be applied to the database.

#### Internal Logic
1. Specifies the dependency on the previous migration.
2. Defines several `AlterField` operations for both `HistoricalOrganizationSetting` and `OrganizationSetting` models:
   - Updates the `setting_group` field with new choices.
   - Updates the `setting_name` field with new choices.
3. Runs the `change_organization_setting_names` function using `RunPython`.

## Dependencies
This migration depends on the previous migration: `0162_remove_pricetier_batch_rounding_type_old_and_more`.

## Configuration
The migration updates the following configuration options:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| setting_group | CharField | N/A | Updated choices for setting groups |
| setting_name | CharField | N/A | Updated choices for setting names |

## Error Handling
The migration uses Django's built-in error handling for migrations. If any operation fails, the entire migration will be rolled back.

## Side Effects
This migration will:
1. Update the schema of `HistoricalOrganizationSetting` and `OrganizationSetting` models.
2. Rename existing setting names in the database from "subscription_filters" to "subscription_filter_keys" and from "invoice_grace_period" to "payment_grace_period".

These changes may affect any code that relies on the old setting names or choices. Ensure that all related code is updated to use the new names and choices after applying this migration.