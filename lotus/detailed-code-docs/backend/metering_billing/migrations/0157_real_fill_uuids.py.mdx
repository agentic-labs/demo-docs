---
title: "0157_real_fill_uuids.py"
---

## High-level description
This Django migration script updates various models in the `metering_billing` app by replacing existing text-based primary keys with UUIDs. It iterates through each instance of the specified models and assigns a new UUID to the designated `*_id` field.

## References
This migration references the following models in the `metering_billing` app:
- `Organization`
- `Backtest`
- `CustomerBalanceAdjustment`
- `Feature`
- `Metric`
- `Invoice`
- `InvoiceLineItem`
- `OrganizationSetting`
- `Plan`
- `PlanVersion`
- `Subscription`
- `SubscriptionRecord`
- `Tag`
- `UsageAlert`
- `WebhookEndpoint`

## Symbols

### `transfer_text_to_uuid(apps, schema_editor)`
#### Description
This function fetches all instances of specified models and assigns a new UUID to their respective `*_id` fields.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| apps | django.db.migrations.state.StateApps | Registry of models and other application state. |
| schema_editor | django.db.backends.base.schema.BaseDatabaseSchemaEditor | An object that allows for database schema manipulation. |

#### Outputs
This function does not explicitly return any value.

#### Internal Logic
1. For each model (e.g., `Organization`, `Backtest`, etc.):
    - It retrieves the model using `apps.get_model("metering_billing", "ModelName")`.
    - It iterates through all instances of the model.
    - For each instance, it generates a new UUID using `uuid.uuid4()` and assigns it to the corresponding `*_id` field (e.g., `organization_id`, `backtest_id`, etc.).
    - It saves the modified instance.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| uuid | Used for generating UUIDs. |
| django.db | Used for database operations, including migrations. |

## Error Handling
This migration script does not implement specific error handling. Any exceptions raised during the execution will be propagated and handled by Django's migration framework. 
