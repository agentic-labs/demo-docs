---
title: "0087_alter_metric_unique_together_and_more.py"
---

## High-level description
This Django migration script adds new fields (`metric_id` and `status`) to the `Metric` and `HistoricalMetric` models, modifies the `billable_metric_name` field to be nullable, and updates the `status` field in the `HistoricalProduct` and `Product` models. It also removes the unique constraint from the `Metric` model.

## References
This migration references the `metering_billing.utils.utils.metric_uuid` function to generate default values for the new `metric_id` field.

## Symbols
### `Migration`
#### Description
This class defines a Django migration that alters the database schema by adding new fields, modifying existing fields, and removing constraints.

#### Inputs
N/A - This is a migration class, not a function.

#### Outputs
N/A - This is a migration class, not a function.

#### Internal Logic
The migration performs the following operations:

1. **Removes the unique constraint from the `Metric` model:**
   - `migrations.AlterUniqueTogether(name="metric", unique_together=set())`
     - This removes any existing unique constraints on the `Metric` model, allowing for duplicate metric names.

2. **Adds `metric_id` and `status` fields to `HistoricalMetric` and `Metric` models:**
   - `migrations.AddField(model_name="historicalmetric", name="metric_id", ...)` and `migrations.AddField(model_name="metric", name="metric_id", ...)`
     - These lines add a new `metric_id` field to both the `HistoricalMetric` (used for tracking history) and `Metric` models. 
     - The field is a `CharField` with a maximum length of 200 characters.
     - It has a default value generated by the `metering_billing.utils.utils.metric_uuid` function.
   - `migrations.AddField(model_name="historicalmetric", name="status", ...)` and `migrations.AddField(model_name="metric", name="status", ...)`
     - These lines add a new `status` field to both the `HistoricalMetric` and `Metric` models.
     - The field is a `CharField` with choices "active" and "archived", defaulting to "active".

3. **Modifies the `billable_metric_name` field in `HistoricalMetric` and `Metric` models:**
   - `migrations.AlterField(model_name="historicalmetric", name="billable_metric_name", ...)` and `migrations.AlterField(model_name="metric", name="billable_metric_name", ...)`
     - These lines modify the existing `billable_metric_name` field in both the `HistoricalMetric` and `Metric` models to allow null values.

4. **Updates the `status` field in `HistoricalProduct` and `Product` models:**
   - `migrations.AlterField(model_name="historicalproduct", name="status", ...)` and `migrations.AlterField(model_name="product", name="status", ...)`
     - These lines modify the existing `status` field in both the `HistoricalProduct` and `Product` models.
     - The field remains a `CharField` but now explicitly defines its choices as "active" and "archived".

## Side Effects
This migration will modify the database schema by adding new fields, modifying existing fields, and removing constraints. It's crucial to run this migration in a controlled environment and ensure it's compatible with existing data.
