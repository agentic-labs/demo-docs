---
title: "0058_remove_customer_balance_and_more.py"
---

## High-level description
This migration file (0058_remove_customer_balance_and_more.py) is a Django migration that makes several changes to the database schema, including removing fields from Customer and HistoricalCustomer models, adding fields to Invoice and Subscription models, and creating a new CustomerBalanceAdjustment model.

## Code Structure
The migration is defined as a single class `Migration` that inherits from Django's migration framework. It specifies the dependencies and a list of operations to be performed on the database schema.

## Symbols

### Migration
#### Description
This class defines the migration operations to be applied to the database schema.

#### Internal Logic
The migration performs the following key operations:
1. Removes 'balance' and 'balance_currency' fields from Customer and HistoricalCustomer models.
2. Adds 'invoice_id' field to Invoice and HistoricalInvoice models.
3. Adds 'scheduled_end_date' field to Subscription and HistoricalSubscription models.
4. Modifies 'usage_billing_frequency' field in PlanVersion and HistoricalPlanVersion models.
5. Changes 'flat_fee_already_billed' field in Subscription and HistoricalSubscription models.
6. Creates a new CustomerBalanceAdjustment model with various fields for tracking customer balance adjustments.

## Dependencies
This migration depends on the previous migration '0057_alter_priceadjustment_price_adjustment_amount'.

## Configuration
The migration uses the following configuration options:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| dependencies | list | [...] | Specifies the migration this one depends on |
| operations | list | [...] | Defines the sequence of operations to be performed |

## Notes
- The migration removes the 'balance' field from the Customer model, suggesting a change in how customer balances are tracked.
- The new CustomerBalanceAdjustment model is introduced, likely to provide more detailed and flexible balance management for customers.
- The addition of 'scheduled_end_date' to Subscription models suggests an enhancement in subscription management capabilities.
- The changes to 'usage_billing_frequency' indicate a modification in how billing frequencies are handled, now including 'quarterly' as an option.

This migration represents a significant change in the application's data model, particularly in how customer balances and subscriptions are managed.