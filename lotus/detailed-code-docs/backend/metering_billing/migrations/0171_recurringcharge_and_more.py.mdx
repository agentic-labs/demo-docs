---
title: "0171_recurringcharge_and_more.py"
---

## High-level description
This Django migration file introduces the `RecurringCharge` model to the `metering_billing` app and establishes relationships with existing models like `Organization`, `PlanComponent`, `PlanVersion`, and `PricingUnit`. It defines fields for recurring charges, such as name, timing, behavior, and amount.

## Code Structure
The `Migration` class defines operations to create the `RecurringCharge` model and add fields and constraints related to it. It leverages Django's ORM to define the model structure, relationships, and constraints.

## References
This migration references the following models:
- `metering_billing.Organization`
- `metering_billing.PlanComponent`
- `metering_billing.PlanVersion`
- `metering_billing.PricingUnit`

## Symbols
### `Migration`
#### Description
This class represents a Django migration that alters the database schema by creating the `RecurringCharge` model and defining its fields, relationships, and constraints.

#### Inputs
N/A - This is a migration class and doesn't accept direct inputs.

#### Outputs
N/A - This is a migration class and doesn't return any outputs. It modifies the database schema.

#### Internal Logic
The `operations` list defines the steps involved in this migration:
- **CreateModel:** Creates the `RecurringCharge` model with fields for `id`, `name`, `charge_timing`, `charge_behavior`, and `amount`.
- **AddField:** Adds fields to the `RecurringCharge` model to establish relationships with other models:
    - `organization`: ForeignKey to `Organization`
    - `plan_component`: ForeignKey to `PlanComponent` (nullable)
    - `plan_version`: ForeignKey to `PlanVersion`
    - `pricing_unit`: ForeignKey to `PricingUnit` (nullable)
- **AddConstraint:** Adds a unique constraint to ensure that each recurring charge name is unique within a specific plan version for an organization.

## Side Effects
- Creates the `RecurringCharge` table in the database.
- Adds new columns to the `RecurringCharge` table for relationships with other tables.
- Creates a unique constraint on the `RecurringCharge` table.

## Dependencies
- `django.db.migrations`
- `django.db.models`
- `django.core.validators`
- `decimal.Decimal`

### Configuration
N/A - This migration doesn't define any configuration options.

## Error Handling
N/A - This migration relies on Django's built-in error handling for database operations.

## Logging
N/A - This migration doesn't implement any specific logging.

## API/Interface Reference
N/A - This migration doesn't expose any API endpoints.
