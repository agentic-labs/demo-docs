---
title: "0003_alter_invoice_customer_alter_invoice_line_items_and_more.py"
---

## High-level description
This migration file modifies the `Invoice` model in the `metering_billing` app. It changes several fields from foreign key relationships to JSONField, and updates the `status` field choices.

## Code Structure
This migration file contains a single `Migration` class with dependencies and operations. The operations modify the `Invoice` model by removing and adding fields, and altering existing fields.

## Symbols

### Migration
#### Description
This class defines the migration operations to be applied to the database schema.

#### Internal Logic
1. Removes the `customer`, `line_items`, `organization`, and `subscription` fields from the `Invoice` model.
2. Adds new JSONField versions of `customer`, `line_items`, `organization`, and `subscription` to the `Invoice` model.
3. Alters the `status` field of the `Invoice` model, updating its choices.

## Dependencies
This migration depends on the previous migration file "0002_alter_billingplan_flat_rate_and_more".

## Operations
The migration performs the following operations:

1. Removes the `customer` field and adds it back as a JSONField.
2. Removes the `line_items` field and adds it back as a JSONField.
3. Removes the `organization` field and adds it back as a JSONField.
4. Alters the `status` field, updating its choices to:
   - "requires_payment_method"
   - "requires_action"
   - "processing"
   - "succeeded"
5. Removes the `subscription` field and adds it back as a JSONField.

These changes suggest that the `Invoice` model is being modified to store related data as JSON objects instead of foreign key relationships. This could be for performance reasons, to reduce database joins, or to allow for more flexible data structures.

The update to the `status` field choices indicates a refinement in the possible states an invoice can be in, likely aligning with payment processing stages.