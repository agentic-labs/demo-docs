---
title: "0139_alter_organizationsetting_unique_together_and_more.py"
---

## High-level description
This Django migration script makes changes to the database schema for a metering and billing application. It alters tables related to organizations, subscriptions, invoices, and customer balance adjustments, adding and removing fields, constraints, and indexes. 

The migration also introduces new models for webhook endpoints and triggers, allowing for integration with external services.

## Code Structure
This code defines a Django migration with a series of operations that modify the database schema. The operations are executed in sequence to alter existing tables and create new ones.

## References
This migration references the following models:
- `OrganizationSetting`
- `HistoricalSubscriptionRecord`
- `SubscriptionRecord`
- `HistoricalInvoice`
- `Invoice`
- `Subscription`

## Symbols
### `Migration`
#### Description
This class represents a database migration operation. It defines a set of dependencies on previous migrations and a list of operations to be performed on the database schema.

#### Inputs
N/A - This is a class definition, not a function.

#### Outputs
N/A - This is a class definition, not a function.

#### Internal Logic
The `operations` list defines the changes to be made to the database schema. These operations include:
- `AlterUniqueTogether`: Removes the unique constraint from the `OrganizationSetting` model.
- `RemoveField`: Removes the `status` field from `HistoricalSubscriptionRecord` and `SubscriptionRecord` models.
- `AlterField`: Modifies the `invoice_pdf` field in `HistoricalInvoice` and `Invoice` models to be a URLField with a maximum length of 300 characters.
- `AddConstraint`: Adds several constraints to the `Subscription` model:
    - Ensures that the `start_date` is less than or equal to the `end_date`.
    - Enforces uniqueness on the combination of `subscription_id` and `organization`.
    - Enforces uniqueness on the combination of `customer`, `start_date`, and `end_date`.

## Side Effects
This migration script modifies the database schema, which may impact existing data.

## Dependencies
This migration depends on the following Django modules:
- `django.db.migrations`
- `django.db.models.expressions`
- `django.db`
- `django.db.models`

It also depends on a previous migration:
- `"metering_billing", "0138_customer_tax_rate_historicalcustomer_tax_rate_and_more"`
