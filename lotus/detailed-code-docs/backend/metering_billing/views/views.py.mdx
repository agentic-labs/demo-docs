---
title: "views.py"
---

This file, `backend/metering_billing/views/views.py`, contains various API views for handling different functionalities in the Lotus billing system. Here's a high-level description of its purpose and main functionality:

The file defines several API endpoints that provide data and functionality for the Lotus billing system's frontend. These endpoints handle operations such as retrieving revenue data, event data, subscription data, and customer data. They also provide functionality for importing customers, payment objects, and subscriptions from external payment processors.

## Code Structure

The file defines several class-based views, each handling a specific set of related operations. These views inherit from Django Rest Framework's APIView class and implement various HTTP methods (GET, POST) to handle different types of requests.

## Symbols

Here are some of the main symbols (classes) defined in this file:

### PeriodMetricRevenueView
#### Description
This view handles requests for revenue data over a specified period.

#### Inputs
- start_date: The start date of the period
- end_date: The end date of the period

#### Outputs
- total_revenue: The total revenue collected during the period
- earned_revenue: The total revenue earned during the period

### PeriodEventsView
#### Description
This view handles requests for event data over two specified periods.

#### Inputs
- period_1_start_date, period_1_end_date: The start and end dates of the first period
- period_2_start_date, period_2_end_date: The start and end dates of the second period

#### Outputs
- total_events_period_1: The total number of events in the first period
- total_events_period_2: The total number of events in the second period

### PeriodSubscriptionsView
#### Description
This view handles requests for subscription data over two specified periods.

#### Inputs
- period_1_start_date, period_1_end_date: The start and end dates of the first period
- period_2_start_date, period_2_end_date: The start and end dates of the second period

#### Outputs
- period_1_total_subscriptions: The total number of subscriptions in the first period
- period_1_new_subscriptions: The number of new subscriptions in the first period
- period_2_total_subscriptions: The total number of subscriptions in the second period
- period_2_new_subscriptions: The number of new subscriptions in the second period

### PeriodMetricUsageView
#### Description
This view handles requests for metric usage data over a specified period.

#### Inputs
- start_date: The start date of the period
- end_date: The end date of the period
- top_n_customers: The number of top customers to include in the results

#### Outputs
- metrics: A dictionary containing usage data for each metric

### ChangeUserOrganizationView
#### Description
This view handles requests to change a user's organization.

#### Inputs
- transfer_to_organization_id: The ID of the organization to transfer the user to

#### Outputs
- HTTP 200 OK if successful

### ImportCustomersView, ImportPaymentObjectsView, ImportSubscriptionsView
#### Description
These views handle requests to import customers, payment objects, and subscriptions from external payment processors.

#### Inputs
- source: The payment processor to import from (e.g., "stripe")

#### Outputs
- status: Success or error
- detail: A message describing the result of the operation

## Dependencies
The file imports and uses various models, serializers, and utility functions from other parts of the Lotus project. It also uses Django Rest Framework for handling API requests and responses.

This file is a crucial part of the Lotus billing system's backend, providing the necessary API endpoints for the frontend to interact with the system's data and functionality.