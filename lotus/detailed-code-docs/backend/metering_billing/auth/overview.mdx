---
title: "Overview"
---

## High-level description
The `backend/metering_billing/auth` directory houses the authentication and authorization logic for the metering and billing backend. It primarily deals with API key validation, organization association, and custom permission management.

## What does it do?
This directory ensures secure access to the application's API by:

1. **API Key Validation:** It checks the validity of API keys provided in requests, ensuring only authorized clients can access resources.
2. **Organization Association:** It determines the organization associated with either an API key or an authenticated user session. This is crucial for applying organization-specific permissions and billing.
3. **Custom Permission Policies:** It defines flexible permission policies based on HTTP methods, allowing for granular control over API access.

## Entry points
The main entry point is `auth_utils.py`, which contains the core logic for authentication and authorization. It defines functions for API key validation, organization parsing, and a mixin for custom permission policies.

## Key Files
### backend/metering_billing/auth/auth_utils.py
This file is the heart of the authentication system. It provides:

- `get_organization_from_key`: Retrieves an organization based on a provided API key.
- `parse_organization`: Determines the organization from either an API key or user session, ensuring consistency.
- `fast_api_key_validation_and_cache`: Optimizes API key validation using caching for faster response times.
- `PermissionPolicyMixin`: Allows defining custom permission policies based on HTTP methods, enhancing security granularity.

## Dependencies
- `django.core.cache`: Used for caching API key validation results to improve performance.
- `drf_spectacular.extensions`: Facilitates the integration of Knox token authentication with OpenAPI documentation.
- `metering_billing.exceptions`: Leverages custom exception classes for specific authentication and authorization errors.
- `metering_billing.models`: Utilizes database models, such as `APIToken`, for API key management and validation.
- `metering_billing.permissions`: Employs custom permission classes to enforce access control based on organization and user roles.
- `metering_billing.utils`: Incorporates utility functions for common tasks within the authentication and authorization processes. 
