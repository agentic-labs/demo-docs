---
title: "test_register.py"
---

## High-level description
This file contains test cases for the registration functionality of a backend system. It tests various scenarios of user registration, including successful registration and handling of different error cases.

## Code Structure
The code defines a test class `TestRegister` with multiple test methods. It uses pytest fixtures to set up common test data and configurations. The tests interact with a Django REST framework API client to send registration requests and assert the expected outcomes.

## Symbols

### `registration_test_common_setup`
#### Description
A pytest fixture that sets up common test data for registration tests, including organizations, API keys, and users.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| setup_dict | dict | A dictionary containing test setup data |

#### Internal Logic
1. Creates two organizations with API keys
2. Creates an API client
3. Adds a user to the first organization
4. Returns a dictionary with all the setup data

### `register_payload`
#### Description
A pytest fixture that generates a payload for registration requests.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization_name | str | Name of the organization |
| industry | str | Industry of the organization |
| email | str | Email of the user |
| password | str | Password for the user |
| username | str | Username for the user |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| payload | dict | A dictionary containing registration data |

### `TestRegister`
#### Description
A test class containing multiple test methods for the registration functionality.

#### Test Methods

1. `test_register_valid`
   - Tests successful registration with valid data
   - Asserts that a new user and organization are created

2. `test_register_org_exists`
   - Tests registration with an existing organization name
   - Asserts that the registration fails with a 400 status code

3. `test_register_username_exists`
   - Tests registration with an existing username
   - Asserts that the registration fails with a 400 status code

4. `test_register_email_exists`
   - Tests registration with an existing email
   - Asserts that the registration fails with a 400 status code

#### Internal Logic
Each test method follows a similar pattern:
1. Set up test data using the `registration_test_common_setup` fixture
2. Create a registration payload using the `register_payload` fixture
3. Send a POST request to the registration endpoint
4. Assert the expected response status code and database state

## Dependencies
- pytest
- Django
- Django REST framework
- metering_billing.models (Organization, User)
- metering_billing.serializers.serializer_utils (DjangoJSONEncoder)

This test file ensures that the registration functionality works correctly, handling both successful registrations and various error cases appropriately.