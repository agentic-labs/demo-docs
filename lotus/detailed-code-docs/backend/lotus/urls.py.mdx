---
title: "urls.py"
---

## High-level description
This file defines the URL patterns for the Lotus application, mapping URLs to corresponding views. It includes routes for both the Django admin interface and the application's API, handling authentication, data management, and various application-specific functionalities. The file also incorporates conditional URL patterns based on settings like DEBUG mode and PROFILER_ENABLED.

## Code Structure
The code defines two routers: `router` for the main application views and `api_router` for the API views. These routers register various viewsets, associating them with specific URL patterns. The `urlpatterns` list then combines these routers with additional URL patterns for specific views and functionalities, including authentication, CRM integration, Stripe webhooks, and more.

## References
This file references several viewsets and views defined in other modules, including:
- `api.views`: Contains API-specific viewsets for customers, plans, subscriptions, invoices, and credits.
- `metering_billing.views.auth_views`: Handles authentication-related views like login, logout, registration, and password reset.
- `metering_billing.views.organization_views`: Manages organization-related views like invitations.
- `metering_billing.views.webhook_views`: Processes webhook events, specifically from Stripe.
- `metering_billing.views.crm_views`: Handles CRM integration functionalities.
- `metering_billing.views.model_views`: Contains viewsets for managing various data models like users, customers, metrics, subscriptions, invoices, features, webhooks, etc.
- `metering_billing.views.payment_processor_views`: Manages payment processor-related views.
- `metering_billing.views.views`: Includes views for specific application functionalities like switching organizations, importing data, and generating reports.

## Symbols
### `urlpatterns`
#### Description
This list defines the URL patterns for the Lotus application, mapping URLs to corresponding views. It combines routes from the `router` and `api_router`, along with additional URL patterns for specific views and functionalities.

#### Internal Logic
The `urlpatterns` list is constructed as follows:
1. **Admin:** Includes the Django admin interface at `/admin/`.
2. **API Views:** Includes the API router (`api_router`) at `/api/`, handling API-specific functionalities.
3. **App Views:** Includes the main application router (`router`) at `/app/`, handling data management and application-specific functionalities.
4. **Authentication:** Defines routes for login, logout, registration, password reset, and organization invitations.
5. **Stripe:** Includes a route for handling Stripe webhooks at `/stripe/webhook/`.
6. **CRM:** Defines routes for CRM integration functionalities, including linking and storing tokens, managing CRM connections, and setting customer source of truth.
7. **Conditional URL Patterns:**
    - If `PROFILER_ENABLED` is True, includes routes for the Silk profiler at `/silk/`.
    - If `DEBUG` is True, includes a catch-all route that serves the `index.html` template for any unmatched URL.

## Dependencies
This file depends on Django's URL handling mechanisms and the `rest_framework` library for routing and viewsets.

## Configuration
The code uses the following configuration settings from Django's `settings` module:
- `DEBUG`: Determines whether to include debug-specific URL patterns.
- `PROFILER_ENABLED`: Determines whether to include URL patterns for the Silk profiler.

## Error Handling
The code does not implement specific error handling mechanisms beyond basic exception raising.

## Logging
The code does not implement logging.

## API/Interface Reference
This file defines the API endpoints for the Lotus application, but the specific request/response formats and authentication requirements are handled by the individual viewsets and views referenced in the `urlpatterns` list.
