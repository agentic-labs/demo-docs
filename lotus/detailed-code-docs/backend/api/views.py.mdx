---
title: "views.py"
---

Here's a high-level description of the target file (backend/api/views.py):

This file contains the main API views for the Lotus billing and metering system. It defines various ViewSets and API endpoints for managing customers, plans, subscriptions, invoices, and other core functionality. The views handle operations like creating and retrieving resources, as well as more complex billing-related tasks. The file integrates with Django REST Framework for API functionality and uses custom serializers, permissions, and authentication. It also implements webhooks, caching, and integrates with external services like payment processors and analytics tools.

Code Structure:
The file is organized into several main classes and functions:

1. ViewSets for core models (CustomerViewSet, PlanViewSet, SubscriptionViewSet, InvoiceViewSet, etc.)
2. API views for specific operations (MetricAccessView, FeatureAccessView, etc.) 
3. Utility functions for common tasks
4. Webhook and external integration handling

The ViewSets and API views inherit from base classes provided by Django REST Framework and custom mixins. They use serializers defined in other files to handle data validation and formatting.

Key components:
- CustomerViewSet: Handles CRUD operations for customers
- PlanViewSet: Manages plan-related operations
- SubscriptionViewSet: Handles subscription creation, updates, and cancellations
- InvoiceViewSet: Manages invoice generation and retrieval
- MetricAccessView/FeatureAccessView: Check access to metrics and features for customers
- Ping/Healthcheck: Simple endpoints for API status checks
- track_event: Handles event tracking and ingestion

The file makes extensive use of Django ORM queries, custom permissions, and integrates with external services like Stripe, Braintree, and PostHog for analytics.