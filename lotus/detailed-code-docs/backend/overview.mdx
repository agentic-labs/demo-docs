---
title: "Overview"
---

## High-level description
The `backend` directory contains the core components of the Lotus application's backend, built primarily using Django and Django REST Framework. It includes the main API implementation, database models, authentication mechanisms, billing and metering logic, and various utility functions. The backend is designed to handle customer management, subscription plans, usage tracking, invoice generation, and payment processing.

## What does it do?
The backend of Lotus provides a comprehensive set of functionalities for a metering and billing system:

1. Exposes RESTful API endpoints for managing customers, plans, subscriptions, and invoices.
2. Tracks customer usage of services and calculates billable metrics.
3. Manages subscription plans and pricing models.
4. Generates invoices based on usage data and subscription plans.
5. Integrates with payment processors like Stripe and Braintree for handling transactions.
6. Implements user authentication and organization management.
7. Executes background tasks for periodic operations such as invoice generation and alert refreshing.
8. Supports CRM integrations for customer data synchronization.
9. Generates PDF invoices and manages their storage in AWS S3.
10. Implements webhooks for notifying external systems of important events.

## Entry points
The main entry points for the backend are:

1. `backend/api/views.py`: Contains the API endpoint definitions using Django REST Framework viewsets and views.
2. `backend/metering_billing/models.py`: Defines the core data models for the application.
3. `backend/metering_billing/tasks.py`: Implements background tasks executed by Celery.
4. `backend/lotus/urls.py`: Defines the URL routing for the entire application.
5. `backend/manage.py`: The command-line utility for executing Django management commands.

## Key Files
1. `backend/metering_billing/models.py`: Defines the core data structures for customers, plans, subscriptions, invoices, and other entities.
2. `backend/metering_billing/views/model_views.py`: Contains viewsets for CRUD operations on the main models.
3. `backend/metering_billing/tasks.py`: Implements background tasks for invoice generation, alert refreshing, and other periodic operations.
4. `backend/metering_billing/invoice.py`: Handles the logic for generating invoices.
5. `backend/metering_billing/payment_processors.py`: Implements integrations with payment processors like Stripe and Braintree.
6. `backend/metering_billing/aggregation/billable_metrics.py`: Handles usage calculation for different metric types.
7. `backend/lotus/settings.py`: Contains the Django project settings and configuration.

## Dependencies
The backend relies on several external libraries and frameworks:

1. Django (4.0.5): The core web framework used for building the application.
2. Django REST Framework: Used for building the API.
3. Celery: Used for asynchronous task processing.
4. Redis: Serves as a message broker for Celery and potentially as a cache backend.
5. Stripe and Braintree SDKs: Used for payment processing.
6. boto3: Used for interacting with AWS S3.
7. reportlab: Used for generating PDF invoices.
8. taxjar: Used for tax calculations.
9. svix: Used for managing webhooks.
10. Kafka: Used for event streaming.
11. Sentry: Used for error tracking and performance monitoring.
12. PostHog: Used for product analytics.

## Configuration
The Lotus backend uses various configuration settings, including:

1. Django settings in `backend/lotus/settings.py` for database configuration, installed apps, middleware, and other Django-specific settings.
2. Environment variables for API keys, secret keys, and other sensitive information.
3. Custom settings for features like payment processors, S3 bucket names, and webhook configurations.
4. `backend/pyproject.toml` for configuring development tools like Ruff (for code linting) and Poetry (for dependency management).

The backend is designed to be flexible and extensible, supporting various pricing models and integrations with external systems. It uses a combination of Django's ORM for data modeling, Django REST Framework for API development, and Celery for handling background tasks. The system is set up to work in both development and production environments, with configuration options to adjust based on the deployment context.