---
title: "helpers.go"
---

## High-level description
This file, `build/testing/helpers.go`, contains utility functions and types for testing the Flipt application. It provides helpers for executing commands, asserting outputs, and generating TLS certificates, which are likely used in various test scenarios for the Flipt project.

## Code Structure
The code defines several helper functions and types that work together to facilitate testing. The main components include command execution helpers, assertion types and functions, and a TLS certificate generator.

## Symbols

### `flipt`
#### Description
A helper function that prepends "/flipt" to the given arguments.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| args | ...string | Variable number of string arguments |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | []string | Slice of strings with "/flipt" prepended |

### `sh`
#### Description
A helper function that creates a shell command array.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cmd | string | The command to be executed in the shell |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | []string | Slice of strings representing the shell command |

### `stringAssertion`
#### Description
An interface for asserting string values.

#### Methods
| Name | Inputs | Outputs | Description |
|:-----|:-------|:--------|:------------|
| assert | string | error | Asserts the given string value |

### `assertConf`
#### Description
A struct that holds configuration for assertions.

### `assertOption`
#### Description
A function type for configuring assertions.

### `fails`
#### Description
An assertion option that sets the success flag to false.

### `stdout`
#### Description
An assertion option that adds a string assertion for stdout.

### `stderr`
#### Description
An assertion option that adds a string assertion for stderr.

### `equals`
#### Description
A string assertion type that checks for exact equality.

### `contains`
#### Description
A string assertion type that checks if a string contains another string.

### `matches`
#### Description
A string assertion type that checks if a string matches a regular expression.

### `assertExec`
#### Description
Executes a command in a container and performs assertions on the output.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| ctx | context.Context | The context for execution |
| flipt | *dagger.Container | The container to execute the command in |
| args | []string | The command arguments |
| opts | ...assertOption | Optional assertion configurations |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| *dagger.Container | The container after execution |
| error | Any error that occurred during execution or assertion |

### `generateTLSCert`
#### Description
Generates a TLS certificate and private key.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| dnsname | ...string | DNS names to be included in the certificate |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| keyBytes | []byte | The private key in PEM format |
| certBytes | []byte | The certificate in PEM format |
| err | error | Any error that occurred during generation |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| context | For handling context in asynchronous operations |
| crypto/rand | For generating random numbers for TLS cert |
| crypto/rsa | For RSA key generation |
| crypto/x509 | For X.509 certificate handling |
| encoding/pem | For PEM encoding of keys and certificates |
| errors | For error handling |
| fmt | For formatted I/O |
| math/big | For big integer operations |
| regexp | For regular expression matching |
| strings | For string manipulation |
| time | For time-related operations |
| github.com/google/go-cmp/cmp | For comparing values in assertions |
| go.flipt.io/build/internal/dagger | For container operations (likely a custom package) |

This file provides essential testing utilities for the Flipt project, including command execution, output assertion, and TLS certificate generation. These helpers are designed to make writing and running tests more efficient and less error-prone.