---
title: "api.go"
---

## High-level description
This file contains integration tests for the Flipt feature flag management system. It defines a comprehensive suite of tests that cover various aspects of Flipt's functionality, including API operations, authentication, authorization, and different storage backends.

## Code Structure
The code is organized into several test functions, each focusing on a specific area of Flipt's functionality. These functions are called within the main `API` function, which sets up the test environment and runs the tests. The code also includes helper functions for setting up different storage backends and running specific test suites.

## Symbols

### `API`
#### Description
This is the main function that orchestrates the integration tests for Flipt. It sets up the test environment and runs various test suites.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| t | *testing.T | Testing object |
| ctx | context.Context | Context for the test execution |
| opts | integration.TestOpts | Test options |

#### Internal Logic
1. Sets up the test environment with authentication configurations.
2. Runs test suites for Namespaces, Flags and Variants, Segments and Constraints, Rules and Distributions, Evaluation, and Batch Evaluation.
3. Performs cleanup operations after tests.

### `withSQLite`, `withLibSQL`, `withPostgres`, `withMySQL`, `withCockroach`
#### Description
These functions set up different database backends for testing Flipt with various storage options.

### `cache`, `cacheWithTLS`
#### Description
These functions set up tests for Flipt's caching functionality, with and without TLS.

### `snapshot`, `ofrep`
#### Description
These functions set up tests for Flipt's snapshot and OFREP (Object File REPresentation) functionality.

### `local`, `git`, `s3`, `oci`, `azblob`
#### Description
These functions set up tests for different storage backends (local filesystem, Git, S3, OCI, Azure Blob Storage).

### `importExport`
#### Description
This function tests Flipt's import and export functionality.

### `authn`, `authz`
#### Description
These functions test Flipt's authentication and authorization functionality.

### `withWebhook`, `withWebhookTemplates`
#### Description
These functions set up tests for Flipt's webhook functionality, with and without templates.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| testing | Go testing framework |
| context | Context management |
| crypto | Cryptographic operations |
| encoding/json | JSON encoding/decoding |
| fmt | Formatted I/O |
| os | Operating system functionality |
| path | File path manipulation |
| runtime | Go runtime information |
| strings | String manipulation |
| time | Time-related functions |
| github.com/containerd/containerd/platforms | Platform-specific operations |
| github.com/go-jose/go-jose/v3 | JSON Object Signing and Encryption |
| github.com/google/go-cmp/cmp | Deep equality comparisons |
| github.com/google/uuid | UUID generation |
| github.com/hashicorp/cap/jwt | JWT handling |
| go.flipt.io/build/internal/dagger | Internal build tool |
| go.flipt.io/stew/config | Configuration management |
| golang.org/x/sync/errgroup | Error group synchronization |
| gopkg.in/yaml.v3 | YAML parsing |

## Error Handling
The code uses Go's standard error handling mechanisms. Errors are propagated up the call stack and logged or returned as appropriate.

## Logging
The code uses Go's testing package for logging test results and errors.

## TODOs
- There is a TODO comment indicating that metric tests for gRPC are not yet supported.