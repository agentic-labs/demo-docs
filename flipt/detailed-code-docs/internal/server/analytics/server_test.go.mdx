---
title: "server_test.go"
---

## High-level description
The code defines a test suite for the `Server` struct in the `analytics` package. It specifically tests the `GetFlagEvaluationsCount` method of the server, which retrieves the count of flag evaluations within a specified time range. The test utilizes a mock client to simulate interactions with an analytics store.

## Code Structure
The `TestServer` function tests the `Server` struct which depends on the `Client` interface. The test creates a `testClient` that implements the `Client` interface for testing purposes.

## References
- `analytics.GetFlagEvaluationsCountRequest`: This struct is used to define the request parameters for the `GetFlagEvaluationsCount` method.
- `analytics.GetFlagEvaluationsCountResponse`: This struct is used to define the response structure for the `GetFlagEvaluationsCount` method.

## Symbols
### `testClient`
#### Description
This struct is a mock implementation of the `Client` interface, used for testing the `Server`. It provides a dummy implementation for the `GetFlagEvaluationsCount` method, returning predefined values.

#### Inputs
N/A - This is a struct definition.

#### Outputs
N/A - This is a struct definition.

#### Internal Logic
- **GetFlagEvaluationsCount**: This method returns hardcoded timestamps (`[]string{"2000-01-01 00:00:00", "2000-01-01 00:01:00", "2000-01-01 00:02:00"}`) and values (`[]float32{20.0, 30.0, 40.0}`) to simulate a successful response from an analytics store.

- **String**: This method returns a string identifying the client as "test_client".

### `TestServer`
#### Description
This function is a test function that verifies the functionality of the `GetFlagEvaluationsCount` method of the `Server` struct.

#### Inputs
- `t *testing.T`:  A testing object used to control the test execution and report results.

#### Outputs
N/A - This is a test function and does not return any values.

#### Internal Logic
1. **Arrange:**
    - Creates a new instance of the `Server` struct, initializing it with a no-op logger and a `testClient`.
2. **Act:**
    - Calls the `GetFlagEvaluationsCount` method of the server with a predefined `analytics.GetFlagEvaluationsCountRequest`.
3. **Assert:**
    - Uses `require.Nil(t, err)` to assert that the `GetFlagEvaluationsCount` call returned no error.
    - Uses `assert.Equal` to assert that the returned timestamps and values match the predefined values from the `testClient`.
