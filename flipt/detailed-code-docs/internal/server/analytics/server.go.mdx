---
title: "server.go"
---

## High-level description
The `server.go` file defines a gRPC server for Flipt analytics. It uses a `Client` interface to interact with different analytics stores and exposes an API for retrieving analytics data.

## Code Structure
The `Server` struct holds a logger, a `Client` instance, and embeds the `UnimplementedAnalyticsServiceServer` from the `analytics` package. The `New` function creates a new `Server` instance. The `RegisterGRPC` method registers the server with a gRPC server.

## References
- `analytics.Client`: An interface for interacting with analytics stores.
- `analytics.GetFlagEvaluationsCountRequest`: A request message for retrieving flag evaluation counts.
- `analytics.UnimplementedAnalyticsServiceServer`: An unimplemented gRPC server for the analytics service.

## Symbols

### `Client`
#### Description
`Client` is an interface that defines the methods required for an analytics store to be used by the analytics server.

#### Inputs
N/A (interface definition)

#### Outputs
N/A (interface definition)

### `Server`
#### Description
`Server` is a gRPC server for Flipt analytics. It uses a `Client` to interact with an analytics store.

#### Inputs
N/A (struct definition)

#### Outputs
N/A (struct definition)

### `New`
#### Description
`New` constructs a new `Server` instance with the provided logger and `Client`.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| logger | `*zap.Logger` | A logger instance. |
| client | `Client` | An analytics store client. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| server | `*Server` | A new `Server` instance. |

#### Internal Logic
The function simply initializes a new `Server` struct with the provided logger and client.

### `RegisterGRPC`
#### Description
`RegisterGRPC` registers the analytics server with a gRPC server.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| server | `*grpc.Server` | A gRPC server instance. |

#### Outputs
N/A

#### Internal Logic
The function calls `analytics.RegisterAnalyticsServiceServer` to register the server with the provided gRPC server.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| `context` | Provides context management for requests. |
| `fmt` | Implements formatted I/O. |
| `go.flipt.io/flipt/rpc/flipt/analytics` | Provides gRPC definitions for the Flipt analytics service. |
| `go.uber.org/zap` | Provides structured logging. |
| `google.golang.org/grpc` | Provides gRPC support. |

## Error Handling
The code does not implement specific error handling beyond basic exception raising.

## Logging
The code uses the `zap` logger for structured logging.
