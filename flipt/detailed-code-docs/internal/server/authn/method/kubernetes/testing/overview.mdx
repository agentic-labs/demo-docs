---
title: "Overview"
---

## High-level description
This directory contains testing utilities for the Kubernetes authentication method in the Flipt server. It provides functionality to set up both gRPC and HTTP servers for testing purposes, allowing developers to simulate and test the Kubernetes authentication process in a controlled environment.

## What does it do?
The code in this directory facilitates testing of the Kubernetes authentication method by:

1. Setting up a gRPC server with the Kubernetes authentication method registered.
2. Creating an HTTP server that wraps the gRPC server, allowing for HTTP-based testing of the authentication process.
3. Providing methods to start and stop these servers, making it easy to set up and tear down test environments.
4. Using an in-memory store for authentication data during tests.
5. Offering client connections and interfaces for interacting with the test servers.

These utilities allow developers to write integration tests for the Kubernetes authentication method, ensuring that it works correctly within the Flipt server environment.

## Key Files

### grpc.go
This file contains the implementation of the gRPC server for testing. Key components include:

- `GRPCServer` struct: Represents a test gRPC server with the Kubernetes authentication method.
- `StartGRPCServer` function: Initializes and starts the gRPC server for testing.
- Methods for managing the server lifecycle and accessing the client.

### http.go
This file provides an HTTP server wrapper around the gRPC server for testing. Key components include:

- `StartHTTPServer` function: Creates and starts an HTTP server that uses the gRPC server for Kubernetes authentication.
- `HTTPServer` struct: Represents the HTTP server and provides a method to stop it.

## Dependencies
The testing utilities rely on several external libraries and internal Flipt packages:

- `github.com/grpc-ecosystem/go-grpc-middleware`: For gRPC interceptors.
- `github.com/stretchr/testify/require`: For test assertions.
- `go.flipt.io/flipt/internal/config`: For authentication configuration.
- `go.flipt.io/flipt/internal/server/authn/method/kubernetes`: For the Kubernetes authentication method implementation.
- `go.flipt.io/flipt/internal/storage/authn/memory`: For in-memory authentication storage.
- `go.flipt.io/flipt/rpc/flipt/auth`: For authentication service definitions.
- `go.uber.org/zap`: For logging.
- `google.golang.org/grpc`: For gRPC functionality.
- `github.com/go-chi/chi/v5`: For HTTP routing in the HTTP server.

These dependencies are used to create a realistic testing environment that closely mimics the production setup while allowing for easy manipulation and assertion in tests.

## Configuration
The testing utilities use the `config.AuthenticationConfig` struct to configure the authentication settings for the test servers. This allows tests to simulate different authentication configurations and scenarios.

In summary, this directory provides a comprehensive set of tools for testing the Kubernetes authentication method in Flipt, allowing developers to ensure the reliability and correctness of this critical component of the authentication system.