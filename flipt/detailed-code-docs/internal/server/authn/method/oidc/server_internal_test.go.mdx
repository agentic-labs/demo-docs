---
title: "server_internal_test.go"
---

## High-level description
The `server_internal_test.go` file contains unit tests for internal server functions related to the OpenID Connect (OIDC) authentication method in the Go Flipt project. It specifically tests the construction of the callback URL and the authentication skipping behavior of the OIDC server.

## Symbols

### `TestCallbackURL`
#### Description
This function tests the `callbackURL` function, which is responsible for constructing the callback URL used during the OIDC authentication flow. The test cases cover various scenarios for the provided host, including different port combinations, trailing slashes, and protocol prefixes.

#### Inputs
This function takes no explicit inputs. It defines a table of test cases within its scope.

#### Outputs
This function has no explicit outputs. It uses the `assert` package to verify the expected outcomes of the test cases.

#### Internal Logic
The test function iterates through a predefined set of test cases, each containing a test name, a host string, and the expected callback URL. For each test case, it calls the `callbackURL` function with the provided host and a fixed method name "foo". The `assert.Equal` function then compares the returned callback URL with the expected value from the test case.

### `Test_Server_SkipsAuthentication`
#### Description
This function tests the `SkipsAuthentication` method of the `Server` struct. This method is intended to determine whether the server should skip the authentication step for a given request.

#### Inputs
This function takes no explicit inputs. It creates an instance of the `Server` struct within its scope.

#### Outputs
This function has no explicit outputs. It uses the `assert` package to verify the expected outcomes of the test case.

#### Internal Logic
The test function creates a new `Server` object and then calls its `SkipsAuthentication` method with a background context. The `assert.True` function then verifies that the method returns `true`, indicating that the server should skip authentication. This behavior suggests that the OIDC authentication flow might handle authentication externally and doesn't require the server to perform it directly.

## References
- `callbackURL(host, method string) string`: This function is tested by `TestCallbackURL` and is responsible for constructing the callback URL.
- `Server.SkipsAuthentication(ctx context.Context) bool`: This method is tested by `Test_Server_SkipsAuthentication` and determines whether the server should skip authentication.
- `github.com/stretchr/testify/assert`: This package is used for assertions in the test functions.

## Dependencies
- `github.com/stretchr/testify/assert`: This library is used for writing test assertions. 
