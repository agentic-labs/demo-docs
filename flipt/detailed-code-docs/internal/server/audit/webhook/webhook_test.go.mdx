---
title: "webhook_test.go"
---

## High-level description
The code defines a test suite for the `webhook.Sink` type, which is responsible for sending audit events to a webhook endpoint. The tests ensure that the sink correctly sends audit events and handles errors.

## Symbols

### `TestSink`
#### Description
This function is a test function that checks the functionality of the `webhook.Sink` type. It creates a new `webhook.Sink` instance, sends two audit events, and verifies that there are no errors.

#### Inputs
This function takes no inputs. It is a test function and relies on the testing framework to provide context.

#### Outputs
This function has no outputs. It is a test function and uses assertions to verify the expected behavior.

#### Internal Logic
1. **Arrange:**
   - Creates a new `webhook.Sink` instance with a no-op logger and a dummy webhook client.
2. **Act:**
   - Calls the `SendAudits` method of the sink with two sample audit events.
3. **Assert:**
   - Asserts that the `String()` method of the sink returns "webhook".
   - Asserts that the `SendAudits` method returns no error.
   - Asserts that the `Close` method of the sink returns no error.

## References
- `audit.Event`: Represents an audit event.
- `flipt.SubjectFlag`: Represents the subject of an audit event as a flag.
- `flipt.ActionCreate`: Represents the action of an audit event as a create action.
- `flipt.SubjectConstraint`: Represents the subject of an audit event as a constraint.
- `flipt.ActionUpdate`: Represents the action of an audit event as an update action.

## Dependencies
- `github.com/stretchr/testify/assert`: Provides assertion functions for testing.
- `github.com/stretchr/testify/require`: Provides assertion functions that terminate the test if they fail.
- `go.flipt.io/flipt/internal/server/audit`: Provides the `audit.Event` type.
- `go.flipt.io/flipt/rpc/flipt`: Provides constants for audit event subjects and actions.
- `go.uber.org/zap`: Provides a structured logger.

## Error Handling
The test function uses the `require.NoError` function to assert that no errors are returned by the `SendAudits` and `Close` methods of the `webhook.Sink` type. This ensures that the sink handles errors gracefully.
