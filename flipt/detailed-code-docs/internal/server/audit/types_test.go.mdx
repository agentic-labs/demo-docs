---
title: "types_test.go"
---

## High-level description
The `internal/server/audit/types_test.go` file contains unit tests for the `NewFlag`, `NewVariant`, `NewConstraint`, `NewNamespace`, `NewDistribution`, `NewSegment`, and `NewRule` functions in the `internal/server/audit` package. These functions appear to be converting types from the `flipt` package to a different internal representation used for audit logging.

## References
This code references the following symbols from other parts of the codebase:

* `flipt.Flag`: Represents a feature flag.
* `flipt.Variant`: Represents a variant of a feature flag.
* `flipt.Constraint`: Represents a constraint on a segment.
* `flipt.Namespace`: Represents a namespace for organizing flags and segments.
* `flipt.Distribution`: Represents the distribution of variants for a rule.
* `flipt.Segment`: Represents a segment of users.
* `flipt.Rule`: Represents a rule for evaluating feature flags.

## Symbols

### `TestFlag`
#### Description
Tests the `NewFlag` function. It creates a `flipt.Flag` object and passes it to the `NewFlag` function. It then asserts that the fields of the returned object match the fields of the original `flipt.Flag` object.

#### Inputs
This is a test function, it takes `t *testing.T` as input.

#### Outputs
This is a test function, it does not return any output.

#### Internal Logic
1. **Arrange:** Creates a `flipt.Flag` object with sample data.
2. **Act:** Calls the `NewFlag` function with the created `flipt.Flag` object.
3. **Assert:** Asserts that the fields of the returned object match the fields of the original `flipt.Flag` object using `assert.Equal`.

### `TestVariant`
#### Description
Tests the `NewVariant` function. It creates a `flipt.Variant` object and passes it to the `NewVariant` function. It then asserts that the fields of the returned object match the fields of the original `flipt.Variant` object.

#### Inputs
This is a test function, it takes `t *testing.T` as input.

#### Outputs
This is a test function, it does not return any output.

#### Internal Logic
1. **Arrange:** Creates a `flipt.Variant` object with sample data.
2. **Act:** Calls the `NewVariant` function with the created `flipt.Variant` object.
3. **Assert:** Asserts that the fields of the returned object match the fields of the original `flipt.Variant` object using `assert.Equal`.

### `testConstraintHelper`
#### Description
A helper function used by other tests to assert the equality of fields between a `flipt.Constraint` object and the object returned by the `NewConstraint` function.

#### Inputs
* `t *testing.T`: The testing object.
* `c *flipt.Constraint`: The original `flipt.Constraint` object.

#### Outputs
This is a test helper function, it does not return any output.

#### Internal Logic
1. Calls the `NewConstraint` function with the provided `flipt.Constraint` object.
2. Asserts that the fields of the returned object match the fields of the original `flipt.Constraint` object using `assert.Equal`.

### `TestConstraint`
#### Description
Tests the `NewConstraint` function using the `testConstraintHelper` function.

#### Inputs
This is a test function, it takes `t *testing.T` as input.

#### Outputs
This is a test function, it does not return any output.

#### Internal Logic
1. **Arrange:** Creates a `flipt.Constraint` object with sample data.
2. **Act:** Calls the `testConstraintHelper` function with the created `flipt.Constraint` object.
3. **Assert:** The `testConstraintHelper` function handles the assertions.

### `TestNamespace`
#### Description
Tests the `NewNamespace` function. It creates a `flipt.Namespace` object and passes it to the `NewNamespace` function. It then asserts that the fields of the returned object match the fields of the original `flipt.Namespace` object.

#### Inputs
This is a test function, it takes `t *testing.T` as input.

#### Outputs
This is a test function, it does not return any output.

#### Internal Logic
1. **Arrange:** Creates a `flipt.Namespace` object with sample data.
2. **Act:** Calls the `NewNamespace` function with the created `flipt.Namespace` object.
3. **Assert:** Asserts that the fields of the returned object match the fields of the original `flipt.Namespace` object using `assert.Equal`.

### `testDistributionHelper`
#### Description
A helper function used by other tests to assert the equality of fields between a `flipt.Distribution` object and the object returned by the `NewDistribution` function.

#### Inputs
* `t *testing.T`: The testing object.
* `d *flipt.Distribution`: The original `flipt.Distribution` object.

#### Outputs
This is a test helper function, it does not return any output.

#### Internal Logic
1. Calls the `NewDistribution` function with the provided `flipt.Distribution` object.
2. Asserts that the fields of the returned object match the fields of the original `flipt.Distribution` object using `assert.Equal`.

### `TestDistribution`
#### Description
Tests the `NewDistribution` function using the `testDistributionHelper` function.

#### Inputs
This is a test function, it takes `t *testing.T` as input.

#### Outputs
This is a test function, it does not return any output.

#### Internal Logic
1. **Arrange:** Creates a `flipt.Distribution` object with sample data.
2. **Act:** Calls the `testDistributionHelper` function with the created `flipt.Distribution` object.
3. **Assert:** The `testDistributionHelper` function handles the assertions.

### `TestSegment`
#### Description
Tests the `NewSegment` function. It creates a `flipt.Segment` object with a nested `flipt.Constraint` object and passes it to the `NewSegment` function. It then asserts that the fields of the returned object match the fields of the original `flipt.Segment` object, including the nested `flipt.Constraint` object.

#### Inputs
This is a test function, it takes `t *testing.T` as input.

#### Outputs
This is a test function, it does not return any output.

#### Internal Logic
1. **Arrange:** Creates a `flipt.Segment` object with sample data, including a nested `flipt.Constraint` object.
2. **Act:** Calls the `NewSegment` function with the created `flipt.Segment` object.
3. **Assert:** 
    * Asserts that the fields of the returned object match the fields of the original `flipt.Segment` object using `assert.Equal`.
    * Iterates through the `Constraints` field of the original `flipt.Segment` object and calls the `testConstraintHelper` function for each `flipt.Constraint` object.

### `TestRule`
#### Description
Tests the `NewRule` function. It creates a `flipt.Rule` object with a nested `flipt.Distribution` object and passes it to the `NewRule` function. It then asserts that the fields of the returned object match the fields of the original `flipt.Rule` object, including the nested `flipt.Distribution` object.

#### Inputs
This is a test function, it takes `t *testing.T` as input.

#### Outputs
This is a test function, it does not return any output.

#### Internal Logic
1. **Arrange:** Creates a `flipt.Rule` object with sample data, including a nested `flipt.Distribution` object.
2. **Act:** Calls the `NewRule` function with the created `flipt.Rule` object.
3. **Assert:** 
    * Asserts that the fields of the returned object match the fields of the original `flipt.Rule` object using `assert.Equal`.
    * Iterates through the `Distributions` field of the original `flipt.Rule` object and calls the `testDistributionHelper` function for each `flipt.Distribution` object.

## Dependencies
* `testing`: Provides testing framework functionalities.
* `github.com/stretchr/testify/assert`: Provides assertion functions for testing.
* `go.flipt.io/flipt/rpc/flipt`: Provides the Flipt RPC definitions.

