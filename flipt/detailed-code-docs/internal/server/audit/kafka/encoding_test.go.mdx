---
title: "encoding_test.go"
---

## High-level description
This file contains unit tests for encoding audit events into different formats (Protobuf and Avro) for Kafka publishing in the Flipt server. It ensures that different event types and payloads can be successfully encoded without errors.

## Code Structure
The code defines a single test function `TestEncoding` that iterates over different encoding functions and event payloads, encoding the events and asserting the results.

## Symbols
### `TestEncoding`
#### Description
This function is a table-driven test that verifies the encoding of audit events into different formats. It iterates through a list of encoders (Protobuf and Avro) and a dataset of events with different payloads. For each combination, it creates an audit event, encodes it using the specified encoder, and asserts that the encoding was successful and produced non-empty output.

#### Inputs
This function takes no explicit inputs as it is a test function.

#### Outputs
This function has no explicit outputs as it is a test function.

#### Internal Logic
1. **Iterate through encoders:** The function iterates through a list of encoding functions, each representing a different serialization format (Protobuf and Avro).
2. **Iterate through event dataset:** For each encoder, the function iterates through a dataset of events, each containing a different payload type (Flag, Rollout, Auth, and nil).
3. **Create audit event:** For each encoder and payload combination, the function creates a new `audit.Event` with a predefined request, actor, and the current payload.
4. **Encode event:** The function encodes the created event using the current encoder.
5. **Assert encoding results:** The function asserts that the encoding process was successful (no errors) and that the encoded output is not empty.

## Dependencies
* **github.com/stretchr/testify/require:** Used for assertions in tests.
* **go.flipt.io/flipt/internal/server/audit:** Provides the audit event structures and functions.
* **go.flipt.io/flipt/rpc/flipt:** Provides Flipt RPC definitions.

## Error Handling
The code uses the `require.NoError` function from the `github.com/stretchr/testify/require` package to handle errors during the encoding process. If an error occurs, the test will fail.

## Logging
The code does not implement any specific logging mechanisms.
