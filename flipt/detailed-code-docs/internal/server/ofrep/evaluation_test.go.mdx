---
title: "evaluation_test.go"
---

## High-level description
The `evaluation_test.go` file contains unit tests for the `EvaluateFlag` and `EvaluateBulk` methods of the `ofrep.Server` struct. These methods are responsible for evaluating feature flags using the OpenFeature protocol.

## Code Structure
The file defines a series of test functions, each testing a specific aspect of the `EvaluateFlag` and `EvaluateBulk` methods. Each test function sets up a mock `Bridge` object, which is used to simulate the interaction with the underlying feature flag evaluation engine. The test functions then call the `EvaluateFlag` or `EvaluateBulk` method with a specific request and assert that the response matches the expected result.

## References
- `ofrep.Server`: The struct that implements the OpenFeature protocol.
- `ofrep.Bridge`: An interface that defines the methods for interacting with the underlying feature flag evaluation engine.
- `ofrep.EvaluationBridgeInput`: A struct that contains the input parameters for evaluating a feature flag.
- `ofrep.EvaluationBridgeOutput`: A struct that contains the output of evaluating a feature flag.
- `ofrep.EvaluateFlagRequest`: A struct that represents a request to evaluate a single feature flag.
- `ofrep.EvaluateBulkRequest`: A struct that represents a request to evaluate multiple feature flags.
- `ofrep.EvaluatedFlag`: A struct that represents the result of evaluating a feature flag.
- `ofrep.BulkEvaluationResponse`: A struct that represents the result of evaluating multiple feature flags.

## Symbols

### `TestEvaluateFlag_Success`
#### Description
This test function tests the successful evaluation of a single feature flag using the `EvaluateFlag` method.

#### Internal Logic
The test function defines two sub-tests:
- The first sub-test verifies that the `EvaluateFlag` method uses the default namespace when no namespace is provided in the request context.
- The second sub-test verifies that the `EvaluateFlag` method uses the namespace provided in the request context when one is present.

Both sub-tests set up a mock `Bridge` object and configure it to return a specific `EvaluationBridgeOutput` for a given `EvaluationBridgeInput`. The sub-tests then call the `EvaluateFlag` method with a specific request and assert that the response matches the expected `EvaluatedFlag`.

### `TestEvaluateFlag_Failure`
#### Description
This test function tests the error handling of the `EvaluateFlag` method.

#### Internal Logic
The test function defines a series of sub-tests, each testing a specific error condition. Each sub-test sets up a mock `Bridge` object and configures it to return a specific error for a given `EvaluationBridgeInput`. The sub-tests then call the `EvaluateFlag` method with a specific request and assert that the returned error matches the expected error.

### `TestEvaluateBulkSuccess`
#### Description
This test function tests the successful evaluation of multiple feature flags using the `EvaluateBulk` method.

#### Internal Logic
The test function defines a sub-test that verifies that the `EvaluateBulk` method uses the default namespace when no namespace is provided in the request context. The sub-test sets up a mock `Bridge` object and configures it to return a specific `EvaluationBridgeOutput` for a given `EvaluationBridgeInput`. The sub-test then calls the `EvaluateBulk` method with a specific request and asserts that the response matches the expected `BulkEvaluationResponse`.
