---
title: "rollout.go"
---

## High-level description
The code in `rollout.go` defines the server-side implementation of the Flipt API for managing rollout rules. It provides methods for retrieving, listing, creating, updating, deleting, and ordering rollout rules.

## Code Structure
The `rollout.go` file defines a set of methods on the `Server` struct, each corresponding to an API endpoint for managing rollout rules. These methods interact with the `store` field of the `Server` struct, which represents an abstraction layer for accessing the underlying storage mechanism.

## References
- `storage.Store`: An interface defining the storage operations for rollout rules.
- `flipt.GetRolloutRequest`, `flipt.Rollout`, etc.: Protobuf message types defining the request and response formats for the Flipt API.

## Symbols

### `(s *Server) GetRollout(ctx context.Context, r *flipt.GetRolloutRequest) (*flipt.Rollout, error)`
#### Description
Retrieves a single rollout rule from storage based on the provided request.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| ctx | context.Context | The context of the request. |
| r | *flipt.GetRolloutRequest | The request message containing the rollout rule ID and namespace. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| *flipt.Rollout |  | The retrieved rollout rule. |
| error | error | An error if one occurred during the retrieval process. |

#### Internal Logic
1. Logs a debug message indicating the start of the operation.
2. Calls the `GetRollout` method of the underlying storage to retrieve the rollout rule.
3. Logs a debug message with the retrieved rollout rule.
4. Returns the rollout rule and any error encountered.

### `(s *Server) ListRollouts(ctx context.Context, r *flipt.ListRolloutRequest) (*flipt.RolloutList, error)`
#### Description
Retrieves a list of rollout rules based on the provided request, supporting pagination.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| ctx | context.Context | The context of the request. |
| r | *flipt.ListRolloutRequest | The request message containing the flag key, namespace, pagination options, etc. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| *flipt.RolloutList |  | A list of rollout rules matching the request criteria. |
| error | error | An error if one occurred during the retrieval process. |

#### Internal Logic
1. Logs a debug message indicating the start of the operation.
2. Calls the `ListRollouts` method of the underlying storage to retrieve the rollout rules.
3. Constructs a `flipt.RolloutList` response message containing the retrieved rules.
4. Retrieves the total count of rollout rules for the given flag key.
5. Sets the pagination information in the response message.
6. Logs a debug message with the response.
7. Returns the response message and any error encountered.

### `(s *Server) CreateRollout(ctx context.Context, r *flipt.CreateRolloutRequest) (*flipt.Rollout, error)`
#### Description
Creates a new rollout rule based on the provided request.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| ctx | context.Context | The context of the request. |
| r | *flipt.CreateRolloutRequest | The request message containing the rollout rule data. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| *flipt.Rollout |  | The created rollout rule. |
| error | error | An error if one occurred during the creation process. |

#### Internal Logic
1. Logs a debug message indicating the start of the operation.
2. Calls the `CreateRollout` method of the underlying storage to create the rollout rule.
3. Logs a debug message with the created rollout rule.
4. Returns the created rollout rule and any error encountered.

### `(s *Server) UpdateRollout(ctx context.Context, r *flipt.UpdateRolloutRequest) (*flipt.Rollout, error)`
#### Description
Updates an existing rollout rule based on the provided request.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| ctx | context.Context | The context of the request. |
| r | *flipt.UpdateRolloutRequest | The request message containing the updated rollout rule data. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| *flipt.Rollout |  | The updated rollout rule. |
| error | error | An error if one occurred during the update process. |

#### Internal Logic
1. Logs a debug message indicating the start of the operation.
2. Calls the `UpdateRollout` method of the underlying storage to update the rollout rule.
3. Logs a debug message with the updated rollout rule.
4. Returns the updated rollout rule and any error encountered.

### `(s *Server) DeleteRollout(ctx context.Context, r *flipt.DeleteRolloutRequest) (*empty.Empty, error)`
#### Description
Deletes a rollout rule based on the provided request.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| ctx | context.Context | The context of the request. |
| r | *flipt.DeleteRolloutRequest | The request message containing the rollout rule ID. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| *empty.Empty |  | An empty response message. |
| error | error | An error if one occurred during the deletion process. |

#### Internal Logic
1. Logs a debug message indicating the start of the operation.
2. Calls the `DeleteRollout` method of the underlying storage to delete the rollout rule.
3. Logs a debug message with any error encountered.
4. Returns an empty response message and any error encountered.

### `(s *Server) OrderRollouts(ctx context.Context, r *flipt.OrderRolloutsRequest) (*empty.Empty, error)`
#### Description
Updates the order of rollout rules for a given flag key.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| ctx | context.Context | The context of the request. |
| r | *flipt.OrderRolloutsRequest | The request message containing the flag key and the ordered list of rollout rule IDs. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| *empty.Empty |  | An empty response message. |
| error | error | An error if one occurred during the ordering process. |

#### Internal Logic
1. Logs a debug message indicating the start of the operation.
2. Calls the `OrderRollouts` method of the underlying storage to update the rollout rule order.
3. Logs a debug message with any error encountered.
4. Returns an empty response message and any error encountered.

## Dependencies
- `context`
- `go.flipt.io/flipt/internal/storage`
- `go.flipt.io/flipt/rpc/flipt`
- `go.uber.org/zap`
- `google.golang.org/protobuf/types/known/emptypb`

## Logging
The code uses the `zap` logging library to log debug messages for each operation, including the request and response details.
