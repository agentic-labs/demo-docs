---
title: "Overview"
---

## High-level description
This directory contains an in-memory implementation of the `storage.AuthenticationStore` interface. It is designed to store authentication data in memory, making it suitable for testing and development environments. The implementation is part of the `memory` package and provides a flexible and configurable in-memory storage solution for authentication-related operations.

## What does it do?
The code in this directory implements an in-memory storage system for authentication data. It allows for the creation, retrieval, listing, deletion, and expiration of authentication entries. The store uses two main data structures: a map indexed by authentication ID and another map indexed by client token. This dual-indexing approach enables efficient lookups based on both ID and token.

The implementation supports various operations such as:
1. Creating new authentication entries
2. Retrieving authentication entries by client token or ID
3. Listing authentication entries with pagination and filtering
4. Deleting authentication entries based on specific criteria
5. Expiring authentication entries by setting an expiration time

The store is designed to be thread-safe, using a mutex to protect concurrent access to the in-memory data structures. It also provides configuration options for customizing the behavior of timestamp generation, ID generation, and token generation.

## Key Files

### store.go
This file contains the main implementation of the in-memory authentication store. It defines the `Store` struct, which holds the in-memory data structures and implements the `storage.AuthenticationStore` interface. The file includes methods for all the supported operations mentioned above, as well as configuration options for customizing the store's behavior.

Key components in this file include:
- `Store` struct: The main data structure holding the in-memory authentication data.
- `Option` type: A function type for configuring the store.
- `NewStore` function: Creates and configures a new `Store` instance.
- Various methods implementing the `storage.AuthenticationStore` interface.

### store_test.go
This file contains the test suite for the in-memory authentication store. It uses a test harness from the `authtesting` package to run a series of standard authentication store tests against the implementation.

The main test function, `TestAuthenticationStoreHarness`, creates a new instance of the in-memory store and passes it to the test harness, which then executes a predefined set of tests to ensure the correctness of the implementation.

## Dependencies
The implementation relies on the following main dependencies:

1. `go.flipt.io/flipt/internal/storage/authn`: Provides the `storage.AuthenticationStore` interface that this implementation adheres to.
2. `go.flipt.io/flipt/rpc/flipt/auth`: Contains the `rpcauth.Authentication` type used to represent authentication entries.
3. `google.golang.org/protobuf/types/known/timestamppb`: Used for handling timestamps in the authentication entries.

## Configuration
The in-memory store can be configured using the following options:

1. `WithNowFunc`: Overrides the function used for generating timestamps.
2. `WithTokenGeneratorFunc`: Overrides the function used for generating authentication tokens.
3. `WithIDGeneratorFunc`: Overrides the function used for generating authentication IDs.

These options can be passed to the `NewStore` function when creating a new store instance, allowing for customization of the store's behavior in different scenarios, such as testing or specific application requirements.

In summary, this directory provides a flexible, in-memory implementation of an authentication store, suitable for testing and development environments. It offers a complete set of operations for managing authentication data and can be easily configured to suit different use cases.