---
title: "Overview"
---

## High-level description
The `internal/storage/sql/common` directory contains the core SQL implementation for Flipt's storage layer. It provides a set of functions and methods to interact with the database, handling operations related to feature flags, segments, rules, rollouts, and other essential components of the Flipt system.

## What does it do?
This directory implements the storage layer for Flipt using SQL databases. It provides functionality to:

1. Manage feature flags: Create, retrieve, update, delete, and list flags and their variants.
2. Handle segments: Create, retrieve, update, delete, and list segments and their associated constraints.
3. Manage rules: Create, retrieve, update, delete, and order rules for feature flags.
4. Handle rollouts: Create, retrieve, update, delete, and order rollouts for gradual feature releases.
5. Manage distributions: Create, update, and delete distributions associated with rules.
6. Handle namespaces: Create, retrieve, update, and delete namespaces, which are used to organize and isolate resources.
7. Provide evaluation-related data: Retrieve evaluation rules, distributions, and rollouts for feature flag evaluation.

The code in this directory abstracts the database operations, providing a consistent interface for the rest of the Flipt system to interact with the stored data.

## Entry points
The main entry point for this directory is the `Store` struct defined in `storage.go`. This struct implements the `storage.Store` interface and provides methods for all the storage operations. The `NewStore` function in `storage.go` is used to create a new instance of the `Store` struct.

Other files in the directory implement specific functionality:

- `evaluation.go`: Handles retrieval of evaluation-related data.
- `flag.go`: Manages feature flags and variants.
- `namespace.go`: Handles namespace operations.
- `rollout.go`: Manages rollouts for gradual feature releases.
- `rule.go`: Handles rules associated with feature flags.
- `segment.go`: Manages segments and their constraints.

These files work together to provide a complete storage solution for Flipt, with data flowing between different components as needed for various operations.

## Key Files
1. `storage.go`: Defines the `Store` struct and provides the `NewStore` function to create a new storage instance.
2. `evaluation.go`: Contains functions for retrieving evaluation rules, distributions, and rollouts.
3. `flag.go`: Implements CRUD operations for feature flags and variants.
4. `namespace.go`: Handles operations related to namespaces.
5. `rollout.go`: Manages rollout-related operations for gradual feature releases.
6. `rule.go`: Implements CRUD and ordering operations for rules associated with feature flags.
7. `segment.go`: Handles CRUD operations for segments and their constraints.
8. `util.go`: Provides utility functions for common tasks like decoding page tokens and sanitizing segment keys.

## Dependencies
The code in this directory relies on several external libraries and internal packages:

1. `database/sql`: Standard Go package for database operations.
2. `github.com/Masterminds/squirrel`: Used for building SQL queries.
3. `github.com/gofrs/uuid`: Used for generating UUIDs.
4. `go.uber.org/zap`: Used for logging.
5. `go.flipt.io/flipt/errors`: Custom error types for Flipt.
6. `go.flipt.io/flipt/internal/storage`: Defines the storage interface.
7. `go.flipt.io/flipt/internal/storage/sql`: SQL-specific storage utilities.
8. `go.flipt.io/flipt/rpc/flipt`: Contains protocol buffer definitions for Flipt's RPC API.

## Configuration
The `Store` struct in `storage.go` is configured with:

1. A `*sql.DB` instance for database connection.
2. A `sq.StatementBuilderType` for building SQL statements.
3. A `*zap.Logger` for logging.

These are provided when creating a new `Store` instance using the `NewStore` function. The specific database connection and configuration are handled outside this package, allowing for flexibility in the choice of SQL database.

The code uses environment variables and configuration files indirectly through the provided database connection and logger. Specific configuration fields are not directly referenced in this package.

In summary, the `internal/storage/sql/common` directory provides a comprehensive SQL-based storage implementation for Flipt, handling all necessary database operations for managing feature flags, segments, rules, rollouts, and other core components of the system.