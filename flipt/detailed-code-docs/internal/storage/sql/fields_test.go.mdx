---
title: "fields_test.go"
---

## High-level description
The code defines unit tests for custom SQL data types `Timestamp`, `NullableTimestamp`, and `JSONField` that implement the `sql.Scanner` and `driver.Valuer` interfaces for interacting with a SQL database. These types facilitate the storage and retrieval of specific data formats in the database.

## Symbols

### `TestTimestamp_Scan`
#### Description
Tests the `Scan` method of the `Timestamp` type. It verifies that the `Scan` method correctly parses a `time.Time` value and stores it in the `Timestamp` struct.

#### Inputs
This is a test function, so there are no explicit inputs.

#### Outputs
This is a test function, so there are no explicit outputs.

#### Internal Logic
1. **Arrange:** Creates a new `Timestamp` instance.
2. **Act:** Calls the `Scan` method with a sample `time.Time` value.
3. **Assert:** Uses `assert.NoError` to verify that the `Scan` operation completed without errors.

### `TestTimestamp_Value`
#### Description
Tests the `Value` method of the `Timestamp` type. It verifies that the `Value` method correctly converts the internal `timestamppb.Timestamp` to a `time.Time` value.

#### Inputs
This is a test function, so there are no explicit inputs.

#### Outputs
This is a test function, so there are no explicit outputs.

#### Internal Logic
1. **Arrange:** Creates a new `Timestamp` instance with a predefined `timestamppb.Timestamp`.
2. **Act:** Calls the `Value` method to retrieve the underlying time value.
3. **Assert:** 
    - Uses `assert.NoError` to verify that the `Value` operation completed without errors.
    - Asserts that the returned value is of type `time.Time` and its value matches the expected time.

### `TestNullableTimestamp_Scan`
#### Description
Tests the `Scan` method of the `NullableTimestamp` type. It verifies that the `Scan` method correctly handles both `nil` values and valid `time.Time` values.

#### Inputs
This is a test function, so there are no explicit inputs.

#### Outputs
This is a test function, so there are no explicit outputs.

#### Internal Logic
1. **Arrange:** Creates a new `NullableTimestamp` instance.
2. **Act:** 
    - Calls the `Scan` method with a `nil` value and verifies that there are no errors.
    - Calls the `Scan` method with a sample `time.Time` value and verifies that there are no errors.
3. **Assert:** Uses `assert.NoError` to verify that both `Scan` operations completed without errors.

### `TestNullableTimestamp_Value`
#### Description
Tests the `Value` method of the `NullableTimestamp` type. It verifies that the `Value` method correctly handles both `nil` and non-`nil` `timestamppb.Timestamp` values.

#### Inputs
This is a test function, so there are no explicit inputs.

#### Outputs
This is a test function, so there are no explicit outputs.

#### Internal Logic
1. **Arrange:** 
    - Creates a new `NullableTimestamp` instance with a `nil` `Timestamp` field and verifies that the `Value` method returns `nil` without errors.
    - Creates another `NullableTimestamp` instance with a predefined `timestamppb.Timestamp`.
2. **Act:** Calls the `Value` method to retrieve the underlying time value.
3. **Assert:** 
    - Uses `assert.NoError` to verify that the `Value` operation completed without errors.
    - Asserts that the returned value is of type `time.Time` and its value matches the expected time.

### `TestJSONField_Scan`
#### Description
Tests the `Scan` method of the `JSONField` type. It verifies that the `Scan` method correctly parses JSON data from both `string` and `[]byte` inputs.

#### Inputs
This is a test function, so there are no explicit inputs.

#### Outputs
This is a test function, so there are no explicit outputs.

#### Internal Logic
1. **Arrange:** Creates a new `JSONField` instance with a `map[string]string` type.
2. **Act:** 
    - Calls the `Scan` method with a JSON string and verifies that there are no errors.
    - Calls the `Scan` method with a JSON byte slice and verifies that there are no errors.
3. **Assert:** Uses `assert.NoError` to verify that both `Scan` operations completed without errors.

### `TestJSONField_Value`
#### Description
Tests the `Value` method of the `JSONField` type. It verifies that the `Value` method correctly serializes the internal data to a JSON byte slice.

#### Inputs
This is a test function, so there are no explicit inputs.

#### Outputs
This is a test function, so there are no explicit outputs.

#### Internal Logic
1. **Arrange:** Creates a new `JSONField` instance with a predefined `map[string]string` data.
2. **Act:** Calls the `Value` method to retrieve the JSON representation of the data.
3. **Assert:** 
    - Uses `assert.NoError` to verify that the `Value` operation completed without errors.
    - Asserts that the returned value is of type `[]byte` and its content matches the expected JSON string.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| github.com/stretchr/testify/assert | Provides assertion functions for testing. |
| google.golang.org/protobuf/types/known/timestamppb | Provides the `timestamppb.Timestamp` type for representing timestamps. |

```
```