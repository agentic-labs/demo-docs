---
title: "sql_test.go"
---

## High-level description
The `sql_test.go` file contains a single test function, `Test_Harness`, which serves as an integration test for the `oplock/sql` package. It verifies the functionality of the SQL-based distributed lock implementation by leveraging the `oplocktesting.Harness` function.

## References
- `oplocktesting.Harness`: This function, likely defined in the `oplocktesting` package, provides a framework for testing different implementations of the `oplock.Service` interface.
- `memory.New`: This function, defined within the same package, creates a new instance of the SQL-based `oplock.Service`.

## Symbols

### `Test_Harness`
#### Description
This function is a test function that verifies the functionality of the SQL-based distributed lock implementation.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| t | *testing.T | The testing object used for reporting test results and errors. |

#### Internal Logic
1. **Arrange:**
    - Creates a new logger using `zaptest.NewLogger(t)`.
    - Establishes a connection to a test database using `sqltesting.Open()`.
2. **Act:**
    - Invokes the `oplocktesting.Harness` function, passing in:
        - The testing object `t`.
        - A new instance of the SQL-based `oplock.Service` created using `memory.New`. The service is initialized with the logger, database driver, and a SQL statement builder.
3. **Assert:**
    - The `oplocktesting.Harness` function is expected to execute a series of predefined tests against the provided `oplock.Service` implementation. The test function relies on the harness to perform assertions and report any failures.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| go.flipt.io/flipt/internal/storage/oplock/testing | Provides the testing harness for `oplock.Service` implementations. |
| go.flipt.io/flipt/internal/storage/sql | Offers utilities for interacting with SQL databases. |
| go.flipt.io/flipt/internal/storage/sql/testing | Provides testing utilities for SQL-related operations. |
| go.uber.org/zap/zaptest | Offers a testing logger implementation. |
