---
title: "audit.go"
---

## High-level description
This code defines the configuration structure and validation logic for Flipt's audit functionality. It includes configurations for various audit sinks (log, webhook, cloud, and Kafka), buffering, and event filtering. The code also provides methods for setting defaults and validating the configuration.

## Code Structure
The main structure is `AuditConfig`, which contains nested configurations for sinks, buffer, and events. It implements the `defaulter` and `validator` interfaces. The code also defines several sink-specific configurations and helper methods for validation and checking if the audit is enabled.

## Symbols

### `AuditConfig`
#### Description
Represents the main configuration structure for Flipt's audit functionality.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Sinks | SinksConfig | Configuration for various audit sinks |
| Buffer | BufferConfig | Configuration for audit event buffering |
| Events | []string | List of audit events to capture |

#### Internal Logic
- Implements `Enabled()` method to check if any sink is enabled
- Implements `IsZero()` method to check if the configuration is empty
- Implements `setDefaults()` method to set default values using Viper
- Implements `validate()` method to validate the configuration

### `SinksConfig`
#### Description
Contains configurations for different audit sinks (log, webhook, cloud, and Kafka).

### `WebhookSinkConfig`
#### Description
Configuration for the webhook audit sink.

#### Internal Logic
Implements `validate()` method to ensure either URL or templates are provided, but not both.

### `KafkaSinkConfig`
#### Description
Configuration for the Kafka audit sink.

#### Internal Logic
Implements `validate()` method to ensure required fields (topic and bootstrap servers) are provided.

### `BufferConfig`
#### Description
Configuration for audit event buffering.

## Error Handling
The code implements validation methods that return errors for invalid configurations. For example:
- Invalid buffer capacity or flush period
- Missing URL or templates for webhook sink
- Missing topic or bootstrap servers for Kafka sink

## Configuration
The code defines several configuration options with default values set in the `setDefaults` method:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| audit.sinks.log.enabled | bool | false | Enable log sink |
| audit.sinks.webhook.enabled | bool | false | Enable webhook sink |
| audit.sinks.cloud.enabled | bool | false | Enable cloud sink |
| audit.sinks.kafka.enabled | bool | false | Enable Kafka sink |
| audit.buffer.capacity | int | 2 | Buffer capacity |
| audit.buffer.flush_period | duration | 2m | Buffer flush period |
| audit.events | []string | ["*:*"] | Audit events to capture |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| github.com/spf13/viper | Configuration management |
| errors | Error handling |
| time | Time-related operations |

This code provides a flexible and extensible configuration system for Flipt's audit functionality, allowing users to customize various aspects of the audit process, including sink selection, buffering, and event filtering.