---
title: "main.go"
---

## High-level description
This code implements a simple REST API endpoint ("/api/greeting") that demonstrates the integration of Flipt, OpenFeature, and OpenTelemetry for feature flagging and distributed tracing. It uses the Flipt OpenFeature provider to fetch feature flag values and the OpenTelemetry hook to instrument the code for tracing, sending data to a Jaeger instance.

## Code Structure
The code initializes a Jaeger tracer, sets up a Flipt OpenFeature provider, and defines a single route ("/api/greeting") in a Gorilla Mux router. The route handler retrieves a feature flag value from Flipt, logs it, and returns a JSON response.

## References
This code references the following external libraries:
- `github.com/open-feature/go-sdk/openfeature`: Used for interacting with OpenFeature API.
- `go.flipt.io/flipt-openfeature-provider/pkg/provider/flipt`: Used for the Flipt OpenFeature provider.
- `go.opentelemetry.io/otel`: Used for OpenTelemetry instrumentation.
- `go.opentelemetry.io/otel/exporters/otlp/otlptrace`: Used for exporting traces to Jaeger.

## Symbols

### `main`
#### Description
This function initializes the application, sets up tracing, the Flipt OpenFeature provider, and the API router. It then starts the HTTP server.

#### Inputs
This function takes no inputs.

#### Outputs
This function has no explicit outputs, but it starts an HTTP server that listens on port 8000.

#### Internal Logic
1. **Initialization:**
    - Parses command-line flags.
    - Sets up a logger.
    - Initializes a Jaeger tracer provider.
    - Sets the global tracer provider to the Jaeger provider.
    - Sets the global text map propagator to use TraceContext.
2. **OpenFeature Setup:**
    - Adds the OpenTelemetry hook to OpenFeature.
    - Creates a new Flipt OpenFeature provider.
    - Sets the global OpenFeature provider to the Flipt provider.
    - Creates a new OpenFeature client.
3. **API Setup:**
    - Creates a new Gorilla Mux router.
    - Defines a route handler for `/api/greeting`.
4. **Server Start:**
    - Prints informational messages about the running services.
    - Starts the HTTP server, listening on port 8000.

### `tracerProvider`
#### Description
This function creates and configures a new OpenTelemetry tracer provider that exports traces to a Jaeger instance.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| url | string | The URL of the Jaeger instance. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| tp | `*tracesdk.TracerProvider` | The configured OpenTelemetry tracer provider. |
| err | `error` | An error object if an error occurred during initialization. |

#### Internal Logic
1. **Exporter Creation:** Creates a new Jaeger exporter using the provided URL.
2. **Tracer Provider Creation:** Creates a new tracer provider with the Jaeger exporter and a resource that includes information about the application.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| `github.com/gofrs/uuid` | Used for generating UUIDs. |
| `github.com/gorilla/mux` | Used for routing HTTP requests. |
| `github.com/open-feature/go-sdk/openfeature` | Used for interacting with the OpenFeature API. |
| `github.com/open-feature/go-sdk-contrib/hooks/open-telemetry/pkg` | Used for the OpenTelemetry hook for OpenFeature. |
| `go.flipt.io/flipt-openfeature-provider/pkg/provider/flipt` | Used for the Flipt OpenFeature provider. |
| `go.opentelemetry.io/otel` | Used for OpenTelemetry instrumentation. |
| `go.opentelemetry.io/otel/attribute` | Used for defining OpenTelemetry attributes. |
| `go.opentelemetry.io/otel/exporters/otlp/otlptrace` | Used for exporting traces to Jaeger. |
| `go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc` | Used for exporting traces to Jaeger over gRPC. |
| `go.opentelemetry.io/otel/propagation` | Used for context propagation in OpenTelemetry. |
| `go.opentelemetry.io/otel/sdk/resource` | Used for defining OpenTelemetry resources. |
| `go.opentelemetry.io/otel/sdk/trace` | Used for OpenTelemetry tracing. |
| `go.opentelemetry.io/otel/semconv/v1.24.0` | Used for OpenTelemetry semantic conventions. |

### Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `server` | string | `flipt:9000` | Address of the Flipt backend server. |
| `jaeger` | string | `jaeger:4317` | Address of the Jaeger server. |

## Logging
The code uses the standard `log` package for logging informational messages to the console.
