---
title: "main.go"
---

## High-level description
This code implements a simple HTTP server that demonstrates basic feature flag evaluation using the Flipt gRPC client. It connects to a Flipt server, retrieves the status of a specified flag, and renders a web page displaying the flag's state.

## Code Structure
The code defines a `main` function that handles server setup and request handling. It uses the `flipt` package to interact with the Flipt server and the `net/http` package to handle HTTP requests. The `data` struct is used to pass flag information to the HTML template.

## References
- `flipt.NewFliptClient`: Creates a new Flipt gRPC client.
- `flipt.GetFlagRequest`: Represents a request to retrieve a flag.
- `flipt.GetFlag`: Retrieves a feature flag from the Flipt server.

## Symbols
### `main`
#### Description
This function initializes the application, connects to the Flipt server, sets up an HTTP handler, and starts the server.

#### Inputs
- Command line flags:
    - `-server`: Address of the Flipt backend server (default: "flipt:9000").
    - `-flag`: Flag key to query (default: "example").

#### Outputs
- Starts an HTTP server listening on port 8000.
- Logs server start information and any errors encountered.

#### Internal Logic
1. Parses command line flags.
2. Establishes a gRPC connection to the Flipt server.
3. Creates a new Flipt gRPC client.
4. Parses the HTML template.
5. Defines an HTTP handler function that:
    - Retrieves the specified flag from the Flipt server.
    - Renders the HTML template with the flag's state.
6. Starts the HTTP server.

### `data`
#### Description
This struct defines the data structure used to pass flag information to the HTML template.

#### Inputs
N/A

#### Outputs
N/A

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| `flipt "go.flipt.io/flipt-grpc"` | Provides the Flipt gRPC client for interacting with the Flipt server. |
| `google.golang.org/grpc` | Implements the gRPC framework. |
| `net/http` | Provides HTTP server and client implementations. |
| `text/template` | Provides HTML templating functionality. |

## Configuration
- `fliptServer`: Address of the Flipt backend server.
- `flagKey`: Key of the flag to query.

## Error Handling
The code handles errors by logging them and returning appropriate HTTP error codes. For example, if the flag is not found, it returns a 404 Not Found error.

## Logging
The code uses the standard `log` package for logging. It logs server start information, flag retrieval information, and any errors encountered.
