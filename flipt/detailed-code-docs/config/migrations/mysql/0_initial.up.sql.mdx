---
title: "0_initial.up.sql"
---

## High-level description
This SQL script defines the initial database schema for a feature flag management system. It creates six tables: flags, segments, variants, constraints, rules, and distributions, which together form the structure for managing feature flags, user segments, and rollout distributions.

## Code Structure
The script creates six interconnected tables, each with its own purpose in the feature flag system. The tables are related through foreign key constraints, ensuring data integrity and relationships between different entities.

## Symbols

### Table: flags
#### Description
Stores information about feature flags.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| key | VARCHAR(255) | Unique identifier for the flag |
| name | VARCHAR(255) | Name of the flag |
| description | TEXT | Detailed description of the flag |
| enabled | BOOLEAN | Flag to indicate if the feature is enabled |
| created_at | TIMESTAMP | Timestamp of creation |
| updated_at | TIMESTAMP | Timestamp of last update |

### Table: segments
#### Description
Defines user segments for targeting specific groups.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| key | VARCHAR(255) | Unique identifier for the segment |
| name | VARCHAR(255) | Name of the segment |
| description | TEXT | Detailed description of the segment |
| match_type | INTEGER | Type of matching for the segment |
| created_at | TIMESTAMP | Timestamp of creation |
| updated_at | TIMESTAMP | Timestamp of last update |

### Table: variants
#### Description
Stores different variants of a feature flag.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| id | VARCHAR(255) | Unique identifier for the variant |
| flag_key | VARCHAR(255) | Foreign key referencing the flag |
| key | VARCHAR(255) | Variant key |
| name | VARCHAR(255) | Name of the variant |
| description | TEXT | Detailed description of the variant |
| created_at | TIMESTAMP | Timestamp of creation |
| updated_at | TIMESTAMP | Timestamp of last update |

### Table: constraints
#### Description
Defines constraints for segments.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| id | VARCHAR(255) | Unique identifier for the constraint |
| segment_key | VARCHAR(255) | Foreign key referencing the segment |
| type | INTEGER | Type of constraint |
| property | VARCHAR(255) | Property to be constrained |
| operator | VARCHAR(255) | Operator for the constraint |
| value | TEXT | Value for the constraint |
| created_at | TIMESTAMP | Timestamp of creation |
| updated_at | TIMESTAMP | Timestamp of last update |

### Table: rules
#### Description
Defines rules for applying feature flags to segments.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| id | VARCHAR(255) | Unique identifier for the rule |
| flag_key | VARCHAR(255) | Foreign key referencing the flag |
| segment_key | VARCHAR(255) | Foreign key referencing the segment |
| rank | INTEGER | Rank of the rule |
| created_at | TIMESTAMP | Timestamp of creation |
| updated_at | TIMESTAMP | Timestamp of last update |

### Table: distributions
#### Description
Defines the distribution of variants for rules.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| id | VARCHAR(255) | Unique identifier for the distribution |
| rule_id | VARCHAR(255) | Foreign key referencing the rule |
| variant_id | VARCHAR(255) | Foreign key referencing the variant |
| rollout | float | Rollout percentage for the variant |
| created_at | TIMESTAMP | Timestamp of creation |
| updated_at | TIMESTAMP | Timestamp of last update |

## Dependencies
This SQL script is designed for MySQL databases, as evident from the file name and syntax used.

## Configuration
The script uses default MySQL configurations for timestamps and auto-incrementing fields. It also sets up foreign key constraints to maintain data integrity across tables.

## Error Handling
The script uses `IF NOT EXISTS` clauses to prevent errors if the tables already exist. Foreign key constraints are set up to use `ON DELETE CASCADE`, which automatically deletes related records when a parent record is deleted.

## Performance Considerations
1. Indexes are automatically created for primary keys and foreign keys, which should provide good performance for most queries involving these fields.
2. The use of `VARCHAR(255)` for keys and names might be excessive for some use cases and could be optimized if shorter lengths are sufficient.
3. The `TIMESTAMP` fields with `DEFAULT CURRENT_TIMESTAMP` and `ON UPDATE CURRENT_TIMESTAMP` provide automatic tracking of creation and update times without additional application logic.

This schema provides a solid foundation for a feature flag management system, allowing for complex targeting and rollout strategies through the use of segments, rules, and distributions.