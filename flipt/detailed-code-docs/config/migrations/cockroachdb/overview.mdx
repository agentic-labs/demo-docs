---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for a CockroachDB database, primarily focused on managing feature flags, user segments, rollouts, and authentication. The migrations create and modify tables to support a complex feature flag management system with namespace support, rollout management, and authentication mechanisms.

## What does it do?
The migrations in this directory set up and evolve a database schema for a feature flag management system. Here's a breakdown of the main functionalities:

1. Feature Flag Management: Creates tables for flags, variants, and rules to define and control feature flags.
2. User Segmentation: Establishes tables for segments and constraints to target specific user groups.
3. Rollout Management: Introduces tables for rollouts, thresholds, and segment-based rollouts to gradually release features.
4. Authentication: Sets up a table to store authentication data for secure access to the system.
5. Namespace Support: Adds namespace functionality to organize and isolate different environments or projects.
6. Metadata and Configuration: Adds columns for storing metadata, default variants, and other configuration options.

The migrations progressively enhance the schema, adding new features and modifying existing structures to support evolving requirements of the feature flag system.

## Entry points
The main entry point for these migrations is the initial schema creation in `0_initial.up.sql`. Subsequent migrations build upon this foundation, with each numbered file representing a step in the evolution of the database schema.

Key files include:
1. `0_initial.up.sql`: Sets up the core tables for flags, segments, variants, constraints, rules, and distributions.
2. `3_create_namespaces.up.sql`: Introduces the concept of namespaces.
3. `4_namespaces_relationships.up.sql`: Establishes relationships between namespaces and other entities.
4. `7_rollouts.up.sql`: Adds support for feature rollouts.

The migrations should be applied in the order specified by their numerical prefixes to ensure proper schema evolution.

## Dependencies
The primary dependency for these migrations is CockroachDB, a distributed SQL database compatible with PostgreSQL. The scripts use CockroachDB-specific features and syntax, including:

| Dependency | Purpose |
|:-----------|:--------|
| CockroachDB | The target database system for storing and managing feature flag data |

## Configuration
The migrations use various configuration options within the SQL statements:

1. Default values: Many columns have default values specified, such as `DEFAULT 0` for integer columns or `DEFAULT CURRENT_TIMESTAMP` for timestamp columns.
2. Foreign key constraints: Used extensively to maintain referential integrity between related tables.
3. Unique constraints and indexes: Applied to ensure uniqueness of certain column combinations.
4. Data types: Specific data types like `JSONB` for storing JSON data and `VARCHAR(255)` for string identifiers are used consistently.

These configurations are embedded within the SQL statements and do not require external configuration files.

In summary, this directory contains a comprehensive set of database migrations for setting up and evolving a feature flag management system in CockroachDB. The migrations progressively build a complex schema that supports namespaces, rollouts, user segmentation, and various other features necessary for sophisticated feature flag management.