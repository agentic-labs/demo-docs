---
title: "RuleForm.tsx"
---

## High-level description
This code defines a React component called `RuleForm` that allows users to create new rules for feature flags. It provides a form interface for selecting segments, defining distribution types, and setting variant distributions for a flag.

## Code Structure
The main `RuleForm` component uses Formik for form handling and validation. It includes several sub-components and utility functions to manage different aspects of the rule creation process, such as segment selection, distribution type selection, and variant distribution settings.

## Symbols

### `RuleForm`
#### Description
The main component that renders the rule creation form.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| setOpen | function | Function to control the visibility of the form |
| onSuccess | function | Callback function called on successful rule creation |
| flag | IFlag | The flag object for which the rule is being created |
| rank | number | The rank of the new rule |
| segments | ISegment[] | Available segments for rule creation |

#### Internal Logic
1. Initializes form state and validation schema using Formik and Yup.
2. Manages state for distribution type, selected variant, and distributions.
3. Handles form submission by calling the `createRule` mutation.
4. Renders form fields for segment selection, distribution type, and variant distribution based on the selected type.

### `distTypes`
#### Description
An array of distribution type options for the rule.

### `ruleValidationSchema`
#### Description
Yup validation schema for the rule form.

### `computePercentages`
#### Description
Utility function to compute initial percentage distributions for variants.

### `validRollout`
#### Description
Function to validate if the total rollout percentage is less than or equal to 100%.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @headlessui/react | UI components (Dialog) |
| @heroicons/react | Icons |
| formik | Form handling |
| react | React hooks and components |
| react-redux | Redux state management |
| react-router-dom | Routing |
| yup | Form validation |

## Error Handling
The component uses custom hooks `useError` and `useSuccess` for error and success message handling.

## API/Interface Reference
| Endpoint | Method | Description |
|:---------|:-------|:------------|
| createRule | POST | Creates a new rule for the flag |

This component provides a comprehensive interface for creating new rules for feature flags, allowing users to define complex targeting and distribution strategies.