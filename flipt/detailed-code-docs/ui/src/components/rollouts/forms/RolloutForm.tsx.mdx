---
title: "RolloutForm.tsx"
---

## High-level description
This code defines a React component called `RolloutForm` that creates a form for adding a new rollout rule to a feature flag. It allows users to specify the type of rollout (segment or threshold), set various parameters, and submit the form to create a new rollout.

## Code Structure
The main `RolloutForm` component uses Formik for form management and validation. It contains several sub-components and hooks for handling form submission, error handling, and success messages. The component also uses various UI components from other parts of the application for rendering form inputs and buttons.

## Symbols

### `RolloutForm`
#### Description
The main component that renders the rollout creation form.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| setOpen | function | Function to control the visibility of the form |
| onSuccess | function | Callback function called on successful form submission |
| flagKey | string | The key of the flag associated with this rollout |
| segments | ISegment[] | Array of available segments |
| rank | number | The rank of the new rollout |

#### Internal Logic
1. Initializes form state and validation using Formik
2. Handles form submission by calling the appropriate API mutation based on the rollout type
3. Renders form fields dynamically based on the selected rollout type
4. Provides error handling and success messaging

### `handleSegmentSubmit`
#### Description
Handles the submission of a segment-based rollout.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| values | RolloutFormValues | Form values for the rollout |

#### Internal Logic
Calls the `createRollout` mutation with the appropriate payload for a segment-based rollout.

### `handleThresholdSubmit`
#### Description
Handles the submission of a threshold-based rollout.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| values | RolloutFormValues | Form values for the rollout |

#### Internal Logic
Calls the `createRollout` mutation with the appropriate payload for a threshold-based rollout.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @headlessui/react | UI components for the form |
| @heroicons/react | Icons used in the form |
| formik | Form management and validation |
| react-redux | Access to Redux store for namespace information |
| ~/app/flags/rolloutsApi | API for creating rollouts |
| ~/app/namespaces/namespacesSlice | Accessing current namespace information |
| Various UI components | Rendering form inputs and buttons |

## Error Handling
The component uses the `useError` and `useSuccess` hooks to handle and display error and success messages during form submission.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| /namespaces/${namespaceKey}/flags/${flagKey}/rollouts | POST | Rollout data | void | Creates a new rollout |

This component provides a user interface for creating new rollout rules for feature flags, allowing users to specify different types of rollouts and their associated parameters.