---
title: "rulesApi.ts"
---

## High-level description
This code defines a Redux Toolkit Query API for managing rules in a feature flag system. It provides endpoints for listing, creating, updating, deleting, and reordering rules, as well as updating distributions within rules.

## Code Structure
The code defines a `rulesApi` object using Redux Toolkit's `createApi` function. This API includes several endpoints for different operations on rules. It also exports a `ruleTag` function for caching purposes and hook functions for using the API in React components.

## Symbols

### `ruleTag`
#### Description
A function that generates a tag for caching purposes based on namespace and flag keys.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| arg | object | An object containing namespaceKey and flagKey |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| tag | TagDescription&lt;'Rule'&gt; | A tag object for caching |

### `rulesApi`
#### Description
The main API object created using Redux Toolkit's `createApi` function. It defines the base query, reducer path, and endpoints for rule-related operations.

#### Endpoints
1. `listRules`: Fetches a list of rules for a given namespace and flag.
2. `createRule`: Creates a new rule with associated distributions.
3. `deleteRule`: Deletes a specific rule.
4. `updateRule`: Updates an existing rule.
5. `orderRules`: Reorders the rules and includes optimistic updates.
6. `updateDistribution`: Updates a distribution within a rule.

#### Internal Logic
Each endpoint defines its query function, any transformations needed, and cache invalidation tags. The `createRule` endpoint uses a custom `queryFn` to create both the rule and its distributions in separate API calls.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @reduxjs/toolkit | Provides the createApi function and other utilities |
| ~/utils/redux-rtk | Imports the baseQuery function for API requests |
| ~/types/* | Imports various type definitions used in the API |

## Exported Hooks
The file exports several custom hooks generated by Redux Toolkit Query for use in React components:
- `useListRulesQuery`
- `useCreateRuleMutation`
- `useDeleteRuleMutation`
- `useUpdateRuleMutation`
- `useOrderRulesMutation`
- `useUpdateDistributionMutation`

These hooks can be used to interact with the API endpoints in React components, providing automatic fetching, caching, and updates.

## Error Handling
Error handling is primarily managed by Redux Toolkit Query. Errors from API calls are automatically available in the returned objects from the hooks.

## Side Effects
The API endpoints may cause side effects by modifying the server state for rules and distributions. The `orderRules` endpoint includes an optimistic update to immediately reflect changes in the UI before server confirmation.