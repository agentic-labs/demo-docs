---
title: "license.rb"
---

## High-level description
This code initializes a `License` object using the `LagoUtils::License` class and verifies the license unless the application is running in the test environment. It's responsible for setting up and managing the license functionality for the Lago application.

## Symbols

### `License`
#### Description
`License` is a global constant that represents an instance of `LagoUtils::License`. It's initialized with the license URL from the Rails application configuration.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Rails.application.config.license_url | String | The URL for license verification |

#### Internal Logic
1. Creates a new instance of `LagoUtils::License` with the provided license URL.
2. Calls the `verify` method on the `License` object unless the application is running in the test environment.

## Side Effects
- The `verify` method is called on the `License` object, which may make an HTTP request to verify the license if `ENV['LAGO_LICENSE']` is present.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| lago_utils | Provides the `LagoUtils::License` class |

## Error Handling
This code doesn't implement specific error handling. Any exceptions raised during license verification would propagate up the call stack.

## TODOs
There are no explicit TODOs in this code.

## References
The `License` object is used in other parts of the application, such as:
1. In `app/services/invoices/retry_service.rb`, it's used to check if the license is premium before delivering emails.
2. In `app/services/invoices/progressive_billing_service.rb`, it's also used to check for premium status before delivering emails.
3. In `app/services/invoices/create_pay_in_advance_charge_service.rb`, it's used similarly to check premium status for email delivery.

These references suggest that the `License` object is crucial for determining feature availability based on the license status.