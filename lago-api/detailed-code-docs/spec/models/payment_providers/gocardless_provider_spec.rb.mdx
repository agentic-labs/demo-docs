---
title: "gocardless_provider_spec.rb"
---

## High-level description
This file contains RSpec tests for the `PaymentProviders::GocardlessProvider` model. It tests various validations, including the format and uniqueness of certain fields, and the behavior of the `access_token` and `success_redirect_url` attributes.

## Symbols

### `RSpec.describe PaymentProviders::GocardlessProvider`
#### Description
This is the main describe block for the `PaymentProviders::GocardlessProvider` model tests. It sets up the context for all the tests related to this model.

#### Internal Logic
- Uses `build(:gocardless_provider, attributes)` to create test instances
- Tests various validations and behaviors of the model

### Validation Tests
#### Description
These tests check the validations implemented in the `GocardlessProvider` model.

#### Internal Logic
- Tests length validation of `success_redirect_url`
- Tests presence validation of `name`
- Tests uniqueness validation of `code` scoped to `organization_id`

### `describe 'validations'`
#### Description
This nested describe block focuses on more specific validation tests, particularly for the `success_redirect_url` format.

#### Internal Logic
- Tests various scenarios for `success_redirect_url` validation:
  - Valid URLs with http(s) scheme
  - URLs with custom schemes
  - Nil values
  - Empty strings
  - Invalid URL formats

### `describe 'access_token'`
#### Description
Tests the behavior of the `access_token` attribute.

#### Internal Logic
- Checks if the `access_token` can be assigned and retrieved correctly

### `describe '#success_redirect_url'`
#### Description
Tests the behavior of the `success_redirect_url` attribute.

#### Internal Logic
- Verifies that the `success_redirect_url` can be set and retrieved correctly

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment |
| FactoryBot | Used for creating test instances (`build` method) |
| Faker | Used for generating fake data (e.g., `Faker::Internet.url`) |

## Error Handling
The tests check for the presence or absence of specific errors in the `errors` object of the model instance, particularly for the `success_redirect_url` validation.

## Notes
- The tests use RSpec's expectation syntax (`expect`, `is_expected`)
- FactoryBot is used to create test instances of the `GocardlessProvider` model
- The `success_redirect_url` validation is thoroughly tested for various scenarios
- The `access_token` is tested for basic assignment and retrieval
- The code uses `frozen_string_literal: true` pragma