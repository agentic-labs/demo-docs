---
title: "adyen_provider_spec.rb"
---

## High-level description
This file contains RSpec tests for the `PaymentProviders::AdyenProvider` model. It tests various validations, attributes, and methods of the Adyen payment provider implementation, ensuring proper functionality and data integrity.

## Symbols

### RSpec.describe PaymentProviders::AdyenProvider
#### Description
This is the main test suite for the `PaymentProviders::AdyenProvider` model. It includes various test cases to validate the model's behavior and attributes.

#### Internal Logic
The test suite is organized into several sections:
1. Validation tests for `success_redirect_url` length and `name` presence
2. Validation of `code` uniqueness
3. Validation of `success_redirect_url` format
4. Tests for attribute accessor methods

### subject(:provider)
#### Description
This sets up the subject for the tests, creating an instance of `AdyenProvider` using a factory.

### Validation tests
#### Description
These tests check various validation rules for the `AdyenProvider` model.

#### Internal Logic
- Tests length validation of `success_redirect_url`
- Tests presence validation of `name`
- Tests uniqueness validation of `code` scoped to `organization_id`
- Tests format validation of `success_redirect_url` for various scenarios (valid URLs, custom schemes, nil, empty string, invalid URLs)

### Attribute accessor tests
#### Description
These tests verify that the attribute accessor methods for `api_key`, `merchant_account`, `live_prefix`, `hmac_key`, and `success_redirect_url` work correctly.

#### Internal Logic
For each attribute:
1. Set a value for the attribute
2. Verify that the getter method returns the correct value

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment |
| Faker | Generates fake data for testing |

## Error Handling
The tests check for the presence of errors in the `provider.errors` object when validations fail.

## Notes
- The tests use RSpec's expectation syntax (`expect` and `is_expected`)
- Factory Bot is used to create test instances (`build(:adyen_provider)`)
- The `context` blocks are used to group related test cases
- The `describe` blocks are used to organize tests for different methods or scenarios

This test file ensures that the `AdyenProvider` model behaves correctly and maintains data integrity through various validations and attribute accessors.