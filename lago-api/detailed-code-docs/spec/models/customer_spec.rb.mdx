---
title: "customer_spec.rb"
---

## High-level description
This file contains RSpec tests for the Customer model in a Rails application. It tests various aspects of the Customer model, including associations, validations, and custom methods related to customer attributes, timezones, and address handling.

## Code Structure
The test suite is organized into several describe blocks, each focusing on a specific aspect of the Customer model. It uses RSpec's shared examples, expectations, and context blocks to structure the tests.

## Symbols

### RSpec.describe Customer
#### Description
This is the main describe block for the Customer model tests. It sets up the subject and includes shared examples for paper_trail traceability.

#### Internal Logic
- Sets up a factory-created customer as the subject
- Includes shared examples for paper_trail traceability
- Tests associations and validations
- Tests custom methods related to customer attributes and behavior

### describe 'validations'
#### Description
This block tests various validations for the Customer model, including country, language code, and timezone.

#### Internal Logic
- Tests the validity of different country codes
- Tests the validity of different language codes
- Tests the validity of different timezones

### describe 'preferred_document_locale'
#### Description
Tests the preferred_document_locale method of the Customer model.

#### Internal Logic
- Tests when the customer has a document_locale
- Tests when the customer doesn't have a document_locale, falling back to the organization's locale

### describe '#editable?'
#### Description
Tests the editable? method of the Customer model.

#### Internal Logic
- Tests various scenarios where a customer should not be editable (has wallet, coupon, addon, invoice, or subscription)
- Tests when a customer should be editable

### describe '#provider_customer'
#### Description
Tests the provider_customer method of the Customer model.

#### Internal Logic
- Tests for different payment providers (stripe and gocardless)

### describe '#applicable_timezone'
#### Description
Tests the applicable_timezone method of the Customer model.

#### Internal Logic
- Tests when the customer has a timezone
- Tests when the customer doesn't have a timezone, falling back to the organization's timezone or UTC

### describe '#applicable_invoice_grace_period'
#### Description
Tests the applicable_invoice_grace_period method of the Customer model.

#### Internal Logic
- Tests when the customer has an invoice grace period
- Tests when the customer doesn't have an invoice grace period, falling back to the organization's grace period or 0

### describe 'timezones'
#### Description
Tests timezone-related helper methods of the Customer model.

#### Internal Logic
- Tests created_at_in_customer_timezone and created_at_in_organization_timezone methods

### describe 'slug'
#### Description
Tests the slug generation for the Customer model.

#### Internal Logic
- Tests slug generation with and without custom document number prefix

### describe '#same_billing_and_shipping_address?'
#### Description
Tests the same_billing_and_shipping_address? method of the Customer model.

#### Internal Logic
- Tests various scenarios with different billing and shipping address combinations

### describe '#empty_billing_and_shipping_address?'
#### Description
Tests the empty_billing_and_shipping_address? method of the Customer model.

#### Internal Logic
- Tests various scenarios with different billing and shipping address combinations

## Dependencies
The test file depends on the following:
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Provides the testing environment setup |
| FactoryBot | Used for creating test data |

Note: The related code snippet (rails_helper.rb) shows additional dependencies and configurations for the testing environment, including SimpleCov for code coverage, DatabaseCleaner, and various RSpec configurations.