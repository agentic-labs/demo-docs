---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for the `PaymentProviderCustomers` models, specifically for Adyen and Stripe customers. These tests ensure the correct functionality of customer-related operations for these payment providers within the application.

## What does it do?
The tests in this directory verify the behavior of customer models for different payment providers (Adyen and Stripe). They check:

1. For Adyen customers:
   - The correct assignment and retrieval of payment method IDs.

2. For Stripe customers:
   - The assignment and retrieval of payment method IDs.
   - The handling of provider payment methods, including their assignment and validation.
   - Various scenarios for payment method validation, including empty arrays, nil values, invalid values, and special cases like the 'link' payment method.

These tests ensure that the application correctly manages customer data and payment methods for different payment providers, which is crucial for maintaining accurate financial transactions and customer records.

## Key Files

1. `adyen_customer_spec.rb`:
   This file contains tests for the `PaymentProviderCustomers::AdyenCustomer` model. It focuses on verifying the correct functionality of the `payment_method_id` method.

   Key aspects:
   - Uses FactoryBot to create stubbed instances of AdyenCustomer.
   - Verifies that the `payment_method_id` method returns the correct assigned value.

2. `stripe_customer_spec.rb`:
   This file contains more extensive tests for the `PaymentProviderCustomers::StripeCustomer` model. It covers various aspects of the model's functionality.

   Key aspects:
   - Tests the assignment and retrieval of `payment_method_id`.
   - Verifies the functionality of `provider_payment_methods`.
   - Includes comprehensive validation tests for provider payment methods, covering various scenarios such as empty arrays, nil values, invalid values, and special cases.

## Dependencies
Both test files rely on the following dependencies:

1. `rails_helper`: Loads the Rails testing environment and configuration.
2. FactoryBot: Used for creating test objects (stubbed in these cases).
3. Faker (in stripe_customer_spec.rb): Used for generating random test data.
4. SecureRandom (in adyen_customer_spec.rb): Used to generate a random UUID for the payment method ID.

## Configuration
While there are no explicit configuration files in this directory, the tests use certain constants and settings:

1. In `stripe_customer_spec.rb`:
   - `PAYMENT_METHODS`: A constant array containing valid payment method types for Stripe.
   - The tests check for specific validation error messages, which should align with the actual model validations.

2. Both files use `frozen_string_literal: true`, which is a Ruby optimization that prevents string literals from being modified and potentially reduces memory usage.

These tests play a crucial role in ensuring the reliability and correctness of the payment provider customer models in the application. They cover various scenarios and edge cases, helping to maintain the integrity of customer data and payment method handling across different payment providers.