---
title: "generate_pdf_job_spec.rb"
---

## High-level description
This code defines a RSpec test for the `CreditNotes::GeneratePdfJob` job. The test verifies that the job correctly delegates the PDF generation task to the `CreditNotes::GenerateService`.

## Symbols

### `RSpec.describe CreditNotes::GeneratePdfJob, type: :job`
#### Description
This is the main RSpec test block for the `CreditNotes::GeneratePdfJob` job.

### `let(:credit_note)`
#### Description
Creates a test `credit_note` object using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| credit_note | CreditNote | A test credit note object |

### `let(:result)`
#### Description
Creates a new `BaseService::Result` object to simulate the result of the generate service.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | BaseService::Result | A result object for the generate service |

### `let(:generate_service)`
#### Description
Creates a test double for the `CreditNotes::GenerateService`.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| generate_service | Double | A test double for CreditNotes::GenerateService |

### `it 'delegates to the Generate service'`
#### Description
This is the main test case that verifies the job's behavior.

#### Internal Logic
1. Sets up expectations for the `CreditNotes::GenerateService.new` method call.
2. Sets up expectations for the `generate_service.call` method.
3. Executes the job using `described_class.perform_now(credit_note)`.
4. Verifies that the expected method calls were made.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment |
| FactoryBot | Used implicitly for creating test objects |

## References
This test file references the following components:
- `CreditNotes::GeneratePdfJob`: The job being tested
- `CreditNotes::GenerateService`: The service that the job is expected to use
- `BaseService::Result`: Used to represent the result of the generate service

Based on the related code snippets, we can see that the `CreditNotes::GenerateService` is responsible for actually generating the PDF for a credit note. The job being tested here (`CreditNotes::GeneratePdfJob`) is likely a wrapper that ensures this generation happens in the background.