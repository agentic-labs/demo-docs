---
title: "stripe_create_job_spec.rb"
---

## High-level description
This code defines a RSpec test for the `PaymentRequests::Payments::StripeCreateJob` job. It verifies that the job correctly calls the Stripe create service with the given payment request.

## Symbols

### `RSpec.describe PaymentRequests::Payments::StripeCreateJob, type: :job`
#### Description
This is the main describe block for the test suite, focusing on the `PaymentRequests::Payments::StripeCreateJob` job.

### `let(:payment_request)`
#### Description
Creates a factory-generated payment request object for use in the tests.

### `let(:stripe_service)`
#### Description
Creates a double (mock) of the `PaymentRequests::Payments::StripeService` for use in the tests.

### `it 'calls the stripe create service'`
#### Description
This is the main test case that verifies the job's behavior.

#### Internal Logic
1. Sets up expectations for the `PaymentRequests::Payments::StripeService.new` method to return the mocked `stripe_service`.
2. Sets up expectations for the `stripe_service.create` method to return a `BaseService::Result` object.
3. Executes the job with the `payment_request`.
4. Verifies that the `StripeService` was initialized with the correct payment request.
5. Verifies that the `create` method was called on the `stripe_service`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used for creating test data (implied by the use of `create(:payment_request)`) |

## Notes
- This test is focused on ensuring that the job correctly delegates to the `PaymentRequests::Payments::StripeService` for creating a Stripe payment.
- The test uses doubles and stubs to isolate the job's behavior and avoid making actual calls to the Stripe API.
- The test doesn't verify the actual result of the Stripe service call, only that it was called correctly.