---
title: "adyen_create_job_spec.rb"
---

## High-level description
This code is a RSpec test file for the `PaymentRequests::Payments::AdyenCreateJob` job. It verifies that the job correctly initializes and calls the `AdyenService` to create a payment using the Adyen payment provider.

## Symbols

### `RSpec.describe PaymentRequests::Payments::AdyenCreateJob, type: :job`
#### Description
This is the main RSpec describe block that groups all the tests for the `PaymentRequests::Payments::AdyenCreateJob` job.

### `let(:payment_request)`
#### Description
This is a test helper that creates a new `payment_request` object using FactoryBot for each test example.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| payment_request | PaymentRequest | A newly created payment request object |

### `let(:adyen_service)`
#### Description
This is a test double (mock) for the `PaymentRequests::Payments::AdyenService` class.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| adyen_service | instance_double(PaymentRequests::Payments::AdyenService) | A mock object for the AdyenService |

### `it 'calls the stripe create service'`
#### Description
This is the main test example that verifies the behavior of the `AdyenCreateJob`.

#### Internal Logic
1. Set up expectations for the `PaymentRequests::Payments::AdyenService.new` method to return the mock `adyen_service`.
2. Set up expectations for the `adyen_service.create` method to return a `BaseService::Result` object.
3. Perform the job by calling `described_class.perform_now(payment_request)`.
4. Verify that the `PaymentRequests::Payments::AdyenService.new` method was called with the `payment_request`.
5. Verify that the `adyen_service.create` method was called.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and RSpec configuration |
| FactoryBot | Used to create test data (payment_request) |
| RSpec | The testing framework used for writing and running the tests |

## Notes
1. The test file uses RSpec's `let` syntax for defining test data and mocks.
2. The test verifies that the job correctly initializes the `AdyenService` and calls its `create` method.
3. The test uses mocking to isolate the job's behavior from the actual `AdyenService` implementation.
4. The test file is using the `type: :job` metadata, which may apply specific configurations or behaviors for job specs.
5. The `BaseService::Result` class is used as the return value for the `create` method, suggesting a standardized result object for service operations.

This test ensures that the `AdyenCreateJob` correctly delegates the payment creation process to the `AdyenService`, which is crucial for maintaining the separation of concerns and testability of the payment processing system.