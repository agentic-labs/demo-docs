---
title: "gocardless_create_job_spec.rb"
---

## High-level description
This code defines a RSpec test for the `PaymentRequests::Payments::GocardlessCreateJob` job. The test verifies that the job correctly initializes and calls the `GocardlessService` to create a payment.

## Symbols

### `RSpec.describe PaymentRequests::Payments::GocardlessCreateJob, type: :job`
#### Description
This is the main RSpec test block for the `GocardlessCreateJob`. It sets up the context for testing the job as an ActiveJob.

### `let(:payment_request)`
#### Description
This creates a test `payment_request` object using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| payment_request | PaymentRequest | A test payment request object |

### `let(:gocardless_service)`
#### Description
This creates a test double (mock) for the `GocardlessService`.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| gocardless_service | Double | A mock object for GocardlessService |

### `it 'calls the stripe create service'`
#### Description
This is the main test case that verifies the behavior of the `GocardlessCreateJob`.

#### Internal Logic
1. Set up expectations for the `GocardlessService`:
   - Expect `new` to be called with the `payment_request` and return the mock service.
   - Expect `create` to be called on the mock service and return a `BaseService::Result`.
2. Perform the job using `described_class.perform_now(payment_request)`.
3. Verify that the expectations were met:
   - `GocardlessService.new` was called with the correct argument.
   - `create` was called on the mock service.

## References
- `PaymentRequests::Payments::GocardlessCreateJob`: The job being tested.
- `PaymentRequests::Payments::GocardlessService`: The service used by the job to create payments.
- `BaseService::Result`: The result object returned by the service.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and RSpec configurations |
| FactoryBot | Used to create test objects (payment_request) |

This test ensures that the `GocardlessCreateJob` correctly initializes the `GocardlessService` with the provided payment request and calls the `create` method on the service. It verifies the job's core functionality without actually creating a real payment, by using a mock object for the service.