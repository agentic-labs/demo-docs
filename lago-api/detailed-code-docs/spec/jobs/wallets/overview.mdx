---
title: "Overview"
---

## High-level description
This code defines an RSpec test for the `Wallets::RefreshOngoingBalanceJob` job. The test verifies that the job correctly delegates its work to the `Wallets::Balance::RefreshOngoingService`.

## Symbols

### `RSpec.describe Wallets::RefreshOngoingBalanceJob, type: :job`
#### Description
This is the main RSpec test block for the `Wallets::RefreshOngoingBalanceJob` job.

### `let(:wallet)`
#### Description
Creates a test wallet using FactoryBot.

### `let(:result)`
#### Description
Creates a new instance of `BaseService::Result` to simulate the service result.

### `let(:refresh_service)`
#### Description
Creates a test double for the `Wallets::Balance::RefreshOngoingService`.

### `it 'delegates to the RefreshOngoingBalance service'`
#### Description
This test case verifies that the job delegates its work to the `Wallets::Balance::RefreshOngoingService`.

#### Internal Logic
1. Sets up expectations for the `Wallets::Balance::RefreshOngoingService`:
   - Expects `new` to be called with the wallet and return the test double.
   - Expects `call` to be called on the test double and return the result.
2. Performs the job using `described_class.perform_now(wallet)`.
3. Verifies that the service was initialized and called as expected.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails-specific test configurations and helpers |
| FactoryBot | Used for creating test data (wallet) |

## References
- `Wallets::Balance::RefreshOngoingService`: The service that the job delegates to.
- `BaseService::Result`: Used to create a result object for the service.

This test ensures that the `Wallets::RefreshOngoingBalanceJob` correctly delegates its work to the `Wallets::Balance::RefreshOngoingService`, which is responsible for refreshing the ongoing balance of a wallet. The test uses RSpec's mocking and stubbing capabilities to isolate the job's behavior and verify its interactions with the service.