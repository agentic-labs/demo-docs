---
title: "gocardless_create_job_spec.rb"
---

## High-level description
This code defines a RSpec test for the `Invoices::Payments::GocardlessCreateJob` job. It verifies that the job correctly initializes and calls the `GocardlessService` to create a payment for an invoice using the GoCardless payment provider.

## Symbols

### `RSpec.describe Invoices::Payments::GocardlessCreateJob, type: :job`
#### Description
This is the main test suite for the `Invoices::Payments::GocardlessCreateJob`. It sets up the context for testing the job's behavior.

### `let(:invoice)`
#### Description
Creates a test invoice using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| invoice | Invoice | A test invoice instance |

### `let(:gocardless_service)`
#### Description
Creates a double (mock) of the `Invoices::Payments::GocardlessService`.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| gocardless_service | Double | A mock of the GocardlessService |

### `it 'calls the stripe create service'`
#### Description
This test case verifies that the job correctly initializes the `GocardlessService` and calls its `create` method.

#### Internal Logic
1. Sets up expectations for the `GocardlessService` initialization and `create` method call.
2. Executes the job with the test invoice.
3. Verifies that the service was initialized and the `create` method was called as expected.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and RSpec configuration |
| FactoryBot | Used to create test data (invoice) |

## References
- `Invoices::Payments::GocardlessCreateJob`: The job being tested
- `Invoices::Payments::GocardlessService`: The service used by the job to create GoCardless payments
- `BaseService::Result`: Used as a return value for the `create` method of the `GocardlessService`

## Notes
1. The test uses RSpec's `allow` and `receive` methods to set up expectations and mock behavior.
2. The test verifies that the job correctly delegates the payment creation to the `GocardlessService`.
3. The actual implementation of the `GocardlessCreateJob` is not shown in the provided code, but it can be inferred that it initializes the `GocardlessService` with an invoice and calls its `create` method.
4. The test doesn't verify the actual creation of a payment or any side effects, focusing solely on the correct method calls.