---
title: "refresh_draft_job_spec.rb"
---

## High-level description
This code is a RSpec test file for the `Invoices::RefreshDraftJob` job. It verifies that the job correctly delegates its work to the `Invoices::RefreshDraftService`.

## Symbols

### `RSpec.describe Invoices::RefreshDraftJob, type: :job`
#### Description
This is the main test suite for the `Invoices::RefreshDraftJob`. It sets up the context for testing the job and contains the test cases.

### `let(:invoice)`
#### Description
Creates a test invoice using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| invoice | Invoice | A test invoice instance |

### `let(:result)`
#### Description
Creates a new instance of `BaseService::Result` to simulate the result of the service call.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | BaseService::Result | An instance of the result object |

### `let(:refresh_service)`
#### Description
Creates a test double for the `Invoices::RefreshDraftService`.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| refresh_service | RSpec::Mocks::InstanceVerifyingDouble | A test double for the RefreshDraftService |

### `it 'delegates to the RefreshDraft service'`
#### Description
This is the main test case that verifies the job's behavior.

#### Internal Logic
1. Sets up expectations for the `Invoices::RefreshDraftService.new` method call.
2. Sets up expectations for the `call` method on the service instance.
3. Executes the job using `described_class.perform_now(invoice)`.
4. Verifies that the service was instantiated and called as expected.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and RSpec configuration |
| FactoryBot | Used for creating test data (invoice) |
| RSpec | The testing framework used |

## References
- `Invoices::RefreshDraftJob`: The job being tested
- `Invoices::RefreshDraftService`: The service that the job is expected to use
- `BaseService::Result`: Used to represent the result of the service call

This test file ensures that the `Invoices::RefreshDraftJob` correctly delegates its work to the `Invoices::RefreshDraftService`. It does this by setting up a mock service, executing the job, and then verifying that the service was called with the expected parameters. This approach allows for isolated testing of the job's behavior without actually executing the service logic.