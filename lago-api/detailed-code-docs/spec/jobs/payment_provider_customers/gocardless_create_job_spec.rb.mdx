---
title: "gocardless_create_job_spec.rb"
---

## High-level description
This code is a RSpec test file for the `PaymentProviderCustomers::GocardlessCreateJob` job. It verifies that the job correctly calls the `GocardlessService` to create a Gocardless customer.

## Symbols

### `RSpec.describe PaymentProviderCustomers::GocardlessCreateJob, type: :job`
#### Description
This is the main RSpec describe block that groups the tests for the `PaymentProviderCustomers::GocardlessCreateJob` job.

### `let(:gocardless_customer)`
#### Description
This `let` block creates a factory instance of a Gocardless customer for use in the tests.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| gocardless_customer | GocardlessCustomer | An instance of a Gocardless customer created using FactoryBot |

### `let(:gocardless_service)`
#### Description
This `let` block creates a double of the `PaymentProviderCustomers::GocardlessService` for use in the tests.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| gocardless_service | Double | A test double of the GocardlessService |

### `it 'calls the gocardless create service'`
#### Description
This is the main test case that verifies the behavior of the `GocardlessCreateJob`.

#### Internal Logic
1. Set up expectations for the `GocardlessService`:
   - Expect `PaymentProviderCustomers::GocardlessService.new` to be called with the `gocardless_customer` and return the `gocardless_service` double.
   - Expect the `create` method to be called on the `gocardless_service` double and return a `BaseService::Result` instance.
2. Perform the job by calling `described_class.perform_now(gocardless_customer)`.
3. Verify that the expectations were met:
   - `PaymentProviderCustomers::GocardlessService.new` was called.
   - `create` method was called on the `gocardless_service`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and RSpec configuration |
| FactoryBot | Used to create test data (gocardless_customer) |
| RSpec | The testing framework used for writing and running the tests |

## Notes
- The test file uses RSpec's `let` syntax for defining test data and doubles.
- It uses the `instance_double` method to create a strict test double for the `GocardlessService`.
- The test verifies that the job interacts correctly with the `GocardlessService` by checking that the appropriate methods are called with the expected arguments.
- The actual implementation of the `GocardlessCreateJob` is not shown in this file, as this is only the test specification.