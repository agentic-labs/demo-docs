---
title: "stripe_create_job_spec.rb"
---

## High-level description
This code is a RSpec test file for the `PaymentProviderCustomers::StripeCreateJob` job. It verifies that the job correctly calls the Stripe create service with the provided stripe customer.

## Symbols

### `RSpec.describe PaymentProviderCustomers::StripeCreateJob, type: :job`
#### Description
This is the main test suite for the `PaymentProviderCustomers::StripeCreateJob`. It sets up the context for testing the job's behavior.

### `let(:stripe_customer)`
#### Description
This creates a test double for a stripe customer using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| stripe_customer | StripeCustomer | A mock stripe customer object |

### `let(:stripe_service)`
#### Description
This creates an instance double of the `PaymentProviderCustomers::StripeService`.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| stripe_service | instance_double(PaymentProviderCustomers::StripeService) | A mock stripe service object |

### `it 'calls the stripe create service'`
#### Description
This is the main test case that verifies the job's behavior.

#### Internal Logic
1. Arrange:
   - Set up expectations for `PaymentProviderCustomers::StripeService.new` to return the mock `stripe_service`.
   - Set up expectations for `stripe_service.create` to return a `BaseService::Result` object.

2. Act:
   - Call `described_class.perform_now(stripe_customer)` to execute the job.

3. Assert:
   - Verify that `PaymentProviderCustomers::StripeService.new` was called with the `stripe_customer`.
   - Verify that `stripe_service.create` was called.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and RSpec configuration |
| FactoryBot | Used for creating test data (stripe_customer) |
| RSpec | The testing framework used |

## References
- `PaymentProviderCustomers::StripeService`: The service class that the job is expected to use
- `BaseService::Result`: The expected return type of the `create` method on the stripe service

This test file ensures that the `PaymentProviderCustomers::StripeCreateJob` correctly initializes the `PaymentProviderCustomers::StripeService` with the provided stripe customer and calls its `create` method. It uses RSpec's mocking and stubbing capabilities to isolate the job's behavior and verify its interactions with the stripe service.