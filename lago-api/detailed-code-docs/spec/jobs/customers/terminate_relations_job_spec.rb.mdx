---
title: "terminate_relations_job_spec.rb"
---

## High-level description
This file contains a RSpec test for the `Customers::TerminateRelationsJob` job. The test verifies that the job correctly calls the `Customers::TerminateRelationsService` with the appropriate customer when performed.

## Symbols

### `RSpec.describe Customers::TerminateRelationsJob`
#### Description
This is the main RSpec test suite for the `Customers::TerminateRelationsJob` job. It sets up the context for testing the job's behavior.

### `let(:customer)`
#### Description
This is a test helper that creates a deleted customer instance for use in the test.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| customer | Customer | A deleted customer instance |

### `it 'calls the service'`
#### Description
This is the main test case that verifies the job's behavior.

#### Internal Logic
1. Arrange: Set up an expectation for the `Customers::TerminateRelationsService.call` method to be called with the customer.
2. Act: Perform the job with the customer's ID.
3. Assert: Verify that the service was called as expected.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and RSpec configuration |
| RSpec | Testing framework used for writing and running the test |
| FactoryBot | Implied dependency for creating test data (`:customer` factory) |

## Notes
1. The test uses RSpec's `allow` and `expect` methods to set up and verify method call expectations.
2. The job is tested using `perform_now`, which runs the job synchronously in the test environment.
3. The test assumes the existence of a `Customer` model with a `deleted` trait or scope.
4. The `BaseService::Result` class is used as a return value for the mocked service call, implying a common pattern for service objects in the application.

This test ensures that the `Customers::TerminateRelationsJob` correctly delegates its work to the `Customers::TerminateRelationsService`, passing the appropriate customer object. It does not test the actual termination logic, which is presumably handled by the service.