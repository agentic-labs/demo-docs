---
title: "export_resources_job_spec.rb"
---

## High-level description
This code is a RSpec test file for the `DataExports::ExportResourcesJob` job. It verifies that the job correctly calls the `DataExports::ExportResourcesService` with the expected parameters when performed.

## Symbols

### `RSpec.describe DataExports::ExportResourcesJob, type: :job`
#### Description
This is the main RSpec test group for the `DataExports::ExportResourcesJob` job. It sets up the context for testing the job and includes one test case.

#### Internal Logic
1. Sets up a mock `data_export` object using FactoryBot.
2. Creates a mock `BaseService::Result` object.
3. Stubs the `DataExports::ExportResourcesService.call` method to return the mock result.
4. Defines a test case to verify the job's behavior.

### `let(:data_export)`
#### Description
Creates a mock `data_export` object using FactoryBot for use in the tests.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data_export | DataExport | A mock DataExport object |

### `let(:result)`
#### Description
Creates a mock `BaseService::Result` object for use in the tests.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | BaseService::Result | A mock Result object |

### `before` block
#### Description
Sets up a stub for the `DataExports::ExportResourcesService.call` method to return the mock result when called with the mock `data_export`.

#### Internal Logic
Uses RSpec's `allow` method to stub the `DataExports::ExportResourcesService.call` method and configure it to return the mock `result` when called with the specified `data_export`.

### Test: "calls ExportResources service"
#### Description
Verifies that the job calls the `DataExports::ExportResourcesService.call` method with the correct parameter when performed.

#### Internal Logic
1. Arrange: The setup is done in the `before` block and with the `let` statements.
2. Act: Calls `described_class.perform_now(data_export)` to execute the job.
3. Assert: Expects that `DataExports::ExportResourcesService.call` was called with the `data_export` parameter.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| rspec | Testing framework used for writing and running the tests |
| factory_bot | Used for creating test data (mock objects) |

## Notes
1. The test file uses the `type: :job` metadata to indicate that it's testing an ActiveJob job.
2. The test relies on RSpec's mocking and stubbing capabilities to isolate the job's behavior and verify its interactions with the `DataExports::ExportResourcesService`.
3. The test doesn't verify the actual execution of the export process, only that the job correctly delegates to the service.