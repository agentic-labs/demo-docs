---
title: "send_restlet_endpoint_job_spec.rb"
---

## High-level description
This code defines a RSpec test for the `Integrations::Aggregator::SendRestletEndpointJob` job. It verifies that the job correctly initializes and calls the `Integrations::Aggregator::SendRestletEndpointService` to send a restlet URL to an aggregator.

## Symbols

### `RSpec.describe Integrations::Aggregator::SendRestletEndpointJob`
#### Description
This is the main test suite for the `SendRestletEndpointJob`. It sets up the necessary test environment and defines a test case for the job's functionality.

#### Internal Logic
1. Sets up a double for the `SendRestletEndpointService`.
2. Creates a mock integration object.
3. Configures the double to return a `BaseService::Result` object.
4. Defines a test case to verify the job's behavior.

### `described_class.perform_now(integration:)`
#### Description
This line executes the job being tested with the mock integration object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| integration | NetsuiteIntegration | A mock integration object |

### `expect(Integrations::Aggregator::SendRestletEndpointService).to have_received(:new)`
#### Description
This expectation verifies that the `SendRestletEndpointService` is initialized when the job is performed.

### `expect(send_endpoint_service).to have_received(:call)`
#### Description
This expectation checks that the `call` method of the `SendRestletEndpointService` is invoked during job execution.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Provides the necessary setup for Rails-specific RSpec tests |
| FactoryBot | Used to create test objects (e.g., `create(:netsuite_integration)`) |
| RSpec | The testing framework used to define and run the tests |

## References
- `Integrations::Aggregator::SendRestletEndpointService`: The service class that the job is expected to use.
- `BaseService::Result`: A result object returned by the service.

This test ensures that the `SendRestletEndpointJob` correctly delegates its work to the `SendRestletEndpointService`, which is responsible for sending the restlet URL to the aggregator. The test uses doubles and expectations to verify the job's behavior without actually executing the service's logic.