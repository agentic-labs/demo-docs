---
title: "Overview"
---

## High-level description
This code defines an RSpec test for the `Integrations::Aggregator::SalesOrders::CreateJob` job. It verifies that the job correctly calls the `Integrations::Aggregator::SalesOrders::CreateService` with the provided invoice.

## Symbols

### `RSpec.describe Integrations::Aggregator::SalesOrders::CreateJob, type: :job`
#### Description
This is the main RSpec test block for the `Integrations::Aggregator::SalesOrders::CreateJob`. It sets up the test environment and defines the test cases for this job.

### `subject(:create_job)`
#### Description
Defines the subject of the test, which is the `Integrations::Aggregator::SalesOrders::CreateJob` class.

### `let(:service)`
#### Description
Creates a double (mock) of the `Integrations::Aggregator::SalesOrders::CreateService` class.

### `let(:invoice)`
#### Description
Creates a factory-generated invoice object for testing purposes.

### `let(:result)`
#### Description
Creates a new instance of `BaseService::Result` to be used as the return value of the service call.

### `before` block
#### Description
Sets up the test environment by configuring the mock service to return the predefined result when called.

### `it 'calls the aggregator create invoice service'`
#### Description
This is the main test case that verifies the behavior of the job.

#### Internal Logic
1. Calls the `perform_now` method of the job with the created invoice.
2. Uses `aggregate_failures` to group multiple expectations.
3. Verifies that the `Integrations::Aggregator::SalesOrders::CreateService` is instantiated.
4. Checks that the `call` method of the service is invoked.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used to create test data (invoice in this case) |

## References
- `Integrations::Aggregator::SalesOrders::CreateService`: The service class that is expected to be called by the job.
- `BaseService::Result`: Used to create a result object for the service call.

This test ensures that when the `Integrations::Aggregator::SalesOrders::CreateJob` is performed, it correctly instantiates the `CreateService` and calls its `call` method with the provided invoice. The test uses mocking to isolate the job's behavior and verify its interactions with the service class.