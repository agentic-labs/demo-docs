---
title: "recalculate_and_check_job_spec.rb"
---

## High-level description
This code defines a RSpec test for the `LifetimeUsages::RecalculateAndCheckJob` job. The test verifies that the job correctly delegates its work to the `LifetimeUsages::RecalculateAndCheckService`.

## Symbols

### `RSpec.describe LifetimeUsages::RecalculateAndCheckJob, type: :job`
#### Description
This block describes a test suite for the `LifetimeUsages::RecalculateAndCheckJob` class, specifying that it's a job type test.

### `let(:lifetime_usage)`
#### Description
This line creates a factory method for generating a `lifetime_usage` object using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| lifetime_usage | LifetimeUsage | A newly created LifetimeUsage object |

### `it 'delegates to the RecalculateAndCheck service'`
#### Description
This test case verifies that the job delegates its work to the `LifetimeUsages::RecalculateAndCheckService`.

#### Internal Logic
1. Sets up an expectation that the `LifetimeUsages::RecalculateAndCheckService.call` method will be called.
2. Executes the job using `described_class.perform_now(lifetime_usage)`.
3. Verifies that the service's `call` method was invoked with the correct argument.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used for creating test objects (lifetime_usage) |
| RSpec | The testing framework used for writing and running the tests |

## References
- `LifetimeUsages::RecalculateAndCheckService`: The service class that the job is expected to delegate to.
- `FactoryBot`: Used implicitly through the `create` method to generate test data.

This test file ensures that the `LifetimeUsages::RecalculateAndCheckJob` correctly delegates its work to the appropriate service, which is a crucial part of maintaining separation of concerns and testability in the application's job structure.