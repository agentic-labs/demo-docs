---
title: "pay_in_advance_job_spec.rb"
---

## High-level description
This code is a RSpec test file for the `Events::PayInAdvanceJob` job. It verifies that the job correctly calls the `Events::PayInAdvanceService` with the expected parameters when performed.

## Symbols

### `RSpec.describe Events::PayInAdvanceJob, type: :job`
#### Description
This is the main RSpec test group for the `Events::PayInAdvanceJob` class, specifying that it's a job test.

### `let(:pay_in_advance_service)`
#### Description
Creates a double (mock) of the `Events::PayInAdvanceService` class for use in the test.

### `let(:result)`
#### Description
Creates an instance of `BaseService::Result` to be used as the return value of the mocked service call.

### `let(:event)`
#### Description
Creates a test event object using FactoryBot's `build` method with the `:common_event` factory.

### `it 'calls the event pay in advance service'`
#### Description
This is the main test case that verifies the behavior of the `Events::PayInAdvanceJob`.

#### Internal Logic
1. Arrange: Sets up an expectation that `Events::PayInAdvanceService.call` will be called with the `event` parameter and return the `result` object.
2. Act: Performs the job by calling `described_class.perform_now(event)`.
3. Assert: Verifies that `Events::PayInAdvanceService.call` was indeed called as expected.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used to create test objects (`:common_event`) |
| RSpec | The testing framework used for writing and running the tests |

## References
- `Events::PayInAdvanceService`: The service class that is expected to be called by the job
- `BaseService::Result`: A class used to represent the result of the service call
- `:common_event` factory: A FactoryBot factory used to create test event objects

This test file ensures that the `Events::PayInAdvanceJob` correctly delegates its work to the `Events::PayInAdvanceService` when performed, passing the event object as a parameter. It uses RSpec's mocking capabilities to isolate the job's behavior and verify its interactions with the service class.