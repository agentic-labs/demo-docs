---
title: "webhooks_query_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `WebhooksQuery` class. It tests various scenarios of querying webhooks, including pagination, searching, and filtering, to ensure the query returns the expected results under different conditions.

## Code Structure
The test suite is organized around a single `describe` block for the `WebhooksQuery` class. Within this block, there are several contexts and examples that test different aspects of the query's functionality.

## Symbols

### `WebhooksQuery.call`
#### Description
This is the main method being tested. It queries webhooks based on the provided parameters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| webhook_endpoint | WebhookEndpoint | The webhook endpoint to query |
| pagination | Hash | Pagination parameters |
| search_term | String | Term to search for in webhooks |
| filters | Hash | Filters to apply to the query |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Object | An object containing the query results |

### `let` statements
These define the test data and parameters used across the examples:

- `pagination`: Pagination parameters
- `search_term`: Search term for filtering webhooks
- `filters`: Additional filters for the query
- `organization`: The organization associated with the webhook endpoint
- `webhook_endpoint`: A factory-created webhook endpoint
- `webhook_succeeded`: A factory-created successful webhook
- `webhook_failed`: A factory-created failed webhook
- `webhook_other_type`: A factory-created webhook of a different type

### Test Examples
#### "returns all webhooks"
This test ensures that the query returns all created webhooks when no filters or search terms are applied.

#### "with pagination"
This test verifies that pagination is correctly applied to the query results.

#### "when search for /generated/ term"
This test checks if the search functionality correctly filters webhooks based on the search term.

#### "when search for /created/ term and filtering by status"
This test combines searching and filtering to ensure both are applied correctly.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configurations |
| FactoryBot | Used for creating test data |

## Error Handling
The test suite uses RSpec's `aggregate_failures` to group multiple expectations together, allowing all expectations to be evaluated even if one fails.

## Performance Considerations
The test suite creates minimal test data (3 webhooks) to keep the tests fast while still covering the necessary scenarios.