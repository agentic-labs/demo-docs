---
title: "invoices_query_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `InvoicesQuery` class. It tests various scenarios of querying invoices with different filters, pagination, and search terms. The tests ensure that the query returns the expected invoices based on the given parameters.

## Code Structure
The test suite is organized into multiple contexts, each testing different aspects of the `InvoicesQuery` functionality. It uses FactoryBot to create test data and RSpec's `let` statements to define variables used across multiple tests.

## Symbols

### `RSpec.describe InvoicesQuery`
#### Description
This is the main describe block for the `InvoicesQuery` test suite. It sets up the test environment and defines the subject of the tests.

#### Internal Logic
- Sets up test data using FactoryBot
- Defines various invoice scenarios with different attributes
- Tests different query scenarios using contexts and examples

### `context 'with pagination'`
#### Description
Tests the pagination functionality of the `InvoicesQuery`.

#### Internal Logic
- Sets pagination parameters
- Checks if the pagination is applied correctly

### `context 'when filtering by draft status'`
#### Description
Tests filtering invoices by draft status.

#### Internal Logic
- Sets the filter for draft status
- Verifies that only draft invoices are returned

### `context 'when filtering by failed payment_status'`
#### Description
Tests filtering invoices by failed payment status.

#### Internal Logic
- Sets the filter for failed payment status
- Verifies that only invoices with failed payment status are returned

### `context 'when searching for a part of an invoice id'`
#### Description
Tests searching for invoices using a partial invoice ID.

#### Internal Logic
- Sets the search term to a part of an invoice ID
- Verifies that the correct invoice is returned

### `context 'when searching an invoice number'`
#### Description
Tests searching for invoices using an invoice number.

#### Internal Logic
- Sets the search term to an invoice number
- Verifies that the correct invoice is returned

## Dependencies
- RSpec
- FactoryBot
- Rails

## Error Handling
The test suite checks for error scenarios, such as invalid date inputs for `issuing_date_from` and `issuing_date_to` filters.

## Performance Considerations
The test suite creates multiple invoices for each test, which might impact performance for large test suites. Consider using shared examples or more focused tests if performance becomes an issue.