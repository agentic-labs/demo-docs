---
title: "integration_items_query_spec.rb"
---

## High-level description
This file contains RSpec tests for the `IntegrationItemsQuery` class. It verifies the functionality of querying integration items within an organization, including pagination, filtering by integration ID and item type, and searching by name.

## Code Structure
The test suite is organized around different scenarios for the `IntegrationItemsQuery.call` method, testing various combinations of inputs and expected outputs.

## Symbols

### `RSpec.describe IntegrationItemsQuery, type: :query`
#### Description
This is the main describe block for the `IntegrationItemsQuery` test suite.

### `subject(:result)`
#### Description
Defines the subject of the test, which is the result of calling `IntegrationItemsQuery.call` with the specified parameters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The organization to query integration items for |
| search_term | String | The search term to filter integration items |
| pagination | Hash | Pagination parameters |
| filters | Hash | Filters to apply to the query |

### `let` statements
#### Description
These statements set up the test data and parameters used across the test suite.

### Main test case
#### Description
Tests that the query returns all integration items of an organization.

#### Internal Logic
1. Creates test data
2. Calls the query
3. Verifies the result is successful
4. Checks that the correct number of items are returned
5. Ensures the correct items are included/excluded based on the organization

### Context: "with pagination"
#### Description
Tests the pagination functionality of the query.

#### Internal Logic
1. Sets pagination parameters
2. Verifies various pagination attributes of the result

### Context: "when filtering by integration_id"
#### Description
Tests filtering integration items by a specific integration ID.

#### Internal Logic
1. Sets the integration_id filter
2. Verifies that only items from the specified integration are returned

### Context: "when filtering by item type"
#### Description
Tests filtering integration items by item type.

#### Internal Logic
1. Sets the item_type filter to 'tax'
2. Verifies that only items of the specified type are returned

### Context: "when searching by name"
#### Description
Tests searching integration items by name.

#### Internal Logic
1. Sets the search term to 'Findme'
2. Verifies that only items matching the search term are returned

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |

## Error Handling
The test suite uses RSpec's `aggregate_failures` to group related expectations, allowing all expectations within a block to be evaluated even if one fails.