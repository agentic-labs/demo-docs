---
title: "add_ons_query_spec.rb"
---

## High-level description
This file contains RSpec tests for the `AddOnsQuery` class. It verifies the functionality of querying add-ons, including pagination and search capabilities within an organization context.

## Code Structure
The test suite is organized around different scenarios for the `AddOnsQuery.call` method, testing its behavior with various inputs and expected outputs.

## Symbols

### `RSpec.describe AddOnsQuery, type: :query`
#### Description
This is the main describe block for the `AddOnsQuery` test suite. It sets up the context for all the tests related to this query class.

### `subject(:result)`
#### Description
Defines the subject of the test, which is the result of calling `AddOnsQuery.call` with specified parameters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The organization context for the query |
| pagination | Hash | Pagination parameters (page and limit) |
| search_term | String | Optional search term for filtering add-ons |

### `let` statements
#### Description
These statements set up the test data and parameters used across multiple tests.

### `before` block
#### Description
Ensures that the test add-ons are created before running the tests.

### Main test case
#### Description
Verifies that the query returns all add-ons when no specific filters are applied.

#### Internal Logic
1. Calls the query method
2. Checks the count of returned add-ons
3. Verifies that all created add-on IDs are included in the result

### Context: "with pagination"
#### Description
Tests the pagination functionality of the query.

#### Internal Logic
1. Sets pagination parameters to page 2 with a limit of 2
2. Verifies various pagination-related attributes of the result

### Context: "when searching for /de/ term"
#### Description
Tests the search functionality when searching for add-ons containing "de" in their name or code.

#### Internal Logic
1. Sets the search term to "de"
2. Verifies that only the matching add-ons are returned

### Context: "when searching for /1/ term"
#### Description
Tests the search functionality when searching for add-ons containing "1" in their name or code.

#### Internal Logic
1. Sets the search term to "1"
2. Verifies that only the matching add-on is returned

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails-specific test configurations and helpers |

## Configuration
The test suite uses RSpec's `type: :query` configuration, which may have specific settings defined in the `rails_helper.rb` file.