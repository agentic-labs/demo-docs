---
title: "webhook_endpoints_query_spec.rb"
---

## High-level description
This file contains RSpec tests for the `WebhookEndpointsQuery` class. It verifies the functionality of querying webhook endpoints for a specific organization, including pagination and search capabilities.

## Symbols

### `RSpec.describe WebhookEndpointsQuery, type: :query`
#### Description
This is the main test suite for the `WebhookEndpointsQuery` class. It sets up the test environment and defines various test cases to ensure the query behaves correctly under different scenarios.

#### Internal Logic
The test suite creates a set of webhook endpoints associated with an organization and tests various aspects of the query, including:
1. Retrieving all webhook endpoints for an organization
2. Applying pagination to the results
3. Searching for webhook endpoints based on a search term

### `subject(:result)`
#### Description
This defines the subject of the test, which is the result of calling the `WebhookEndpointsQuery.call` method with the specified parameters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The organization to query webhook endpoints for |
| pagination | Hash | Pagination parameters (optional) |
| search_term | String | Search term for filtering webhook endpoints (optional) |

### `let` statements
#### Description
These statements define the test data used across the test cases, including the organization, webhook endpoints, and query parameters.

### Main test case
#### Description
This test case verifies that the query returns all webhook endpoints associated with the specified organization.

#### Internal Logic
1. Calls the query method
2. Checks that the correct number of webhook endpoints are returned
3. Verifies that the returned webhook endpoints belong to the specified organization
4. Ensures that webhook endpoints from other organizations are not included

### `context 'with pagination'`
#### Description
This context tests the pagination functionality of the query.

#### Internal Logic
1. Sets up pagination parameters
2. Verifies that the correct number of results are returned for the specified page
3. Checks pagination metadata (current page, previous page, next page, total pages, total count)

### `context 'when searching for /lago/ term'`
#### Description
This context tests the search functionality of the query.

#### Internal Logic
1. Sets up a search term
2. Verifies that only webhook endpoints matching the search term are returned
3. Ensures that non-matching webhook endpoints are not included in the results

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |

## Configuration
The test suite uses the following RSpec configuration:
- `type: :query` - Specifies that this is a query test
- `let` statements for setting up test data
- `before` block for preparing the test environment

## Error Handling
The test suite uses RSpec's `aggregate_failures` to group related assertions, allowing all expectations within a block to be evaluated even if one fails.