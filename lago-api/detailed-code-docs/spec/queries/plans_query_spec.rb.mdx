---
title: "plans_query_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `PlansQuery` class. It tests the functionality of querying plans within an organization, including pagination, searching, and filtering capabilities.

## Symbols

### `RSpec.describe PlansQuery, type: :query`
#### Description
This is the main describe block for the `PlansQuery` test suite. It sets up the context for testing the `PlansQuery` class.

### `subject(:result)`
#### Description
Defines the subject of the test, which is the result of calling the `PlansQuery.call` method with specified parameters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The organization to query plans for |
| pagination | Hash | Pagination parameters (optional) |
| search_term | String | Search term for filtering plans (optional) |
| filters | Hash | Additional filters for plans (optional) |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Object | The result of the query, containing plans and query status |

### Main test case
#### Description
Tests that the query returns all plans when no filters or pagination are applied.

#### Internal Logic
1. Creates three plans in the database
2. Calls the `PlansQuery.call` method
3. Checks that the result is successful and contains all three plans

### Context: "with pagination"
#### Description
Tests the pagination functionality of the query.

#### Internal Logic
1. Sets pagination parameters (page 2, limit 2)
2. Calls the `PlansQuery.call` method
3. Checks various pagination attributes of the result

### Context: "when searching for /de/ term"
#### Description
Tests the search functionality of the query.

#### Internal Logic
1. Sets a search term "de"
2. Calls the `PlansQuery.call` method
3. Checks that only plans with names containing "de" are returned

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| FactoryBot | Used for creating test data (plans, membership, organization) |

## References
The test file references the following external components:
- `PlansQuery` class (the subject under test)
- `Plan` model
- `Membership` model
- `Organization` model

Note: The actual implementation of `PlansQuery` is not provided in the given code snippets.