---
title: "integration_mappings_query_spec.rb"
---

## High-level description
This file contains RSpec tests for the `IntegrationMappingsQuery` class. It tests various scenarios of querying integration mappings, including filtering and pagination, to ensure the query returns the expected results based on different input parameters.

## Code Structure
The test suite is organized around different contexts, each testing a specific aspect of the `IntegrationMappingsQuery` class. It uses FactoryBot to create test data and RSpec's `describe` and `context` blocks to structure the tests.

## Symbols

### `RSpec.describe IntegrationMappingsQuery`
#### Description
This is the main describe block for the `IntegrationMappingsQuery` test suite. It sets up the test environment and defines various test scenarios.

#### Internal Logic
- Sets up test data using FactoryBot
- Defines different contexts for testing various query scenarios
- Uses `aggregate_failures` to group multiple expectations

### `subject(:integration_mappings_query)`
#### Description
Defines the subject of the test, which is an instance of `IntegrationMappingsQuery`.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The organization for which to query mappings |
| pagination | Hash | Pagination parameters (optional) |
| filters | Hash | Filtering parameters (optional) |

### `context 'when filters are empty'`
#### Description
Tests the behavior of the query when no filters are applied.

#### Internal Logic
- Calls the query without filters
- Checks if all mappings for the organization are returned
- Verifies that mappings from other organizations are not included

### `context 'with pagination'`
#### Description
Tests the pagination functionality of the query.

#### Internal Logic
- Sets pagination parameters (page 2, limit 2)
- Verifies various pagination attributes of the result

### `context 'when filtering by integration id'`
#### Description
Tests the query's behavior when filtering by a specific integration ID.

#### Internal Logic
- Applies a filter for a specific integration ID
- Checks if only mappings for that integration are returned

### `context 'when filtering by mappable type'`
#### Description
Tests the query's behavior when filtering by mappable type.

#### Internal Logic
- Applies a filter for mappable type 'BillableMetric'
- Verifies that only mappings with the specified mappable type are returned

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| FactoryBot | Used for creating test data |
| RSpec | Testing framework used for writing and running tests |

## Error Handling
This test file doesn't explicitly test error handling. It focuses on testing the expected behavior of the `IntegrationMappingsQuery` under different scenarios.