---
title: "common_events.rb"
---

## High-level description
This code defines a factory for creating `Events::Common` objects using FactoryBot. It sets up a common structure for event data, including associations with organizations, billable metrics, and subscriptions, which is likely used for testing purposes in a billing or event tracking system.

## Symbols

### `factory :common_event`
#### Description
This factory defines how to create an `Events::Common` object with default and customizable attributes.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Association | The associated organization (transient attribute) |
| billable_metric | Association | The associated billable metric (transient attribute) |
| subscription | Association | The associated subscription (transient attribute) |

#### Outputs
An instance of `Events::Common` with the specified attributes.

#### Internal Logic
1. Sets up transient attributes for organization, billable_metric, and subscription.
2. Defines default values for various attributes of the common event:
   - `organization_id`: ID of the associated organization
   - `transaction_id`: A randomly generated UUID
   - `external_subscription_id`: External ID of the associated subscription
   - `timestamp`: Current time
   - `code`: Code of the associated billable metric
   - `properties`: An empty hash

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| FactoryBot | Used to define factories for creating test objects |
| SecureRandom | Used to generate UUIDs for transaction_id |

## References
- `Events::Common`: The class for which this factory is defined (from app/models/events/common.rb)
- `Organization`: Referenced in the transient attribute and used to set `organization_id`
- `BillableMetric`: Referenced in the transient attribute and used to set `code`
- `Subscription`: Referenced in the transient attribute and used to set `external_subscription_id`

## Notes
1. The factory uses transient attributes to create associated objects (organization, billable_metric, subscription) which are not directly stored in the `Events::Common` object but are used to set related attributes.
2. The `properties` attribute is set to an empty hash by default, allowing for easy customization in specific test scenarios.
3. This factory is likely used in conjunction with other factories (e.g., organization, billable_metric, subscription) to create a complete test environment for event-related functionality.