---
title: "cached_aggregations.rb"
---

## High-level description
This file defines a factory for creating `CachedAggregation` objects using FactoryBot, a popular Ruby gem for creating test data. The factory sets up default attributes for a `CachedAggregation` instance, including associations with other models and generated unique identifiers.

## Symbols

### `cached_aggregation` (factory)
#### Description
This factory defines how to create a `CachedAggregation` object with predefined attributes and associations. It's used in test environments to generate consistent and realistic test data for `CachedAggregation` models.

#### Inputs
The factory doesn't have explicit inputs, but it uses FactoryBot's DSL to define attributes and associations.

#### Outputs
When invoked, this factory produces a `CachedAggregation` object with the following attributes:

| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Association | Associated organization object |
| charge | Association | Associated charge object (standard_charge) |
| event_id | String (UUID) | Unique identifier for the event |
| event_transaction_id | String (UUID) | Unique identifier for the event transaction |
| external_subscription_id | String (UUID) | Unique identifier for the external subscription |
| timestamp | Time | Current timestamp |

#### Internal Logic
1. Associates an organization using the `organization` factory (implied to exist elsewhere).
2. Associates a charge using the `standard_charge` factory.
3. Generates unique UUIDs for `event_id`, `event_transaction_id`, and `external_subscription_id` using `SecureRandom.uuid`.
4. Sets the `timestamp` to the current time using `Time.current`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| FactoryBot | Provides the DSL for defining factories |
| SecureRandom | Used to generate UUIDs |

Note: The `frozen_string_literal: true` comment at the top of the file indicates that string literals in this file are frozen, which can provide performance benefits and prevent unintended string mutations.