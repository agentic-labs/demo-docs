---
title: "charges.rb"
---

## High-level description
This file defines factories for creating `Charge` objects using FactoryBot in a Ruby on Rails application. It provides various charge models and configurations to simulate different pricing structures for billing purposes in a SaaS or similar business model.

## Code Structure
The file defines a main `charge` factory and several specialized factories for different charge models. It also includes traits for additional charge configurations.

## Symbols

### `charge` (Factory)
#### Description
The base factory for creating `Charge` objects. It sets up common attributes for all charge types.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| billable_metric | association | Associated billable metric |
| plan | association | Associated plan |
| invoice_display_name | string | Display name for the charge on invoices |

### `standard_charge` (Factory)
#### Description
Creates a standard charge with a fixed amount.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| charge_model | string | Set to 'standard' |
| properties | hash | Contains the amount for the charge |

### `graduated_charge` (Factory)
#### Description
Creates a graduated charge with an empty array for graduated ranges.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| charge_model | string | Set to 'graduated' |
| properties | hash | Contains an empty array for graduated ranges |

### `package_charge` (Factory)
#### Description
Creates a package-based charge with amount, free units, and package size.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| charge_model | string | Set to 'package' |
| properties | hash | Contains amount, free units, and package size |

### `percentage_charge` (Factory)
#### Description
Creates a percentage-based charge with a rate and fixed amount.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| charge_model | string | Set to 'percentage' |
| properties | hash | Contains rate and fixed amount |

### `volume_charge` (Factory)
#### Description
Creates a volume-based charge with multiple ranges and per-unit pricing.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| charge_model | string | Set to 'volume' |
| properties | hash | Contains an array of volume ranges with pricing details |

### `graduated_percentage_charge` (Factory)
#### Description
Creates a graduated percentage charge with multiple ranges and flat amounts.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| charge_model | string | Set to 'graduated_percentage' |
| properties | hash | Contains an array of graduated percentage ranges with pricing details |

### `custom_charge` (Factory)
#### Description
Creates a custom charge with user-defined properties.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| charge_model | string | Set to 'custom' |
| properties | hash | Contains custom properties for the charge |

### `pay_in_advance` (Trait)
#### Description
A trait that sets the charge to be paid in advance.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pay_in_advance | boolean | Set to true |

### `regroup_paid_fees` (Trait)
#### Description
A trait that configures the charge to regroup paid fees on the invoice.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pay_in_advance | boolean | Set to true |
| invoiceable | boolean | Set to false |
| regroup_paid_fees | string | Set to 'invoice' |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| FactoryBot | Used for defining factories for creating test objects |
| Faker | Used for generating random data for some attributes |

This file is crucial for setting up test data for various charge models in the application. It provides a flexible way to create different types of charges with predefined or random attributes, which can be used in tests or for seeding the database with sample data.