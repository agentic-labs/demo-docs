---
title: "events_count_aggs.rb"
---

## High-level description
This code defines a factory for creating `Clickhouse::EventsCountAgg` objects using FactoryBot. It sets up default attributes and associations for testing purposes, allowing for easy creation of test data related to event count aggregations in a ClickHouse database.

## Code Structure
The code defines a single factory `clickhouse_events_count_agg` within the FactoryBot framework. It uses transient attributes to set up associated objects and then defines the attributes for the `Clickhouse::EventsCountAgg` model.

## Symbols

### `factory :clickhouse_events_count_agg`
#### Description
This factory defines how to create a `Clickhouse::EventsCountAgg` object for testing purposes.

#### Inputs
The factory doesn't have explicit inputs, but it uses transient attributes to set up associated objects:
- `subscription`
- `customer`
- `organization`
- `billable_metric`
- `plan`
- `charge`

#### Outputs
An instance of `Clickhouse::EventsCountAgg` with the following attributes:
- `organization_id`
- `external_subscription_id`
- `code`
- `timestamp`
- `value`
- `charge_id`
- `filters`
- `grouped_by`

#### Internal Logic
1. Sets up transient attributes for associated objects.
2. Defines attributes for the `Clickhouse::EventsCountAgg` model, using the transient attributes to set values.
3. Sets default values for `filters` and `grouped_by` as empty hashes.

## Dependencies
This factory depends on other factories:
- `subscription`
- `customer`
- `billable_metric`
- `plan`
- `standard_charge`

These dependencies are used to create associated objects for the `Clickhouse::EventsCountAgg` instance.

## Notes
- The factory uses FactoryBot's `create` method to instantiate associated objects, which means these objects will be persisted in the test database when the factory is used.
- The `timestamp` attribute is set to the current time's beginning of the hour, which may be useful for testing time-based aggregations.
- The `value` attribute is set to 1.0, which might represent a single event count.
- The `filters` and `grouped_by` attributes are set to empty hashes, allowing for flexibility in testing different aggregation scenarios.

This factory is likely used in test suites to create test data for event count aggregations, possibly for testing billing or analytics features that rely on ClickHouse data.