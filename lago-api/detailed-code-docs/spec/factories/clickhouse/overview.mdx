---
title: "Overview"
---

## High-level description
This directory contains FactoryBot factories for creating test instances of various Clickhouse-related models in a Ruby on Rails application. These factories are designed to generate test data for models that represent aggregated event data stored in a Clickhouse database, which is likely used for analytics and billing purposes.

## What does it do?
These factories provide a convenient way for developers to create test instances of Clickhouse-related models with realistic associations and default values. This allows for easier setup of test scenarios involving aggregated event data, which can be crucial for testing billing, analytics, or reporting features of the application.

The factories cover different types of event aggregations:
1. Event Count Aggregations
2. Enriched Events
3. Maximum Value Aggregations
4. Sum Aggregations

Each factory sets up transient attributes to create associated objects (such as subscriptions, customers, organizations, billable metrics, plans, and charges) and then uses these to populate the attributes of the Clickhouse model instances.

## Key Files

1. `events_count_aggs.rb`: Defines a factory for `Clickhouse::EventsCountAgg` model, representing count-based event aggregations.

2. `events_enriched.rb`: Creates a factory for `Clickhouse::EventsEnriched` model, which represents enriched event data with additional context.

3. `events_max_aggs.rb`: Establishes a factory for `Clickhouse::EventsMaxAgg` model, used for maximum value aggregations of events.

4. `events_sum_aggs.rb`: Defines a factory for `Clickhouse::EventsSumAgg` model, representing sum-based aggregations of event values.

Each of these files follows a similar structure:
- They define a FactoryBot factory named after the corresponding Clickhouse model.
- They set up transient attributes for associated objects.
- They define attributes for the Clickhouse model instance, often using data from the associated objects.
- They provide default values for various fields, such as timestamps, numeric values, and empty hashes for filters and groupings.

## Dependencies
These factories rely on FactoryBot, a popular test data generation library for Ruby on Rails applications. They also indirectly depend on other factories and models within the application, such as:

- Subscription
- Customer
- Organization
- BillableMetric
- Plan
- Charge (or StandardCharge)

The use of these associated models suggests that the application likely deals with subscription-based billing and analytics, possibly for a SaaS (Software as a Service) product.

## Configuration
While there are no explicit configuration files in this directory, the factories themselves serve as a form of configuration for test data generation. Key configurable aspects include:

1. Default values for attributes (e.g., `value: 1.0` for count aggregations, `value: 21.0` for enriched events).
2. Time-based defaults (e.g., `timestamp: Time.current.beginning_of_hour`).
3. Empty hashes for `filters` and `grouped_by` attributes, allowing for flexible testing of different aggregation scenarios.

Developers can easily override these defaults when creating test instances, providing flexibility in setting up various test scenarios.

In summary, this directory contains essential factories for generating test data related to Clickhouse event aggregations. These factories play a crucial role in facilitating thorough testing of analytics and billing features that rely on aggregated event data stored in Clickhouse.