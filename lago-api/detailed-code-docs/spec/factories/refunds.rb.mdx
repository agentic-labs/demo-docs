---
title: "refunds.rb"
---

## High-level description
This file defines a factory for creating `Refund` objects using FactoryBot, a popular Ruby gem for creating test data. The factory sets up default attributes and associations for a refund, including its credit note, payment, payment provider, and customer details.

## Symbols

### `:refund` factory
#### Description
This factory defines the attributes and associations for creating a `Refund` object. It sets up default values for various attributes and establishes associations with related models.

#### Inputs
The factory doesn't have explicit inputs, but it can be customized when used in tests by overriding any of the defined attributes.

#### Outputs
When used, this factory produces a `Refund` object with the specified attributes and associations.

#### Internal Logic
The factory sets up the following attributes and associations:

1. Associates the refund with a `credit_note` (likely another factory).
2. Associates the refund with a `payment` (likely another factory).
3. Sets the `payment_provider` association using the `:stripe_provider` factory.
4. Sets the `payment_provider_customer` association using the `:stripe_customer` factory.
5. Sets the `amount_cents` to 200.
6. Sets the `amount_currency` to 'EUR'.
7. Generates a random UUID for the `provider_refund_id` using `SecureRandom.uuid`.
8. Sets the `status` to 'pending'.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| FactoryBot | Used to define and create test data factories |
| SecureRandom | Used to generate a random UUID for the provider_refund_id |

Note: The factory also depends on other factories (`:stripe_provider` and `:stripe_customer`) which are not defined in this file.

## Configuration
The factory defines default values for several attributes:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| amount_cents | Integer | 200 | The refund amount in cents |
| amount_currency | String | 'EUR' | The currency of the refund amount |
| status | String | 'pending' | The status of the refund |

These defaults can be overridden when creating a refund using this factory in tests.