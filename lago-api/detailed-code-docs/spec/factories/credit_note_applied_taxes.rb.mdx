---
title: "credit_note_applied_taxes.rb"
---

## High-level description
This code defines a factory for creating `CreditNote::AppliedTax` objects using FactoryBot, a popular Ruby gem for creating test data. The factory sets up default attributes for a credit note applied tax, including associations with credit note and tax objects, as well as various tax-related details.

## Symbols

### `factory :credit_note_applied_tax`
#### Description
This factory defines the structure and default values for creating `CreditNote::AppliedTax` objects. It's used to generate test data for credit note applied taxes in a consistent and easily customizable manner.

#### Inputs
The factory doesn't have explicit inputs, but it allows overriding any of the defined attributes when creating an instance.

#### Outputs
When used, this factory produces a `CreditNote::AppliedTax` object with the specified attributes.

#### Internal Logic
The factory sets up the following attributes for each `CreditNote::AppliedTax` object:

1. Associations:
   - `credit_note`: Associates with a credit note object.
   - `tax`: Associates with a tax object.

2. Tax details:
   - `tax_code`: Generates a unique tax code using "vat-" prefix and a UUID.
   - `tax_description`: Sets a default description for the tax.
   - `tax_name`: Sets the name of the tax.
   - `tax_rate`: Sets the tax rate as a float.

3. Amount:
   - `amount_cents`: Sets the tax amount in cents.
   - `amount_currency`: Sets the currency for the tax amount.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| FactoryBot | Used to define and create test data factories |
| SecureRandom | Used to generate unique identifiers for tax codes |

## Notes
- The factory uses the `CreditNote::AppliedTax` class, suggesting that `AppliedTax` is nested within a `CreditNote` module or class.
- The tax code is generated dynamically using `SecureRandom.uuid` to ensure uniqueness.
- The factory sets up a default scenario for a French Standard VAT with a 20% rate and an amount of 200 cents (2 EUR).
- The `credit_note` and `tax` associations are likely defined in separate factories, as they are referenced here without additional details.

This factory provides a convenient way to create `CreditNote::AppliedTax` objects for testing purposes, allowing developers to easily generate test data with consistent defaults while also providing the flexibility to override any attribute as needed.