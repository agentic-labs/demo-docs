---
title: "customer_metadata.rb"
---

## High-level description
This code defines a factory for creating `CustomerMetadata` objects using FactoryBot, a popular Ruby gem for creating test data. The factory is designed to generate sample customer metadata with predefined attributes for testing purposes.

## Symbols

### `factory :customer_metadata`
#### Description
This factory defines how to create a `CustomerMetadata` object, which is an instance of the `Metadata::CustomerMetadata` class. It sets up default values for the attributes of a customer metadata record.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| customer | association | Associates the metadata with a customer |
| key | string | The key of the metadata |
| value | string | The value of the metadata |
| display_in_invoice | boolean | Whether to display this metadata in invoices |

#### Outputs
The factory produces a `Metadata::CustomerMetadata` object with the specified attributes.

#### Internal Logic
1. Associates the metadata with a customer using the `customer` association.
2. Sets the `key` attribute to 'lead_name'.
3. Sets the `value` attribute to 'John Doe'.
4. Sets the `display_in_invoice` attribute to `true`.

## References
This factory references the `Metadata::CustomerMetadata` model, which is defined in the related file `app/models/metadata/customer_metadata.rb`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| FactoryBot | Used to define and create test data factories |

## Notes
1. The factory is defined within the `FactoryBot.define` block, which is the standard way to define factories using FactoryBot.
2. The `class:` option in the factory definition specifies the exact class to be instantiated, which is `Metadata::CustomerMetadata` in this case.
3. The `customer` association suggests that there's a relationship between `CustomerMetadata` and a `Customer` model, which is confirmed by the `belongs_to :customer` association in the related `CustomerMetadata` model.
4. The default values provided in this factory (`'lead_name'`, `'John Doe'`, and `true`) are likely chosen to represent a common use case for customer metadata.
5. The related `CustomerMetadata` model provides additional context:
   - It has validations for `key` and `value` attributes, ensuring presence and maximum length.
   - It has a uniqueness constraint on `key` scoped to `customer_id`.
   - It defines a `displayable` scope for metadata that should be displayed in invoices.
   - There's a constant `COUNT_PER_CUSTOMER` set to 5, which might indicate a limit on metadata entries per customer.

This factory provides a convenient way to create `CustomerMetadata` objects for testing purposes, with sensible defaults that align with the model's validations and common use cases.