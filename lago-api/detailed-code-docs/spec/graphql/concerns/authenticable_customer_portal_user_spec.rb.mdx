---
title: "authenticable_customer_portal_user_spec.rb"
---

## High-level description
This code defines a test suite for the `AuthenticableCustomerPortalUser` concern, which is used in GraphQL resolvers to authenticate customer portal users. The tests verify that the resolver works correctly when a customer portal user is present and returns an error when no user is authenticated.

## Code Structure
The code defines a test module `AuthenticableCustomerPortalUserSpec` containing mock GraphQL types and a test schema. It then uses RSpec to describe the behavior of the `AuthenticableCustomerPortalUser` concern in different contexts.

## References
- `AuthenticableCustomerPortalUser` concern
- `LagoApiSchema`
- `Types::BaseObject`
- `Resolvers::BaseResolver`

## Symbols

### `AuthenticableCustomerPortalUserSpec::ThingType`
#### Description
A mock GraphQL object type representing a "Thing" with a name field.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | String | The name of the thing |

### `AuthenticableCustomerPortalUserSpec::ThingResolver`
#### Description
A mock resolver that includes the `AuthenticableCustomerPortalUser` concern and returns a hash with a name and count.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | String | The name of the thing |
| count | Integer | A count value |

### `AuthenticableCustomerPortalUserSpec::ThingsQueryType`
#### Description
A mock query type that defines a field for the `ThingResolver`.

### `AuthenticableCustomerPortalUserSpec::TestApiSchema`
#### Description
A test GraphQL schema that uses the `ThingsQueryType` as its query type.

### RSpec Test Suite
#### Description
Tests the behavior of the `AuthenticableCustomerPortalUser` concern in different contexts.

#### Internal Logic
1. Defines a GraphQL query to resolve a "thing" and get its name.
2. Tests the resolver with a customer portal user context:
   - Expects the resolver to return the correct data.
3. Tests the resolver without a customer portal user:
   - Expects the resolver to return an unauthorized error.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configurations |

## Error Handling
The test suite verifies that the `AuthenticableCustomerPortalUser` concern properly handles the case when no customer portal user is present by returning an unauthorized error.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| thing | Query | None | `{ name: String }` | Resolves a "thing" object with a name |

This test suite ensures that the `AuthenticableCustomerPortalUser` concern correctly authenticates users in GraphQL resolvers, allowing access to authorized users and denying access to unauthorized requests.