---
title: "auth_url_resolver_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Resolvers::Auth::Google::AuthUrlResolver` GraphQL resolver. It tests the functionality of generating a Google authentication URL and handles error cases when Google authentication is not properly set up.

## Code Structure
The test suite consists of two main test cases: one for successful URL generation and another for error handling when Google authentication is not set up. It uses RSpec's `describe` and `context` blocks to organize the tests.

## Symbols

### `RSpec.describe Resolvers::Auth::Google::AuthUrlResolver`
#### Description
This is the main describe block for the test suite, focusing on the `AuthUrlResolver` class.

### `let(:query)`
#### Description
Defines a GraphQL query to fetch the Google authentication URL.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | String | A GraphQL query string to fetch the Google auth URL |

### `before` block (first occurrence)
#### Description
Sets up environment variables for Google authentication before running the tests.

#### Side Effects
Sets `GOOGLE_AUTH_CLIENT_ID` and `GOOGLE_AUTH_CLIENT_SECRET` environment variables.

### `it 'returns the google auth url'`
#### Description
Tests the successful generation of a Google authentication URL.

#### Internal Logic
1. Executes the GraphQL query using a mock HTTP request.
2. Checks if the returned URL includes the expected Google accounts URL.

### `context 'when google auth is not setup'`
#### Description
A context block for testing the error case when Google authentication is not set up.

### `before` block (second occurrence)
#### Description
Clears the Google authentication environment variables to simulate a missing setup.

#### Side Effects
Sets `GOOGLE_AUTH_CLIENT_ID` and `GOOGLE_AUTH_CLIENT_SECRET` environment variables to `nil`.

### `it 'returns an error'`
#### Description
Tests the error handling when Google authentication is not set up.

#### Internal Logic
1. Executes the GraphQL query using a mock HTTP request.
2. Checks if the response contains the expected error code and status.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configurations |
| Rack::Request | Used to create mock HTTP requests for testing |
| Rack::MockRequest | Used to create mock HTTP environments for testing |

## Error Handling
The test suite checks for proper error handling when Google authentication is not set up, expecting a specific error code and status.