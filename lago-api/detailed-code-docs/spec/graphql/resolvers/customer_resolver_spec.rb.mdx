---
title: "customer_resolver_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Resolvers::CustomerResolver` GraphQL resolver. It tests various scenarios of querying customer data, including associated subscriptions, invoices, applied add-ons, taxes, and credit notes. The tests ensure that the resolver correctly handles different query parameters and returns the expected data structure.

## Code Structure
The test suite is organized around a main customer query and several test cases that verify different aspects of the resolver's functionality. It uses FactoryBot to create test data and includes shared examples for common authorization checks.

## Symbols

### RSpec.describe Resolvers::CustomerResolver
#### Description
This is the main describe block for the CustomerResolver tests. It sets up the test environment, defines the GraphQL query, and contains individual test cases.

#### Internal Logic
1. Sets up test data using FactoryBot
2. Defines a GraphQL query to fetch customer data
3. Includes shared examples for authorization checks
4. Contains individual test cases for different scenarios

### let(:query)
#### Description
Defines the GraphQL query used in the tests to fetch customer data.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | String | A GraphQL query string for fetching customer data |

### it 'returns a single customer'
#### Description
Tests the main functionality of the CustomerResolver by executing the GraphQL query and verifying the returned data.

#### Internal Logic
1. Executes the GraphQL query with test data
2. Verifies various fields in the response, including customer details, associated data counts, and specific field values

### context 'when active and pending subscriptions are requested'
#### Description
Tests the behavior of the resolver when querying for both active and pending subscriptions.

#### Internal Logic
1. Sets up additional test data for pending subscriptions
2. Defines a modified GraphQL query to include pending subscriptions
3. Verifies that the correct number and types of subscriptions are returned

### context 'when customer is not found'
#### Description
Tests the error handling of the resolver when an invalid customer ID is provided.

#### Internal Logic
1. Executes the GraphQL query with an invalid customer ID
2. Verifies that the appropriate error message is returned

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Provides the testing environment and configuration |
| FactoryBot | Used for creating test data |

## Error Handling
The test suite includes a specific test case for handling the scenario when a customer is not found, ensuring that the resolver returns an appropriate error message.

Your response should not exceed 3000 words or 4000 tokens. Focus on providing clear, concise information that can be directly inferred from the code. Include optional sections only when they provide significant value for understanding the code.