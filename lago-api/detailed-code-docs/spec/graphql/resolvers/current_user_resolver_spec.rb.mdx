---
title: "current_user_resolver_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Resolvers::CurrentUserResolver` in a GraphQL API. It tests various scenarios of querying the current user's information, including their memberships, organizations, and handling of revoked memberships. The tests ensure that the resolver correctly returns user data and handles authentication errors.

## Code Structure
The test suite is organized into several describe and context blocks, each focusing on different aspects of the `CurrentUserResolver`. The main symbols are the test cases (it blocks) that verify the resolver's behavior under different conditions.

## Symbols

### RSpec.describe Resolvers::CurrentUserResolver
#### Description
This is the main describe block for the `CurrentUserResolver` tests. It contains all the test cases and nested describe blocks for specific scenarios.

### let(:query)
#### Description
Defines the GraphQL query used in the main test case. It requests the current user's id, email, premium status, and membership details.

### it 'returns current_user'
#### Description
Tests the basic functionality of the `CurrentUserResolver` by creating a user with an admin membership and verifying the returned data.

#### Internal Logic
1. Creates a user and an associated membership
2. Executes the GraphQL query with the created user as the current user
3. Verifies various fields in the response, including email, id, premium status, and membership details

### describe 'with organizations instead of memberships'
#### Description
Tests the resolver's behavior when querying for organizations instead of memberships.

#### Internal Logic
1. Defines a new GraphQL query that includes organizations instead of memberships
2. Creates an organization and a membership
3. Executes the query and verifies that the correct organization ID is returned

### describe 'with revoked membership'
#### Description
Tests the resolver's handling of revoked memberships.

#### Internal Logic
1. Creates a regular membership and a revoked membership for the same user
2. Executes the query and verifies that the revoked membership is not included in the result

### context 'with no current_user'
#### Description
Tests the resolver's behavior when there is no authenticated user.

#### Internal Logic
Executes the query without a current user and expects an unauthorized error

## Dependencies
The test suite relies on the following dependencies:
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Provides the testing environment and configuration |
| FactoryBot | Used for creating test data (users, memberships, organizations) |
| GraphQL | The GraphQL implementation being tested |

## Error Handling
The test suite includes a specific test case for handling unauthorized access when no current user is provided. It uses the `expect_unauthorized_error` method to verify the error response.

## TODOs
There are no explicit TODOs in the code.

This test suite provides comprehensive coverage for the `CurrentUserResolver`, ensuring it correctly handles various scenarios and edge cases in the GraphQL API implementation.