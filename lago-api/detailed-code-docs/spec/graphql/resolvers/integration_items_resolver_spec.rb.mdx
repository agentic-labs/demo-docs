---
title: "integration_items_resolver_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Resolvers::IntegrationItemsResolver` in a GraphQL API. It tests the functionality of querying integration items, including permission checks, error handling, and response structure validation.

## Code Structure
The test suite is organized around a main query and several test cases. It uses shared examples for common checks and defines various let blocks for setting up the test environment.

## Symbols

### RSpec.describe Resolvers::IntegrationItemsResolver
#### Description
This is the main describe block for the test suite, focusing on the `IntegrationItemsResolver`.

#### Internal Logic
The test suite sets up the necessary data using FactoryBot, defines the GraphQL query, and includes shared examples for common checks. It then proceeds to test specific scenarios.

### let blocks
#### Description
These blocks define the setup for the tests, creating necessary objects and data.

#### Inputs
N/A (These are not functions, but RSpec helpers for lazy-loading test data)

#### Outputs
Various test objects including `integration_item`, `integration`, `organization`, `membership`, etc.

### it_behaves_like shared examples
#### Description
These shared examples test common behaviors across different resolvers.

#### Internal Logic
- 'requires current user': Ensures the resolver requires a current user
- 'requires current organization': Checks if the resolver requires a current organization
- 'requires permission': Verifies if the resolver checks for the 'organization:integrations:view' permission

### 'returns a list of integration items' test
#### Description
This test verifies that the resolver correctly returns a list of integration items based on the provided parameters.

#### Internal Logic
1. Executes the GraphQL query with specific variables
2. Checks the response structure and content
3. Verifies the count of returned items and their properties
4. Validates the metadata (currentPage and totalCount)

### 'without integration id' context
#### Description
This context tests the error handling when the integration ID is not provided.

#### Internal Logic
1. Executes the GraphQL query without the integrationId variable
2. Checks for the expected GraphQL error message

## Dependencies
The test file depends on:
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails and RSpec configuration |
| FactoryBot | Creates test data |
| GraphQL | Defines and executes GraphQL queries |

## Error Handling
The test suite includes a specific test for error handling when the integration ID is not provided, expecting a GraphQL error with a specific message.

## TODOs
There are no explicit TODOs in the code.

This test suite provides comprehensive coverage for the `IntegrationItemsResolver`, including permission checks, successful query execution, and error handling. It ensures that the resolver behaves correctly under various scenarios and returns the expected data structure.