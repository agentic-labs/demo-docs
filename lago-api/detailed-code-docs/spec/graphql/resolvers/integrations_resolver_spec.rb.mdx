---
title: "integrations_resolver_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Resolvers::IntegrationsResolver` GraphQL resolver. It tests the functionality of querying integrations, specifically focusing on NetSuite integrations, and ensures proper authorization and data retrieval.

## Code Structure
The test suite is organized into a single `RSpec.describe` block for the `Resolvers::IntegrationsResolver`. It includes shared examples for authorization checks and defines tests for querying integrations with and without type filters.

## References
- `Resolvers::IntegrationsResolver`: The GraphQL resolver being tested.
- `NetsuiteIntegration`: A model representing NetSuite integrations.
- Shared examples: `'requires current user'`, `'requires current organization'`, `'requires permission'`.

## Symbols

### RSpec.describe Resolvers::IntegrationsResolver
#### Description
This is the main test suite for the IntegrationsResolver. It sets up the necessary test data and defines various test cases to ensure the resolver functions correctly.

#### Internal Logic
1. Sets up test data including a membership, organization, and NetSuite integration.
2. Defines a GraphQL query to fetch integrations.
3. Includes shared examples for authorization checks.
4. Tests the resolver's behavior when a type filter is applied.

### let(:query)
#### Description
Defines the GraphQL query used to fetch integrations.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | String | GraphQL query for fetching integrations |

### let(:membership)
#### Description
Creates a test membership using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| membership | Membership | A test membership instance |

### let(:organization)
#### Description
Retrieves the organization associated with the test membership.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The organization associated with the test membership |

### let(:netsuite_integration)
#### Description
Creates a test NetSuite integration associated with the test organization.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| netsuite_integration | NetsuiteIntegration | A test NetSuite integration instance |

### context 'when type is present'
#### Description
Tests the behavior of the resolver when a type filter (netsuite) is applied to the query.

#### Internal Logic
1. Defines a new GraphQL query with a type filter.
2. Executes the GraphQL query with the necessary context (user, organization, permissions).
3. Verifies the response structure and content, including the number of integrations returned, their IDs, and metadata.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| rspec | Testing framework |
| graphql | GraphQL implementation for Ruby |
| FactoryBot | Test data generation |

## Error Handling
The test suite doesn't explicitly test error handling, but it implicitly checks for proper authorization through shared examples.

## TODOs
There are no explicit TODOs in the code.