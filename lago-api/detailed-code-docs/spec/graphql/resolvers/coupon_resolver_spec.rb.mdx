---
title: "coupon_resolver_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Resolvers::CouponResolver` GraphQL resolver. It tests the functionality of querying a single coupon, including its various attributes, and verifies the required permissions and error handling.

## Code Structure
The test suite is organized around a single GraphQL query for fetching a coupon. It sets up necessary test data, defines shared examples for common behaviors, and includes specific tests for successful coupon retrieval and error handling.

## References
This test file references the `Resolvers::CouponResolver` class, which is likely defined elsewhere in the application.

## Symbols

### RSpec.describe Resolvers::CouponResolver
#### Description
This is the main describe block for the test suite, focusing on the `Resolvers::CouponResolver` class.

### let blocks
#### Description
These blocks define variables and objects used throughout the tests, including the GraphQL query, test data (membership, organization, customer, coupon, applied_coupon), and required permissions.

### before block
#### Description
Sets up additional test data, creating a customer, an applied coupon, and two subscriptions.

### Shared examples
#### Description
The test suite includes shared examples for common behaviors:
- `requires current user`
- `requires current organization`
- `requires permission`

These likely test authentication and authorization requirements.

### it 'returns a single coupon'
#### Description
This test verifies that the resolver correctly returns a single coupon with the expected attributes.

#### Internal Logic
1. Executes the GraphQL query with necessary context (current user, organization, permissions).
2. Verifies the returned coupon data matches the expected values.

### context 'when plan is not found'
#### Description
This context block tests the error handling when an invalid coupon ID is provided.

#### Internal Logic
1. Executes the GraphQL query with an invalid coupon ID.
2. Verifies that the appropriate error message is returned.

## Dependencies
The test file depends on the following:
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configurations |
| RSpec | Testing framework |
| FactoryBot | Test data generation |

## Error Handling
The test suite includes a specific test for error handling when a coupon is not found, expecting a "Resource not found" error message.

## TODOs
There are no explicit TODOs in this code.