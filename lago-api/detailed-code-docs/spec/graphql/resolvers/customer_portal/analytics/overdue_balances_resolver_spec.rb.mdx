---
title: "overdue_balances_resolver_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Resolvers::CustomerPortal::Analytics::OverdueBalancesResolver` GraphQL resolver. It verifies that the resolver correctly returns a list of overdue balances for a customer in the customer portal, including the month, amount, invoice IDs, and currency.

## Code Structure
The test suite defines a GraphQL query, sets up necessary test data, and includes a shared example for customer portal user authentication. The main test case creates invoices and checks if the resolver returns the expected overdue balances.

## Symbols

### RSpec.describe Resolvers::CustomerPortal::Analytics::OverdueBalancesResolver
#### Description
This is the main test suite for the OverdueBalancesResolver. It sets up the test environment and defines the test cases.

#### Internal Logic
1. Defines the GraphQL query to be tested
2. Sets up test data (organization, membership, customer)
3. Includes a shared example for customer portal user authentication
4. Defines a test case for returning a list of overdue balances

### let(:query)
#### Description
Defines the GraphQL query used to test the OverdueBalancesResolver.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | String | GraphQL query for fetching overdue balances |

### let(:organization)
#### Description
Creates a test organization with a specific creation date.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | Test organization instance |

### let(:membership)
#### Description
Creates a test membership associated with the test organization.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| membership | Membership | Test membership instance |

### let(:customer)
#### Description
Creates a test customer associated with the test organization and sets the currency to USD.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| customer | Customer | Test customer instance |

### it "returns a list of overdue balances"
#### Description
This test case verifies that the OverdueBalancesResolver correctly returns a list of overdue balances.

#### Internal Logic
1. Sets the current time to February 10, 2024
2. Creates three invoices: one regular and two overdue
3. Executes the GraphQL query with the test customer
4. Checks if the response contains the expected overdue balance data

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| RSpec | Testing framework used for writing and running tests |
| FactoryBot | Used for creating test data (organization, membership, customer, invoices) |
| GraphQL | Used for defining and executing the test query |

## Error Handling
The test case implicitly handles errors by expecting the GraphQL query to execute successfully and return the expected data. Any unexpected errors would cause the test to fail.

## TODOs
- The shared example "requires a customer portal user" is referenced but not defined in this file. It should be implemented in a separate file or included in the test suite.