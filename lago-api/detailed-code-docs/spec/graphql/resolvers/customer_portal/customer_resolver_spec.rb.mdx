---
title: "customer_resolver_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Resolvers::CustomerPortal::CustomerResolver` GraphQL resolver. It verifies the behavior of the `customerPortalUser` query, ensuring it returns the correct customer data and handles authentication properly.

## Code Structure
The test suite defines a GraphQL query and sets up necessary test data using FactoryBot. It then runs tests to verify the resolver's behavior in different scenarios.

## Symbols

### RSpec.describe Resolvers::CustomerPortal::CustomerResolver
#### Description
This is the main describe block for the test suite, focusing on the `CustomerResolver` in the `CustomerPortal` namespace.

### let(:query)
#### Description
Defines the GraphQL query used in the tests, requesting `id`, `name`, and `currency` fields for the `customerPortalUser`.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | String | GraphQL query string |

### let(:membership)
#### Description
Creates a test membership using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| membership | Membership | A test membership object |

### let(:organization)
#### Description
Retrieves the organization associated with the test membership.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The organization of the test membership |

### let(:customer)
#### Description
Creates a test customer associated with the organization and sets a specific currency.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| customer | Customer | A test customer object with EUR currency |

### it_behaves_like 'requires a customer portal user'
#### Description
Includes shared examples to test if the resolver requires a customer portal user for authentication.

### it 'returns a single customer'
#### Description
Tests the successful scenario where a customer portal user is provided, and the resolver returns the correct customer data.

#### Internal Logic
1. Executes the GraphQL query with the test customer as the authenticated user.
2. Verifies that the returned data matches the expected customer information (id, name, and currency).

### context 'without customer portal user'
#### Description
Tests the scenario where no customer portal user is provided.

#### Internal Logic
1. Executes the GraphQL query without providing a customer portal user.
2. Verifies that an unauthorized error is returned.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| FactoryBot | Used for creating test data (membership, customer) |
| GraphQLHelper | Provides helper methods for executing GraphQL queries in tests |

## References
- The test suite references `Resolvers::CustomerPortal::CustomerResolver`, which is the actual implementation being tested.
- It uses shared examples defined elsewhere in the test suite (`requires a customer portal user`).
- The `execute_graphql` and `expect_unauthorized_error` methods are likely defined in the `GraphQLHelper` module.

This test suite ensures that the `CustomerResolver` correctly handles authentication and returns the expected customer data when queried through GraphQL in the customer portal context.