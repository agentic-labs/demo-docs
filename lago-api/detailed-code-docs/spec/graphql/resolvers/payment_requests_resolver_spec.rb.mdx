---
title: "payment_requests_resolver_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Resolvers::PaymentRequestsResolver` GraphQL resolver. It verifies the behavior of the `paymentRequests` query, including permission checks, data retrieval, and response structure.

## Code Structure
The test suite is organized as an RSpec describe block for the `Resolvers::PaymentRequestsResolver`. It includes shared examples for common checks and a main test case for verifying the resolver's functionality.

## Symbols

### RSpec.describe Resolvers::PaymentRequestsResolver
#### Description
This is the main describe block for the test suite, focusing on the `Resolvers::PaymentRequestsResolver` GraphQL resolver.

#### Internal Logic
1. Sets up necessary test data (membership, organization, customer, payment_request)
2. Defines the GraphQL query to be tested
3. Includes shared examples for common checks
4. Implements a specific test case for the `paymentRequests` query

### let(:required_permission)
#### Description
Defines the required permission for accessing payment requests.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to view payment requests |

### let(:query)
#### Description
Defines the GraphQL query to be tested.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | String | The GraphQL query for fetching payment requests |

### let(:membership)
#### Description
Creates a test membership using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| membership | Membership | A test membership instance |

### let(:organization)
#### Description
Retrieves the organization associated with the test membership.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The organization associated with the test membership |

### let(:customer)
#### Description
Creates a test customer associated with the test organization.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| customer | Customer | A test customer instance |

### let(:payment_request)
#### Description
Creates a test payment request associated with the test organization and customer.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| payment_request | PaymentRequest | A test payment request instance |

### before
#### Description
Sets up the test environment by creating the payment request.

### it_behaves_like "requires current user"
#### Description
Includes a shared example to test if the resolver requires a current user.

### it_behaves_like "requires current organization"
#### Description
Includes a shared example to test if the resolver requires a current organization.

### it_behaves_like "requires permission", "payment_requests:view"
#### Description
Includes a shared example to test if the resolver requires the "payment_requests:view" permission.

### it "returns a list of payment_requests"
#### Description
Tests the main functionality of the `paymentRequests` query.

#### Internal Logic
1. Executes the GraphQL query with the necessary context (current user, organization, and permissions)
2. Verifies the response structure and content:
   - Checks the number of returned payment requests
   - Verifies the ID of the first payment request
   - Checks the amount in cents of the first payment request
   - Verifies the customer ID associated with the first payment request
   - Checks that the invoices array is empty for the first payment request

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and RSpec configuration |
| FactoryBot | Used for creating test data (implied by the use of `create` method) |

Note: The actual FactoryBot dependency is not explicitly shown in the provided code but is implied by the use of the `create` method for generating test data.