---
title: "gross_revenues_resolver_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Resolvers::Analytics::GrossRevenuesResolver` GraphQL resolver. It verifies the resolver's behavior, including permission checks and the expected response format for the `grossRevenues` query.

## Code Structure
The test suite defines a set of shared examples for common checks and a specific test case for the `grossRevenues` query. It uses FactoryBot for creating test data and relies on helper methods for executing GraphQL queries.

## References
- `Resolvers::Analytics::GrossRevenuesResolver`
- `FactoryBot`
- Various RSpec shared examples

## Symbols

### RSpec.describe Resolvers::Analytics::GrossRevenuesResolver
#### Description
This is the main describe block for the test suite, focusing on the `GrossRevenuesResolver`.

### let(:required_permission)
#### Description
Defines the required permission for accessing the gross revenues data.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to access gross revenues data |

### let(:query)
#### Description
Defines the GraphQL query used to fetch gross revenues data.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | String | The GraphQL query for fetching gross revenues |

### let(:membership)
#### Description
Creates a test membership using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| membership | Membership | A test membership object |

### let(:organization)
#### Description
Retrieves the organization associated with the test membership.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The organization associated with the test membership |

### it_behaves_like 'requires current user'
#### Description
Includes shared examples to test if the resolver requires a current user.

### it_behaves_like 'requires current organization'
#### Description
Includes shared examples to test if the resolver requires a current organization.

### it_behaves_like 'requires permission', 'analytics:view'
#### Description
Includes shared examples to test if the resolver requires the 'analytics:view' permission.

### it 'returns a list of gross revenues'
#### Description
Tests the execution of the `grossRevenues` query and verifies the response format.

#### Internal Logic
1. Executes the GraphQL query using the `execute_graphql` helper method.
2. Passes the current user, organization, and required permission.
3. Expects the result to contain an empty collection of gross revenues.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| FactoryBot | Creates test data |
| GraphQL | Defines and executes GraphQL queries |

## Error Handling
The test suite relies on RSpec's built-in error handling and assertion mechanisms.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| grossRevenues | QUERY | { currency, externalCustomerId, expireCache } | { collection: [{ month, amountCents, currency, invoicesCount }] } | Fetches gross revenues data |