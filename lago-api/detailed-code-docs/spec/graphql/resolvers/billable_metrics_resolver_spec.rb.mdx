---
title: "billable_metrics_resolver_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Resolvers::BillableMetricsResolver` GraphQL resolver. It verifies the resolver's functionality in retrieving billable metrics, including their filters, and ensures proper authorization and pagination.

## Code Structure
The test suite is organized as a single RSpec describe block for the `Resolvers::BillableMetricsResolver`. It includes shared examples for authorization checks and a main test case for retrieving billable metrics.

## Symbols

### RSpec.describe Resolvers::BillableMetricsResolver
#### Description
This is the main describe block for the test suite, focusing on the `Resolvers::BillableMetricsResolver`.

#### Internal Logic
1. Sets up necessary test data (membership, organization, billable metric, and filters).
2. Defines the GraphQL query to be tested.
3. Includes shared examples for authorization checks.
4. Executes the main test case for retrieving billable metrics.

### let(:required_permission)
#### Description
Defines the required permission for accessing billable metrics.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to view billable metrics |

### let(:query)
#### Description
Defines the GraphQL query used in the test.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| query | String | The GraphQL query for retrieving billable metrics |

### let(:membership)
#### Description
Creates a test membership using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| membership | Membership | A test membership object |

### let(:organization)
#### Description
Retrieves the organization associated with the test membership.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The organization associated with the test membership |

### it 'returns a list of billable metrics'
#### Description
The main test case that verifies the retrieval of billable metrics.

#### Internal Logic
1. Creates a test billable metric and associated filters.
2. Executes the GraphQL query using the `execute_graphql` helper method.
3. Verifies the response structure and content using RSpec expectations.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| FactoryBot | Creates test data |
| GraphQL | Defines and executes GraphQL queries |

## Error Handling
The test case uses RSpec's `aggregate_failures` to group multiple expectations, allowing all assertions to be checked even if some fail.

## API/Interface Reference
| Query | Description |
|:------|:------------|
| billableMetrics | Retrieves a list of billable metrics with their filters and pagination metadata |