---
title: "payment_providers_resolver_spec.rb"
---

## High-level description
This RSpec test file is designed to test the `Resolvers::PaymentProvidersResolver` GraphQL resolver. It verifies the resolver's behavior for querying payment providers, including filtering by type, handling permissions, and protecting sensitive fields.

## Code Structure
The test file is organized into several contexts, each testing different aspects of the `PaymentProvidersResolver`:
1. General behavior and permission checks
2. Filtering by payment provider type
3. Querying all payment providers
4. Handling of protected fields with and without proper permissions

## Symbols

### RSpec.describe Resolvers::PaymentProvidersResolver
#### Description
This is the main test suite for the `PaymentProvidersResolver`. It sets up the necessary test data and defines various test scenarios.

#### Internal Logic
1. Sets up test data including a membership, organization, and different types of payment providers (Adyen, GoCardless, Stripe).
2. Defines GraphQL queries for different test scenarios.
3. Includes shared examples for common behavior checks.
4. Tests different aspects of the resolver in separate contexts.

### Context: "when type is present"
#### Description
Tests the resolver's behavior when a specific payment provider type is requested.

#### Internal Logic
1. Defines a GraphQL query with a `type: stripe` parameter.
2. Executes the query and verifies that only Stripe providers are returned.
3. Checks the metadata for correct pagination information.

### Context: "when type is not present"
#### Description
Tests the resolver's behavior when no specific payment provider type is specified.

#### Internal Logic
1. Defines a GraphQL query without a type parameter.
2. Executes the query and verifies that all types of payment providers are returned.
3. Checks the metadata for correct pagination information.

### Context: "when requesting protected fields"
#### Description
Tests the handling of protected fields with and without the required permissions.

#### Internal Logic
1. Defines a GraphQL query requesting protected fields for each provider type.
2. Tests the query execution without the required permission and verifies that protected fields are filtered out.
3. Tests the query execution with the required permission and verifies that protected fields are included in the response.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Provides the necessary setup for Rails-specific RSpec tests |
| FactoryBot | Used for creating test data |

## Error Handling
The test file doesn't explicitly test error handling but relies on RSpec's built-in expectation system to catch and report any discrepancies between expected and actual results.

## API/Interface Reference
The test file indirectly documents the GraphQL API for querying payment providers:

| Query | Parameters | Description |
|:------|:-----------|:------------|
| paymentProviders | limit, type | Retrieves a list of payment providers, optionally filtered by type |

The response includes a `collection` of payment providers and `metadata` for pagination.

## TODOs
There are no explicit TODOs in this test file.