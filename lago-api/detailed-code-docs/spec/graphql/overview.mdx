---
title: "Overview"
---

## High-level description

This directory contains RSpec test files for a GraphQL API implementation in a Rails application. The tests cover various aspects of the GraphQL schema, including mutations, resolvers, types, and concerns. The codebase appears to be for a billing or subscription management system with features such as customer management, invoicing, payment processing, and analytics.

## What does it do?

The test suite in this directory verifies the functionality of a comprehensive GraphQL API for a billing and subscription management system. It covers the following key areas:

1. Authentication and Authorization: Ensures that API users and customer portal users are properly authenticated and authorized to perform specific actions.

2. Customer Management: Tests the creation, updating, and querying of customer records.

3. Billing and Invoicing: Verifies the creation of invoices, credit notes, and fee adjustments.

4. Subscription Management: Checks the creation, updating, and termination of subscriptions.

5. Payment Provider Integrations: Tests integrations with various payment providers such as Adyen, GoCardless, and Stripe.

6. Analytics: Verifies the retrieval of analytical data such as gross revenues, invoice collections, and MRR.

7. Organization and User Management: Tests invite processes and membership management.

8. Wallet and Payment Transactions: Checks wallet-related operations and payment processing.

9. Webhook Management: Verifies the creation and management of webhook endpoints.

10. GraphQL Schema Integrity: Ensures that the GraphQL schema matches the expected structure and field definitions across various types and entities.

## Entry points

The main entry points for understanding the test structure are:

1. `spec/graphql/mutations/`: Contains tests for GraphQL mutations, organized by feature or entity.
2. `spec/graphql/resolvers/`: Includes tests for GraphQL resolvers, covering various query operations.
3. `spec/graphql/types/`: Tests the structure and field definitions of GraphQL types used in the schema.
4. `spec/graphql/concerns/`: Verifies the behavior of shared concerns used in the GraphQL implementation.
5. `spec/graphql/lago_api_schema_spec.rb`: Ensures that the overall GraphQL schema matches the expected definition.

## Key Files

1. `spec/graphql/lago_api_schema_spec.rb`: Verifies that the current GraphQL schema matches the dumped schema files.
2. `spec/graphql/concerns/authenticable_api_user_spec.rb`: Tests the authentication mechanism for API users.
3. `spec/graphql/concerns/can_require_permissions_spec.rb`: Checks the permission enforcement for GraphQL mutations.
4. `spec/graphql/mutations/auth/`: Contains tests for authentication-related mutations.
5. `spec/graphql/mutations/customers/`: Includes tests for customer management mutations.
6. `spec/graphql/resolvers/analytics/`: Tests resolvers for retrieving analytical data.
7. `spec/graphql/types/organizations/current_organization_type_spec.rb`: Tests the current organization type, which is likely a central part of the application.

## Dependencies

The test suite relies on the following key dependencies:

1. RSpec: The testing framework used for writing and running the tests.
2. Rails: The application framework, with `rails_helper` being used to load the testing environment and configurations.
3. GraphQL-Ruby: The GraphQL implementation for Ruby, used for defining the schema, types, and executing queries.
4. FactoryBot: Used for creating test data and fixtures.
5. Custom GraphQL testing matchers: The tests use matchers like `have_field` and `accept_argument`, which are likely provided by a GraphQL testing library.

## Configuration

While there are no explicit configuration files in the `spec/graphql` directory, the tests rely on the broader Rails and RSpec configuration. Key configuration elements include:

1. RSpec configuration: Tests are typically marked as `type: :graphql`.
2. Shared examples: Used for common checks like authentication and permission requirements.
3. Factory definitions: Used to create test data consistently across tests.
4. GraphQL schema and type definitions: The tests verify against the expected schema structure.
5. Custom helpers and configurations: Likely defined in support files (e.g., `spec/support/graphql_helper.rb`).

The test suite plays a crucial role in ensuring the reliability, correctness, and consistency of the GraphQL API across various functionalities of the billing and subscription management system. It provides a comprehensive safety net for future changes and helps maintain the integrity of the API.