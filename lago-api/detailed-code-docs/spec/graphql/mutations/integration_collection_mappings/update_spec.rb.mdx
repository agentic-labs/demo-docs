---
title: "update_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Mutations::IntegrationCollectionMappings::Update` GraphQL mutation. It verifies the functionality of updating an integration collection mapping, including permission checks and data validation.

## Code Structure
The test suite is organized as a single RSpec describe block, containing several let statements for setup and a main test case. It also includes shared examples for common permission checks.

## Symbols

### RSpec.describe Mutations::IntegrationCollectionMappings::Update
#### Description
This is the main test suite for the Update mutation of IntegrationCollectionMappings. It sets up the necessary test data and defines the test cases.

#### Internal Logic
1. Sets up test data using `let` statements
2. Defines the GraphQL mutation query
3. Includes shared examples for permission checks
4. Defines a test case for updating a NetSuite integration

### let statements
#### Description
These statements define the test data and variables used throughout the test suite.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to perform the update |
| integration_collection_mapping | Object | The collection mapping to be updated |
| integration | Object | The integration associated with the mapping |
| mapping_type | String | A randomly selected mapping type |
| organization | Object | The organization associated with the membership |
| membership | Object | A membership object |
| external_account_code | String | A randomly generated account code |
| external_id | String | A randomly generated UUID |
| external_name | String | A randomly generated department name |

### mutation
#### Description
Defines the GraphQL mutation query used to update the integration collection mapping.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutation | String | The GraphQL mutation query |

### Shared Examples
#### Description
The test suite includes shared examples for common permission checks.

1. `requires current user`
2. `requires current organization`
3. `requires permission`

### Main Test Case: 'updates a netsuite integration'
#### Description
This test case verifies that the mutation successfully updates a NetSuite integration collection mapping.

#### Internal Logic
1. Executes the GraphQL mutation with the necessary input data
2. Retrieves the result data from the mutation response
3. Uses `aggregate_failures` to group multiple expectations
4. Verifies that the updated fields match the input data

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| RSpec | Testing framework |
| FactoryBot | Used for creating test data |
| Faker | Generates random test data |

## Error Handling
The test case uses `aggregate_failures` to group multiple expectations, allowing all assertions to be checked even if one fails.