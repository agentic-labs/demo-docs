---
title: "terminate_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Mutations::Wallets::Terminate` GraphQL mutation. It verifies that the mutation correctly terminates a customer's wallet, ensuring proper authentication, authorization, and expected behavior.

## Code Structure
The test suite is organized as a single RSpec describe block for the `Mutations::Wallets::Terminate` mutation. It sets up necessary test data, defines the GraphQL mutation, and includes shared examples for authentication and authorization checks before testing the main functionality.

## Symbols

### RSpec.describe Mutations::Wallets::Terminate
#### Description
This is the main test suite for the `Terminate` mutation in the `Mutations::Wallets` namespace. It sets up the test environment and defines the test cases.

#### Internal Logic
1. Sets up test data using FactoryBot (let blocks for membership, organization, customer, subscription, and wallet).
2. Defines the GraphQL mutation string.
3. Includes shared examples for authentication and authorization checks.
4. Tests the main functionality of terminating a wallet.

### let blocks
#### Description
These blocks define the test data used throughout the test suite.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to execute the mutation |
| membership | Membership | A factory-created membership object |
| organization | Organization | The organization associated with the membership |
| customer | Customer | A factory-created customer associated with the organization |
| subscription | Subscription | A factory-created subscription for the customer |
| wallet | Wallet | A factory-created wallet for the customer |

### mutation
#### Description
Defines the GraphQL mutation string used to terminate a customer's wallet.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutation | String | The GraphQL mutation string for terminating a wallet |

### it 'terminates a wallet'
#### Description
This test case verifies that the mutation correctly terminates a wallet.

#### Internal Logic
1. Executes the GraphQL mutation with the necessary inputs and permissions.
2. Checks the returned data for correctness:
   - Verifies the returned wallet ID matches the input.
   - Checks that the wallet name is correct.
   - Ensures the wallet status is set to 'terminated'.
   - Confirms that a termination timestamp is present.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| RSpec | Testing framework used for writing and running the tests |
| FactoryBot | Used for creating test data objects |
| GraphQL | The query language being tested |

## Error Handling
This test suite doesn't explicitly test error handling. It focuses on the happy path where the wallet termination is successful.

## Notes
1. The test suite uses shared examples for checking authentication and authorization, which are likely defined in a separate file.
2. The `execute_graphql` method is not defined in this file and is likely a helper method defined elsewhere in the test suite.
3. The test assumes the existence of factories for creating test data objects (membership, customer, subscription, wallet).
4. The test doesn't verify any side effects of wallet termination beyond the returned data. Additional tests might be needed to ensure any related business logic is correctly applied.