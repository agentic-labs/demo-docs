---
title: "create_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Mutations::BillableMetrics::Create` GraphQL mutation. It verifies the behavior of creating a billable metric, including permission checks and the correct handling of input parameters.

## Code Structure
The test suite is organized as an RSpec describe block for the `Mutations::BillableMetrics::Create` mutation. It includes shared examples for common checks and a main test case for creating a billable metric.

## Symbols

### RSpec.describe Mutations::BillableMetrics::Create
#### Description
This is the main describe block for testing the `Mutations::BillableMetrics::Create` GraphQL mutation.

#### Internal Logic
1. Sets up necessary let variables for the tests.
2. Defines the GraphQL mutation query.
3. Includes shared examples for common checks.
4. Contains a main test case for creating a billable metric.

### let(:required_permission)
#### Description
Defines the required permission for creating a billable metric.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to create a billable metric |

### let(:membership)
#### Description
Creates a test membership object.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| membership | Membership | A test membership object |

### let(:mutation)
#### Description
Defines the GraphQL mutation query for creating a billable metric.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutation | String | The GraphQL mutation query for creating a billable metric |

### it 'creates a billable metric'
#### Description
Tests the creation of a billable metric using the GraphQL mutation.

#### Internal Logic
1. Executes the GraphQL mutation with test input data.
2. Verifies the response data matches the expected output.
3. Checks various attributes of the created billable metric.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |

## Error Handling
The test case uses `aggregate_failures` to group multiple expectations, allowing all assertions to be checked even if some fail.

___

This test file ensures that the `Mutations::BillableMetrics::Create` GraphQL mutation correctly creates a billable metric with the provided input parameters. It verifies the presence and correctness of various fields in the response, including id, name, code, organization, aggregation type, recurring status, weighted interval, and filters. The test also includes shared examples to check for required permissions and the presence of a current user and organization.