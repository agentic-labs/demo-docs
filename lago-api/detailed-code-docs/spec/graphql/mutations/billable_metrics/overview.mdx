---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for GraphQL mutations related to billable metrics. The tests cover the creation, updating, and deletion of billable metrics through GraphQL mutations. These tests ensure that the mutations behave correctly, handle permissions appropriately, and produce the expected results.

## What does it do?
The tests in this directory verify the functionality of GraphQL mutations for managing billable metrics. They simulate various scenarios such as:

1. Creating a new billable metric with specific attributes
2. Updating an existing billable metric's properties
3. Deleting a billable metric

The tests check that these operations can only be performed by users with the correct permissions, and that the mutations return the expected data structures. They also verify that the changes are correctly reflected in the database.

## Key Files
1. `create_spec.rb`: Tests the creation of billable metrics
   - Verifies that a new billable metric can be created with the correct attributes
   - Checks that the response includes all expected fields (id, name, code, organization, etc.)

2. `update_spec.rb`: Tests the updating of existing billable metrics
   - Ensures that a billable metric's properties can be modified
   - Verifies that the updated values are correctly reflected in the response

3. `destroy_spec.rb`: Tests the deletion of billable metrics
   - Confirms that a billable metric can be successfully deleted
   - Checks that the mutation returns the ID of the deleted metric

Each of these files follows a similar structure:
- They define the required permissions for the operation
- Set up test data using FactoryBot
- Define the GraphQL mutation query
- Include shared examples for common checks (e.g., user authentication, permissions)
- Contain specific test cases for the mutation's functionality

## Dependencies
The test files rely on the following key dependencies:

1. RSpec: The testing framework used for writing and running the tests
2. GraphQL: The GraphQL implementation for Ruby, used to define and execute the mutation queries
3. FactoryBot: A library for setting up test data, used to create test objects like memberships and billable metrics

## Configuration
The tests use the Rails testing environment, which is likely configured in the `spec/rails_helper.rb` file (not provided in the given code snippets). This file would typically set up the testing environment, including database cleaner strategies and other RSpec configurations.

The tests also make use of shared examples and helper methods (e.g., `execute_graphql`), which are likely defined in support files not shown in the provided code.

Key configuration aspects include:

1. Permission settings: Each mutation has a `required_permission` defined, such as `'billable_metrics:create'` or `'billable_metrics:delete'`.
2. Test data setup: The tests use FactoryBot to create test objects, configuring them with specific attributes as needed for each test case.
3. GraphQL query definitions: Each test file defines a GraphQL mutation query string, which is used to test the corresponding mutation.

These tests play a crucial role in ensuring the reliability and correctness of the billable metrics GraphQL API, covering the full CRUD (Create, Read, Update, Delete) lifecycle of billable metric objects.