---
title: "update_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Mutations::BillableMetrics::Update` GraphQL mutation. It verifies the functionality of updating a billable metric, including permission checks and the correct handling of input parameters.

## Code Structure
The test suite is organized as an RSpec describe block for the `Mutations::BillableMetrics::Update` mutation. It includes shared examples for permission checks and a main test case for updating a billable metric.

## Symbols

### RSpec.describe Mutations::BillableMetrics::Update
#### Description
This is the main describe block for the test suite, focusing on the `Update` mutation for billable metrics.

#### Internal Logic
1. Sets up necessary test data (membership, billable metric)
2. Defines the GraphQL mutation query
3. Includes shared examples for permission checks
4. Contains a test case for updating a billable metric

### let(:required_permission)
#### Description
Defines the required permission for updating billable metrics.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to update billable metrics |

### let(:membership)
#### Description
Creates a test membership object.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| membership | Membership | A test membership object |

### let(:billable_metric)
#### Description
Creates a test weighted sum billable metric associated with the membership's organization.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| billable_metric | BillableMetric | A test weighted sum billable metric |

### let(:mutation)
#### Description
Defines the GraphQL mutation query for updating a billable metric.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutation | String | The GraphQL mutation query for updating a billable metric |

### it 'updates a billable metric'
#### Description
Tests the functionality of updating a billable metric through the GraphQL mutation.

#### Internal Logic
1. Executes the GraphQL mutation with test input data
2. Verifies the response data matches the expected updated values
3. Checks various attributes of the updated billable metric, including name, code, organization, aggregation type, weighted interval, recurring status, and filters

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and RSpec configuration |

## Error Handling
The test case uses `aggregate_failures` to group multiple expectations, allowing all assertions to be checked even if some fail.

This documentation provides a comprehensive overview of the test file, explaining its purpose, structure, and key components. It focuses on the main test case for updating a billable metric and includes relevant details about the test setup and expectations.