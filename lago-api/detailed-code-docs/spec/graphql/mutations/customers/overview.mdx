---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for GraphQL mutations related to customer operations in the Lago application. The tests cover creating, updating, and deleting customers, as well as updating specific customer attributes like invoice grace period. These tests ensure that the GraphQL mutations function correctly, handle permissions appropriately, and manage both standard and premium features.

## What does it do?
The test suite in this directory verifies the functionality of GraphQL mutations for customer-related operations. It checks that:

1. New customers can be created with various attributes, including premium features when enabled.
2. Existing customers can be updated, with different sets of attributes depending on user permissions and premium feature status.
3. Customers can be deleted successfully.
4. Specific customer attributes, like invoice grace period, can be updated independently.

The tests also ensure that these operations require proper authentication and permissions, and that they handle validation errors correctly.

## Key Files
1. `create_spec.rb`: Tests the creation of new customers through GraphQL mutation.
2. `update_spec.rb`: Verifies the updating of existing customer information.
3. `destroy_spec.rb`: Ensures customers can be deleted correctly.
4. `update_invoice_grace_period_spec.rb`: Tests the specific mutation for updating a customer's invoice grace period.

Each file contains a set of RSpec tests that cover various scenarios and edge cases for their respective mutations.

## Dependencies
The test suite relies on several key dependencies:

1. RSpec: The testing framework used for writing and running the tests.
2. FactoryBot: Used for creating test data and objects.
3. GraphQL: The GraphQL implementation for Ruby, used to define and execute the mutations being tested.
4. WebMock: Used for stubbing HTTP requests, particularly for mocking Stripe API calls.

## Configuration
The tests use various configuration settings and helper methods:

1. `rails_helper`: Loads the Rails testing environment and configurations.
2. `lago_premium!`: A method used to enable premium features for specific tests.
3. Shared examples: Used for common checks like requiring a current user or specific permissions.

The tests also make use of let statements to set up test data and variables, including:

- `required_permissions`: Specifies the permissions needed for each operation.
- `membership` and `organization`: Set up the context for the current user.
- `customer`: Creates a test customer object.
- `stripe_provider`: Sets up a mock Stripe provider for payment-related tests.

## Error Handling
The test suite includes scenarios for handling validation errors and permission checks. For example, in `create_spec.rb`, there's a specific context for testing validation errors when invalid input is provided. The tests ensure that the mutations return appropriate error responses in these cases.

In summary, this directory contains a comprehensive set of tests that ensure the reliability and correctness of customer-related GraphQL mutations in the Lago application, covering both basic functionality and more complex scenarios involving permissions and premium features.