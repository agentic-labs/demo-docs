---
title: "destroy_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Mutations::Customers::Destroy` GraphQL mutation. It verifies that the mutation correctly deletes a customer, requires proper user authentication, and checks for the necessary permissions.

## Code Structure
The test suite defines a set of let variables to set up the test environment and a GraphQL mutation query. It then uses shared examples for common authentication checks and includes a specific test for customer deletion.

## Symbols

### RSpec.describe Mutations::Customers::Destroy
#### Description
This is the main describe block for the test suite, focusing on the `Mutations::Customers::Destroy` GraphQL mutation.

### let variables
#### Description
These variables set up the test environment with necessary objects and data.

| Name | Type | Description |
|:-----|:-----|:------------|
| required_permissions | String | The permission required to delete a customer |
| membership | Membership | A factory-created membership object |
| organization | Organization | The organization associated with the membership |
| customer | Customer | A factory-created customer associated with the organization |
| mutation | String | The GraphQL mutation query for destroying a customer |

### it_behaves_like 'requires current user'
#### Description
This shared example ensures that the mutation requires a current user to be present.

### it_behaves_like 'requires permission', 'customers:delete'
#### Description
This shared example verifies that the mutation requires the 'customers:delete' permission.

### it 'deletes a customer'
#### Description
This test case verifies that the mutation successfully deletes a customer.

#### Internal Logic
1. Executes the GraphQL mutation with the necessary inputs (current user, permissions, query, and variables).
2. Checks the result to ensure the deleted customer's ID matches the input customer's ID.

## Dependencies
The test suite relies on the following dependencies:
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Provides the necessary setup for Rails-specific testing |
| RSpec | The testing framework used |
| FactoryBot | Used for creating test objects (implied by the use of `create` method) |

## Configuration
The test suite uses the following configuration:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| type: :graphql | Symbol | N/A | Specifies that this is a GraphQL-related test |

## Error Handling
The test implicitly checks for error handling by expecting the mutation to succeed when proper authentication and permissions are provided. Specific error cases are not explicitly tested in this file.

## API/Interface Reference
The test suite is checking the following GraphQL mutation:
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| destroyCustomer | Mutation | DestroyCustomerInput | ID | Deletes a customer and returns its ID |

This documentation provides a comprehensive overview of the `spec/graphql/mutations/customers/destroy_spec.rb` file, explaining its purpose, structure, and key components without exceeding the specified word limit.