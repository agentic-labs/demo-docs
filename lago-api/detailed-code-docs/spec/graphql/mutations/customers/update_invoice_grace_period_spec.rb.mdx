---
title: "update_invoice_grace_period_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Mutations::Customers::UpdateInvoiceGracePeriod` GraphQL mutation. It verifies the functionality of updating a customer's invoice grace period, including permission checks and the correct execution of the mutation.

## Code Structure
The test suite is organized as an RSpec describe block for the `Mutations::Customers::UpdateInvoiceGracePeriod` mutation. It includes shared examples for permission checks and a specific test case for updating a customer's invoice grace period.

## Symbols

### RSpec.describe Mutations::Customers::UpdateInvoiceGracePeriod
#### Description
This is the main describe block that groups all the tests for the UpdateInvoiceGracePeriod mutation.

### let blocks
#### Description
These blocks define variables used throughout the tests, including required permissions, membership, organization, customer, and the GraphQL mutation query.

### around block
#### Description
This block wraps each test in a lago_premium! context, likely enabling premium features for testing.

### Shared examples
#### Description
Two shared example groups are included to test common behaviors:
1. 'requires current user'
2. 'requires permission'

These ensure that the mutation requires a current user and specific permissions to execute.

### 'updates a customer' test
#### Description
This test verifies that the mutation successfully updates a customer's invoice grace period.

#### Internal Logic
1. Executes the GraphQL mutation with specific inputs (customer ID and new invoice grace period).
2. Checks the result data to ensure the update was successful.
3. Uses aggregate_failures to group multiple expectations.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| current_user | User | The user executing the mutation |
| permissions | String | The required permissions |
| query | String | The GraphQL mutation query |
| variables | Hash | Input variables for the mutation |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Hash | The GraphQL response containing updated customer data |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and RSpec configurations |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| type | Symbol | :graphql | Specifies the type of RSpec test |

Note: This test file is part of a larger Rails application using GraphQL and RSpec for testing. It assumes the existence of certain factories, helpers, and shared examples that are not directly visible in this file.