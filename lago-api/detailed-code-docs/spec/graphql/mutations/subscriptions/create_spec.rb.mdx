---
title: "create_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Mutations::Subscriptions::Create` GraphQL mutation. It verifies the functionality of creating a subscription, including permission checks, input validation, and the correct structure of the returned data.

## Code Structure
The test suite is organized around a single describe block for the `Mutations::Subscriptions::Create` mutation. It uses let statements to set up test data and defines a GraphQL mutation query. The main test case checks the creation of a subscription with various attributes and plan overrides.

## Symbols

### `RSpec.describe Mutations::Subscriptions::Create, type: :graphql`
#### Description
This is the main describe block that groups all the tests for the `Mutations::Subscriptions::Create` mutation.

### `let` statements
#### Description
These statements define test data and variables used throughout the test suite.

### `around { |test| lago_premium!(&test) }`
#### Description
This hook ensures that the tests are run in the context of a premium Lago account.

### `it_behaves_like` statements
#### Description
These shared examples test common behaviors such as requiring a current user, current organization, and specific permissions.

### `it 'creates a subscription'`
#### Description
This is the main test case that verifies the creation of a subscription through the GraphQL mutation.

#### Internal Logic
1. Executes the GraphQL mutation with specific input data.
2. Checks the returned data for correctness, including subscription details, customer information, and plan details.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails and RSpec configuration |

## Configuration
The test suite uses several configuration options defined in the `rails_helper.rb` file, including:

| Option | Description |
|:-------|:------------|
| `config.include GraphQLHelper, type: :graphql` | Includes GraphQL-specific helper methods |
| `config.include LicenseHelper` | Includes license-related helper methods |

## TODOs
There are no explicit TODOs in the code.

This test suite provides comprehensive coverage for the subscription creation mutation, ensuring that it handles various inputs correctly and returns the expected data structure. It also verifies that the mutation respects permission requirements and organization context.