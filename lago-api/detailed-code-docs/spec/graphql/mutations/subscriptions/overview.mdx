---
title: "Overview"
---

## High-level description
This directory contains RSpec test suites for GraphQL mutations related to subscription management in the Lago application. The tests cover three main operations: creating, terminating, and updating subscriptions. These test files ensure that the GraphQL mutations behave correctly, handle permissions appropriately, and return the expected data structures.

## What does it do?
The test suites in this directory verify the functionality of GraphQL mutations for subscription management. Here's a breakdown of what each test file covers:

1. Creating a subscription: This test ensures that users can create new subscriptions with various attributes and plan overrides. It checks if the mutation respects permission requirements and returns the correct subscription details.

2. Terminating a subscription: This test verifies that users can terminate existing subscriptions. It checks if the mutation updates the subscription status to 'terminated' and sets a termination date.

3. Updating a subscription: This test confirms that users can modify existing subscriptions, such as changing the subscription name. It verifies that the mutation requires proper permissions and returns the updated subscription data.

These tests help ensure that the subscription management features of the Lago application work correctly and maintain data integrity.

## Key Files
1. `create_spec.rb`: Tests the creation of new subscriptions.
2. `terminate_spec.rb`: Tests the termination of existing subscriptions.
3. `update_spec.rb`: Tests the updating of existing subscriptions.

Each of these files contains a set of RSpec tests that verify the behavior of their respective GraphQL mutations.

## Dependencies
The test suites rely on the following dependencies:

1. RSpec: The testing framework used for writing and running the tests.
2. FactoryBot: Used for creating test data, such as memberships and subscriptions.
3. GraphQL: The GraphQL implementation for Ruby, used to define and execute the mutation queries.

These dependencies are likely managed through the project's Gemfile, although the specific versions are not mentioned in the provided summaries.

## Configuration
The test suites use several configuration options, primarily defined in the `rails_helper.rb` file:

1. `config.include GraphQLHelper, type: :graphql`: Includes GraphQL-specific helper methods for the tests.
2. `config.include LicenseHelper`: Includes license-related helper methods.

Additionally, the tests use shared examples and hooks to set up common test scenarios:

- `around { |test| lago_premium!(&test) }`: Ensures that tests run in the context of a premium Lago account.
- `it_behaves_like 'requires current user'`: Checks if the mutation requires a current user.
- `it_behaves_like 'requires permission'`: Verifies if the mutation requires specific permissions.

These configuration options and shared examples help maintain consistency across the test suites and reduce code duplication.

In summary, this directory contains comprehensive test coverage for the subscription-related GraphQL mutations in the Lago application, ensuring that these critical operations function correctly and securely.