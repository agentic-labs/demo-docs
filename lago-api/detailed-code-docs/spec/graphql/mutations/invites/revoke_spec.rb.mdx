---
title: "revoke_spec.rb"
---

## High-level description
This RSpec test file describes the behavior of the `Mutations::Invites::Revoke` GraphQL mutation. It verifies that the mutation correctly revokes an invite, handles permissions, and manages different invite statuses.

## Code Structure
The test file is organized into several contexts and examples that test different aspects of the invite revocation mutation. It uses shared examples for common behaviors and defines specific test cases for successful revocation and error handling.

## Symbols

### RSpec.describe Mutations::Invites::Revoke
#### Description
This is the main describe block for the `Mutations::Invites::Revoke` GraphQL mutation tests.

#### Internal Logic
- Sets up necessary let variables for the tests
- Defines the GraphQL mutation query
- Includes shared examples for common behaviors
- Contains specific test cases for invite revocation

### let(:mutation)
#### Description
Defines the GraphQL mutation query for revoking an invite.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutation | String | GraphQL mutation query for revoking an invite |

### Context: 'with an existing invite'
#### Description
Tests the successful revocation of an existing invite.

#### Internal Logic
1. Creates an invite for the organization
2. Executes the GraphQL mutation with the invite ID
3. Verifies that the returned data matches the expected revoked invite details

### Context: 'when the invite accepted'
#### Description
Tests the error handling when trying to revoke an already accepted invite.

#### Internal Logic
1. Creates an accepted invite for the organization
2. Executes the GraphQL mutation with the accepted invite ID
3. Verifies that the appropriate error message and details are returned

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| RSpec | Testing framework used for writing and running tests |
| FactoryBot | Used for creating test data (invites, memberships, etc.) |
| GraphQL | The API technology being tested |

## Error Handling
The test file includes a specific test case for handling errors when attempting to revoke an already accepted invite. It verifies that the correct error message, code, and details are returned.

## API/Interface Reference
| Mutation | Input | Output | Description |
|:---------|:------|:-------|:------------|
| revokeInvite | RevokeInviteInput (containing invite ID) | Revoked invite details (id, status, revokedAt) | Revokes an existing invite |

Your response should not exceed 3000 words or 4000 tokens. Focus on providing clear, concise information that can be directly inferred from the code. Include optional sections only when they provide significant value for understanding the code.