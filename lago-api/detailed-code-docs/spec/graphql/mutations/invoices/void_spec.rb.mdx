---
title: "void_spec.rb"
---

## High-level description
This RSpec test file describes the behavior of the `Mutations::Invoices::Void` GraphQL mutation. It verifies that the mutation correctly voids an invoice, checks for required permissions, and ensures the proper response structure.

## Code Structure
The test file defines a set of let statements to set up the test environment, a GraphQL mutation query, and a main test case. It also includes shared examples for common authorization checks.

## Symbols

### RSpec.describe Mutations::Invoices::Void
#### Description
This is the main describe block for the test suite, focusing on the `Mutations::Invoices::Void` GraphQL mutation.

### let statements
#### Description
These statements set up the test environment by creating necessary objects and defining the GraphQL mutation query.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to void an invoice |
| membership | Membership | A factory-created membership object |
| organization | Organization | The organization associated with the membership |
| customer | Customer | A factory-created customer associated with the organization |
| invoice | Invoice | A factory-created finalized invoice associated with the customer and organization |
| mutation | String | The GraphQL mutation query for voiding an invoice |

### it_behaves_like shared examples
#### Description
These shared examples test common authorization scenarios.

#### Internal Logic
1. 'requires current user': Ensures the mutation requires a logged-in user
2. 'requires current organization': Verifies the mutation requires a current organization context
3. 'requires permission': Checks if the user has the 'invoices:void' permission

### Main test case: 'voids the given invoice'
#### Description
This test case verifies that the mutation successfully voids the given invoice and returns the expected response.

#### Internal Logic
1. Freezes time to ensure consistent timestamps
2. Executes the GraphQL mutation with the necessary inputs and context
3. Verifies the response structure and content
4. Checks that the returned invoice ID is present
5. Ensures the returned invoice status is 'voided'

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| RSpec | Testing framework used for writing and running tests |
| FactoryBot | Used for creating test objects (e.g., membership, customer, invoice) |
| GraphQL | The API query language being tested |

## Error Handling
This test file doesn't explicitly test error handling scenarios. It focuses on the happy path where the invoice is successfully voided.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| voidInvoice | Mutation | VoidInvoiceInput | Invoice | Voids the specified invoice |

The `VoidInvoiceInput` is expected to contain the `id` of the invoice to be voided. The response includes the `id` and `status` of the voided invoice.