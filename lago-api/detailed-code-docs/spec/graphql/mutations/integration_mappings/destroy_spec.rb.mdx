---
title: "destroy_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Mutations::IntegrationMappings::Destroy` GraphQL mutation. It verifies the functionality of deleting an integration mapping, including permission checks and error handling for non-existent mappings.

## Code Structure
The test suite defines a set of shared contexts and examples, then proceeds to test the mutation's behavior under different scenarios.

## Symbols

### RSpec.describe Mutations::IntegrationMappings::Destroy
#### Description
This is the main describe block for the test suite, focusing on the `Destroy` mutation for integration mappings.

### let blocks
#### Description
These blocks define shared variables and objects used across the test cases.

| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to perform the mutation |
| integration_mapping | IntegrationMapping | The mapping object to be deleted |
| integration | Integration | The integration associated with the mapping |
| organization | Organization | The organization associated with the membership |
| membership | Membership | A membership object for the test user |
| mutation | String | The GraphQL mutation query |

### before block
#### Description
This block ensures the `integration_mapping` is created before running the tests.

### it 'deletes an integration mapping'
#### Description
This test case verifies that the mutation successfully deletes an integration mapping.

#### Internal Logic
1. Executes the GraphQL mutation with the necessary context and variables.
2. Expects the count of `IntegrationMappings::BaseMapping` to decrease by 1.

### Shared examples
#### Description
The test suite includes shared example groups to test common behaviors:
- `requires current user`
- `requires current organization`
- `requires permission`

### context 'when integration mapping is not found'
#### Description
This context tests the error handling when trying to delete a non-existent mapping.

#### Internal Logic
1. Executes the GraphQL mutation with an invalid ID.
2. Expects a "not found" error to be returned.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails and RSpec configuration |
| graphql | Testing GraphQL mutations |
| FactoryBot | Creating test data |

## Error Handling
The test suite includes a specific test case for handling the scenario when an integration mapping is not found, expecting a "not found" error to be returned.