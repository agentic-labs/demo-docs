---
title: "update_spec.rb"
---

## High-level description
This RSpec test file describes the behavior of the `Mutations::PaymentProviders::Gocardless::Update` GraphQL mutation. It tests the functionality of updating a GoCardless payment provider, including permission checks and handling of the success redirect URL.

## Code Structure
The test file defines a set of RSpec examples that verify the behavior of the GoCardless payment provider update mutation. It uses shared examples for common checks and defines specific test cases for updating the provider's attributes.

## Symbols

### RSpec.describe Mutations::PaymentProviders::Gocardless::Update
#### Description
This is the main describe block for the test suite, focusing on the GoCardless payment provider update mutation.

#### Internal Logic
- Sets up necessary test data and mocks
- Defines shared examples for permission checks
- Tests the update functionality of the GoCardless provider
- Checks the behavior when the success redirect URL is set to nil

### let(:required_permission)
#### Description
Defines the required permission for updating the GoCardless payment provider.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to update the provider |

### let(:oauth_client), let(:auth_code_strategy), let(:access_token)
#### Description
These `let` blocks set up mock objects for OAuth2 authentication, which are used to simulate the OAuth flow in the tests.

### let(:membership), let(:gocardless_provider)
#### Description
These `let` blocks create test data for a membership and a GoCardless provider associated with the membership's organization.

### let(:mutation)
#### Description
Defines the GraphQL mutation string used in the tests.

### before block
#### Description
Sets up the test environment by configuring mock objects and creating the GoCardless provider.

### it_behaves_like shared examples
#### Description
Uses shared examples to test common behaviors such as requiring a current user, current organization, and specific permissions.

### Main test case
#### Description
Tests the successful update of a GoCardless provider, including setting a new success redirect URL.

### Context: when success redirect url is nil
#### Description
Tests the behavior when updating the GoCardless provider with a nil success redirect URL.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Provides the necessary setup for Rails-specific RSpec tests |
| OAuth2::Client | Used to mock OAuth2 authentication flow |
| FactoryBot | Used to create test data (membership and provider) |

## Error Handling
The test suite doesn't explicitly test error handling but implicitly checks for correct behavior in various scenarios.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| updateGocardlessPaymentProvider | Mutation | UpdateGocardlessPaymentProviderInput | Provider ID and successRedirectUrl | Updates a GoCardless payment provider |

Note: This test file is checking the behavior of a GraphQL mutation, not defining the API itself. The actual API is implemented elsewhere in the application.