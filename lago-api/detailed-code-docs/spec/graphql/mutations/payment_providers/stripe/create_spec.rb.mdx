---
title: "create_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Mutations::PaymentProviders::Stripe::Create` GraphQL mutation. It verifies the functionality of creating a Stripe payment provider, including permission checks and the correct handling of input data.

## Code Structure
The test suite is organized as a single RSpec describe block, containing several shared examples and a main test case. It uses let statements to define variables and a GraphQL mutation string.

## Symbols

### RSpec.describe Mutations::PaymentProviders::Stripe::Create
#### Description
This is the main describe block for the test suite, focusing on the Stripe payment provider creation mutation.

#### Internal Logic
1. Sets up necessary test data using `let` statements.
2. Includes shared examples for permission and authentication checks.
3. Defines a test case to verify the creation of a Stripe provider.

### let(:mutation)
#### Description
Defines the GraphQL mutation string used for testing the Stripe payment provider creation.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutation | String | GraphQL mutation for adding a Stripe payment provider |

### it 'creates a stripe provider'
#### Description
The main test case that verifies the creation of a Stripe payment provider through the GraphQL mutation.

#### Internal Logic
1. Executes the GraphQL mutation with test data.
2. Verifies the response contains the expected data for the created Stripe provider.
3. Uses `aggregate_failures` to group multiple expectations.

#### Arrange
- Sets up test data including user, organization, permissions, and input variables.

#### Act
- Executes the GraphQL mutation using the `execute_graphql` helper method.

#### Assert
- Verifies the presence of an ID in the response.
- Checks if the secret key is partially masked in the response.
- Confirms that the code, name, and success redirect URL match the input data.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| RSpec | Testing framework used for writing and running tests |
| FactoryBot | Used for creating test data (implied by the use of `create(:membership)`) |

## Error Handling
The test case uses `aggregate_failures` to group multiple expectations, allowing all assertions to be checked even if one fails.

## TODOs
- None explicitly mentioned in the code.

This test suite ensures that the Stripe payment provider creation mutation works correctly, handles permissions appropriately, and returns the expected data structure. It's part of a larger test suite for the application's GraphQL API and payment integration features.