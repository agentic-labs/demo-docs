---
title: "destroy_spec.rb"
---

## High-level description
This RSpec test file describes the behavior of the `Mutations::WebhookEndpoints::Destroy` GraphQL mutation. It verifies that the mutation correctly destroys a webhook endpoint, and checks for proper authentication and authorization.

## Code Structure
The test file defines a single RSpec describe block for the `Mutations::WebhookEndpoints::Destroy` mutation. It sets up necessary test data, defines the GraphQL mutation, and includes shared examples for authentication and authorization checks. The main test case verifies that the mutation successfully destroys a webhook endpoint.

## Symbols

### RSpec.describe Mutations::WebhookEndpoints::Destroy
#### Description
This is the main describe block for testing the `Destroy` mutation of webhook endpoints.

#### Internal Logic
1. Sets up test data using `let` statements for required permission, membership, organization, and webhook endpoint.
2. Defines the GraphQL mutation query.
3. Includes shared examples for authentication and authorization checks.
4. Tests the destruction of a webhook endpoint.

### let(:required_permission)
#### Description
Defines the required permission for executing the mutation.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to execute the mutation |

### let(:membership)
#### Description
Creates a test membership using FactoryBot.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| membership | Membership | A test membership object |

### let(:organization)
#### Description
Retrieves the organization associated with the test membership.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The organization associated with the test membership |

### let(:webhook_endpoint)
#### Description
Creates a test webhook endpoint associated with the test organization.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| webhook_endpoint | WebhookEndpoint | A test webhook endpoint object |

### let(:mutation)
#### Description
Defines the GraphQL mutation query for destroying a webhook endpoint.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutation | String | The GraphQL mutation query |

### it 'destroys a webhook_endpoint'
#### Description
Tests that the mutation successfully destroys a webhook endpoint.

#### Internal Logic
1. Executes the GraphQL mutation with the necessary parameters.
2. Checks that the `WebhookEndpoint.count` decreases by 1 after the mutation is executed.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| rspec | Testing framework |
| graphql | GraphQL implementation for Ruby |
| FactoryBot | Test data generation |

## Error Handling
The test relies on RSpec's built-in error handling and assertion mechanisms. No specific error handling is implemented in this test file.