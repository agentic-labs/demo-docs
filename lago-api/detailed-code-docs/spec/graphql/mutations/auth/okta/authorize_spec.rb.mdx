---
title: "authorize_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Mutations::Auth::Okta::Authorize` GraphQL mutation. It verifies the behavior of the Okta authorization process, including successful authorization URL generation and error handling for invalid inputs.

## Symbols

### `RSpec.describe Mutations::Auth::Okta::Authorize, type: :graphql`
#### Description
This is the main describe block for the test suite, focusing on the `Mutations::Auth::Okta::Authorize` GraphQL mutation.

### `let(:user)`
#### Description
Creates a user instance using FactoryBot for testing purposes.

### `let(:okta_integration)`
#### Description
Creates an Okta integration instance using FactoryBot for testing purposes.

### `let(:mutation)`
#### Description
Defines the GraphQL mutation query string used in the tests.

### `it 'returns authorize url'`
#### Description
Tests the successful case where the mutation returns a valid Okta authorization URL.

#### Internal Logic
1. Executes the GraphQL mutation with a valid email.
2. Verifies that the returned URL includes the Okta integration's organization name.

### `context 'when email domain is not configured with an integration'`
#### Description
Tests the error case when an email with an unconfigured domain is provided.

#### Internal Logic
1. Executes the GraphQL mutation with an invalid email domain.
2. Verifies that an error is returned with the correct status and details.

### `context 'when invite token is provided'`
#### Description
Tests the case where an invite token is included in the mutation input.

#### Internal Logic
1. Creates an invite for a user with a valid Okta integration domain.
2. Executes the GraphQL mutation with the invite token and email.
3. Verifies that a valid authorization URL is returned.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| FactoryBot | Used for creating test data (user, okta_integration, invite) |

## References
The test suite references the following external components:
- `Mutations::Auth::Okta::Authorize`: The GraphQL mutation being tested
- `OktaAuthorizeInput`: The input type for the mutation
- `User` model
- `OktaIntegration` model
- `Invite` model

Note: The actual implementation of these components is not provided in the given code snippet.

## Error Handling
The test suite checks for error responses in the case of invalid inputs, specifically when an email domain is not configured with an integration. It verifies the error status code and details.

This comprehensive test suite ensures that the Okta authorization mutation behaves correctly under various scenarios, including successful authorization, error handling, and invite token processing.