---
title: "login_user_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Mutations::Auth::Google::LoginUser` GraphQL mutation. It tests the functionality of logging in a user using Google authentication, including successful login scenarios and error handling for non-existent users.

## Code Structure
The test suite is organized around the `Mutations::Auth::Google::LoginUser` mutation. It uses RSpec's `describe` and `context` blocks to structure different test scenarios. The tests mock the `Auth::GoogleService` to simulate the login process and verify the expected outcomes.

## Symbols

### `RSpec.describe Mutations::Auth::Google::LoginUser`
#### Description
This is the main describe block for the test suite, focusing on the `Mutations::Auth::Google::LoginUser` GraphQL mutation.

### `let` blocks
#### Description
These blocks define shared resources and mocks used across the tests:
- `membership`: Creates a membership factory
- `user`: References the user associated with the membership
- `google_service`: Mocks the `Auth::GoogleService`
- `login_result`: Simulates a successful login result
- `mutation`: Defines the GraphQL mutation string

### `before` block
#### Description
Sets up the test environment by mocking the `Auth::GoogleService` and its `login` method.

### Main test case
#### Description
Tests the successful login scenario, verifying that the mutation returns the expected token and user information.

#### Internal Logic
1. Executes the GraphQL mutation with a mock request and input
2. Verifies the response contains the correct token and user details

### `context 'when user does not exist'` block
#### Description
Tests the error handling scenario when the user doesn't exist in the system.

#### Internal Logic
1. Modifies the `login_result` to simulate a user not found error
2. Executes the GraphQL mutation
3. Verifies that the response contains the expected error status and message

## Dependencies
The test file depends on the following:
- RSpec testing framework
- FactoryBot for creating test data
- GraphQL testing helpers (implied by the `type: :graphql` metadata)
- `Auth::GoogleService` for handling Google authentication
- `BaseService::Result` for structuring service results

## Error Handling
The test suite covers error handling for the case when a user does not exist, verifying that the appropriate error response is returned.

Your response should not exceed 3000 words or 4000 tokens. Focus on providing clear, concise information that can be directly inferred from the code. Include optional sections only when they provide significant value for understanding the code.