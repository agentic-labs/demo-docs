---
title: "register_user_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Mutations::Auth::Google::RegisterUser` GraphQL mutation. It verifies the functionality of registering a user through Google authentication, including successful registration and handling of existing user scenarios.

## Code Structure
The test suite uses RSpec and focuses on testing the `googleRegisterUser` GraphQL mutation. It sets up a mock `Auth::GoogleService` and tests both successful registration and error handling for existing users.

## Symbols

### RSpec.describe Mutations::Auth::Google::RegisterUser
#### Description
This is the main test suite for the Google user registration mutation. It sets up the necessary test environment and contains individual test cases.

#### Internal Logic
1. Sets up mock objects and services
2. Defines the GraphQL mutation query
3. Contains test cases for successful registration and existing user scenarios

### let(:google_service)
#### Description
Creates a double of the `Auth::GoogleService` class for mocking purposes.

### let(:user)
#### Description
Creates a factory-generated user object for testing.

### let(:register_user_result)
#### Description
Defines a mock result object returned by the `register_user` method of `Auth::GoogleService`.

### let(:mutation)
#### Description
Defines the GraphQL mutation query string used for testing.

### before block
#### Description
Sets up the test environment by mocking the `Auth::GoogleService` and its `register_user` method.

### it 'returns token and user'
#### Description
Tests the successful user registration scenario.

#### Internal Logic
1. Executes the GraphQL mutation with mock input
2. Verifies that the response contains the expected token and user information

### context 'when user already exists'
#### Description
Tests the scenario where a user attempts to register with an email that already exists in the system.

#### Internal Logic
1. Sets up a mock result indicating a user already exists
2. Executes the GraphQL mutation
3. Verifies that the appropriate error response is returned

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configurations |
| Auth::GoogleService | Service for handling Google authentication (mocked in tests) |
| BaseService::Result | Used to create mock result objects |
| FactoryBot | Used to create test data (user factory) |

## Error Handling
The test suite covers error handling for the case when a user already exists, verifying that the appropriate error response is returned.