---
title: "destroy_spec.rb"
---

## High-level description
This code defines a RSpec test suite for the `Mutations::AddOns::Destroy` GraphQL mutation. It verifies that the mutation requires a current user and specific permissions, and successfully deletes an add-on when executed with valid inputs.

## Symbols

### `RSpec.describe Mutations::AddOns::Destroy, type: :graphql`
#### Description
This describes a test suite for the `Mutations::AddOns::Destroy` GraphQL mutation.

#### Internal Logic
The test suite sets up necessary test data, defines the GraphQL mutation, and includes shared examples for permission checks. It then tests the actual functionality of deleting an add-on.

### `let` blocks
#### Description
These blocks define lazy-loaded variables used throughout the test suite.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| required_permission | String | The permission required to execute the mutation |
| membership | Membership | A factory-created membership object |
| organization | Organization | The organization associated with the membership |
| add_on | AddOn | A factory-created add-on associated with the organization |

### `mutation`
#### Description
Defines the GraphQL mutation string for destroying an add-on.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutation | String | The GraphQL mutation string |

### `it_behaves_like` blocks
#### Description
These blocks include shared examples to test common behaviors.

#### Internal Logic
- 'requires current user': Likely checks if the mutation requires a logged-in user
- 'requires permission': Checks if the mutation requires the 'addons:delete' permission

### `it 'deletes an add-on'`
#### Description
This test case verifies that the mutation successfully deletes an add-on.

#### Internal Logic
1. Executes the GraphQL mutation with necessary inputs
2. Checks if the returned data contains the correct add-on ID

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configurations |
| RSpec | Testing framework used for writing and running tests |
| FactoryBot | Used for creating test data (implied by the use of `create` method) |

## References
- `Mutations::AddOns::Destroy`: The actual mutation being tested (not shown in the provided code)
- `execute_graphql`: A helper method for executing GraphQL queries (likely defined in a support file)

This test file ensures that the `Mutations::AddOns::Destroy` GraphQL mutation works as expected, requiring proper authentication and permissions, and successfully deleting an add-on when called with valid inputs.