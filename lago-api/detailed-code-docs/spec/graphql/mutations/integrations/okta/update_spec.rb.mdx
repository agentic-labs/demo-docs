---
title: "update_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Mutations::Integrations::Okta::Update` GraphQL mutation. It verifies the behavior of updating an Okta integration, including permission checks and the actual update process.

## Code Structure
The test suite is organized as an RSpec describe block for the `Mutations::Integrations::Okta::Update` class. It includes several let statements for setting up test data, a GraphQL mutation query, and various test cases.

## Symbols

### RSpec.describe Mutations::Integrations::Okta::Update
#### Description
This is the main describe block for the test suite, focusing on the Okta integration update mutation.

### let statements
#### Description
These statements set up the test data and environment:

- `required_permission`: Sets the required permission for the mutation.
- `integration`: Creates an Okta integration associated with the organization.
- `organization`: References the organization from the membership.
- `membership`: Creates a membership record.
- `mutation`: Defines the GraphQL mutation query for updating an Okta integration.

### around { |test| lago_premium!(&test) }
#### Description
This hook ensures that the tests are run in a premium context, likely enabling premium features for the duration of each test.

### before block
#### Description
This setup block creates the integration and updates the organization to include 'okta' in its premium integrations.

### Shared examples
#### Description
The test suite includes shared example groups for common test scenarios:

- `'requires current user'`
- `'requires current organization'`
- `'requires permission'`

These likely check for proper authentication and authorization.

### 'updates an okta integration' test
#### Description
This test case verifies that the mutation correctly updates an Okta integration.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| current_user | User | The user performing the mutation |
| current_organization | Organization | The organization context |
| permissions | String | The required permission |
| query | String | The GraphQL mutation query |
| variables | Hash | Input variables for the mutation |

#### Internal Logic
1. Executes the GraphQL mutation with the provided inputs.
2. Retrieves the result data from the response.
3. Uses `aggregate_failures` to group expectations.
4. Checks if the `domain` and `organizationName` fields are updated correctly.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| type | Symbol | :graphql | Specifies the type of test (GraphQL) |

This comprehensive test suite ensures that the Okta integration update mutation functions correctly, respecting permissions and properly updating the specified fields.