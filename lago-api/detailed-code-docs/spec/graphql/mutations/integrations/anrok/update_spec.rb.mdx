---
title: "update_spec.rb"
---

## High-level description
This RSpec test file describes the behavior of the `Mutations::Integrations::Anrok::Update` GraphQL mutation. It verifies that the mutation correctly updates an Anrok integration, including permissions checks and proper handling of input data.

## Code Structure
The test file defines a set of let variables for setup, a GraphQL mutation query, and a main test case. It also includes shared examples for common permission checks.

## Symbols

### RSpec.describe Mutations::Integrations::Anrok::Update
#### Description
This is the main describe block for the test suite, focusing on the Anrok integration update mutation.

### let variables
#### Description
These variables set up the test environment with necessary data:

- `required_permission`: The permission required to perform the update.
- `integration`: An instance of the Anrok integration.
- `organization`: The organization associated with the membership.
- `membership`: A user's membership in the organization.
- `code`, `name`, `api_key`: New values for updating the integration.

### mutation
#### Description
This variable contains the GraphQL mutation query string used to update an Anrok integration.

### around block
#### Description
This block ensures that the test runs in a premium context using the `lago_premium!` method.

### before block
#### Description
This setup block creates the integration and updates the organization to include 'anrok' in its premium integrations.

### Shared examples
#### Description
The test includes shared examples for checking user authentication, organization presence, and required permissions.

### Main test case
#### Description
This test verifies that the mutation successfully updates an Anrok integration.

#### Internal Logic
1. Executes the GraphQL mutation with the necessary input.
2. Checks the result data for updated values.
3. Uses `aggregate_failures` to group multiple expectations.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |

## Configuration
The test file uses RSpec configuration from the `rails_helper.rb` file, which sets up the testing environment, including database cleaner, SimpleCov for code coverage, and various RSpec configurations.

## Error Handling
The test implicitly checks for errors by expecting successful execution of the mutation and correct output values.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| updateAnrokIntegration | Mutation | UpdateAnrokIntegrationInput | Updated integration data | Updates an Anrok integration |

Note: This is a GraphQL mutation, not a REST API endpoint.