---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for the `LagoUtils` module, specifically focusing on the `License` and `RubySandbox` classes. These tests ensure the proper functioning of license verification and sandboxed Ruby code execution within the Lago application.

## What does it do?
The test suite in this directory verifies two main functionalities:

1. License Verification: It checks if the application correctly handles different license scenarios, such as valid licenses, invalid licenses, and cases where no license is present. This is crucial for managing premium features or access control in the Lago application.

2. Ruby Code Sandbox: It tests a utility that allows safe execution of Ruby code in a controlled environment. This sandbox prevents potentially dangerous operations like loading external libraries or executing system commands, while still allowing basic Ruby code execution and method definitions.

These tests ensure that the Lago application can securely manage its licensing system and provide a safe environment for running user-provided Ruby code, which could be useful for custom integrations or user-defined calculations.

## Key Files

1. `license_spec.rb`:
   This file contains tests for the `LagoUtils::License` class. It verifies the behavior of the `verify` method under different scenarios:
   - When a valid license is provided, it checks if the premium status is set to true.
   - When no license is present, it ensures the premium status remains false.
   - When an invalid license is provided, it confirms the premium status stays false.

2. `ruby_sandbox_spec.rb`:
   This file tests the `LagoUtils::RubySandbox` class, focusing on the `run` method. It verifies:
   - Basic code execution capabilities.
   - Ability to define and execute methods within the sandbox.
   - Restrictions on loading external libraries.
   - Prevention of executing blacklisted methods.
   - Blocking of external system command execution.

Both files use RSpec for testing and include the `rails_helper`, which sets up the Rails testing environment and configurations.

## Dependencies
The test files rely on the following dependencies:

1. RSpec: The testing framework used for writing and running the tests.
2. Rails: The test files are part of a Rails application, as evidenced by the inclusion of `rails_helper`.
3. WebMock: Used in `license_spec.rb` for stubbing HTTP requests in tests.

## Configuration
The test suite uses the following configuration:

1. In `license_spec.rb`:
   - `LAGO_LICENSE`: An environment variable set to 'test-license' for testing purposes.

2. In `ruby_sandbox_spec.rb`:
   - No specific configuration is mentioned, but it's implied that there's a list of blacklisted methods and restricted operations in the `LagoUtils::RubySandbox` class.

Both test files make use of the `rails_helper`, which likely includes additional configuration for the Rails testing environment, RSpec, and other testing tools like SimpleCov for code coverage.

These tests play a crucial role in ensuring the reliability and security of the Lago application's license management and custom code execution features. They help prevent unauthorized access to premium features and protect the system from potentially malicious user-provided code.