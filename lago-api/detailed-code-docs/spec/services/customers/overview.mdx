---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for various customer-related services in the application. These services handle operations such as applying taxes, creating customers, destroying customers, generating checkout URLs, updating customer metadata, terminating customer relations, and updating invoice-related settings.

## What does it do?
The tests in this directory verify the functionality of services that manage customer data and operations. These include:

1. Applying taxes to customers and handling tax-related scenarios
2. Creating and updating customer records, including metadata and billing configurations
3. Soft-deleting customers and terminating their associated resources
4. Generating checkout URLs for payment providers
5. Updating customer metadata
6. Terminating customer relations, including subscriptions and invoices
7. Updating invoice grace periods and payment due dates
8. Handling EU auto-taxes for customers

The tests ensure that these services behave correctly under various scenarios, handle errors appropriately, and interact correctly with other parts of the system such as payment providers and invoicing.

## Key Files
1. `apply_taxes_service_spec.rb`: Tests the application of taxes to customers, including error handling and invoice updating.

2. `create_service_spec.rb`: Verifies the creation and updating of customer records, including metadata handling and integration with payment providers.

3. `destroy_service_spec.rb`: Tests the soft deletion of customers and the enqueuing of jobs to terminate customer resources.

4. `eu_auto_taxes_service_spec.rb`: Checks the determination of appropriate EU tax codes based on customer and organization details.

5. `generate_checkout_url_service_spec.rb`: Tests the generation of checkout URLs for customers, including various scenarios with payment providers.

6. `terminate_relations_service_spec.rb`: Verifies the termination of customer relations, including subscriptions, invoices, and wallets.

7. `update_invoice_grace_period_service_spec.rb`: Tests the updating of invoice grace periods and its effects on draft invoices.

8. `update_service_spec.rb`: Checks various scenarios for updating customer information, including premium features and metadata handling.

## Dependencies
The test files rely on the following main dependencies:
1. RSpec: The testing framework used for writing and running the tests.
2. FactoryBot: Used for creating test data and objects.
3. Rails testing environment: Loaded via `rails_helper` in most test files.
4. Various application services and models: The actual services being tested and their associated models.

## Configuration
The tests make use of RSpec's configuration options, such as:
- `type: :service` to specify service tests
- `travel_to` method for time manipulation in tests
- Mocking and stubbing of external services and methods

Many tests also use `let` statements to set up test data and objects, which are then used across multiple test cases within a describe block.

The tests cover a wide range of scenarios, including error cases, edge cases, and interactions with other parts of the system. They help ensure the reliability and correctness of the customer-related services in the application.