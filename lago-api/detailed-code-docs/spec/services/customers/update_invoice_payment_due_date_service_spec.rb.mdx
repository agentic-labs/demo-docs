---
title: "update_invoice_payment_due_date_service_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Customers::UpdateInvoicePaymentDueDateService` class. It verifies that the service correctly updates the payment due date of a draft invoice based on the customer's net payment term.

## Symbols

### `RSpec.describe Customers::UpdateInvoicePaymentDueDateService`
#### Description
This is the main describe block for the test suite, focusing on the `Customers::UpdateInvoicePaymentDueDateService` class.

### `subject(:update_service)`
#### Description
Defines the subject of the test, which is an instance of the `Customers::UpdateInvoicePaymentDueDateService` class.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| customer | Customer | The customer associated with the invoice |
| net_payment_term | Integer | The number of days for the net payment term |

### `describe '#call'`
#### Description
This describe block focuses on testing the `#call` method of the service.

### `it 'updates invoice payment_due_date'`
#### Description
This test case verifies that calling the service updates the `payment_due_date` of the draft invoice.

#### Internal Logic
1. Arrange: Creates a draft invoice with a specific issuing date.
2. Act: Calls the `update_service.call` method.
3. Assert: Checks that the `payment_due_date` of the invoice has changed from the original issuing date to the issuing date plus the net payment term in days.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment |
| FactoryBot | Used for creating test data (implied by the use of `create` method) |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| type: :service | Symbol | N/A | Specifies that this is a service test |

## Error Handling
This test file does not explicitly test error handling scenarios.

___

This test file is designed to verify the functionality of the `Customers::UpdateInvoicePaymentDueDateService`. It focuses on ensuring that the service correctly updates the payment due date of a draft invoice based on the customer's net payment term. The test creates a draft invoice with a specific issuing date and then checks if the service updates the payment due date correctly by adding the net payment term to the issuing date.

The test uses FactoryBot to create test data, including a membership, organization, customer, and invoice. It sets up a scenario with a 30-day net payment term and a draft invoice dated June 21, 2022. The test then expects the service to change the payment due date to July 21, 2022 (30 days later).

This test helps ensure that the service behaves correctly in updating invoice payment due dates, which is crucial for maintaining accurate financial records and customer expectations in the invoicing system.