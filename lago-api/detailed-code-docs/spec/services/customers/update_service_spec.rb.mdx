---
title: "update_service_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Customers::UpdateService` class. It tests various scenarios for updating customer information, including basic updates, premium features, metadata handling, validation errors, and interactions with payment providers and EU tax management.

## Code Structure
The main describe block focuses on the `update` method of the `Customers::UpdateService` class. Within this block, there are multiple contexts and examples testing different aspects of the update functionality.

## Symbols

### `RSpec.describe Customers::UpdateService`
#### Description
This is the main describe block for the `Customers::UpdateService` class tests.

### `describe 'update'`
#### Description
This describe block focuses on testing the `update` method of the `Customers::UpdateService` class.

### `let` statements
#### Description
These statements define various test data and objects used throughout the tests, such as `user`, `membership`, `organization`, `customer`, and `update_args`.

### `it 'updates a customer'`
#### Description
This example tests the basic functionality of updating a customer's information.

### `context 'with premium features'`
#### Description
This context tests updating customer information with premium features enabled.

### `context 'with metadata'`
#### Description
This context tests updating customer metadata.

### `context 'with validation error'`
#### Description
This context tests the behavior when there's a validation error during the update process.

### `context 'when attached to a subscription'`
#### Description
This context tests updating a customer that is attached to a subscription.

### `context 'when updating payment provider'`
#### Description
This context tests updating a customer's payment provider information.

### `context 'when partialy updating'`
#### Description
This context tests partial updates to a customer's information.

### `context 'when updating net payment term'`
#### Description
This context tests updating the net payment term for a customer and its effect on draft invoices.

### `context 'when organization has eu tax management'`
#### Description
This context tests the behavior when updating a customer for an organization with EU tax management enabled.

## Dependencies
- RSpec
- FactoryBot
- Various application services and models (e.g., `Customers::UpdateService`, `PaymentProviderCustomers::UpdateService`)

## Error Handling
The tests cover various error scenarios, including validation errors and currency mismatches.

## Notes
- The tests make use of the `lago_premium!` method, which likely enables premium features for testing purposes.
- The tests mock external services like `PaymentProviderCustomers::UpdateService` and `Customers::EuAutoTaxesService` to isolate the behavior of the `UpdateService`.