---
title: "customer_created_service_spec.rb"
---

## High-level description
This code defines a RSpec test suite for the `Webhooks::Integrations::CustomerCreatedService` class. It verifies that the service correctly creates a webhook when a customer is created, with specific event details and payload structure.

## Symbols

### `RSpec.describe Webhooks::Integrations::CustomerCreatedService`
#### Description
This is the main describe block that groups all tests related to the `Webhooks::Integrations::CustomerCreatedService` class.

### `subject(:webhook_service)`
#### Description
Defines the subject of the test, which is an instance of `Webhooks::Integrations::CustomerCreatedService` initialized with a customer object.

### `let(:customer)`
#### Description
Creates a customer instance using FactoryBot, associated with the organization defined in the `organization` let block.

### `let(:organization)`
#### Description
Creates an organization instance using FactoryBot.

### `describe '.call'`
#### Description
Describes the test for the `.call` method of the `Webhooks::Integrations::CustomerCreatedService` class.

### `it_behaves_like 'creates webhook'`
#### Description
Uses a shared example to test the webhook creation behavior. It expects the service to create a webhook with the following characteristics:
- Event name: 'customer.accounting_provider_created'
- Object type: 'customer'
- Payload: Contains an 'integration_customers' key with an empty array as its value

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used for creating test data (customer and organization) |

## References
This test file references:
1. The `Webhooks::Integrations::CustomerCreatedService` class, which is being tested.
2. A shared example 'creates webhook', which is likely defined in a support file.

## Notes
1. The test uses FactoryBot to create test data, indicating that there are factory definitions for both `customer` and `organization` models.
2. The shared example 'creates webhook' is used to encapsulate common webhook creation testing logic, promoting DRY (Don't Repeat Yourself) principles in the test suite.
3. The test focuses on verifying that the correct webhook event is created with the expected payload structure when a customer is created.
4. The empty array for 'integration_customers' in the expected payload suggests that this might be a placeholder for future implementation or represents the initial state of a newly created customer.

This test file is part of a larger test suite for webhook-related functionality in the application, specifically for customer creation events that need to be communicated to integrated accounting providers.