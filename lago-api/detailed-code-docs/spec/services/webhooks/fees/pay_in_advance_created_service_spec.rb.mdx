---
title: "pay_in_advance_created_service_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Webhooks::Fees::PayInAdvanceCreatedService` class. It specifically tests the `.call` method of the service, ensuring that it creates a webhook with the correct event type and payload structure for a fee creation event.

## Symbols

### `RSpec.describe Webhooks::Fees::PayInAdvanceCreatedService`
#### Description
This is the main RSpec describe block that groups all tests related to the `Webhooks::Fees::PayInAdvanceCreatedService` class.

### `subject(:webhook_service)`
#### Description
Defines the subject of the test, which is an instance of the `Webhooks::Fees::PayInAdvanceCreatedService` class, initialized with a fee object.

### `let` blocks
#### Description
These blocks define the test data used in the specs:

- `organization`: Creates an organization
- `customer`: Creates a customer associated with the organization
- `subscription`: Creates a subscription associated with the organization
- `fee`: Creates a fee associated with the customer and subscription

### `describe '.call'`
#### Description
This describe block focuses on testing the `.call` method of the service.

#### Internal Logic
The test uses a shared example `'creates webhook'` to verify that the `.call` method creates a webhook with the following characteristics:
1. Event type: `'fee.created'`
2. Resource type: `'fee'`
3. Expected payload structure: Contains an `'amount_cents'` key with an Integer value

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and RSpec configuration |
| FactoryBot | Implied usage for creating test data (e.g., `create(:organization)`) |

## Notes
1. The test relies on shared examples, which are not defined in this file. The shared example `'creates webhook'` is likely defined elsewhere in the test suite.
2. The test is focused on ensuring that the webhook creation process works correctly for a fee creation event, specifically checking the event type, resource type, and payload structure.
3. The test doesn't verify the actual content of the webhook payload beyond the presence of the `'amount_cents'` key with an Integer value.

This spec file provides a concise test for the `Webhooks::Fees::PayInAdvanceCreatedService`, focusing on its core functionality of creating a webhook for a fee creation event. It uses factory methods to set up the necessary test data and relies on shared examples for the actual test assertions.