---
title: "payment_overdue_service_spec.rb"
---

## High-level description
This file contains RSpec tests for the `Webhooks::Invoices::PaymentOverdueService` class. It verifies that the service correctly creates a webhook event for an overdue invoice payment.

## Symbols

### `RSpec.describe Webhooks::Invoices::PaymentOverdueService`
#### Description
This is the main RSpec describe block that groups all tests related to the `Webhooks::Invoices::PaymentOverdueService` class.

#### Internal Logic
The test suite sets up a subject (the webhook service) and necessary test data (organization, customer, and invoice) using FactoryBot factories. It then describes the behavior of the `.call` method.

### `subject(:webhook_service)`
#### Description
Defines the subject of the test, which is an instance of `Webhooks::Invoices::PaymentOverdueService` initialized with an invoice object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| object | Invoice | An invoice instance set to payment_overdue |

### `let(:organization)`
#### Description
Creates a test organization using FactoryBot.

### `let(:customer)`
#### Description
Creates a test customer associated with the test organization using FactoryBot.

### `let(:invoice)`
#### Description
Creates a test invoice associated with the test customer and organization, with `payment_overdue` set to true, using FactoryBot.

### `describe ".call"`
#### Description
Describes the behavior of the `.call` method of the `Webhooks::Invoices::PaymentOverdueService` class.

#### Internal Logic
It uses a shared example `"creates webhook"` to test if the service creates a webhook event with the type "invoice.payment_overdue" and the resource type "invoice".

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and RSpec configuration |
| FactoryBot | Used for creating test data (implied by the use of `create` method) |

## Notes
1. The test relies on a shared example `"creates webhook"`, which is not defined in this file. It's likely defined in a separate shared examples file.
2. The test is focused on verifying that the service creates the correct type of webhook event when called.
3. The use of FactoryBot suggests that there are factory definitions for Organization, Customer, and Invoice models elsewhere in the test suite.
4. The test doesn't directly assert any behavior but relies on the shared example to perform the actual assertions.

This test file ensures that the `Webhooks::Invoices::PaymentOverdueService` correctly creates a webhook event when an invoice payment becomes overdue, which is likely part of a larger system for managing invoices and notifying relevant parties about payment status changes.