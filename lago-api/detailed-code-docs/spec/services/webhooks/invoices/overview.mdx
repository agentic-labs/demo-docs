---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for various webhook services related to invoice operations in a Rails application. These services are responsible for creating webhook events for different invoice-related actions such as creation, drafting, payment status updates, and voiding.

## What does it do?
The tests in this directory verify that the webhook services correctly create webhook events for various invoice-related actions. Each service is responsible for a specific event type, such as:

1. Adding an add-on to an invoice
2. Creating a new invoice
3. Drafting an invoice
4. Generating an invoice
5. Creating a one-off invoice
6. Adding a paid credit to an invoice
7. Handling a lost payment dispute
8. Marking a payment as overdue
9. Updating payment status
10. Voiding an invoice

The tests ensure that when these actions occur, the corresponding service creates a webhook with the correct event type, resource type, and any additional required data. This allows the system to notify external services or parts of the application about changes in invoice status or content.

## Key Files
1. `add_on_created_service_spec.rb`: Tests the service that creates a webhook when an add-on is added to an invoice.
2. `created_service_spec.rb`: Verifies the service that generates a webhook when a new invoice is created.
3. `drafted_service_spec.rb`: Tests the service responsible for creating a webhook when an invoice is drafted.
4. `generated_service_spec.rb`: Checks the service that creates a webhook when an invoice is generated.
5. `one_off_created_service_spec.rb`: Verifies the service that creates a webhook for one-off invoice creation.
6. `paid_credit_added_service_spec.rb`: Tests the service that generates a webhook when a paid credit is added to an invoice.
7. `payment_dispute_lost_service_spec.rb`: Checks the service that creates a webhook when a payment dispute is lost.
8. `payment_overdue_service_spec.rb`: Verifies the service that generates a webhook when a payment becomes overdue.
9. `payment_status_updated_service_spec.rb`: Tests the service responsible for creating a webhook when an invoice's payment status is updated.
10. `voided_service_spec.rb`: Checks the service that creates a webhook when an invoice is voided.

## Dependencies
The test files in this directory depend on the following:

1. RSpec: The testing framework used for writing and running the tests.
2. FactoryBot: Used for creating test data (organizations, customers, subscriptions, invoices, fees, and credits).
3. Rails testing environment: Loaded via `rails_helper`, which sets up the necessary configuration for testing Rails applications.
4. Shared examples: Used across multiple test files to reduce code duplication for common webhook creation testing logic.

## Configuration
The tests rely on the standard RSpec and Rails test configuration, which is likely defined in the `rails_helper.rb` file. This configuration typically includes:

1. Setting up the test environment
2. Configuring the database cleaner
3. Loading support files and shared examples
4. Configuring FactoryBot

Additionally, some tests use specific configurations:

1. `frozen_string_literal: true` is used in some files to freeze string literals for performance benefits.
2. Transactional fixtures are disabled in some cases (`config.use_transactional_fixtures = false`).
3. SimpleCov is configured for code coverage reporting.

These tests play a crucial role in ensuring that the webhook system for invoice-related events functions correctly, maintaining the integrity of the application's event notification system.