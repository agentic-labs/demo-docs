---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for various payment provider services, including Adyen, GoCardless, and Stripe. The tests cover a wide range of functionality, including creating and updating payment providers, handling incoming webhooks, processing different types of events, and managing chargebacks and disputes.

## What does it do?
The tests in this directory ensure that the payment provider services correctly handle various scenarios related to payment processing, webhook management, and dispute resolution. Specifically, they verify:

1. Creation and updating of payment providers (Adyen, GoCardless, Stripe)
2. Handling of incoming webhooks from different payment providers
3. Processing of various event types (e.g., authorizations, refunds, payments)
4. Management of chargebacks and disputes
5. Webhook registration and refreshing (for Stripe)
6. Error handling for various scenarios (e.g., authentication failures, invalid payloads)

These tests simulate different scenarios and events from payment providers and verify that the system responds correctly, updating relevant data, triggering necessary actions, and handling errors appropriately.

## Key Files

1. `spec/services/payment_providers/adyen_service_spec.rb`:
   Tests the AdyenService, covering provider creation/updating, webhook handling, and event processing.

2. `spec/services/payment_providers/gocardless_service_spec.rb`:
   Verifies the GoCardlessService functionality, including provider management, webhook handling, and event routing.

3. `spec/services/payment_providers/stripe_service_spec.rb`:
   Tests the StripeService, focusing on provider management, webhook refreshing, incoming webhook handling, and various event type processing.

4. `spec/services/payment_providers/webhooks/adyen/chargeback_service_spec.rb`:
   Verifies the Adyen ChargebackService, testing chargeback handling for different invoice statuses.

5. `spec/services/payment_providers/webhooks/stripe/charge_dispute_closed_service_spec.rb`:
   Tests the Stripe ChargeDisputeClosedService, covering dispute resolution for various scenarios.

6. `spec/services/payment_providers/destroy_service_spec.rb`:
   Verifies the functionality of destroying payment providers, including error handling.

7. `spec/services/payment_providers/find_service_spec.rb`:
   Tests the FindService for locating payment providers based on various input parameters.

## Dependencies
The test files rely on several key dependencies:

| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails and RSpec configuration for testing |
| FactoryBot | Used for creating test objects (organizations, customers, invoices, payments, etc.) |
| RSpec | The testing framework used for writing and running the tests |
| Stripe | Mocked for testing Stripe-related functionality |
| GoCardlessPro | Mocked for testing GoCardless-related functionality |
| OAuth2::Client | Mocked for OAuth operations in GoCardless tests |

## Configuration
The tests use various `let` statements and factories to set up test environments. Common configurations include creating test organizations, customers, invoices, and payment providers. Many tests also use JSON fixtures or mock data to simulate events from payment providers.

The test suites cover a wide range of scenarios, including:
- Creating and updating payment providers
- Handling incoming webhooks
- Processing various event types
- Managing chargebacks and disputes
- Error handling for invalid inputs or API failures

These comprehensive test suites ensure that the payment provider services handle different scenarios correctly, maintaining the integrity and reliability of the payment processing system across multiple providers.