---
title: "adyen_service_spec.rb"
---

## High-level description
This file contains RSpec tests for the `PaymentProviders::AdyenService` class. It tests various methods of the service, including creating or updating Adyen providers, handling incoming webhooks, and processing different types of Adyen events.

## Code Structure
The test suite is organized into several describe blocks, each focusing on a specific method of the `AdyenService`:
1. `.create_or_update`: Tests creating and updating Adyen providers.
2. `#handle_incoming_webhook`: Tests handling incoming webhooks from Adyen.
3. `#handle_event`: Tests processing different types of Adyen events.

## Symbols

### `PaymentProviders::AdyenService`
#### Description
This is the main class being tested. It handles operations related to Adyen payment providers.

### `describe '.create_or_update'`
#### Description
Tests the creation and updating of Adyen providers.

#### Internal Logic
- Tests creating a new Adyen provider
- Tests updating an existing Adyen provider
- Tests handling validation errors

### `describe '#handle_incoming_webhook'`
#### Description
Tests the handling of incoming webhooks from Adyen.

#### Internal Logic
- Tests successful webhook handling
- Tests error cases (organization not found, payment provider not found, invalid signature)

### `describe '#handle_event'`
#### Description
Tests the processing of different types of Adyen events.

#### Internal Logic
- Tests handling of authorization events
- Tests handling of refund events
- Uses mocks to simulate the behavior of other services

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Provides Rails-specific testing configurations |
| FactoryBot | Used for creating test data |

## Error Handling
The tests cover various error scenarios, such as validation failures, missing resources, and invalid signatures.

## Notable Test Cases
1. Creating a new Adyen provider
2. Updating an existing Adyen provider
3. Handling incoming webhooks with various scenarios (success, organization not found, payment provider not found, invalid signature)
4. Processing different types of Adyen events (authorization, refund)

This test file ensures that the `AdyenService` correctly handles various scenarios related to Adyen payment processing, including provider management, webhook handling, and event processing.