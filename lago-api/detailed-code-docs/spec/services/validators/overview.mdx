---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for validator services in a Rails application. It includes tests for two main validator services: `DecimalAmountService` and `MetadataValidator`. These tests ensure the correct functionality of validation logic for decimal amounts and metadata structures.

## What does it do?
The tests in this directory verify that:

1. The `DecimalAmountService` correctly validates decimal amounts in string format, including checks for valid positive amounts, zero amounts, negative amounts, and invalid inputs.

2. The `MetadataValidator` properly validates metadata structures, ensuring they meet specific criteria such as the number of key-value pairs, key and value lengths, and overall structure.

These tests help maintain the integrity of the validation services by catching potential regressions or unexpected behavior during development and refactoring.

## Key Files

1. `decimal_amount_service_spec.rb`:
   This file contains tests for the `Validators::DecimalAmountService` class. It verifies the functionality of two main methods:
   - `valid_amount?`: Checks if a given amount is a valid decimal number in string format.
   - `valid_positive_amount?`: Ensures that the amount is not only valid but also positive.

   The tests cover various scenarios, including valid decimal amounts, zero amounts, negative amounts, and invalid inputs.

2. `metadata_validator_spec.rb`:
   This file tests the `Validators::MetadataValidator` class. It focuses on validating metadata structures with the following checks:
   - Number of key-value pairs
   - Key and value lengths
   - Overall structure of the metadata

   The tests cover multiple scenarios, such as valid metadata, excessive key-value pairs, oversized keys or values, nested structures, and invalid formats.

## Dependencies
Both test files depend on the `rails_helper`, which loads the Rails testing environment and RSpec configurations. This suggests that the project is a Rails application using RSpec for testing.

## Configuration
The `metadata_validator_spec.rb` file uses configuration constants from the `Validators::MetadataValidator` class:

| Option | Type | Description |
|:-------|:-----|:------------|
| max_keys | Integer | Maximum number of allowed key-value pairs |
| max_key_length | Integer | Maximum allowed length for keys |
| max_value_length | Integer | Maximum allowed length for values |

These configuration options are used to test various validation scenarios in the `MetadataValidator`.

## Error Handling
Both test files implicitly check error handling by testing various invalid input scenarios:

1. In `decimal_amount_service_spec.rb`:
   - Negative amounts
   - Non-numeric strings
   - Non-string inputs

2. In `metadata_validator_spec.rb`:
   - Too many key-value pairs
   - Keys or values that are too long
   - Nested structures (not allowed)
   - Invalid key-value pair structures

The `metadata_validator_spec.rb` file also checks for specific error messages added to the `errors` hash of the validator, such as 'too_many_keys', 'key_too_long', 'value_too_long', 'nested_structure_not_allowed', and 'invalid_key_value_pair'.

These comprehensive tests ensure that the validator services handle various edge cases and invalid inputs correctly, maintaining the robustness of the application's validation logic.