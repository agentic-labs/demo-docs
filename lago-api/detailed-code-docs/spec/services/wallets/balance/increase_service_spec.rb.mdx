---
title: "increase_service_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Wallets::Balance::IncreaseService` class. It verifies that the service correctly updates a wallet's balance and ongoing balance when increasing credits.

## Symbols

### `RSpec.describe Wallets::Balance::IncreaseService`
#### Description
This is the main describe block for the `Wallets::Balance::IncreaseService` test suite. It sets up the context for testing the service.

### `subject(:create_service)`
#### Description
Defines the subject of the test, which is an instance of the `Wallets::Balance::IncreaseService` class.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| wallet | Wallet | The wallet object to be updated |
| credits_amount | BigDecimal | The amount of credits to be added |

### `let(:credits_amount)`
#### Description
Defines the amount of credits to be added to the wallet.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| credits_amount | BigDecimal | A BigDecimal value of 4.5 |

### `let(:wallet)`
#### Description
Creates a test wallet object with initial balance values.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| wallet | Wallet | A wallet object with predefined balance values |

### `describe '.call'`
#### Description
Describes the test cases for the `call` method of the `IncreaseService`.

#### Internal Logic
1. Tests that the wallet's balance is updated correctly.
2. Tests that the wallet's ongoing balance is refreshed correctly.

## Tests

### "updates wallet balance"
#### Description
Verifies that the wallet's balance and credits balance are correctly updated after calling the service.

#### Internal Logic
1. Arrange: Set up the wallet and service.
2. Act: Call the service.
3. Assert: Check that the balance_cents changes from 1000 to 1450 and credits_balance changes from 10.0 to 14.5.

### "refreshes wallet ongoing balance"
#### Description
Verifies that the wallet's ongoing balance and credits ongoing balance are correctly updated after calling the service.

#### Internal Logic
1. Arrange: Set up the wallet and service.
2. Act: Call the service.
3. Assert: Check that the ongoing_balance_cents changes from 800 to 1450 and credits_ongoing_balance changes from 8.0 to 14.5.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |

## Notes
- The test uses FactoryBot to create the wallet object.
- The `wallet` is reloaded in the expectations to ensure the latest database values are checked.
- The test uses `BigDecimal` for precise decimal calculations, which is important for financial transactions.