---
title: "destroy_service_spec.rb"
---

## High-level description
This RSpec test file is designed to test the `IntegrationCollectionMappings::DestroyService` class. It verifies the behavior of the service when destroying integration collection mappings, including successful destruction and error handling when the mapping is not found.

## Symbols

### `RSpec.describe IntegrationCollectionMappings::DestroyService`
#### Description
This is the main test suite for the `IntegrationCollectionMappings::DestroyService` class. It sets up the necessary context and defines test cases for the service's functionality.

### `subject(:destroy_service)`
#### Description
Defines the subject of the test, which is an instance of the `IntegrationCollectionMappings::DestroyService` class.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| integration_collection_mapping | IntegrationCollectionMapping | The mapping to be destroyed |

### `describe '.call'`
#### Description
This block describes the tests for the `call` method of the `DestroyService`.

#### Internal Logic
1. Sets up the necessary context before each test using the `before` block.
2. Defines two contexts: one for when the integration is present and another for when it's not found.

### Context: "when integration is present"
#### Description
Tests the behavior of the service when a valid integration collection mapping exists.

#### Internal Logic
1. Creates a Netsuite collection mapping associated with the integration.
2. Expects the `call` method to decrease the count of `IntegrationCollectionMappings::BaseCollectionMapping` by 1.

### Context: "when integration is not found"
#### Description
Tests the behavior of the service when the integration collection mapping is not found (nil).

#### Internal Logic
1. Sets the `integration_collection_mapping` to nil.
2. Calls the service and checks the result for an error.
3. Verifies that the result is not successful and has the correct error code.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used for creating test data (factories) |

## Error Handling
The test suite checks for error handling when the integration collection mapping is not found. It verifies that the service returns an unsuccessful result with the appropriate error code.

---

This test file ensures that the `IntegrationCollectionMappings::DestroyService` correctly handles both successful destruction of integration collection mappings and error cases when the mapping is not found. It uses RSpec's `describe`, `context`, and `it` blocks to organize the tests and FactoryBot to create test data.