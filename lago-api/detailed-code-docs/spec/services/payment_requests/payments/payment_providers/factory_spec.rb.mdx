---
title: "factory_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `PaymentRequests::Payments::PaymentProviders::Factory` class. It verifies that the factory correctly instantiates the appropriate payment service class based on the customer's payment provider.

## Code Structure
The test suite defines a single describe block for the `PaymentRequests::Payments::PaymentProviders::Factory` class, focusing on the `new_instance` class method. It uses context blocks to test different payment provider scenarios.

## Symbols

### PaymentRequests::Payments::PaymentProviders::Factory
#### Description
This is the main class being tested. It appears to be a factory class responsible for creating instances of payment service classes based on the customer's payment provider.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| payable | PaymentRequest | An instance of a PaymentRequest model |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| factory_service | PaymentService | An instance of a specific payment service class |

### #self.new_instance
#### Description
This is the class method being tested. It creates and returns an instance of the appropriate payment service class based on the customer's payment provider.

#### Internal Logic
The method likely uses the `payment_provider` attribute of the customer associated with the `payable` to determine which payment service class to instantiate.

## Test Cases

### Context: when stripe
#### Description
Tests the factory when the customer's payment provider is 'stripe'.

#### Internal Logic
1. Sets up a customer with 'stripe' as the payment provider.
2. Creates a payment request associated with this customer.
3. Calls the factory method with the payment request.
4. Expects the returned object to be an instance of 'PaymentRequests::Payments::StripeService'.

### Context: when adyen
#### Description
Tests the factory when the customer's payment provider is 'adyen'.

#### Internal Logic
1. Sets up a customer with 'adyen' as the payment provider.
2. Creates a payment request associated with this customer.
3. Calls the factory method with the payment request.
4. Expects the returned object to be an instance of 'PaymentRequests::Payments::AdyenService'.

### Context: when gocardless
#### Description
Tests the factory when the customer's payment provider is 'gocardless'.

#### Internal Logic
1. Sets up a customer with 'gocardless' as the payment provider.
2. Creates a payment request associated with this customer.
3. Calls the factory method with the payment request.
4. Expects the returned object to be an instance of 'PaymentRequests::Payments::GocardlessService'.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| FactoryBot | Used for creating test data (customers and payment requests) |

Note: The `rails_helper` file includes various testing configurations and helpers, including SimpleCov for code coverage, DatabaseCleaner, and other RSpec configurations.