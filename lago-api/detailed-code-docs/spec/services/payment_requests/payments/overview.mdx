---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for various payment-related services within the `PaymentRequests::Payments` namespace. The tests cover different payment providers (Adyen, GoCardless, and Stripe) as well as general payment creation and error handling services.

## What does it do?
These tests ensure that the payment services function correctly for different scenarios:

1. Creating payments through various providers (Adyen, GoCardless, Stripe)
2. Handling successful payment creation
3. Managing error scenarios and edge cases
4. Delivering error webhooks when necessary
5. Selecting the appropriate payment service based on the customer's payment provider

The tests simulate different payment scenarios, mock external API calls, and verify that the services behave as expected in various situations, including successful payments, error handling, and edge cases like zero-amount payments or missing payment providers.

## Key Files
1. `adyen_service_spec.rb`: Tests the Adyen payment service, covering successful payments, error handling, and edge cases.
2. `gocardless_service_spec.rb`: Tests the GoCardless payment service, including successful payment creation, error handling, and scenarios like zero-amount payments.
3. `stripe_service_spec.rb`: Tests the Stripe payment service, covering various scenarios such as successful payments, processing payments, and error handling.
4. `create_service_spec.rb`: Tests the service responsible for creating payments by enqueuing the appropriate job based on the customer's payment provider.
5. `deliver_error_webhook_service_spec.rb`: Tests the service that enqueues a job to send payment failure webhooks.
6. `payment_providers/factory_spec.rb`: Tests the factory class responsible for instantiating the appropriate payment service based on the customer's payment provider.

## Dependencies
The test files rely on several external libraries and frameworks:

1. RSpec: The testing framework used for writing and running the tests.
2. FactoryBot: Used for creating test data and objects.
3. Rails: The underlying web framework, with `rails_helper` used to load the Rails testing environment.
4. Adyen, GoCardless, and Stripe APIs: Mocked in the tests to simulate interactions with these payment providers.

## Configuration
The tests use various mocking and stubbing techniques to isolate the services being tested:

1. External API calls are mocked to prevent actual calls to payment providers during testing.
2. Test data is generated using FactoryBot factories.
3. The `rails_helper` file is used to load the Rails testing environment and configuration, including SimpleCov for code coverage and DatabaseCleaner for managing test data.

The tests cover a wide range of scenarios, ensuring that the payment services are robust and can handle various situations, from successful payments to error conditions and edge cases. This comprehensive test suite helps maintain the reliability and correctness of the payment processing system across different payment providers.