---
title: "factory_spec.rb"
---

## High-level description
This RSpec test file is designed to test the `Integrations::Aggregator::Contacts::Payloads::Factory` class. It verifies the functionality of creating and updating payload bodies for different types of customers (Netsuite, Xero, and Anrok) in an integration system.

## Code Structure
The test file is organized into three main describe blocks, each focusing on a different method of the Factory class: `new_instance`, `create_body`, and `update_body`. Within each block, there are context-specific tests for different customer types.

## Symbols

### `RSpec.describe Integrations::Aggregator::Contacts::Payloads::Factory`
#### Description
This is the main describe block for the Factory class, containing all the tests.

### `describe '.new_instance'`
#### Description
Tests the `new_instance` class method of the Factory.

#### Internal Logic
- Creates different types of integration customers (Netsuite, Xero, Anrok)
- Calls `new_instance` with the created customer
- Expects the returned object to be of the correct payload type

### `describe '#create_body'`
#### Description
Tests the `create_body` instance method of the Factory.

#### Internal Logic
- Creates different types of integration customers
- Calls `create_body` on the instance created by `new_instance`
- Verifies that the returned payload body contains the correct customer name

### `describe '#update_body'`
#### Description
Tests the `update_body` instance method of the Factory.

#### Internal Logic
- Creates different types of integration customers
- Calls `update_body` on the instance created by `new_instance`
- Verifies that the returned payload body contains the correct customer name and external customer ID

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails environment and RSpec configuration |
| FactoryBot | Used for creating test data |

## Configuration
The test file uses `let` statements to define shared variables:

| Option | Type | Description |
|:-------|:-----|:------------|
| customer | Object | The customer object associated with the integration customer |
| integration | Object | The integration object associated with the integration customer |
| subsidiary_id | String | A sample subsidiary ID used in the tests |
| integration_customer | Object | The main test object, created using FactoryBot for different customer types |

## Error Handling
This test file doesn't explicitly test error handling. It focuses on the happy path scenarios for different customer types.

## Notes
1. The test file uses FactoryBot to create test data, which allows for easy creation of different customer types (Netsuite, Xero, Anrok).
2. The tests use `aggregate_failures` in some cases to group multiple expectations together, allowing all expectations to be evaluated even if one fails.
3. The file structure follows RSpec best practices, using `describe` and `context` blocks to organize tests logically.
4. The tests cover the creation of new instances, creation of payload bodies, and updating of payload bodies for different customer types, ensuring comprehensive coverage of the Factory class functionality.