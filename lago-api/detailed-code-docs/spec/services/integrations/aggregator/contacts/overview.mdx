---
title: "Overview"
---

## High-level description

This directory contains RSpec test files for the `Integrations::Aggregator::Contacts` module, which is responsible for creating and updating customer contacts in various accounting systems, primarily NetSuite and Xero. The tests cover the creation and update services, as well as the payload generation for different integration types.

## What does it do?

The code in this directory tests the functionality of an integration aggregator service that manages customer contacts across different accounting systems. It ensures that:

1. Contacts can be created and updated in external systems like NetSuite and Xero.
2. Appropriate payloads are generated for different integration types (NetSuite, Xero, Anrok).
3. The system handles various scenarios, including successful operations and different types of errors.
4. Customer data, such as addresses, email addresses, and phone numbers, are correctly formatted and transmitted.
5. Webhooks are properly enqueued for both successful operations and errors.

These tests are crucial for maintaining the integrity and reliability of the integration system, ensuring that customer data is correctly managed across different external accounting platforms.

## Key Files

1. `create_service_spec.rb`:
   - Tests the `Integrations::Aggregator::Contacts::CreateService` class.
   - Verifies the correct creation of contacts in NetSuite and Xero.
   - Tests various success and error scenarios, including server errors and payload errors.

2. `update_service_spec.rb`:
   - Tests the `Integrations::Aggregator::Contacts::UpdateService` class.
   - Ensures proper updating of contact information in NetSuite and Xero.
   - Covers scenarios for successful updates and different types of errors.

3. `payloads/factory_spec.rb`:
   - Tests the `Integrations::Aggregator::Contacts::Payloads::Factory` class.
   - Verifies the correct creation of payload instances for different customer types.

4. `payloads/netsuite_spec.rb`:
   - Tests the `Integrations::Aggregator::Contacts::Payloads::Netsuite` class.
   - Ensures correct generation of payload bodies for creating and updating NetSuite customer records.
   - Tests various scenarios, including different address configurations and legacy script settings.

## Dependencies

The test files rely on the following key dependencies:

| Dependency | Purpose | Version |
|:-----------|:--------|:--------|
| rails_helper | Loads Rails environment and RSpec configuration | Not specified |
| FactoryBot | Used for creating test data | Not specified |
| Faker | Generates fake data for tests | Not specified |
| LagoHttpClient::Client | Mocked to simulate HTTP requests to the integration service | Not specified |

These dependencies are crucial for setting up the test environment, generating test data, and simulating external service interactions.

## Configuration

The test files use `let` statements to define shared variables and test data. For example:

```ruby
let(:customer) { create(:customer) }
let(:organization) { customer.organization }
let(:lago_client) { instance_double(LagoHttpClient::Client) }
let(:endpoint) { 'https://api.getlago.com/api/v1/contacts' }
```

These configurations allow for flexible and reusable test setups, making it easier to test different scenarios and edge cases.

The tests are organized using RSpec's `describe` and `context` blocks to improve readability and maintainability. They cover various aspects of the integration process, including:

- Successful creation and updating of contacts
- Error handling for server errors, payload errors, and client errors
- Correct payload generation for different integration types
- Proper handling of customer data, including addresses, email addresses, and phone numbers
- Webhook delivery for both successful operations and errors

In summary, this directory contains comprehensive tests for the contact management system of the integration module, focusing on creation, updating, and payload generation for different accounting systems. The tests ensure that the system can correctly handle various customer types, scenarios, and error conditions, providing confidence in the reliability of the integration process.