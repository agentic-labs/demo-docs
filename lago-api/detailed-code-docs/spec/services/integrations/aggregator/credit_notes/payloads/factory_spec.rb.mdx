---
title: "factory_spec.rb"
---

## High-level description
This RSpec test file describes the behavior of the `Integrations::Aggregator::CreditNotes::Payloads::Factory` class. It tests the `.new_instance` method, which creates and returns the appropriate payload object based on the type of integration customer provided.

## Code Structure
The test file contains a single describe block for the `.new_instance` method, with three contexts testing different types of integration customers: Netsuite, Xero, and Anrok.

## Symbols

### `Integrations::Aggregator::CreditNotes::Payloads::Factory.new_instance`
#### Description
This class method creates and returns a payload object based on the type of integration customer provided.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| integration_customer | Object | An object representing the integration customer (Netsuite, Xero, or Anrok) |
| credit_note | Object | A credit note object |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| payload | Object | An instance of the appropriate payload class (Netsuite, Xero, or Anrok) |

#### Internal Logic
The method determines the type of integration customer and returns the corresponding payload object:
1. For Netsuite customers, it returns a `Netsuite` payload object.
2. For Xero customers, it returns a `Xero` payload object.
3. For Anrok customers, it returns an `Anrok` payload object.

### Test Contexts

#### Context: "when customer is a netsuite customer"
##### Description
Tests the behavior when the integration customer is a Netsuite customer.

##### Internal Logic
1. Creates a Netsuite customer using FactoryBot.
2. Expects the returned object to be an instance of `Integrations::Aggregator::CreditNotes::Payloads::Netsuite`.

#### Context: "when customer is a xero customer"
##### Description
Tests the behavior when the integration customer is a Xero customer.

##### Internal Logic
1. Creates a Xero customer using FactoryBot.
2. Expects the returned object to be an instance of `Integrations::Aggregator::CreditNotes::Payloads::Xero`.

#### Context: "when customer is an anrok customer"
##### Description
Tests the behavior when the integration customer is an Anrok customer.

##### Internal Logic
1. Creates an Anrok customer using FactoryBot.
2. Expects the returned object to be an instance of `Integrations::Aggregator::CreditNotes::Payloads::Anrok`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Provides the necessary setup for Rails-specific RSpec testing |
| FactoryBot | Used to create test objects (credit_note and integration customers) |

Note: The related files show the implementation of the `Factory` class and the payload classes (`Netsuite`, `Xero`, and `Anrok`), which are being tested in this spec file.