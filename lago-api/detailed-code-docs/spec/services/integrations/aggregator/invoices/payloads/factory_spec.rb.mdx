---
title: "factory_spec.rb"
---

## High-level description
This RSpec test file is designed to verify the functionality of the `Integrations::Aggregator::Invoices::Payloads::Factory` class, specifically its `new_instance` method. The tests ensure that the factory returns the correct payload object based on the type of integration customer provided.

## Symbols

### `Integrations::Aggregator::Invoices::Payloads::Factory.new_instance`
#### Description
This class method is responsible for creating and returning the appropriate payload object based on the integration customer type.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| integration_customer | Object | An instance of a customer integration (Netsuite, Xero, or Anrok) |
| invoice | Object | An instance of an invoice |
| type | String | The type of payload (e.g., 'invoice') |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| payload | Object | An instance of a specific payload class (Netsuite, Xero, or Anrok) |

### RSpec Tests
#### Description
The test suite contains three contexts, each testing a different type of integration customer: Netsuite, Xero, and Anrok.

#### Internal Logic
For each context:
1. Arrange: Create a mock integration customer and invoice using FactoryBot.
2. Act: Call the `new_instance` method with the arranged objects.
3. Assert: Verify that the returned object is an instance of the expected payload class.

___

### `context 'when customer is a netsuite customer'`
#### Description
Tests the factory's behavior when provided with a Netsuite customer.

#### Internal Logic
- Arranges a Netsuite customer using FactoryBot.
- Expects the returned payload to be an instance of `Integrations::Aggregator::Invoices::Payloads::Netsuite`.

___

### `context 'when customer is a xero customer'`
#### Description
Tests the factory's behavior when provided with a Xero customer.

#### Internal Logic
- Arranges a Xero customer using FactoryBot.
- Expects the returned payload to be an instance of `Integrations::Aggregator::Invoices::Payloads::Xero`.

___

### `context 'when customer is an anrok customer'`
#### Description
Tests the factory's behavior when provided with an Anrok customer.

#### Internal Logic
- Arranges an Anrok customer using FactoryBot.
- Expects the returned payload to be an instance of `Integrations::Aggregator::Invoices::Payloads::Anrok`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used to create test objects (customers and invoices) |

Note: The `rails_helper` file is included in the related code snippets and sets up the testing environment, including SimpleCov for code coverage, database cleaner configuration, and various RSpec configurations.