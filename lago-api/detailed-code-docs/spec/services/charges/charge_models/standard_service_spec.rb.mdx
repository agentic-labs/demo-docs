---
title: "standard_service_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Charges::ChargeModels::StandardService` class. It tests the functionality of applying a standard charge model to a given charge and aggregation result, verifying the correct calculation of amounts and handling of different input scenarios.

## Symbols

### `RSpec.describe Charges::ChargeModels::StandardService, type: :service`
#### Description
This is the main describe block for the test suite, focusing on the `Charges::ChargeModels::StandardService` class and specifying it as a service type test.

### `subject(:apply_standard_service)`
#### Description
Defines the subject of the test, which is the result of calling the `apply` method on the described class with specific parameters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| charge | Object | The charge object to be processed |
| aggregation_result | BaseService::Result | The result object containing aggregation data |
| properties | Hash | Properties of the charge |

### `before` block
#### Description
Sets up the test environment by populating the `aggregation_result` object with test data before each test.

### `let` statements
#### Description
Define variables used across the tests, including `aggregation_result`, `aggregation`, `total_aggregated_units`, `full_units_number`, and `charge`.

### Main test case
#### Description
Tests the basic functionality of applying the standard charge model.

#### Internal Logic
1. Calls the `apply` method on the service.
2. Checks if the resulting `amount` is correctly calculated (51.2345).
3. Verifies that the `unit_amount` is set correctly (5.12345).

### Context: "when aggregation result contains total_aggregated_units"
#### Description
Tests the behavior when the aggregation result includes `total_aggregated_units`.

#### Internal Logic
Verifies that the `total_aggregated_units` value is correctly assigned to the result.

### Context: "when aggregation result contains full_units_number"
#### Description
Tests the behavior when the aggregation result includes `full_units_number`.

#### Internal Logic
Checks if the `unit_amount` is correctly calculated based on the `full_units_number` (0.512345).

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used for creating test objects (`:standard_charge`) |

## Notes
1. The test uses FactoryBot to create a standard charge with specific properties.
2. The service seems to handle different scenarios based on the presence of `total_aggregated_units` and `full_units_number`.
3. The test focuses on verifying the correct calculation of amounts and proper assignment of values in the result object.