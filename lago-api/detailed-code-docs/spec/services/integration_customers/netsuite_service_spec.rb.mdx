---
title: "netsuite_service_spec.rb"
---

## High-level description
This RSpec test file describes the behavior of the `IntegrationCustomers::NetsuiteService` class, specifically its `create` method. The test ensures that the service correctly creates a new Netsuite customer integration and returns the expected result.

## Code Structure
The test file defines a single describe block for the `IntegrationCustomers::NetsuiteService` class, with a nested describe block for the `#create` method. It uses let statements to set up test data and mocks, and includes two test cases to verify the behavior of the `create` method.

## Symbols

### `RSpec.describe IntegrationCustomers::NetsuiteService`
#### Description
This is the main describe block for the `IntegrationCustomers::NetsuiteService` class.

### `describe '#create'`
#### Description
This nested describe block focuses on testing the `create` method of the `IntegrationCustomers::NetsuiteService` class.

### `let` statements
#### Description
These statements set up test data and mocks used throughout the tests.

### `subject(:service_call)`
#### Description
Defines the subject of the test, which is a call to the `create` method of `IntegrationCustomers::NetsuiteService`.

### `before` block
#### Description
Sets up mocks for the `Integrations::Aggregator::Contacts::CreateService` class and its `call` method.

### `it 'returns integration customer'`
#### Description
This test case verifies that the `create` method returns a successful result with the expected integration customer attributes.

#### Internal Logic
1. Calls the service method
2. Checks that the aggregator service was called
3. Verifies the success status of the result
4. Checks various attributes of the returned integration customer

### `it 'creates integration customer'`
#### Description
This test case ensures that calling the `create` method increases the count of `IntegrationCustomers::NetsuiteCustomer` records by 1.

#### Internal Logic
Uses a change matcher to verify that the count of `IntegrationCustomers::NetsuiteCustomer` records increases by 1 when the service is called.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| BaseService::Result | Used to create a mock result object |
| Integrations::Aggregator::Contacts::CreateService | Mocked service for creating contacts |
| IntegrationCustomers::NetsuiteCustomer | The model being tested for creation |

## Error Handling
The test file does not explicitly test error handling scenarios. It focuses on the successful creation of an integration customer.

## Notes
- The test uses `aggregate_failures` to group multiple expectations together, allowing all expectations to be evaluated even if one fails.
- The test mocks the `Integrations::Aggregator::Contacts::CreateService` to isolate the behavior of the `NetsuiteService`.
- The test verifies both the returned result and the side effect of creating a new record in the database.