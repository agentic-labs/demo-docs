---
title: "create_or_update_service_spec.rb"
---

## High-level description
This RSpec test file describes the behavior of the `IntegrationCustomers::CreateOrUpdateService` service. It tests various scenarios for creating, updating, and removing integration customers, focusing on different combinations of input parameters and existing data.

## Code Structure
The test file is organized into a single `RSpec.describe` block for the `IntegrationCustomers::CreateOrUpdateService`. Within this block, there are multiple nested `context` blocks that test different scenarios for the `#call` method of the service.

## Symbols

### `IntegrationCustomers::CreateOrUpdateService.call`
#### Description
This is the main method being tested. It handles the creation, update, or removal of integration customers based on the provided parameters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| integration_customers | Array | List of integration customer data |
| customer | Customer | The customer object |
| new_customer | Boolean | Indicates if it's a new customer |

#### Internal Logic
The method's behavior changes based on the input parameters and existing data. It can:
1. Create new integration customers
2. Update existing integration customers
3. Remove integration customers
4. Handle multiple integration customers simultaneously

## Test Scenarios

### Without integration
Tests that no jobs are enqueued when the integration doesn't exist.

### Without customer
Tests that no jobs are enqueued when the customer is nil.

### Without external fields set
Tests that no jobs are enqueued when external fields are not set.

### Removing integration customer
Tests the removal of integration customers and handling of existing customers that should be removed or updated.

### Updating integration customer
Tests the update of existing integration customers.

### Creating integration customer
Tests the creation of new integration customers, including scenarios with multiple integrations and adding new integration customers to existing ones.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment |
| FactoryBot | Used for creating test data |

## Error Handling
The tests don't explicitly cover error handling scenarios. They focus on the expected behavior of the service under different conditions.

## Logging
No specific logging mechanisms are tested in this file.

## API/Interface Reference
This test file doesn't define an API but tests the interface of the `IntegrationCustomers::CreateOrUpdateService.call` method.