---
title: "update_service_spec.rb"
---

## High-level description
This RSpec test file describes the behavior of the `IntegrationCustomers::UpdateService` class. It focuses on testing the `call` method of the service, specifically for Netsuite premium integration scenarios, examining how the service handles different input parameters and integration states.

## Code Structure
The test file is organized into a single `describe` block for the `#call` method, with nested contexts for different scenarios. It uses let statements to set up test data and mocks, and employs RSpec's `around` block to simulate a premium environment.

## Symbols

### `RSpec.describe IntegrationCustomers::UpdateService`
#### Description
This is the main describe block for the `IntegrationCustomers::UpdateService` class, focusing on the `#call` method.

### `#call`
#### Description
Tests the `call` method of the `IntegrationCustomers::UpdateService` class under various conditions.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| params | Hash | Contains integration details and customer information |
| integration | Object | The integration object |
| integration_customer | Object | The integration customer object |

#### Internal Logic
1. Sets up test data and mocks using `let` statements.
2. Uses an `around` block to simulate a premium environment.
3. Tests different scenarios based on the `sync_with_provider` flag and the presence of `external_customer_id`.
4. Verifies the behavior of the service, including calls to the `Integrations::Aggregator::Contacts::UpdateService`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Provides Rails-specific testing configurations |
| IntegrationCustomers::UpdateService | The service being tested |
| Integrations::Aggregator::Contacts::UpdateService | Mocked service for updating contacts |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| lago_premium! | Method | N/A | Simulates a premium environment for testing |

## Error Handling
The test file doesn't explicitly test error handling scenarios but focuses on successful update cases.

## Notes
- The test file uses RSpec's `let` statements extensively to set up test data and mocks.
- It employs `aggregate_failures` to group multiple expectations together.
- The test simulates both scenarios where `sync_with_provider` is true and false.
- It checks for the correct updating of `external_customer_id` and `subsidiary_id` under different conditions.
- The test file mocks the `Integrations::Aggregator::Contacts::UpdateService` to isolate the behavior of the `IntegrationCustomers::UpdateService`.

This test file provides comprehensive coverage for the `IntegrationCustomers::UpdateService`, ensuring it behaves correctly under various conditions related to Netsuite premium integration scenarios.