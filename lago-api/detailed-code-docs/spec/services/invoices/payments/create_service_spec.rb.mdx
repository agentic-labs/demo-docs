---
title: "create_service_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Invoices::Payments::CreateService` class. It verifies that the service correctly enqueues jobs for creating payments based on the customer's payment provider, either Stripe or GoCardless.

## Symbols

### `RSpec.describe Invoices::Payments::CreateService`
#### Description
This is the main describe block for the `Invoices::Payments::CreateService` test suite. It sets up the context for testing the service's functionality.

#### Internal Logic
- Defines the subject of the test as an instance of `Invoices::Payments::CreateService`.
- Sets up test data using FactoryBot to create an invoice, customer, and payment provider.

### `describe '#call'`
#### Description
This nested describe block focuses on testing the `#call` method of the `CreateService`.

#### Internal Logic
- Tests the behavior of the `#call` method for different payment providers.

### `it 'enqueues a job to create a stripe payment'`
#### Description
This test ensures that calling the service enqueues a Stripe payment creation job when the payment provider is Stripe.

#### Internal Logic
- Arranges: The payment provider is set to 'stripe' (default).
- Acts: Calls the `create_service.call` method.
- Asserts: Expects the `Invoices::Payments::StripeCreateJob` to be enqueued.

### `context 'with gocardless payment provider'`
#### Description
This context block tests the behavior when the payment provider is GoCardless.

#### Internal Logic
- Sets the payment provider to 'gocardless'.
- Contains a test similar to the Stripe test, but for GoCardless.

### `it 'enqueues a job to create a gocardless payment'`
#### Description
This test ensures that calling the service enqueues a GoCardless payment creation job when the payment provider is GoCardless.

#### Internal Logic
- Arranges: The payment provider is set to 'gocardless'.
- Acts: Calls the `create_service.call` method.
- Asserts: Expects the `Invoices::Payments::GocardlessCreateJob` to be enqueued.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used for creating test data (invoice, customer) |
| RSpec | The testing framework used for writing and running the tests |

Note: The `rails_helper` file is included in the related code snippets and sets up the testing environment, including SimpleCov for code coverage, database cleaner, and various RSpec configurations.