---
title: "factory_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `Invoices::Payments::PaymentProviders::Factory` class. It verifies that the factory correctly instantiates the appropriate payment service class based on the customer's payment provider.

## Code Structure
The test suite defines a single describe block for the `Invoices::Payments::PaymentProviders::Factory` class, focusing on the `new_instance` class method. It uses context blocks to test different payment provider scenarios.

## Symbols

### RSpec.describe Invoices::Payments::PaymentProviders::Factory
#### Description
This is the main describe block for the test suite, targeting the `Invoices::Payments::PaymentProviders::Factory` class.

### #self.new_instance
#### Description
This method is the main focus of the test suite. It's responsible for creating the appropriate payment service instance based on the customer's payment provider.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| invoice | Invoice | An invoice object associated with a customer |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| factory_service | PaymentService | An instance of the appropriate payment service class |

#### Internal Logic
The method determines the correct payment service class based on the customer's payment provider and returns an instance of that class.

### context 'when stripe'
#### Description
Tests the factory's behavior when the payment provider is 'stripe'.

#### Internal Logic
It expects the factory to return an instance of `Invoices::Payments::StripeService`.

### context 'when adyen'
#### Description
Tests the factory's behavior when the payment provider is 'adyen'.

#### Internal Logic
It expects the factory to return an instance of `Invoices::Payments::AdyenService`.

### context 'when gocardless'
#### Description
Tests the factory's behavior when the payment provider is 'gocardless'.

#### Internal Logic
It expects the factory to return an instance of `Invoices::Payments::GocardlessService`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails and RSpec configuration |
| FactoryBot | Used for creating test data (invoice and customer) |

## Configuration
The test suite uses the following FactoryBot factories:
| Factory | Description |
|:--------|:------------|
| :invoice | Creates an invoice object |
| :customer | Creates a customer object with a specified payment provider |

## Error Handling
This test suite does not explicitly test error handling. It focuses on the happy path where the factory successfully creates the appropriate service instance.