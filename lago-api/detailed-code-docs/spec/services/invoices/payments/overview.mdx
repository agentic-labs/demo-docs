---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for various services related to invoice payments in a Rails application. The services handle payment processing, retrying failed payments, and generating payment URLs for different payment providers such as Stripe, GoCardless, and Adyen.

## What does it do?
The code in this directory tests the functionality of several services that manage invoice payments. These services are responsible for:

1. Creating payments through different payment providers (Stripe, GoCardless, Adyen)
2. Updating payment statuses
3. Generating payment URLs for customers to complete their payments
4. Retrying failed payments
5. Handling error scenarios and delivering error webhooks
6. Providing a factory for creating the appropriate payment service based on the customer's payment provider

The tests ensure that these services work correctly under various scenarios, including successful payments, failed payments, edge cases, and error conditions.

## Key Files

1. `adyen_service_spec.rb`: Tests the Adyen payment service, covering payment creation, status updates, and URL generation.

2. `create_service_spec.rb`: Tests the service responsible for enqueuing jobs to create payments based on the customer's payment provider.

3. `deliver_error_webhook_service_spec.rb`: Tests the service that sends webhook notifications for payment failures.

4. `generate_payment_url_service_spec.rb`: Tests the service that generates payment URLs for invoices, handling various scenarios and error cases.

5. `gocardless_service_spec.rb`: Tests the GoCardless payment service, covering payment creation and status updates.

6. `payment_providers/factory_spec.rb`: Tests the factory class that creates the appropriate payment service based on the customer's payment provider.

7. `retry_batch_service_spec.rb`: Tests the service that retries failed payments in batches for a given organization.

8. `retry_service_spec.rb`: Tests the service that retries individual failed payments.

9. `stripe_service_spec.rb`: Tests the Stripe payment service, covering payment creation, status updates, and URL generation.

## Dependencies
The test files rely on several external libraries and frameworks:

1. RSpec: The testing framework used for writing and running the tests.
2. FactoryBot: Used for creating test data (invoices, customers, etc.).
3. Stripe, GoCardless, and Adyen API clients: Mocked in the tests to simulate API responses.

## Configuration
The tests use RSpec configuration provided by the `rails_helper`, which sets up the testing environment, including SimpleCov for code coverage, database cleaner, and various RSpec configurations.

The tests make extensive use of mocking and stubbing to isolate the behavior of the services and avoid making real API calls to external payment providers.

In summary, this directory contains a comprehensive set of tests for invoice payment services, ensuring that the application can handle various payment scenarios across multiple payment providers while maintaining robustness and error handling.