---
title: "destroy_service_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `IntegrationMappings::DestroyService` class. It verifies the behavior of the service when destroying integration mappings, covering scenarios where the integration mapping is present and when it's not found.

## Symbols

### `RSpec.describe IntegrationMappings::DestroyService`
#### Description
This is the main describe block for the `IntegrationMappings::DestroyService` test suite. It sets up the context for testing the destroy service.

#### Internal Logic
- Sets up the subject as an instance of `IntegrationMappings::DestroyService`
- Defines let blocks for creating necessary test data (integration, organization, membership)

### `describe '.call'`
#### Description
This describe block focuses on testing the `call` method of the `IntegrationMappings::DestroyService`.

#### Internal Logic
- Sets up a before block to ensure the integration_mapping is created before each test
- Contains two context blocks for different scenarios

### `context 'when integration is present'`
#### Description
This context tests the behavior when a valid integration mapping exists.

#### Internal Logic
- Creates a Netsuite mapping associated with the integration
- Tests if the `call` method destroys the integration mapping

### `context 'when integration is not found'`
#### Description
This context tests the behavior when the integration mapping is nil.

#### Internal Logic
- Sets the integration_mapping to nil
- Tests if the `call` method returns an error result

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| FactoryBot | Used for creating test data (implied by the use of `create` method) |

## References
The test file references the following classes and modules:
- `IntegrationMappings::DestroyService`
- `IntegrationMappings::BaseMapping`

## Error Handling
The test checks for error handling in the case where the integration mapping is not found. It expects the service to return an unsuccessful result with a specific error code.

## Notes
1. The test uses FactoryBot for creating test data, as evidenced by the `create` method calls.
2. The test is using RSpec's `aggregate_failures` for grouping multiple expectations.
3. The test is checking both the happy path (successful destruction) and an error case (mapping not found).
4. The test is focused on the behavior of the `call` method of the service.

This test suite ensures that the `IntegrationMappings::DestroyService` correctly handles the destruction of integration mappings and properly reports errors when the mapping is not found.