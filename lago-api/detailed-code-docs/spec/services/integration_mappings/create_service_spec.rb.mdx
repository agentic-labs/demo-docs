---
title: "create_service_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `IntegrationMappings::CreateService` class. It tests the functionality of creating integration mappings, specifically for NetSuite integrations, and verifies the behavior of the service under different scenarios.

## Code Structure
The test suite is organized into a single `describe` block for the `IntegrationMappings::CreateService` class, with a nested `describe` block for the `#call` method. It uses let statements to set up test data and contexts to test different scenarios.

## Symbols

### RSpec.describe IntegrationMappings::CreateService
#### Description
This is the main describe block that groups all tests for the `IntegrationMappings::CreateService` class.

### #call
#### Description
This describe block focuses on testing the `call` method of the `IntegrationMappings::CreateService` class.

#### Internal Logic
The test suite sets up various scenarios to test the `call` method:
1. It tests the successful creation of an integration mapping.
2. It verifies the attributes of the created mapping.
3. It checks the return value of the service call.
4. It tests the behavior when there's a validation error.

### let statements
#### Description
These statements set up the test data used across the specs.

| Name | Type | Description |
|:-----|:-----|:------------|
| service | IntegrationMappings::CreateService | The service instance being tested |
| integration | NetsuiteIntegration | A created NetSuite integration |
| organization | Organization | The organization associated with the membership |
| membership | Membership | A created membership |
| add_on | AddOn | A created add-on associated with the organization |

### subject(:service_call)
#### Description
This defines the subject of the test, which is the call to the service's `call` method with the specified arguments.

### context 'without validation errors'
#### Description
This context block tests the successful scenario where an integration mapping is created without errors.

#### Internal Logic
1. It checks if the count of `IntegrationMappings::NetsuiteMapping` increases by 1.
2. It verifies the attributes of the created mapping.
3. It ensures that the service call returns an integration mapping in the result object.

### context 'with validation error'
#### Description
This context block tests the scenario where there's a validation error due to missing required arguments.

#### Internal Logic
1. It checks if the result is not successful.
2. It verifies that the error is of type `BaseService::NotFoundFailure`.
3. It checks the error message.

## Dependencies
The test suite depends on the following:
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used for creating test data |
| RSpec | The testing framework used |

## Configuration
The test suite uses RSpec configuration, which is likely defined in the `rails_helper.rb` file. It includes FactoryBot syntax methods and sets the test type to `:service`.