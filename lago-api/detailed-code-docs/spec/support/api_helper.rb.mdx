---
title: "api_helper.rb"
---

## High-level description
This code defines an `ApiHelper` module that provides utility methods for making HTTP requests with authentication tokens. It simplifies the process of sending GET, POST, PUT, and DELETE requests with proper headers and JSON parsing of responses.

## Symbols

### `ApiHelper`
#### Description
A module that encapsulates helper methods for making authenticated API requests and parsing JSON responses.

### `get_with_token`
#### Description
Sends a GET request with authentication token and custom headers.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Object | The organization object containing the API key |
| path | String | The API endpoint path |
| params | Hash | Query parameters (optional, default: empty hash) |
| headers | Hash | Custom headers (optional, default: empty hash) |

#### Internal Logic
1. Sets the headers using the `set_headers` method
2. Calls the `get` method with the provided path, params, and headers

### `post_with_token`
#### Description
Sends a POST request with authentication token and custom headers.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Object | The organization object containing the API key |
| path | String | The API endpoint path |
| params | Hash | Request body parameters (optional, default: empty hash) |
| headers | Hash | Custom headers (optional, default: empty hash) |

#### Internal Logic
1. Sets the headers using the `set_headers` method
2. Calls the `post` method with the provided path, JSON-encoded params, and headers

### `put_with_token`
#### Description
Sends a PUT request with authentication token and custom headers.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Object | The organization object containing the API key |
| path | String | The API endpoint path |
| params | Hash | Request body parameters (optional, default: empty hash) |
| headers | Hash | Custom headers (optional, default: empty hash) |

#### Internal Logic
1. Sets the headers using the `set_headers` method
2. Calls the `put` method with the provided path, JSON-encoded params, and headers

### `delete_with_token`
#### Description
Sends a DELETE request with authentication token and custom headers.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Object | The organization object containing the API key |
| path | String | The API endpoint path |
| params | Hash | Request body parameters (optional, default: empty hash) |
| headers | Hash | Custom headers (optional, default: empty hash) |

#### Internal Logic
1. Sets the headers using the `set_headers` method
2. Calls the `delete` method with the provided path, JSON-encoded params, and headers

### `json`
#### Description
Parses the response body as JSON if the response content type is JSON.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| parsed_json | Hash/Array | Parsed JSON response with symbolized keys |

#### Internal Logic
1. Checks if the response media type includes 'json'
2. If it's JSON, parses the response body using `JSON.parse` with `symbolize_names: true`
3. If it's not JSON, returns the raw response body

### `set_headers` (private)
#### Description
Sets the necessary headers for API requests, including content type, accept, and authorization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Object | The organization object containing the API key |
| headers | Hash | Custom headers to be modified |

#### Internal Logic
1. Sets the 'Content-Type' header to 'application/json'
2. Sets the 'Accept' header to 'application/json'
3. Sets the 'Authorization' header to "Bearer {organization.api_key}"

## Dependencies
This module likely depends on a testing framework (such as RSpec) and a HTTP client library (such as Faraday or Net::HTTP), which are not explicitly shown in the code.

## Error Handling
The code does not implement explicit error handling. It relies on the underlying HTTP client to raise exceptions for network errors or invalid responses.

## API/Interface Reference
This module is designed to be included in test files or other modules that need to make authenticated API requests. The main interface consists of the following methods:

| Method | Description |
|:-------|:------------|
| `get_with_token` | Sends an authenticated GET request |
| `post_with_token` | Sends an authenticated POST request |
| `put_with_token` | Sends an authenticated PUT request |
| `delete_with_token` | Sends an authenticated DELETE request |
| `json` | Parses the response body as JSON |

These methods should be called with an organization object (containing an `api_key`), a path, and optionally params and headers.