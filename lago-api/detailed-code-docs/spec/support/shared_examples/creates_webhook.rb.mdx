---
title: "creates_webhook.rb"
---

## High-level description
This code defines a shared example for RSpec tests that verifies the creation of a webhook with specific attributes. It's designed to be reused across different test scenarios where webhook creation needs to be validated.

## Symbols

### `RSpec.shared_examples 'creates webhook'`
#### Description
This shared example defines a test case for creating a webhook. It takes three parameters: `webhook_type`, `object_type`, and an optional `object` hash.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| webhook_type | Symbol or String | The type of webhook being created |
| object_type | Symbol or String | The type of object associated with the webhook |
| object | Hash | Optional. Additional attributes for the object |

#### Internal Logic
The shared example contains a single test case that:
1. Calls a `webhook_service.call` method (not defined in this file).
2. Retrieves the most recently created `Webhook` from the database.
3. Verifies that the webhook's payload matches the expected structure and content.

The test uses RSpec's `expect` method to assert that the webhook's payload includes:
- The correct `webhook_type`
- The correct `object_type`
- A hash including the provided `object` attributes under the `object_type` key

## References
This shared example likely references:
- A `Webhook` model (defined in app/models/webhook.rb)
- A `webhook_service` object (not shown in the provided code)

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| RSpec | Testing framework used for defining the shared example |

## Notes
1. The `webhook_service` object and its `call` method are not defined in this file. They are expected to be defined and available in the context where this shared example is used.
2. The test assumes that the `webhook_service.call` method creates a new `Webhook` record in the database.
3. The `Webhook` model (from the related code snippet) has a `payload` attribute that is stored as JSON and includes additional logic for backward compatibility with older string-based payloads.
4. This shared example can be included in other test files to reuse this webhook creation verification logic across different scenarios.