---
title: "Overview"
---

## High-level description
This directory contains RSpec tests for the API endpoints of version 1 (v1) of the application. The tests cover various controllers and their actions, ensuring proper functionality of the API, including CRUD operations, data retrieval, and specific business logic implementations.

## What does it do?
The test suite in this directory verifies the behavior of multiple API endpoints, including but not limited to:

1. Add-ons management (creation, updating, retrieval, deletion)
2. Analytics data retrieval (gross revenues, invoice collections, MRR, etc.)
3. Applied coupons handling
4. Billable metrics management
5. Credit notes operations
6. Customer management
7. Events handling
8. Fees management
9. Invoice operations
10. Organization management
11. Payment requests handling
12. Plans management
13. Subscriptions handling
14. Taxes management
15. Wallet and wallet transactions operations
16. Webhook endpoints management
17. Public key retrieval for webhook signature verification

These tests simulate HTTP requests to the application's API endpoints and verify the responses, ensuring that the API behaves correctly under various conditions, handles errors appropriately, and returns the expected data structures.

## Key Files
1. `add_ons_controller_spec.rb`: Tests CRUD operations for add-ons.
2. `analytics/`: Directory containing tests for various analytics endpoints.
3. `applied_coupons_controller_spec.rb`: Tests applying and listing coupons.
4. `billable_metrics_controller_spec.rb`: Tests CRUD operations for billable metrics.
5. `credit_notes_controller_spec.rb`: Tests credit note operations.
6. `customers/`: Directory containing tests for customer-related operations.
7. `events_controller_spec.rb`: Tests event handling and fee estimation.
8. `fees_controller_spec.rb`: Tests fee-related operations.
9. `invoices_controller_spec.rb`: Tests invoice management.
10. `organizations_controller_spec.rb`: Tests organization-related operations.
11. `payment_requests_controller_spec.rb`: Tests payment request creation and retrieval.
12. `plans_controller_spec.rb`: Tests CRUD operations for plans.
13. `subscriptions_controller_spec.rb`: Tests subscription management.
14. `taxes_controller_spec.rb`: Tests CRUD operations for taxes.
15. `wallet_transactions_controller_spec.rb`: Tests wallet transaction operations.
16. `wallets_controller_spec.rb`: Tests wallet management.
17. `webhook_endpoints_controller_spec.rb`: Tests webhook endpoint management.
18. `webhooks_controller_spec.rb`: Tests public key retrieval for webhook signature verification.

## Dependencies
The test suite relies on the following key dependencies:

1. RSpec: The testing framework used for writing and running the tests.
2. FactoryBot: Used for creating test data (e.g., organizations, customers, plans).
3. Rails: The web application framework that the API is built on.
4. SimpleCov: Used for code coverage analysis.
5. DatabaseCleaner: Used for managing test database state.

Additionally, the tests use custom helper methods and modules for authentication, making API requests, and setting up test environments.

## Configuration
The tests are configured as request specs (`type: :request`), which simulate HTTP requests to the application. They use the `rails_helper` to load the Rails testing environment and configuration.

Some tests use time manipulation with the `travel_to` method to set specific date contexts for testing time-sensitive functionality.

Many tests use `aggregate_failures` to group multiple expectations together, allowing all expectations to be evaluated even if one fails.

## Notes
1. The tests cover both standard and premium features, often using a `lago_premium!` method to enable premium functionality for specific tests.
2. Error handling is thoroughly tested, including cases like non-existent resources, invalid parameters, and unauthorized access.
3. Pagination is tested for endpoints that support it, ensuring proper behavior with different page sizes and page numbers.
4. The tests make extensive use of factories to create test data, which helps in maintaining consistent and easily modifiable test scenarios.
5. Some tests mock external services or API calls (e.g., Stripe API) to isolate the behavior of the application's API endpoints.

This comprehensive test suite ensures that the v1 API endpoints function correctly, handle various scenarios appropriately, and maintain the expected behavior as the application evolves.