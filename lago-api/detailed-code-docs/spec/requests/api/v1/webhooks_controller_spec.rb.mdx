---
title: "webhooks_controller_spec.rb"
---

## High-level description
This code is a RSpec test suite for the Api::V1::WebhooksController. It tests two endpoints: one that returns a public key used for verifying webhook signatures, and another that returns the same key in a JSON format.

## Symbols

### RSpec.describe Api::V1::WebhooksController
#### Description
This is the main describe block for the WebhooksController tests. It sets up the context for testing the controller's endpoints.

#### Internal Logic
- Creates an organization using FactoryBot
- Contains two nested describe blocks for testing different endpoints

### describe 'public_key'
#### Description
This describe block tests the endpoint that returns the public key used for verifying webhook signatures.

#### Internal Logic
- Makes a GET request to '/api/v1/webhooks/public_key' with an authentication token
- Expects a successful HTTP response
- Verifies that the response body matches the encoded public key

### describe 'json_public_key'
#### Description
This describe block tests the endpoint that returns the public key in a JSON format.

#### Internal Logic
- Makes a GET request to '/api/v1/webhooks/json_public_key' with an authentication token
- Expects a successful HTTP response
- Verifies that the JSON response contains the encoded public key in the expected structure

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails and RSpec configuration |
| FactoryBot | Used for creating test data (organization) |

## References
- `get_with_token`: A helper method (likely defined in a support file) used to make authenticated GET requests
- `RsaPublicKey`: A constant or class (not shown in the provided code) that represents the RSA public key used for webhook signature verification

## Notes
1. The tests use `let` to define the `organization` variable, which is likely used in the `get_with_token` method for authentication.
2. The `json` method used in the second test is likely a helper method that parses the JSON response.
3. The code uses `Base64.encode64` to encode the public key, which is consistent across both endpoints.

This test suite ensures that the WebhooksController correctly provides the public key for webhook signature verification in both raw and JSON formats, which is crucial for maintaining secure communication with webhook consumers.