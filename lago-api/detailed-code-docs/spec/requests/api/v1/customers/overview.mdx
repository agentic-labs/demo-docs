---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for the API endpoints related to customer operations in the v1 version of the API. Specifically, it includes tests for the Applied Coupons Controller and the Usage Controller, both of which are part of the customer-related functionality.

## What does it do?
These test files ensure that the API endpoints for managing customer coupons and retrieving usage data are functioning correctly. They simulate various scenarios and edge cases to verify that the API responds appropriately in different situations.

1. For applied coupons:
   - It tests the process of terminating (removing) an applied coupon from a customer.
   - It checks if the API correctly handles cases where the customer or coupon doesn't exist.

2. For usage data:
   - It verifies that the API can retrieve both current and past usage data for customers.
   - It tests various filtering options and different charge models.
   - It ensures that the API handles error cases, such as invalid customer IDs or missing subscription information.

## Key Files

1. `applied_coupons_controller_spec.rb`:
   This file contains tests for the Applied Coupons Controller, focusing on the `destroy` action. It verifies that:
   - An applied coupon can be successfully terminated.
   - The API returns the correct coupon data after termination.
   - The API handles errors correctly when the customer or coupon doesn't exist.

2. `usage_controller_spec.rb`:
   This file tests the Usage Controller, covering two main endpoints:
   - `GET /customers/:customer_id/current_usage`: Tests retrieving current usage data for a customer.
   - `GET /customers/:customer_id/past_usage`: Tests retrieving past usage data for a customer.
   
   It verifies various scenarios including different charge models, filtering options, and error handling.

## Dependencies
The test files rely on the following key dependencies:

1. RSpec: The testing framework used for writing and running the tests.
2. FactoryBot: Used for creating test data (e.g., customers, organizations, plans).
3. Rails helper: Provides Rails-specific testing configurations and helpers.

## Configuration
While there are no explicit configuration files mentioned, the tests use various factory definitions and setup blocks to configure the test environment. For example:

```ruby
let(:organization) { create(:organization) }
let(:customer) { create(:customer, organization:) }
let(:applied_coupon) { create(:applied_coupon, customer:) }
```

These setup blocks create the necessary test data and relationships for each test scenario.

The tests also simulate API requests using helper methods like `get_with_token` and `delete_with_token`, which likely handle authentication for the API endpoints.

In summary, this directory contains comprehensive test coverage for customer-related API endpoints, ensuring that coupon management and usage data retrieval function correctly under various conditions. The tests are well-structured and cover both happy paths and error scenarios, providing a robust validation of the API's behavior.