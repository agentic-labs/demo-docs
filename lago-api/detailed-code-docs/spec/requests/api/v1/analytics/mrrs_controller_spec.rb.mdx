---
title: "mrrs_controller_spec.rb"
---

## High-level description
This RSpec test file is designed to test the functionality of the `Api::V1::Analytics::MrrsController`, specifically the GET request to '/analytics/mrr'. It verifies the behavior of the MRR (Monthly Recurring Revenue) endpoint under different license conditions.

## Code Structure
The test file contains a single `describe` block for the GET request to '/analytics/mrr', with two nested `context` blocks testing different license scenarios.

## Symbols

### RSpec.describe Api::V1::Analytics::MrrsController
#### Description
This is the main describe block that groups all tests related to the `Api::V1::Analytics::MrrsController`.

### describe 'GET /analytics/mrr'
#### Description
This describe block focuses on testing the GET request to the '/analytics/mrr' endpoint.

### context 'when license is premium'
#### Description
This context block tests the behavior of the endpoint when the license is premium.

#### Internal Logic
1. Sets up a premium license environment using `lago_premium!`.
2. Makes a GET request to '/api/v1/analytics/mrr' with an organization token.
3. Verifies the response status and the structure of the returned JSON.

### context 'when license is not premium'
#### Description
This context block tests the behavior of the endpoint when the license is not premium.

#### Internal Logic
1. Makes a GET request to '/api/v1/analytics/mrr' with an organization token.
2. Verifies that the response has a forbidden status.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used for creating test data (customer and organization) |

## Configuration
The test file uses the following configuration:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| type: :request | Symbol | N/A | Specifies that this is a request spec |

## Error Handling
The test file checks for a forbidden status (403) when the license is not premium, which is a form of error handling verification.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| /api/v1/analytics/mrr | GET | N/A | JSON with MRR data | Returns MRR information when the license is premium |

Note: The actual structure of the response is not fully detailed in the test, but it includes a `mrrs` array with `month`, `currency`, and `amount_cents` fields.