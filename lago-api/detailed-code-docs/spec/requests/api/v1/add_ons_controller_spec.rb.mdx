---
title: "add_ons_controller_spec.rb"
---

## High-level description
This file contains RSpec tests for the Api::V1::AddOnsController, focusing on CRUD operations (Create, Read, Update, Delete) for add-ons in an API context. It tests the behavior of creating, updating, showing, deleting, and listing add-ons, including error handling and pagination.

## Code Structure
The test suite is organized into describe blocks for each API endpoint (create, update, show, destroy, index). Each block contains multiple test cases (it blocks) that verify the expected behavior of the endpoint under different scenarios.

## Symbols

### RSpec.describe Api::V1::AddOnsController
#### Description
This is the main describe block that groups all tests for the AddOnsController.

### describe 'create'
#### Description
Tests the creation of a new add-on through the API.

#### Internal Logic
1. Sets up create parameters
2. Sends a POST request to create an add-on
3. Verifies the response status and the created add-on's attributes

### describe 'update'
#### Description
Tests the updating of an existing add-on through the API.

#### Internal Logic
1. Creates an add-on and associated tax
2. Sends a PUT request to update the add-on
3. Verifies the response status and the updated add-on's attributes
4. Tests error cases (add-on not found, duplicate code)

### describe 'show'
#### Description
Tests retrieving a single add-on through the API.

#### Internal Logic
1. Creates an add-on
2. Sends a GET request to retrieve the add-on
3. Verifies the response status and the returned add-on's attributes
4. Tests error case (add-on not found)

### describe 'destroy'
#### Description
Tests deleting an add-on through the API.

#### Internal Logic
1. Creates an add-on
2. Sends a DELETE request to remove the add-on
3. Verifies the response status and the deletion of the add-on
4. Tests error case (add-on not found)

### describe 'index'
#### Description
Tests listing all add-ons through the API, including pagination.

#### Internal Logic
1. Creates add-ons and associated taxes
2. Sends a GET request to list add-ons
3. Verifies the response status and the returned add-ons' attributes
4. Tests pagination by creating multiple add-ons and verifying pagination metadata

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads Rails testing environment and configuration |
| FactoryBot | Used for creating test data (organizations, taxes, add-ons) |

## Error Handling
The test suite covers various error scenarios:
- Not found errors for non-existent add-ons
- Validation errors for duplicate add-on codes

## API/Interface Reference
| Endpoint | Method | Description |
|:---------|:-------|:------------|
| /api/v1/add_ons | POST | Create a new add-on |
| /api/v1/add_ons/:code | PUT | Update an existing add-on |
| /api/v1/add_ons/:code | GET | Retrieve a single add-on |
| /api/v1/add_ons/:code | DELETE | Delete an add-on |
| /api/v1/add_ons | GET | List all add-ons (with pagination) |

This test suite ensures that the AddOnsController correctly handles CRUD operations for add-ons, properly associates taxes with add-ons, and handles pagination for the index endpoint. It also verifies that appropriate error responses are returned for invalid requests.