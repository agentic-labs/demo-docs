---
title: "webhooks_controller_spec.rb"
---

## High-level description
This file contains RSpec tests for the WebhooksController, specifically testing the handling of webhooks for Stripe, GoCardless, and Adyen payment providers. It verifies that the controller correctly processes incoming webhook events and handles both successful and failed scenarios for each provider.

## Code Structure
The spec is organized into three main describe blocks, one for each payment provider (Stripe, GoCardless, and Adyen). Each block tests the POST endpoint for the respective provider, including successful webhook handling and error scenarios.

## Symbols

### `describe 'POST /stripe'`
#### Description
Tests the Stripe webhook endpoint.

#### Internal Logic
1. Sets up a mock Stripe event and service.
2. Tests successful webhook handling.
3. Tests error handling for invalid payloads.

### `describe 'POST /gocardless'`
#### Description
Tests the GoCardless webhook endpoint.

#### Internal Logic
1. Sets up a mock GoCardless event and service.
2. Tests successful webhook handling.
3. Tests error handling for invalid payloads.

### `describe 'POST /adyen'`
#### Description
Tests the Adyen webhook endpoint.

#### Internal Logic
1. Sets up a mock Adyen event and service.
2. Tests successful webhook handling.
3. Tests error handling for invalid payloads.

## Dependencies
- Rails
- RSpec
- FactoryBot
- Stripe
- GoCardlessPro
- PaymentProviders::StripeService
- PaymentProviders::GocardlessService
- PaymentProviders::AdyenService

## Error Handling
The spec tests error scenarios for each payment provider, ensuring that the controller returns a bad request status when handling invalid payloads or when the service fails to process the webhook.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| /webhooks/stripe/:organization_id | POST | Stripe event JSON | 200 OK or 400 Bad Request | Handles Stripe webhooks |
| /webhooks/gocardless/:organization_id | POST | GoCardless event JSON | 200 OK or 400 Bad Request | Handles GoCardless webhooks |
| /webhooks/adyen/:organization_id | POST | Adyen event JSON | 200 OK or 400 Bad Request | Handles Adyen webhooks |