---
title: "Overview"
---

## High-level description
This directory contains RSpec test files for various controllers in a Rails application, focusing on API endpoints, admin functionalities, and webhook handling. The tests cover a wide range of functionalities including authentication, CRUD operations for different resources, payment provider integrations, and GraphQL queries.

## What does it do?
The test suite in this directory verifies the behavior of different parts of the application:

1. API Endpoints: It tests various API endpoints for resources like add-ons, analytics, customers, invoices, plans, subscriptions, and wallets. These tests ensure that the API correctly handles requests, validates input, and returns appropriate responses.

2. Admin Functionalities: The tests verify admin-specific features such as invoice regeneration, membership creation, and organization updates. They ensure that admin routes are properly secured and perform the expected actions.

3. Webhook Handling: The suite includes tests for webhook endpoints from payment providers like Stripe, GoCardless, and Adyen. These tests verify that the application correctly processes incoming webhook events and handles both successful and error scenarios.

4. GraphQL Queries: There are tests for GraphQL endpoints, covering scenarios like user login, JWT token handling, and customer portal token authentication.

5. Application Health: The suite includes tests for the application's health check endpoint and handling of missing resources.

These tests simulate HTTP requests to various endpoints and verify the responses, ensuring that the controllers handle requests correctly, return appropriate status codes, and perform the expected actions on the database.

## Key Files

1. `api/` directory: Contains tests for various API endpoints, including:
   - `base_controller_spec.rb`: Tests the base API controller.
   - `v1/` directory: Tests for specific v1 API endpoints (e.g., add-ons, analytics, customers, invoices).

2. `admin/` directory: Contains tests for admin functionalities, including:
   - `base_controller_spec.rb`: Tests admin authentication.
   - `invoices_controller_spec.rb`: Tests invoice regeneration.
   - `memberships_controller_spec.rb`: Tests membership creation.
   - `organizations_controller_spec.rb`: Tests organization updates.

3. `application_controller_spec.rb`: Tests the application's health check endpoint and handling of missing resources.

4. `graphql_controller_spec.rb`: Tests the GraphQL endpoint, including user login and token handling.

5. `webhooks_controller_spec.rb`: Tests webhook handling for Stripe, GoCardless, and Adyen.

## Dependencies
The test suite relies on several key dependencies:

1. RSpec: The primary testing framework.
2. FactoryBot: Used for creating test data.
3. Rails: The web application framework.
4. SimpleCov: Used for code coverage analysis.
5. DatabaseCleaner: Used for managing test database state.
6. JWT: Used for encoding and decoding JWT tokens in GraphQL tests.
7. Stripe, GoCardlessPro, and Adyen libraries for payment provider integrations.

## Configuration
The tests are configured as request specs (`type: :request`), simulating HTTP requests to the application. They use the `rails_helper` to load the Rails testing environment and configuration. Many tests use `aggregate_failures` to group multiple expectations together, allowing all expectations to be evaluated even if one fails.

The admin tests use specific RSpec configurations and custom helpers like `admin_post` and `admin_put`, suggesting a custom setup for admin-related tests.

In summary, this directory contains a comprehensive test suite covering various aspects of the application, including API endpoints, admin functionalities, webhook handling, and GraphQL queries. These tests ensure that the application's controllers work correctly and securely, providing a safety net for future development and refactoring.