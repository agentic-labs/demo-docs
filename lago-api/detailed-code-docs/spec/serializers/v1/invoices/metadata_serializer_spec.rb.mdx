---
title: "metadata_serializer_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `V1::Invoices::MetadataSerializer` class. It verifies that the serializer correctly converts an `InvoiceMetadata` object into a JSON representation with the expected structure and content.

## Symbols

### `RSpec.describe ::V1::Invoices::MetadataSerializer`
#### Description
This is the main describe block for the test suite, focusing on the `V1::Invoices::MetadataSerializer` class.

### `subject(:serializer)`
#### Description
Defines the subject of the test, which is an instance of the `V1::Invoices::MetadataSerializer` class, initialized with a metadata object and a root name of 'metadata'.

### `let(:metadata)`
#### Description
Creates a test double for an invoice metadata object using FactoryBot.

### `it 'serializes the object'`
#### Description
This test case verifies that the serializer correctly converts the metadata object into a JSON representation.

#### Internal Logic
1. Serializes the metadata object to JSON and parses it back to a Ruby hash.
2. Uses `aggregate_failures` to group multiple expectations together.
3. Checks that the serialized JSON contains the correct values for:
   - `lago_id` (should match the metadata's id)
   - `key` (should match the metadata's key)
   - `value` (should match the metadata's value)
   - `created_at` (should match the metadata's created_at timestamp in ISO8601 format)

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used to create test data (invoice_metadata) |
| JSON | Used to parse the serialized output |

## References
This test file references the following:
- `V1::Invoices::MetadataSerializer`: The class being tested
- `InvoiceMetadata`: The model being serialized (created via FactoryBot)

Note: The related `rails_helper.rb` file provides additional context for the testing setup, including various configurations and helper inclusions that support this and other test files in the project.