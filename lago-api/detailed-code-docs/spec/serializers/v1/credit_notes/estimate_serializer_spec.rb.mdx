---
title: "estimate_serializer_spec.rb"
---

## High-level description
This code is a RSpec test suite for the `V1::CreditNotes::EstimateSerializer` class. It verifies that the serializer correctly transforms an estimated credit note object into a JSON representation with the expected structure and values.

## Symbols

### `RSpec.describe ::V1::CreditNotes::EstimateSerializer`
#### Description
This is the main describe block for the test suite, focusing on the `V1::CreditNotes::EstimateSerializer` class.

### `subject(:serializer)`
#### Description
Defines the subject of the test, which is an instance of the `V1::CreditNotes::EstimateSerializer` class, initialized with an estimated credit note and a root name.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| estimated_credit_note | CreditNote | The credit note object to be serialized |
| root_name | String | The root name for the JSON output |

### `let(:root_name)`
#### Description
Defines the root name for the serialized JSON output.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| root_name | String | The string 'estimated_credit_note' |

### `let(:estimated_credit_note)`
#### Description
Builds a credit note object with associated items and applied taxes.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| estimated_credit_note | CreditNote | A credit note object with items and applied taxes |

### `let(:credit_note_items)`
#### Description
Builds a list of two credit note items.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| credit_note_items | Array&lt;CreditNoteItem&gt; | An array of two credit note items |

### `let(:applied_taxes)`
#### Description
Builds a list of two applied taxes for the credit note.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| applied_taxes | Array&lt;CreditNoteAppliedTax&gt; | An array of two applied taxes |

### `it 'serializes the object'`
#### Description
This test case verifies that the serializer correctly transforms the estimated credit note into a JSON representation with the expected structure and values.

#### Internal Logic
1. Serializes the estimated credit note to JSON and parses it back to a Ruby hash.
2. Uses `aggregate_failures` to group multiple expectations together.
3. Checks various attributes of the serialized credit note, including:
   - lago_invoice_id
   - invoice_number
   - currency
   - taxes_amount_cents
   - sub_total_excluding_taxes_amount_cents
   - max_creditable_amount_cents
   - max_refundable_amount_cents
   - coupons_adjustment_amount_cents
   - taxes_rate
4. Verifies that the serialized output includes the correct number of items and applied taxes.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| rails_helper | Loads the Rails testing environment and configuration |
| FactoryBot | Used for creating test objects (credit notes, items, and taxes) |
| JSON | Used for parsing the serialized output |

Note: The `rails_helper` file is included in the related code snippets and sets up the testing environment, including RSpec configuration, SimpleCov for code coverage, and various helper modules.