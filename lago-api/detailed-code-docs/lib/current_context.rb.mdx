---
title: "current_context.rb"
---

## High-level description
The `CurrentContext` module in `lib/current_context.rb` defines thread-local variables for storing and accessing context information across different parts of the application. It provides a way to maintain and share contextual data within the scope of a single thread.

## Code Structure
The `CurrentContext` module uses the `thread_mattr_accessor` method to define three thread-local variables: `membership`, `source`, and `email`. These variables can be accessed and modified throughout the application within the same thread.

## Symbols

### `CurrentContext`
#### Description
This module serves as a container for thread-local variables that store contextual information.

#### Internal Logic
The module uses `thread_mattr_accessor` to create three thread-local variables:
1. `membership`: Likely used to store information about the current user's membership.
2. `source`: Possibly used to track the source of the current request or operation.
3. `email`: Potentially used to store the email address associated with the current context.

## Side Effects
The use of thread-local variables allows for sharing context across different parts of the application within the same thread. This can be useful for tracking user-specific information or request-specific data without passing it explicitly through method arguments.

## Dependencies
This module relies on the `thread_mattr_accessor` method, which is likely provided by a Rails extension or a custom implementation.

## Usage in Related Code
The `CurrentContext` module is used in various parts of the application:

1. In `app/controllers/concerns/trackable.rb`, it's used to set the `membership` information before actions.
2. In multiple service classes (e.g., `Subscriptions::CreateService`, `Customers::DestroyService`), it's used to access the `membership` information for tracking purposes.
3. In `config/initializers/activejob_traceable.rb`, it's used to set and get tracing information for ActiveJob.
4. In `spec/support/shared_examples/paper_trail_traceable.rb`, it's used in tests to set and verify the `membership` information for versioning.

The `CurrentContext` module provides a centralized way to manage and access context-specific information across different parts of the application, enhancing traceability and context-awareness in various operations.