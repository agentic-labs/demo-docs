---
title: "error_handlable.rb"
---

## High-level description
This code defines an `ErrorHandlable` module within the `Lago::Adyen` namespace. It provides a method to handle responses from Adyen API calls, specifically for error handling and webhook delivery in case of errors.

## Symbols

### `handle_adyen_response`
#### Description
This method processes the response from an Adyen API call, checking for errors and delivering error webhooks if necessary.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| res | Object | The response object from an Adyen API call |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Array | [Boolean, Adyen::AdyenError or nil] | A tuple containing a success flag and an error object (if any) |

#### Internal Logic
1. If the response status is less than 400, it returns `[true, nil]`, indicating success.
2. For status codes 400 and above:
   - Extracts the error type and message from the response.
   - Creates an `Adyen::AdyenError` object.
   - Calls `deliver_error_webhook` with the error.
   - Returns `[false, error]`.

## Side Effects
- Calls `deliver_error_webhook` method (not defined in this module) when an error is encountered.

## Dependencies
This module is included in several services related to Adyen payments, such as `Invoices::Payments::AdyenService`, `PaymentRequests::Payments::AdyenService`, and `PaymentProviderCustomers::AdyenService`. These services use the `handle_adyen_response` method to process Adyen API responses consistently across different payment-related operations.

The module relies on the `Adyen::AdyenError` class for error handling, which is likely defined in the Adyen gem or a custom implementation.

## Error Handling
The module is specifically designed for error handling. It processes Adyen API responses and creates standardized error objects for failed requests. This allows for consistent error handling across different Adyen-related services in the application.