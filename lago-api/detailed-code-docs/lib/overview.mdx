---
title: "Overview"
---

## High-level description
The `lib` directory contains essential utility modules and classes that provide core functionalities for the Lago application. These utilities include context management, EU VAT rate handling, HTTP client operations, and various other helper functions. The directory serves as a central location for common tools used throughout the Lago application, supporting features such as payment processing, tax calculations, and external integrations.

## What does it do?
This directory provides several key functionalities:

1. Context Management: The `CurrentContext` module allows for thread-local storage of contextual information such as membership, source, and email across different parts of the application.

2. Adyen Payment Integration: The `lago/adyen` subdirectory facilitates integration with the Adyen payment platform, handling API responses and formatting request parameters.

3. EU VAT Rate Management: The `lago_eu_vat` module provides access to up-to-date European Union VAT rates, supporting tax calculations for e-commerce and financial operations.

4. HTTP Client: The `lago_http_client` module offers a custom HTTP client for making various types of HTTP requests to external services, supporting webhooks, integrations, and API communications.

5. Utility Functions: The `lago_utils` directory contains utilities for license management, a Ruby sandbox for safe code execution, version management, and additional HTTP client operations.

These functionalities support various parts of the Lago application, enabling features such as payment processing, tax calculations, external integrations, and secure code execution.

## Key Files

1. `current_context.rb`: Defines the `CurrentContext` module for thread-local variable storage.

2. `lago/adyen/error_handlable.rb` and `lago/adyen/params.rb`: Handle Adyen API responses and format request parameters.

3. `lago_eu_vat/eu_vat_rates.json` and `lago_eu_vat/rate.rb`: Store and provide access to EU VAT rates.

4. `lago_http_client/client.rb` and `lago_http_client/http_error.rb`: Implement the custom HTTP client and error handling.

5. `lago_utils/license.rb`, `lago_utils/ruby_sandbox.rb`, and `lago_utils/version.rb`: Provide utilities for license management, safe code execution, and version tracking.

## Dependencies
The utilities in this directory rely on various Ruby standard libraries and external gems:

1. Rails: Used for ActiveSupport features and application configuration.
2. JSON: For parsing and generating JSON data.
3. Net::HTTP: For making HTTP requests.
4. Adyen gem: Used in the Adyen integration module.

## Configuration
Configuration for these utilities is handled through a combination of environment variables, constants, and JSON files:

1. `CurrentContext`: No specific configuration required.
2. Adyen integration: Uses hardcoded application information in the `Params` class.
3. EU VAT rates: Configured through the `eu_vat_rates.json` file.
4. HTTP client: Configurable through initialization parameters and constants.
5. LagoUtils: Uses environment variables (e.g., `LAGO_LICENSE`) and configuration files (e.g., `LAGO_VERSION`).

These utilities provide essential support functions for the Lago application, enabling secure and flexible operations across various features. The modular design allows for easy maintenance and extension of functionality as needed.