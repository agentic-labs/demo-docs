---
title: "Overview"
---

## High-level description
This directory contains SQL views that are crucial for the billing and metrics system of the application. These views aggregate and process data from various tables to provide comprehensive information about billable metrics, charges, and events. The views are designed to facilitate efficient querying and analysis of billing-related data.

## What does it do?
The views in this directory serve several important functions:

1. Aggregate billable metrics and charges: They combine information from multiple tables to provide a consolidated view of billable metrics, associated charges, and their filters. This allows for easy analysis of the billing structure for different organizations and plans.

2. Process event data: Some views focus on processing event data from the last hour, joining it with billable metrics and their associated filters. This enables real-time or near-real-time analysis of billable events.

3. Apply filtering and grouping logic: The views implement complex filtering and grouping logic, allowing for flexible analysis of billing data based on various criteria such as organization, plan, and custom filters.

4. Prepare data for billing calculations: By aggregating and structuring the data, these views lay the groundwork for performing billing calculations and generating invoices.

## Key Files

1. billable_metrics_grouped_charges_v03.sql
   - This view combines data from billable metrics, charges, and filters to provide a comprehensive overview of the billing structure.
   - It handles different charge models and aggregates filter information using JSON functions.
   - The view is crucial for understanding the relationship between billable metrics and charges across different plans and organizations.

2. last_hour_events_mv_v04.sql
   - This materialized view processes event data from the last hour, joining it with billable metrics and their associated filters.
   - It calculates various flags to indicate the validity of events based on billable metric criteria and filters.
   - This view is essential for real-time or near-real-time analysis of billable events and can be used to trigger billing processes or generate reports.

These views work together to provide a comprehensive data structure for the billing system, enabling efficient querying and analysis of billable metrics, charges, and events.

## Dependencies
The views in this directory primarily depend on PostgreSQL-specific features, including:
- JSON functions and operators (e.g., json_object_agg, -&gt;&gt;)
- Array functions (e.g., array_agg)
- Window functions
- Common Table Expressions (CTEs)

Ensure that you are using a compatible version of PostgreSQL to utilize these views effectively.

## Configuration
These views do not require specific configuration files or environment variables. However, it's important to note that they rely on the structure and data of several underlying tables, including:
- billable_metrics
- charges
- charge_filters
- charge_filter_values
- events
- groups

Ensure that these tables are properly maintained and indexed for optimal performance of the views.