---
title: "20221216154033_add_payment_retry_columns_to_invoices.rb"
---

## High-level description
This migration adds two new columns to the `invoices` table: `payment_attempts` and `ready_for_payment_processing`. These columns are intended to track payment retry information and processing readiness for invoices.

## Symbols

### `AddPaymentRetryColumnsToInvoices`
#### Description
This class is an ActiveRecord migration that adds payment retry-related columns to the `invoices` table. It inherits from `ActiveRecord::Migration[7.0]`, indicating it's compatible with Rails 7.0.

#### Internal Logic
The migration uses the `change` method to define the changes to be applied to the database schema. It employs the `safety_assured` method, likely from a database migration safety gem (such as strong_migrations), to bypass potential safety checks.

Inside the `change_table` block, two new columns are added to the `invoices` table:

1. `payment_attempts`: An integer column to track the number of payment attempts, defaulting to 0 and not allowing null values.
2. `ready_for_payment_processing`: A boolean column to indicate if an invoice is ready for payment processing, defaulting to true and not allowing null values.

The `bulk: true` option is used with `change_table` to potentially optimize the migration by combining multiple alterations into a single SQL statement, which can be more efficient for some databases.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord | Provides the migration framework and database interaction capabilities |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| payment_attempts | integer | 0 | Tracks the number of payment attempts for an invoice |
| ready_for_payment_processing | boolean | true | Indicates if an invoice is ready for payment processing |

## Performance Considerations
The use of `bulk: true` in the `change_table` method can potentially improve performance by combining multiple column additions into a single SQL statement, which may be more efficient for some database systems.

## TODOs
There are no explicit TODOs in this migration file.