---
title: "Overview"
---

Here's a concise summary of the `db/migrate` directory:

## High-level description
This directory contains database migration files for a Ruby on Rails application. These migrations define changes to the database schema over time, including table creations, column additions/removals, and index modifications.

## What does it do?
The migrations in this directory collectively:
1. Create and modify tables for various entities (e.g., invoices, customers, payments, subscriptions).
2. Add, remove, or modify columns in existing tables.
3. Create indexes for performance optimization.
4. Establish relationships between tables through foreign keys.
5. Implement soft delete functionality for certain tables.
6. Update data structures to support new features (e.g., progressive billing, usage thresholds).
7. Perform data migrations to maintain consistency with schema changes.

## Entry points
There's no specific entry point for migrations. They are executed in order based on their timestamp prefixes when running `rails db:migrate`.

## Key Files
- `20220525122759_init_schema.rb`: Initial schema setup for the application.
- `20230503143229_create_tax_rates.rb`: Establishes tax rate functionality.
- `20230801134832_create_payment_requests.rb`: Sets up payment request handling.
- `20240801184757_create_progressive_billing_tresholds.rb`: Implements progressive billing feature.

## Dependencies
- ActiveRecord: Provides the migration framework.
- PostgreSQL: Many migrations use PostgreSQL-specific features like JSONB and UUID.

## Configuration
Migrations often include configuration options such as:
- Using UUID for primary keys
- Setting default values for columns
- Defining indexes and foreign key constraints

## Performance Considerations
- Many migrations use `disable_ddl_transaction!` and `algorithm: :concurrently` for index creation to minimize table locking.
- Some migrations use `bulk: true` when modifying tables to optimize performance.
- Complex data migrations are sometimes implemented using raw SQL for efficiency.

The migrations in this directory show a progression of the application's data model, with a focus on billing, subscriptions, and payment processing features. They demonstrate careful consideration for database performance and data integrity throughout the application's evolution.