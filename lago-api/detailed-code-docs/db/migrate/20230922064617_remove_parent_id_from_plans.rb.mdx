---
title: "20230922064617_remove_parent_id_from_plans.rb"
---

## High-level description
This migration removes the `parent_id` from the `plans` table in a Rails application. It uses a reversible migration to set all `parent_id` values to `NULL` when running the migration up.

## Symbols

### `RemoveParentIdFromPlans`
#### Description
This class is an ActiveRecord migration that modifies the `plans` table by removing the `parent_id` column. It inherits from `ActiveRecord::Migration[7.0]`, indicating it's compatible with Rails 7.0.

#### Internal Logic
The migration uses a reversible block to ensure the change can be rolled back if needed. Within the `up` direction of the migration, it executes a SQL statement to update all rows in the `plans` table, setting the `parent_id` to `NULL`.

The `safety_assured` method is used to bypass Strong Migrations checks, indicating that this migration has been manually reviewed for safety.

## Side Effects
This migration will modify all existing rows in the `plans` table, setting their `parent_id` to `NULL`. This could potentially affect any existing relationships or queries that rely on the `parent_id` column.

## Error Handling
The migration doesn't include explicit error handling. If the SQL execution fails, it will raise an exception, and the migration will be rolled back automatically by ActiveRecord.

## Performance Considerations
This migration will update all rows in the `plans` table, which could be a time-consuming operation if the table contains a large number of records. It's advisable to run this migration during a maintenance window or low-traffic period.

## TODOs
The migration sets all `parent_id` values to `NULL`, but it doesn't actually remove the column from the table. A follow-up migration might be needed to remove the `parent_id` column entirely if that's the intended final state.