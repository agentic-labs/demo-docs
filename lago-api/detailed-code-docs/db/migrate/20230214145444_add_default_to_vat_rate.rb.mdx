---
title: "20230214145444_add_default_to_vat_rate.rb"
---

## High-level description
This migration adds a default value of 0.0 to the `vat_rate` column in both the `fees` and `invoices` tables. It also makes these columns non-nullable, ensuring that all existing and future records have a valid VAT rate.

## Symbols

### AddDefaultToVatRate
#### Description
This class is a Rails migration that modifies the `vat_rate` column in the `fees` and `invoices` tables. It sets a default value of 0.0 and makes the column non-nullable.

#### Internal Logic
The migration performs the following steps:
1. Uses `safety_assured` to bypass Strong Migrations checks.
2. Changes the default value of `vat_rate` from `nil` to `0.0` for both `fees` and `invoices` tables.
3. Makes the `vat_rate` column non-nullable for both tables, setting existing `null` values to `0.0`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord::Migration | Provides the base class for database migrations in Rails |

## Performance Considerations
This migration may take some time to complete if the `fees` and `invoices` tables contain a large number of records, as it needs to update all existing rows with `null` values in the `vat_rate` column.

## Error Handling
The migration uses `safety_assured` to bypass Strong Migrations checks. This should be used with caution, as it may potentially cause issues in a production environment if not handled properly.

## TODOs
Consider adding a comment explaining why `safety_assured` is used and any potential risks associated with this migration.