---
title: "20240415122310_add_custom_aggregator_to_billable_metrics.rb"
---

## High-level description
This migration adds a new column called `custom_aggregator` to the `billable_metrics` table in the database. The purpose of this change is to allow for custom aggregation logic to be stored for billable metrics.

## Symbols

### `AddCustomAggregatorToBillableMetrics`
#### Description
This class is a database migration that extends the `ActiveRecord::Migration` class. It defines a change to be applied to the database schema, specifically adding a new column to the `billable_metrics` table.

#### Internal Logic
The migration uses the `change` method to define the modification to the database schema. Inside this method, it calls `add_column` to add a new column to the `billable_metrics` table.

The `add_column` method takes three arguments:
1. `:billable_metrics` - the name of the table to modify
2. `:custom_aggregator` - the name of the new column to add
3. `:text` - the data type of the new column

This will create a new `text` column named `custom_aggregator` in the `billable_metrics` table, allowing for the storage of custom aggregation logic as text.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord::Migration[7.0] | Provides the framework for defining database schema changes in a version-controlled and reversible manner |

## Side Effects
When this migration is run, it will modify the database schema by adding a new column to the `billable_metrics` table. This change is permanent and will affect the structure of the database.

## Performance Considerations
Adding a new column to an existing table is generally a fast operation, especially for small to medium-sized tables. However, for very large tables, this operation might take some time and could potentially lock the table during the migration, depending on the database system being used.

___

This migration is part of a larger system dealing with billable metrics, likely in a billing or analytics context. The addition of a `custom_aggregator` column suggests that the system is being enhanced to support more flexible or customizable ways of aggregating billable metrics, possibly allowing for user-defined aggregation logic to be stored and applied.