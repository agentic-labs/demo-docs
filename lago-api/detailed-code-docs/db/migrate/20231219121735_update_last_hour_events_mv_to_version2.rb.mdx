---
title: "20231219121735_update_last_hour_events_mv_to_version2.rb"
---

## High-level description
This migration updates the materialized view `last_hour_events_mv` to version 2. It drops the existing materialized view and recreates it with the new version.

## Symbols

### `UpdateLastHourEventsMvToVersion2`
#### Description
This class is an ActiveRecord migration that updates the `last_hour_events_mv` materialized view to version 2. It inherits from `ActiveRecord::Migration[7.0]`, indicating it's compatible with Rails 7.0.

#### Internal Logic
The migration performs two main steps:
1. Drops the existing materialized view named `last_hour_events_mv`.
2. Creates a new materialized view with the same name but using version 2 of the view definition.

### `change`
#### Description
This method defines the changes to be applied (or reverted) when running (or rolling back) the migration.

#### Internal Logic
1. Calls `drop_view` to remove the existing materialized view.
2. Calls `create_view` to create a new materialized view with version 2.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord | Provides the migration framework and database interaction capabilities |

## Notes
- The `# frozen_string_literal: true` comment at the top of the file is a Ruby optimization that prevents the creation of new String objects for string literals in this file.
- The specific changes in version 2 of the view are not defined in this migration file. The actual view definition would be in a separate SQL file or defined elsewhere in the application.
- This migration assumes that the `scenic` gem (or a similar tool) is being used to manage database views in the Rails application, as evidenced by the use of `create_view` with a version parameter.