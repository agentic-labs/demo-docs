---
title: "20230424092207_add_one_off_columns_to_fees.rb"
---

## High-level description
This migration adds new columns to the `fees` table to support one-off fees functionality. It introduces an association with add-ons, a description field, and a unit amount field for the fees.

## Symbols

### `AddOneOffColumnsToFees`
#### Description
This class is an ActiveRecord migration that adds three new columns to the `fees` table: `add_on`, `description`, and `unit_amount_cents`. It uses the `change_table` method to modify the existing table structure.

#### Internal Logic
1. The migration is wrapped in a `safety_assured` block, which is likely a custom method to bypass certain safety checks during the migration process.
2. It uses `change_table` with the `bulk: true` option for better performance when making multiple changes to the table.
3. Three new columns are added:
   - `add_on`: A reference to an `add_ons` table, using UUID as the primary key.
   - `description`: A string column to store descriptive information about the fee.
   - `unit_amount_cents`: A bigint column to store the fee amount in cents, with a default value of 0.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord::Migration | Provides the migration framework for database schema changes |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| MIGRATION_VERSION | Float | 7.0 | Specifies the Rails migration version |

## Performance Considerations
The migration uses `bulk: true` option in `change_table`, which can improve performance when making multiple changes to a table by reducing the number of ALTER TABLE statements.