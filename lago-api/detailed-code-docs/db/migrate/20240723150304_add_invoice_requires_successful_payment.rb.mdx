---
title: "20240723150304_add_invoice_requires_successful_payment.rb"
---

## High-level description
This migration adds a new boolean column `invoice_requires_successful_payment` to three tables: `wallets`, `wallet_transactions`, and `recurring_transaction_rules`. The column is set to default to `false` and is not nullable, indicating whether an invoice requires a successful payment for these entities.

## Symbols

### `AddInvoiceRequiresSuccessfulPayment`
#### Description
This class is an ActiveRecord migration that adds the `invoice_requires_successful_payment` column to three different tables in the database.

#### Internal Logic
1. The migration disables DDL transactions using `disable_ddl_transaction!`.
2. It defines a `change` method that adds the new column to each of the three tables:
   - `wallets`
   - `wallet_transactions`
   - `recurring_transaction_rules`
3. For each table, it adds the `invoice_requires_successful_payment` column with the following properties:
   - Type: `boolean`
   - Default value: `false`
   - Null constraint: `false` (not nullable)

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord::Migration | Provides the framework for database migrations in Rails |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| disable_ddl_transaction! | Method | N/A | Disables the use of a DDL transaction for this migration |

## Performance Considerations
The `disable_ddl_transaction!` call suggests that this migration might be intended for use on large tables or in environments where long-running transactions should be avoided. This allows the database to apply the changes without wrapping them in a transaction, which can be beneficial for performance and locking behavior in some scenarios.