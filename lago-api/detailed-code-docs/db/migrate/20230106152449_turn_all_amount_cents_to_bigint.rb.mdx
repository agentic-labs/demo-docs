---
title: "20230106152449_turn_all_amount_cents_to_bigint.rb"
---

## High-level description
This migration file, `TurnAllAmountCentsToBigint`, is designed to modify the data type of the `amount_cents` column in two tables: `applied_add_ons` and `applied_coupons`. The migration changes the column type from `integer` to `bigint`, allowing for larger numerical values to be stored.

## Code Structure
The migration class `TurnAllAmountCentsToBigint` inherits from `ActiveRecord::Migration[7.0]` and defines two methods: `up` for applying the changes and `down` for reverting them.

## Symbols

### TurnAllAmountCentsToBigint
#### Description
This class represents a database migration that alters the `amount_cents` column in two tables to use the `bigint` data type.

#### Internal Logic

##### `up` method
The `up` method is responsible for applying the migration:

1. It uses the `safety_assured` block, which is likely a custom method to bypass certain safety checks.
2. For the `applied_add_ons` table:
   - Changes the `amount_cents` column to `bigint` type.
   - Sets the column as `null: false` (not allowing null values).
3. For the `applied_coupons` table:
   - Changes the `amount_cents` column to `bigint` type.
   - Sets the column as `null: true` (allowing null values).

##### `down` method
The `down` method is responsible for reverting the migration:

1. For the `applied_add_ons` table:
   - Changes the `amount_cents` column back to `integer` type.
   - Maintains the `null: false` constraint.
2. For the `applied_coupons` table:
   - Changes the `amount_cents` column back to `integer` type.
   - Maintains the `null: true` setting.

## Side Effects
This migration will modify the schema of the `applied_add_ons` and `applied_coupons` tables, potentially affecting any code that interacts with these tables. It may also require data conversion for existing records.

## Performance Considerations
Changing column types on large tables can be a time-consuming operation and may lock the tables during the migration. The use of `safety_assured` suggests that there might be some performance or safety checks being bypassed, which should be considered carefully in a production environment.

## Dependencies
This migration relies on the ActiveRecord framework, which is part of Ruby on Rails.

## Error Handling
No explicit error handling is implemented in this migration. It relies on the default error handling provided by ActiveRecord migrations.

## TODOs
There are no explicit TODOs in this code.