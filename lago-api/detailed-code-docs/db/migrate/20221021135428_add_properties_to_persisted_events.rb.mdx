---
title: "20221021135428_add_properties_to_persisted_events.rb"
---

## High-level description
This migration adds a new `properties` column to the `persisted_events` table in the database. The column is of type `jsonb`, which allows for storing JSON data, and is set to be non-nullable with a default empty JSON object.

## Symbols

### `AddPropertiesToPersistedEvents`
#### Description
This class is an ActiveRecord migration that defines a change to be applied to the database schema. It adds a new column named `properties` to the `persisted_events` table.

#### Internal Logic
The migration uses the `add_column` method to add the new column with the following specifications:
- Table name: `persisted_events`
- Column name: `properties`
- Data type: `jsonb` (JSON Binary)
- Constraints: 
  - `null: false` (the column cannot contain null values)
  - `default: {}` (default value is an empty JSON object)

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord::Migration | Provides the framework for defining database schema changes |

## Configuration
This migration is configured to work with Rails version 7.0, as indicated by `ActiveRecord::Migration[7.0]`.

## Notes
1. The use of `jsonb` type suggests that this migration is intended for PostgreSQL databases, as this is a PostgreSQL-specific data type.
2. The `# frozen_string_literal: true` comment at the top of the file is a Ruby magic comment that helps improve performance by freezing all string literals in the file.
3. This migration allows for flexible storage of additional data in the `persisted_events` table without needing to define specific columns for each property.
4. The default empty JSON object (`{}`) ensures that even if no properties are explicitly set, the column will always contain valid JSON data.