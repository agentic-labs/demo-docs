---
title: "20221010142031_update_credit_notes.rb"
---

## High-level description
This migration file updates the structure of the `credit_notes` table in the database. It renames several existing columns and adds two new columns to enhance the representation of credit note data.

## Code Structure
The code defines a single class `UpdateCreditNotes` that inherits from `ActiveRecord::Migration[7.0]`. This class contains a `change` method that encapsulates all the migration operations.

## Symbols

### UpdateCreditNotes
#### Description
This class is an ActiveRecord migration that modifies the `credit_notes` table structure. It renames existing columns and adds new ones to better represent credit note information.

#### Internal Logic
1. The migration is wrapped in a `safety_assured` block, which is likely a custom method to bypass certain safety checks during the migration process.
2. Several columns are renamed using the `rename_column` method.
3. New columns are added using the `change_table` method with the `bulk: true` option for better performance.

## Side Effects
This migration will modify the structure of the `credit_notes` table in the database, potentially affecting any code that relies on the old column names or structure.

### `change`
#### Description
This method defines the changes to be applied to the database schema.

#### Internal Logic
1. Renames the following columns:
   - `status` to `credit_status`
   - `amount_cents` to `credit_amount_cents`
   - `amount_currency` to `credit_amount_currency`
   - `remaining_amount_cents` to `balance_amount_cents`
   - `remaining_amount_currency` to `balance_amount_currency`
2. Adds two new columns:
   - `total_amount_cents` (bigint, non-null, default 0)
   - `total_amount_currency` (string, non-null)

## Dependencies
This migration relies on the ActiveRecord framework, which is part of Ruby on Rails.

## Configuration
The migration is configured to use version 7.0 of ActiveRecord migrations.

## TODOs
There is a note in the code mentioning that a Rubocop comment is disabled because the table is not used in production yet. This suggests that there might be plans to use this table in production in the future, and the Rubocop rule should be re-evaluated at that time.