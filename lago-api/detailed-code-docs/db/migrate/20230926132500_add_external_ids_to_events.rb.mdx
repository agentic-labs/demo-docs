---
title: "20230926132500_add_external_ids_to_events.rb"
---

## High-level description
This migration adds two new string columns, `external_customer_id` and `external_subscription_id`, to the `events` table. It also modifies the `customer_id` column to allow null values. This migration is part of a Rails 7.0 application and uses the `safety_assured` method for potentially dangerous operations.

## Symbols

### `AddExternalIdsToEvents`
#### Description
This class is a Rails migration that extends `ActiveRecord::Migration[7.0]`. It defines changes to be applied to the database schema, specifically adding new columns to the `events` table and modifying an existing column.

#### Internal Logic
The migration performs the following steps:
1. Uses `safety_assured` to bypass Strong Migrations checks.
2. Adds two new string columns to the `events` table using `change_table` with `bulk: true` for efficiency.
3. Modifies the `customer_id` column to allow null values.

## Side Effects
- Adds two new columns to the `events` table: `external_customer_id` and `external_subscription_id`.
- Modifies the `customer_id` column in the `events` table to allow null values.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord::Migration | Provides the framework for defining database schema changes |
| Strong Migrations | Implied by the use of `safety_assured`, used for migration safety checks |

## Performance Considerations
The migration uses `bulk: true` when calling `change_table`, which can improve performance by combining multiple ALTER TABLE statements into a single operation, reducing the number of table rewrites.

## Error Handling
This migration does not implement explicit error handling. It relies on the default behavior of Rails migrations, which will roll back changes if an error occurs during the migration process.

## TODOs
There are no explicit TODOs in this migration file.