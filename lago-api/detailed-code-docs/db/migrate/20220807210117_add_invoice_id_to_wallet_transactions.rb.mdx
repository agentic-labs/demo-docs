---
title: "20220807210117_add_invoice_id_to_wallet_transactions.rb"
---

## High-level description
This migration adds an `invoice_id` column to the `wallet_transactions` table. It establishes a foreign key relationship between wallet transactions and invoices, allowing wallet transactions to be associated with specific invoices.

## Symbols

### `AddInvoiceIdToWalletTransactions`
#### Description
This class is an ActiveRecord migration that adds a new column `invoice_id` to the `wallet_transactions` table. It inherits from `ActiveRecord::Migration[7.0]`, indicating it's compatible with Rails 7.0.

#### Internal Logic
The migration uses the `change` method to define the changes to be applied to the database schema. Inside the `change` method:

1. It wraps the column addition in a `safety_assured` block, which is likely a custom method to bypass certain safety checks.
2. It uses `add_reference` to add the `invoice_id` column with the following specifications:
   - The column is added to the `wallet_transactions` table.
   - The referenced table is `invoice`.
   - The column type is set to `:uuid`.
   - The column is nullable (`null: true`).
   - An index is created for this column (`index: true`).
   - A foreign key constraint is added (`foreign_key: true`).

## Side Effects
- Adds a new `invoice_id` column to the `wallet_transactions` table.
- Creates an index on the `invoice_id` column.
- Establishes a foreign key relationship between `wallet_transactions` and `invoices` tables.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord | Provides the migration framework and database interaction capabilities |

## Performance Considerations
Adding an index on the `invoice_id` column can improve query performance when searching or joining wallet transactions based on their associated invoices. However, it may slightly impact the performance of insert and update operations on the `wallet_transactions` table.