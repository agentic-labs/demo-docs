---
title: "20220905095529_rename_persisted_metrics_into_persisted_events.rb"
---

## High-level description
This migration renames the `persisted_metrics` table to `persisted_events` and updates the associated index name. It's part of a database schema change, likely to reflect a shift in terminology or data model within the application.

## Symbols

### `RenamePersistedMetricsIntoPersistedEvents`
#### Description
This is a Rails migration class that inherits from `ActiveRecord::Migration[7.0]`. It defines the changes to be applied to the database schema, specifically renaming a table and its associated index.

#### Internal Logic
The migration uses the `change` method to define reversible database changes:

1. It wraps the operations in a `safety_assured` block, which is likely a custom method to bypass certain safety checks.
2. It renames the `persisted_metrics` table to `persisted_events` using the `rename_table` method.
3. It renames the index `index_search_persisted_metrics` to `index_search_persisted_events` on the newly renamed `persisted_events` table using the `rename_index` method.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord::Migration | Provides the framework for defining database schema changes in Rails |

## Error Handling
This migration does not implement any specific error handling. It relies on the default behavior of Rails migrations, which will roll back changes if an error occurs during the migration process.

## Performance Considerations
Renaming a table and an index are typically fast operations, but the actual performance impact depends on the size of the table and the database system being used. For large tables, this operation might require a table lock and could potentially cause downtime.

## TODOs
The `safety_assured` method suggests that there might be some safety checks in place for migrations. It's worth investigating what these safety checks are and why they're being bypassed in this case.