---
title: "20230522113810_add_invoiceable_to_charges.rb"
---

## High-level description
This migration adds an `invoiceable` boolean column to the `charges` table and sets its default value to `true`. It also updates existing records where `pay_in_advance` is true to have `invoiceable` set to false.

## Symbols

### AddInvoiceableToCharges
#### Description
This class is a Rails migration that adds the `invoiceable` column to the `charges` table and performs an update on existing records.

#### Internal Logic
1. Adds the `invoiceable` column to the `charges` table with a default value of `true` and `null: false`.
2. Uses `safety_assured` to bypass Strong Migrations checks.
3. Implements a reversible migration with an `up` direction.
4. Executes a SQL statement to update existing records where `pay_in_advance` is true, setting `invoiceable` to false.

## Side Effects
- Modifies the schema of the `charges` table by adding a new column.
- Updates existing records in the `charges` table based on the `pay_in_advance` column.

## Performance Considerations
The migration includes a data update operation, which may take some time to complete depending on the number of records in the `charges` table. This could potentially cause a brief interruption in database access during deployment.

## Error Handling
The migration uses `safety_assured`, which bypasses Strong Migrations checks. This should be used cautiously, ensuring that the migration is indeed safe to run.

## TODOs
There are no explicit TODOs in the code.