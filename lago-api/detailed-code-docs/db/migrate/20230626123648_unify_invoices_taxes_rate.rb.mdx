---
title: "20230626123648_unify_invoices_taxes_rate.rb"
---

## High-level description
This migration file unifies the `taxes_rate` column in the `invoices` table by converting any 'NaN' (Not a Number) values to 0.0. It ensures that all `taxes_rate` values are numeric, improving data consistency and preventing potential issues with calculations or queries involving this column.

## Symbols

### `UnifyInvoicesTaxesRate`
#### Description
This class is an ActiveRecord migration that modifies the `invoices` table to unify the `taxes_rate` column. It inherits from `ActiveRecord::Migration[7.0]`, indicating it's compatible with Rails 7.0 migration framework.

#### Internal Logic
The migration uses a reversible change method with the following key steps:
1. Wraps the operation in `safety_assured` to bypass Strong Migrations checks.
2. Uses a reversible block to define the 'up' direction of the migration.
3. Executes a SQL statement to update the `invoices` table.
4. Sets `taxes_rate` to 0.0 for any rows where it currently equals 'NaN' (when cast to NUMERIC).

## Side Effects
This migration will modify the `invoices` table, changing any 'NaN' values in the `taxes_rate` column to 0.0. This could affect calculations or reports that rely on the `taxes_rate` column.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord | Provides the migration framework |

## Error Handling
The migration doesn't implement explicit error handling. It relies on the default behavior of ActiveRecord migrations, which will roll back changes if an error occurs during execution.

## Performance Considerations
This migration may take longer to run on large `invoices` tables, as it updates all rows where `taxes_rate` is 'NaN'. Consider running this migration during off-peak hours for production databases with a large number of invoices.