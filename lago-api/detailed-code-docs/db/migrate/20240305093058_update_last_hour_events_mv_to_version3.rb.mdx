---
title: "20240305093058_update_last_hour_events_mv_to_version3.rb"
---

## High-level description
This migration updates the materialized view `last_hour_events_mv` to version 3. It drops the existing materialized view and recreates it with the new version.

## Symbols

### `UpdateLastHourEventsMvToVersion3`
#### Description
This class is an ActiveRecord migration that updates the `last_hour_events_mv` materialized view to version 3. It inherits from `ActiveRecord::Migration[7.0]`, indicating it's compatible with Rails 7.0.

#### Internal Logic
The migration performs two main steps:
1. Drops the existing materialized view named `last_hour_events_mv`.
2. Creates a new materialized view with the same name but using version 3 of the view definition.

### `change`
#### Description
This method defines the changes to be applied (or reverted) when running (or rolling back) the migration.

#### Internal Logic
1. Calls `drop_view` to remove the existing materialized view.
2. Calls `create_view` to create a new materialized view with updated parameters.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord::Migration | Provides the framework for defining database schema changes |

## Notes
- The `frozen_string_literal: true` comment at the top of the file enables frozen string literals, which can improve performance and memory usage.
- The specific changes in version 3 of the view are not defined in this migration file. The actual view definition would be located in a separate SQL file or defined elsewhere in the application.
- This migration is reversible by default. Rails can automatically reverse the `create_view` and `drop_view` operations when rolling back the migration.