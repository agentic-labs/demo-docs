---
title: "20220610134535_create_payment_provider_customers.rb"
---

## High-level description
This migration file creates a new table called `payment_provider_customers` in the database. It establishes a relationship between customers and payment providers, storing additional information such as the provider's customer ID and custom settings.

## Code Structure
The code defines a single class `CreatePaymentProviderCustomers` that inherits from `ActiveRecord::Migration[7.0]`. This class contains a `change` method that specifies the structure of the new table.

## Symbols

### CreatePaymentProviderCustomers
#### Description
This class is a database migration that creates the `payment_provider_customers` table. It uses ActiveRecord's migration DSL to define the table structure.

#### Internal Logic
The `change` method uses the `create_table` method to define the new table with the following columns and properties:

1. The table uses UUID as the primary key.
2. It has a foreign key relationship with the `customers` table.
3. It has an optional foreign key relationship with the `payment_providers` table.
4. It includes a `type` column for single table inheritance.
5. It stores the provider's customer ID.
6. It includes a `settings` column to store JSON data.
7. It adds timestamp columns for `created_at` and `updated_at`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord | Provides the migration framework and database abstraction |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| id | symbol | :uuid | Sets the primary key type to UUID |
| customer_id | uuid | N/A | Foreign key to the customers table |
| payment_provider_id | uuid | N/A | Optional foreign key to the payment_providers table |
| type | string | N/A | Stores the type of payment provider customer (for STI) |
| provider_customer_id | string | N/A | Stores the customer ID provided by the payment provider |
| settings | jsonb | {} | Stores additional settings as JSON |

Note: The `timestamps` method automatically adds `created_at` and `updated_at` columns.