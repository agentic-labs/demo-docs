---
title: "20230717090135_add_precise_coupons_amount_cents_to_fees.rb"
---

## High-level description
This migration adds two new columns to the database: `precise_coupons_amount_cents` to the `fees` table and `fees_amount_cents` to the `invoices_taxes` table. These columns are designed to store financial data with high precision for coupons and fees respectively.

## Symbols

### AddPreciseCouponsAmountCentsToFees
#### Description
This is a Rails migration class that inherits from `ActiveRecord::Migration[7.0]`. It defines changes to be applied to the database schema.

#### Internal Logic
The migration performs two main actions:
1. Adds a `precise_coupons_amount_cents` column to the `fees` table.
2. Adds a `fees_amount_cents` column to the `invoices_taxes` table.

### change
#### Description
This method defines the changes to be applied to the database schema when the migration is run.

#### Internal Logic
1. Adds `precise_coupons_amount_cents` column to `fees` table:
   - Type: `decimal`
   - Precision: 30 (total number of digits)
   - Scale: 5 (number of digits after the decimal point)
   - Not null
   - Default value: 0

2. Adds `fees_amount_cents` column to `invoices_taxes` table:
   - Type: `bigint`
   - Not null
   - Default value: 0

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord::Migration | Provides the framework for modifying the database schema |

## Notes
- The `precise_coupons_amount_cents` column uses a high precision decimal type, allowing for accurate financial calculations involving coupons.
- The `fees_amount_cents` column uses a `bigint` type, suitable for storing large integer values representing cents.
- Both new columns are set to `null: false` and have a default value of 0, ensuring data integrity.
- This migration is reversible by default, as Rails can automatically reverse the `add_column` operations if needed.