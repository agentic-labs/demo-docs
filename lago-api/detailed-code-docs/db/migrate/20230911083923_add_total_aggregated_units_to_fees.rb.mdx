---
title: "20230911083923_add_total_aggregated_units_to_fees.rb"
---

## High-level description
This migration adds a new column `total_aggregated_units` to the `fees` table and populates it with data from the existing `units` column for fees of type 0. The migration is designed to be reversible and uses safety measures to ensure data integrity.

## Symbols

### `AddTotalAggregatedUnitsToFees`
#### Description
This class is an ActiveRecord migration that adds a new column to the `fees` table and updates it with existing data for specific fee types.

#### Internal Logic
1. Adds a new `decimal` column named `total_aggregated_units` to the `fees` table.
2. Uses `safety_assured` block to bypass Strong Migrations checks.
3. Implements a reversible migration with an `up` direction.
4. Executes a SQL statement to update the new column with data from the `units` column for fees where `fee_type` is 0.

## Side Effects
- Modifies the `fees` table schema by adding a new column.
- Updates data in the `fees` table for records where `fee_type` is 0.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ActiveRecord::Migration | Provides the migration framework for database schema changes |

## Error Handling
The migration uses `safety_assured` to bypass Strong Migrations checks, indicating that the developer has considered potential safety issues with this migration.

## TODOs
There are no explicit TODOs in the code.