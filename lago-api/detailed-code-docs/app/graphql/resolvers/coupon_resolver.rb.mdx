---
title: "coupon_resolver.rb"
---

## High-level description
This code defines a GraphQL resolver for querying a single coupon within an organization. It ensures that the user is authenticated and has the necessary permissions to view coupons.

## Code Structure
The `CouponResolver` class inherits from `Resolvers::BaseResolver` and includes two modules: `AuthenticableApiUser` and `RequiredOrganization`. It defines the resolver's description, arguments, return type, and the main `resolve` method.

## References
- `Types::Coupons::Object`: The GraphQL type returned by this resolver.
- `Resolvers::BaseResolver`: The base class for this resolver.
- `AuthenticableApiUser`: A module for user authentication.
- `RequiredOrganization`: A module for organization-related checks.

## Symbols

### `CouponResolver`
#### Description
This class resolves queries for a single coupon within an organization. It ensures the user is authenticated and has the required permissions before fetching the coupon.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| id | ID | Unique ID of the coupon (required) |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| coupon | Types::Coupons::Object | The requested coupon object, or null if not found |

#### Internal Logic
1. Checks for user authentication and organization membership (via included modules).
2. Verifies the user has the 'coupons:view' permission.
3. Attempts to find the coupon by ID within the current organization.
4. Returns the coupon if found, or raises a not found error.

## Side Effects
This resolver does not have any side effects. It only reads data from the database.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| AuthenticableApiUser | Ensures the user is authenticated |
| RequiredOrganization | Ensures the user belongs to the required organization |

## Error Handling
- Raises an `unauthorized_error` if the user is not authenticated (via `AuthenticableApiUser`).
- Raises an `organization_error` if the organization is missing or the user is not a member (via `RequiredOrganization`).
- Raises a `not_found_error` if the requested coupon is not found.

## API/Interface Reference
This resolver is part of the GraphQL API and can be queried as follows:
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| /graphql | POST | `{ coupon(id: "coupon_id") { ... } }` | Coupon object or null | Retrieves a single coupon by ID |

Note: The actual endpoint may vary depending on the application's routing configuration.