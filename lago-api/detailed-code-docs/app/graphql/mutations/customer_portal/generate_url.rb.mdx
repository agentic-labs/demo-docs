---
title: "generate_url.rb"
---

## High-level description
This code defines a GraphQL mutation called `GenerateCustomerPortalUrl` within the `Mutations::CustomerPortal` module. It generates a URL for a customer portal, given a customer ID, and returns the generated URL as a string.

## Code Structure
The `GenerateUrl` class inherits from `BaseMutation` and includes two modules: `AuthenticableApiUser` and `RequiredOrganization`. It defines the mutation's name, description, input argument, and output field. The main logic is implemented in the `resolve` method.

## References
- `AuthenticableApiUser` module
- `RequiredOrganization` module
- `::CustomerPortal::GenerateUrlService`

## Symbols

### `Mutations::CustomerPortal::GenerateUrl`
#### Description
This class defines a GraphQL mutation for generating a customer portal URL. It authenticates the API user, ensures the presence of an organization, and uses the `CustomerPortal::GenerateUrlService` to create the URL.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| id | ID | The ID of the customer for whom the portal URL is being generated |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| url | String | The generated customer portal URL |

#### Internal Logic
1. Find the customer in the current organization using the provided ID.
2. Call the `CustomerPortal::GenerateUrlService` with the found customer.
3. If successful, return the generated URL.
4. If unsuccessful, return an error result.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| AuthenticableApiUser | Provides authentication for API users |
| RequiredOrganization | Ensures the presence of an organization |
| CustomerPortal::GenerateUrlService | Generates the customer portal URL |

## Error Handling
The mutation uses the `result_error` method to handle errors returned by the `GenerateUrlService`. Specific error handling mechanisms are not visible in this file but may be implemented in the service or parent classes.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| generateCustomerPortalUrl | POST | `{ id: ID! }` | `{ url: String! }` | Generates a customer portal URL for the given customer ID |

This mutation is part of the GraphQL API and can be accessed through standard GraphQL queries.