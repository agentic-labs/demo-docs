---
title: "adyen_checkout_url_job.rb"
---

## High-level description
This code defines a background job class `AdyenCheckoutUrlJob` within the `PaymentProviderCustomers` module. Its primary purpose is to generate a checkout URL for Adyen payment processing asynchronously, with built-in error handling and retry mechanisms.

## Symbols

### `AdyenCheckoutUrlJob`
#### Description
This class is a subclass of `ApplicationJob` and is responsible for generating an Adyen checkout URL for a given Adyen customer. It uses the `AdyenService` to perform this task.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| adyen_customer | AdyenCustomer | An instance of AdyenCustomer for which the checkout URL needs to be generated |

#### Internal Logic
1. The job is queued in the `:providers` queue.
2. It has retry mechanisms set up for `Adyen::AdyenError` and `ActiveJob::DeserializationError`.
3. In the `perform` method, it creates a new instance of `PaymentProviderCustomers::AdyenService` with the given `adyen_customer`.
4. It calls the `generate_checkout_url` method on the service and raises an error if the result indicates a failure.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ApplicationJob | Base class for background jobs |
| PaymentProviderCustomers::AdyenService | Service class for Adyen-related operations |

## Error Handling
The job implements specific error handling:
1. It retries on `Adyen::AdyenError` with a polynomial backoff strategy, up to 6 attempts.
2. It also retries on `ActiveJob::DeserializationError`, which can occur if the job arguments can't be deserialized.
3. The `raise_if_error!` method is called on the result, which will raise an exception if an error occurred during the checkout URL generation.

## References
This job relies on the `PaymentProviderCustomers::AdyenService` class, specifically its `generate_checkout_url` method. The implementation of this service can be found in the related code snippet `app/services/payment_provider_customers/adyen_service.rb`.

## Performance Considerations
The use of background job processing allows for asynchronous execution of the checkout URL generation, which can help in maintaining responsiveness in the main application, especially if the Adyen API calls take some time to complete.