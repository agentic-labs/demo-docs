---
title: "Overview"
---

## High-level description
The `app/models/integration_customers` directory contains a set of models that represent customers in the context of various integrations. These models are designed to handle customer data specific to different integration platforms, such as Anrok, Netsuite, and Xero. The directory includes a base class (`BaseCustomer`) that provides common functionality, and several subclasses that represent customers for specific integrations.

## What does it do?
This directory implements a system for managing customer data across different integration platforms. It allows the application to:

1. Store and retrieve customer information specific to each integration.
2. Maintain a consistent structure for customer data across different integrations.
3. Handle integration-specific settings and attributes for customers.
4. Provide a unified interface for working with customer data, regardless of the integration type.

The models in this directory enable the application to synchronize customer data between the main application and various external systems (like Anrok, Netsuite, and Xero) while maintaining the integrity and specificity of each integration.

## Key Files

1. `base_customer.rb`: This is the core file in the directory, defining the `IntegrationCustomers::BaseCustomer` class. It serves as the foundation for all integration-specific customer models, providing common attributes, relationships, and functionality. Key features include:
   - Inheritance from `ApplicationRecord`
   - Inclusion of `PaperTrailTraceable` and `SettingsStorable` concerns
   - One-to-one relationships with `Customer` and `Integrations::BaseIntegration` models
   - Scopes for filtering customers
   - A `customer_type` class method for mapping integration types to customer classes

2. `anrok_customer.rb`: Defines the `AnrokCustomer` class, which represents customers in the Anrok integration. This class inherits from `BaseCustomer` without adding any specific functionality.

3. `netsuite_customer.rb`: Implements the `NetsuiteCustomer` class for Netsuite integration. It adds a `subsidiary_id` setting specific to Netsuite customers.

4. `xero_customer.rb`: Defines the `XeroCustomer` class for Xero integration. Like `AnrokCustomer`, it inherits from `BaseCustomer` without adding specific functionality.

These files work together to provide a flexible and extensible system for managing customer data across different integrations. The `BaseCustomer` class provides the core functionality, while the integration-specific classes allow for customization and extension as needed for each integration platform.

## Dependencies
The models in this directory rely on several external libraries and frameworks:

1. Ruby on Rails: The models inherit from `ApplicationRecord`, indicating that this is a Rails application.
2. PaperTrail: Used for versioning and tracking changes to customer records (via the `PaperTrailTraceable` concern).
3. Custom concerns:
   - `PaperTrailTraceable`: Likely provides methods for tracking changes to records.
   - `SettingsStorable`: Provides functionality for storing and accessing settings in a JSONB column.

## Configuration
The `BaseCustomer` class uses the `settings_accessors` method from the `SettingsStorable` concern to define accessors for the `sync_with_provider` setting. This setting is stored in the `settings` JSONB column of the database table.

The `NetsuiteCustomer` class also uses `settings_accessors` to define accessors for the `subsidiary_id` setting, which is specific to Netsuite customers.

These configuration options allow for flexible storage and retrieval of integration-specific settings without requiring additional database columns for each setting.

Example of how settings are defined:

```ruby
class IntegrationCustomers::BaseCustomer &lt; ApplicationRecord
  include SettingsStorable
  
  settings_accessors :sync_with_provider
end

class IntegrationCustomers::NetsuiteCustomer &lt; IntegrationCustomers::BaseCustomer
  settings_accessors :subsidiary_id
end
```

These settings can be accessed and modified like regular attributes:

```ruby
netsuite_customer = IntegrationCustomers::NetsuiteCustomer.new
netsuite_customer.sync_with_provider = true
netsuite_customer.subsidiary_id = 123
```

The use of `settings_accessors` allows for easy addition of new settings without requiring database migrations, providing flexibility in handling integration-specific data.