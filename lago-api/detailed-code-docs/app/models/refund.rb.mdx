---
title: "refund.rb"
---

## High-level description
The `Refund` model represents a refund in the application. It is associated with a payment, credit note, payment provider, and payment provider customer. The model includes paper trail tracing for tracking changes and defines the database schema for the refunds table.

## Code Structure
The `Refund` class inherits from `ApplicationRecord` and includes the `PaperTrailTraceable` module. It defines several associations with other models in the application.

## Symbols

### `Refund`
#### Description
This class represents a refund in the application. It is an ActiveRecord model that includes paper trail tracing for change tracking.

#### Associations
1. `belongs_to :payment`: Associates the refund with a payment.
2. `belongs_to :credit_note`: Associates the refund with a credit note.
3. `belongs_to :payment_provider`: Optional association with a payment provider (class: `PaymentProviders::BaseProvider`).
4. `belongs_to :payment_provider_customer`: Associates the refund with a payment provider customer (class: `PaymentProviderCustomers::BaseCustomer`).

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| PaperTrailTraceable | Includes functionality for tracking changes to the model |

## Schema Information
The code includes a detailed schema information comment, which describes the structure of the `refunds` table in the database. Key fields include:

- `id`: UUID, primary key
- `amount_cents`: Bigint, default 0, not null
- `amount_currency`: String, not null
- `status`: String, not null
- `credit_note_id`: UUID, not null
- `payment_id`: UUID, not null
- `payment_provider_customer_id`: UUID, not null
- `payment_provider_id`: UUID
- `provider_refund_id`: String, not null

The schema also includes information about indexes and foreign keys.

## References
The `Refund` model references the following models:
- `Payment`
- `CreditNote`
- `PaymentProviders::BaseProvider`
- `PaymentProviderCustomers::BaseCustomer`

These references are crucial for understanding the relationships between refunds and other entities in the system.