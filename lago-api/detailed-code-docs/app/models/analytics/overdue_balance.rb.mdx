---
title: "overdue_balance.rb"
---

## High-level description
The `Analytics::OverdueBalance` module defines an abstract class responsible for calculating and retrieving overdue balances for an organization. It provides a `query` method to fetch overdue balance data based on various filters, including organization ID, external customer ID, currency, and number of months.

## Code Structure
The `Analytics::OverdueBalance` class uses a class method `query` to build and execute a SQL query. It also defines methods for cache key generation and expiration. The `query` method utilizes several conditional statements to dynamically construct the SQL query based on the provided arguments.

## References
This class references the following models:
- `Organization`
- `Invoice`
- `Customer`

## Symbols

### `Analytics::OverdueBalance`
#### Description
An abstract class that provides methods for calculating and retrieving overdue balances for an organization.

#### Inputs
This class doesn't have instance methods and therefore doesn't accept direct inputs.

#### Outputs
This class doesn't have instance methods and therefore doesn't return direct outputs.

#### Internal Logic
This class defines several class methods:
- `query`: This method builds and executes a SQL query to retrieve overdue balance data based on the provided arguments. It utilizes several conditional statements to dynamically construct the SQL query, including filters for organization ID, external customer ID, currency, and number of months.
- `cache_key`: This method generates a cache key based on the provided arguments.
- `expire_cache_for_customer`: This method expires the cache for a specific customer within an organization.

## Side Effects
- This class interacts with the Rails cache to store and expire overdue balance data.
- It executes SQL queries against the database to retrieve data.

## Dependencies
- `ActiveRecord` for database interactions.
- `Rails.cache` for caching.

## Error Handling
This class does not implement specific error handling beyond basic exception raising.

## Logging
This class does not implement logging.
