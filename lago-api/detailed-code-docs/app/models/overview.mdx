---
title: "Overview"
---

## High-level description
The `app/models` directory contains the core data models for the Lago application. These models represent various entities and concepts within the billing and subscription management system, including customers, organizations, plans, invoices, payments, and more. The models define the structure, relationships, and business logic for these entities.

## What does it do?
This directory provides the foundation for data management and business logic in the Lago application. It includes models that:

1. Define the structure and relationships of data entities
2. Implement business rules and validations
3. Handle complex calculations related to billing and subscriptions
4. Manage integrations with external payment providers and accounting systems
5. Track changes and maintain audit trails for important entities
6. Implement soft deletion and data recovery mechanisms
7. Provide scopes and methods for querying and manipulating data

These models work together to create a comprehensive system for managing subscriptions, billing, invoicing, and related financial operations.

## Entry points
The main entry points for this directory are the individual model classes. Some of the key models include:

1. `Customer`: Represents customers and their associated data
2. `Organization`: Represents organizations using the Lago system
3. `Plan`: Defines subscription plans and their pricing structures
4. `Subscription`: Manages customer subscriptions to plans
5. `Invoice`: Represents invoices generated for customers
6. `Payment`: Handles payment transactions
7. `Wallet`: Manages customer wallets for prepaid credits

Developers typically interact with these models through ActiveRecord queries, associations, and methods defined within each model class.

## Key Files
1. `application_record.rb`: The base class for all models in the application
2. `customer.rb`: Defines the Customer model and its associated logic
3. `organization.rb`: Represents organizations and their settings
4. `plan.rb`: Manages subscription plans and pricing
5. `subscription.rb`: Handles customer subscriptions and their lifecycle
6. `invoice.rb`: Represents invoices and their generation process
7. `payment.rb`: Manages payment transactions and provider integrations
8. `wallet.rb`: Handles customer wallets and credit management

## Dependencies
The models in this directory rely on several key dependencies:

1. Ruby on Rails: Provides the ActiveRecord ORM and other core functionality
2. PaperTrail: Used for versioning and auditing changes to records
3. Discard: Implements soft delete functionality for various models
4. Money-Rails: Handles currency and monetary calculations
5. AASM: Manages state machines for models with complex lifecycles
6. Ransack: Provides advanced searching capabilities for models

These dependencies were likely chosen to provide robust ORM capabilities, maintain data integrity, and implement complex business logic efficiently.

## Configuration
The models use various configuration options, including:

1. Enum definitions for status fields and other categorical attributes
2. Monetized attributes for handling currency values
3. PaperTrail configuration for versioning
4. Discard configuration for soft deletes
5. Validation rules and custom validators
6. Scopes for common query patterns

Many models also include constants that define allowed values for certain attributes or configuration options specific to that model.

For example, in the `Plan` model:

```ruby
INTERVALS = %w[weekly monthly quarterly yearly].freeze

enum interval: INTERVALS

monetize :amount_cents, with_model_currency: :amount_currency
```

These configuration options allow for flexible and maintainable code while enforcing business rules and data integrity.

In summary, the `app/models` directory forms the backbone of the Lago application's data layer, providing a rich set of models that encapsulate the complex business logic of a subscription and billing management system. The models are designed to work together seamlessly, leveraging various Rails features and external libraries to create a robust and flexible foundation for the application.