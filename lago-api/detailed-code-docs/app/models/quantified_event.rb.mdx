---
title: "quantified_event.rb"
---

## High-level description
The `QuantifiedEvent` model represents a quantifiable event related to a subscription, associated with an organization and a billable metric. It tracks events over time and can be grouped for aggregation.

## Code Structure
The `QuantifiedEvent` model has relationships with `Organization`, `BillableMetric`, and `Group` models. It also has a one-to-many relationship with the `Event` model. The model includes validations for required fields and uses the `PaperTrailTraceable` and `Discard::Model` concerns.

## References
- `ApplicationRecord`: `QuantifiedEvent` inherits from `ApplicationRecord`.
- `PaperTrailTraceable`: Used for tracking changes to the model.
- `Discard::Model`: Provides soft delete functionality.

## Symbols

### `QuantifiedEvent`
#### Description
Represents a quantifiable event associated with a subscription.

#### Inputs
This section is not applicable as this is a model definition, not a method.

#### Outputs
This section is not applicable as this is a model definition, not a method.

#### Internal Logic
The model defines several constants and relationships with other models:
- `RECURRING_TOTAL_UNITS`: A constant representing the total aggregated units.
- `belongs_to :organization`: Each event belongs to an organization.
- `belongs_to :billable_metric`: Each event is associated with a billable metric.
- `belongs_to :group, optional: true`: Events can optionally belong to a group.
- `has_many :events`: Each quantified event can have multiple associated events.

It also includes validations:
- `validates :added_at, presence: true`: Ensures the `added_at` attribute is present.
- `validates :external_subscription_id, presence: true`: Ensures the `external_subscription_id` attribute is present.

Finally, it uses the following:
- `default_scope -&gt; { kept }`: Sets the default scope to only include non-discarded records.

## Side Effects
This section is not applicable as this is a model definition, not a method.

## Dependencies
- `ActiveRecord`: Provides the base model functionality.
- `PaperTrailTraceable`: Provides change tracking functionality.
- `Discard::Model`: Provides soft delete functionality.

## Error Handling
This section is not applicable as this is a model definition, not a method.

## Logging
This section is not applicable as this is a model definition, not a method.

## API/Interface Reference
This section is not applicable as this is a model definition, not a method.
