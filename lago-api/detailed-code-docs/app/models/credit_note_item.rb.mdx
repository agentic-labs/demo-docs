---
title: "credit_note_item.rb"
---

## High-level description
This code defines the `CreditNoteItem` model, which represents an item in a credit note. It belongs to a credit note and a fee, and includes validation and association logic for managing credit note items.

## Code Structure
The `CreditNoteItem` class inherits from `ApplicationRecord` and defines associations, validations, and a method for retrieving applied taxes.

## Symbols

### `CreditNoteItem`
#### Description
This class represents an item in a credit note, associating it with a credit note and a fee.

#### Associations
| Name | Type | Description |
|:-----|:-----|:------------|
| belongs_to :credit_note | Association | Associates the item with a credit note |
| belongs_to :fee | Association | Associates the item with a fee |

#### Validations
| Validation | Description |
|:-----------|:------------|
| monetize :amount_cents | Monetizes the amount_cents attribute |
| validates :amount_cents, numericality: {greater_than_or_equal_to: 0} | Ensures the amount is non-negative |

#### Methods

##### `applied_taxes`
###### Description
Retrieves the applied taxes for the credit note item.

###### Internal Logic
It fetches the applied taxes from the associated credit note where the tax IDs match those of the associated fee's applied taxes.

## Schema Information
The code includes a schema information block detailing the structure of the `credit_note_items` table, including columns, indexes, and foreign keys.

## Dependencies
The code relies on the `ApplicationRecord` class and the `monetize` gem for handling monetary values.

## Performance Considerations
The `applied_taxes` method uses a join and a subquery, which may impact performance for large datasets. Consider optimizing this query if it becomes a bottleneck.

## TODOs
There are no explicit TODOs in this code.