---
title: "stripe_customer.rb"
---

## High-level description
The `StripeCustomer` class represents a customer on the Stripe payment platform. It inherits from the `BaseCustomer` class and adds Stripe-specific validations and settings. It ensures that only allowed payment methods are used and that the 'link' payment method is only used in conjunction with 'card'.

## Code Structure
The `StripeCustomer` class inherits from `BaseCustomer` and defines validations and settings specific to Stripe customers. It uses the `PAYMENT_METHODS` constant to validate allowed payment methods.

## References
This class references the `BaseCustomer` class and uses the `PAYMENT_METHODS` constant.

## Symbols

### `StripeCustomer`
#### Description
This class represents a customer on the Stripe platform. It inherits from `BaseCustomer` and adds Stripe-specific validations and settings.

#### Inputs
This class doesn't have any explicitly defined input parameters.

#### Outputs
This class doesn't have any explicitly defined output values.

#### Internal Logic
The class defines several validations:
- `validates :provider_payment_methods, presence: true`: Ensures that `provider_payment_methods` is always present.
- `validate :allowed_provider_payment_methods`: Ensures that only allowed payment methods are included in `provider_payment_methods`.
- `validate :link_payment_method_can_exist_only_with_card`: Ensures that the 'link' payment method is only used in conjunction with 'card'.

It also defines settings accessors for `payment_method_id`.

The `provider_payment_methods` and `provider_payment_methods=` methods provide access to the `provider_payment_methods` setting stored in the `settings` attribute.

## Side Effects
This class modifies the `settings` attribute of the corresponding database record to store and retrieve Stripe-specific settings.

## Dependencies
This class depends on the `BaseCustomer` class.

## Error Handling
This class uses Active Record validations to handle errors. If any of the validations fail, the corresponding error messages are added to the object's errors collection.
