---
title: "Overview"
---

## High-level description
This directory contains query classes that encapsulate database querying logic for various models in the application. These classes extend a common `BaseQuery` class and provide specialized querying, filtering, and pagination functionality for different entities such as add-ons, coupons, customers, invoices, plans, subscriptions, taxes, and webhooks.

## What does it do?
The query classes in this directory are responsible for:

1. Constructing complex database queries with filtering, searching, and pagination capabilities.
2. Providing a consistent interface for querying different models across the application.
3. Encapsulating query logic to keep controllers and other parts of the application clean and focused.
4. Implementing model-specific filtering and searching logic.
5. Handling pagination of query results.
6. Applying security measures by scoping queries to specific organizations.

These query classes are used throughout the application to retrieve data for API endpoints, GraphQL resolvers, and other parts of the system that need to access and filter data from the database.

## Key Files
1. `base_query.rb`: The parent class for all query classes, providing common functionality for pagination, filtering, and error handling.

2. `customers_query.rb`: Handles querying and filtering customer records, including search functionality.

3. `invoices_query.rb`: Manages complex queries for invoices, including filtering by various criteria such as status, date ranges, and payment information.

4. `subscriptions_query.rb`: Responsible for querying subscriptions with options to filter by status, external customer ID, and plan code.

5. `plans_query.rb`: Handles querying and filtering of plan records, including search functionality and exclusion of plans pending deletion.

6. `fees_query.rb`: Manages queries for fees, including filtering by various criteria such as date ranges, fee types, and payment status.

7. `credit_notes_query.rb`: Handles querying and filtering of credit notes, including customer-specific filters and date range filtering.

8. `webhooks_query.rb` and `webhook_endpoints_query.rb`: These files handle querying of webhooks and webhook endpoints, respectively, providing search and filtering capabilities.

## Dependencies
The query classes in this directory depend on the following key libraries and frameworks:

1. ActiveRecord: Used for building and executing database queries.
2. Ransack: Utilized in several query classes for implementing search functionality.
3. Kaminari: Likely used for pagination (inferred from the use of `page` and `limit` parameters).

## Configuration
The query classes often use configuration from the models they query, such as:

1. Valid statuses for filtering (e.g., in `subscriptions_query.rb` and `invoices_query.rb`).
2. Default ordering options (e.g., in `taxes_query.rb`).
3. Searchable fields defined in the models (used with Ransack).

Environment variables are not directly used in these query classes, but they may indirectly affect the behavior through the models and database configuration.

The query classes are designed to be flexible and configurable through their initialization parameters, allowing callers to specify pagination, filtering, and search options as needed.