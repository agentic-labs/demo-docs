---
title: "Overview"
---

## High-level description
This directory contains services related to fee management in a billing or invoicing system. The services handle various aspects of fee creation, calculation, and management for different types of charges and billing scenarios.

## What does it do?
The services in this directory perform the following key functions:

1. Create and manage fees for different types of charges (e.g., add-ons, subscriptions, one-off charges).
2. Calculate fee amounts based on various factors such as charge models, billing periods, and usage data.
3. Apply taxes to fees.
4. Handle pay-in-advance and pay-in-arrears billing scenarios.
5. Manage fee adjustments and true-ups.
6. Update fee payment statuses.
7. Estimate fees for pay-in-advance charges.
8. Create and manage fees for paid credits and minimum commitments.

These services work together to ensure accurate fee calculation and management throughout the billing process, handling complex scenarios such as prorated billing, upgrades/downgrades, and trial periods.

## Entry points
The main entry points for this directory are the various service classes, each responsible for a specific aspect of fee management:

1. `AddOnService`: Creates fees for add-ons.
2. `ChargeService`: Calculates and creates fees for charges.
3. `SubscriptionService`: Manages subscription fees.
4. `OneOffService`: Handles one-off fee creation.
5. `CreatePayInAdvanceService`: Creates fees for pay-in-advance charges.
6. `EstimatePayInAdvanceService`: Estimates fees for pay-in-advance charges.
7. `UpdateService`: Updates fee payment statuses.

These services are likely called from controllers or other parts of the application that need to perform fee-related operations.

## Key Files
1. `add_on_service.rb`: Handles fee creation for add-ons.
2. `apply_taxes_service.rb`: Applies taxes to fees.
3. `charge_service.rb`: Manages fee calculation and creation for charges.
4. `create_pay_in_advance_service.rb`: Creates fees for pay-in-advance charges.
5. `subscription_service.rb`: Manages subscription fee creation and calculation.
6. `create_true_up_service.rb`: Handles true-up fee creation.
7. `estimate_pay_in_advance_service.rb`: Estimates fees for pay-in-advance charges.
8. `paid_credit_service.rb`: Manages fees for paid credits.

## Dependencies
The services in this directory depend on various models and other services within the application:

1. `BaseService`: A parent class providing common functionality for service objects.
2. `Fee`: The model representing fees in the system.
3. `Invoice`: The model representing invoices.
4. `Subscription`: The model representing subscriptions.
5. `Charge`: The model representing charges.
6. `BillableMetric`: The model representing billable metrics.
7. `ApplyTaxesService`: A service for applying taxes to fees.
8. `ChargeModelFactory`: A factory for creating charge models.
9. `AggregationFactory`: A factory for creating aggregation objects.

External libraries and frameworks are not explicitly mentioned in the provided code summaries, but the services likely rely on Ruby on Rails and its associated libraries.

## Configuration
The services in this directory use various configuration options and constants defined in the models they interact with. For example:

1. `Fee::PAYMENT_STATUS`: Defines valid payment statuses for fees.
2. Charge models and aggregation methods are likely configured elsewhere in the application and used by these services.

Environment variables or specific configuration files are not mentioned in the provided summaries, but they may be used for setting up tax rates, currency conversions, or other system-wide settings that affect fee calculations.

The services in this directory form a crucial part of the billing system, handling the complex logic of fee creation, calculation, and management for various scenarios. They work together to ensure accurate billing and provide flexibility for different types of charges and billing models.