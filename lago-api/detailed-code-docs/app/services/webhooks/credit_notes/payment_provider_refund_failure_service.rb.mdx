---
title: "payment_provider_refund_failure_service.rb"
---

## High-level description
This code defines a service class `PaymentProviderRefundFailureService` within the `Webhooks::CreditNotes` module. It is responsible for handling webhook notifications when a refund failure occurs for a credit note in a payment provider system.

## Code Structure
The `PaymentProviderRefundFailureService` class inherits from `Webhooks::BaseService` and overrides several private methods to customize the webhook behavior for credit note refund failures.

## References
This code references the following:
- `Webhooks::BaseService`
- `::V1::CreditNotes::PaymentProviderRefundErrorSerializer`

## Symbols

### `PaymentProviderRefundFailureService`
#### Description
This class handles the creation and sending of webhooks when a credit note refund fails in the payment provider system.

#### Internal Logic
The class overrides several private methods from the base class to provide specific functionality:
1. It aliases the `object` as `credit_note` for clearer semantics.
2. It defines `current_organization` to retrieve the organization associated with the credit note.
3. It sets up the `object_serializer` using `PaymentProviderRefundErrorSerializer` with specific options.
4. It defines the `webhook_type` and `object_type` for this specific webhook event.

### `current_organization`
#### Description
Retrieves the organization associated with the credit note.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| @current_organization | Organization | The organization associated with the credit note |

### `object_serializer`
#### Description
Creates and returns a serializer for the credit note with specific options.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| serializer | ::V1::CreditNotes::PaymentProviderRefundErrorSerializer | Serializer instance for the credit note |

#### Internal Logic
1. Creates a new instance of `PaymentProviderRefundErrorSerializer`.
2. Passes the credit note, root name, provider error, and provider customer ID as options to the serializer.

### `webhook_type`
#### Description
Defines the type of webhook for this event.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| webhook_type | String | The type of webhook ('credit_note.refund_failure') |

### `object_type`
#### Description
Defines the type of object for this webhook event.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| object_type | String | The type of object ('credit_note_payment_provider_refund_error') |

## Dependencies
This code depends on the following:
| Dependency | Purpose |
|:-----------|:--------|
| Webhooks::BaseService | Parent class providing base webhook functionality |
| ::V1::CreditNotes::PaymentProviderRefundErrorSerializer | Serializer for formatting credit note data |

## Error Handling
Error handling is not explicitly implemented in this service. It relies on the error handling mechanisms of the parent class and the Ruby on Rails framework.