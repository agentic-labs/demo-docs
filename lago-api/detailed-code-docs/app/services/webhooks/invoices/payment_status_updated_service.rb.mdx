---
title: "payment_status_updated_service.rb"
---

## High-level description
This code defines a service class `PaymentStatusUpdatedService` within the `Webhooks::Invoices` module. It is responsible for handling webhook events related to updates in the payment status of invoices. The class inherits from `Webhooks::BaseService` and provides specific implementations for webhook-related operations.

## Code Structure
The `PaymentStatusUpdatedService` class is part of a larger webhook system, as evidenced by its namespace and inheritance. It defines methods that are likely used by the parent class to process and send webhook notifications when an invoice's payment status is updated.

## References
This code references:
- `Webhooks::BaseService` (parent class)
- `::V1::InvoiceSerializer` (used for serializing invoice data)

## Symbols

### `PaymentStatusUpdatedService`
#### Description
This class handles the webhook event for when an invoice's payment status is updated. It provides methods to retrieve the current organization, serialize the invoice object, and define the webhook and object types.

#### Internal Logic
The class defines four methods:
1. `current_organization`: Retrieves the organization associated with the invoice.
2. `object_serializer`: Creates a serializer for the invoice object with specific options.
3. `webhook_type`: Defines the type of webhook event.
4. `object_type`: Specifies the type of object involved in the webhook.

### `current_organization`
#### Description
Retrieves and memoizes the organization associated with the invoice object.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| @current_organization | Organization | The organization associated with the invoice |

### `object_serializer`
#### Description
Creates and returns an instance of `V1::InvoiceSerializer` for the invoice object.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| serializer | V1::InvoiceSerializer | Serializer for the invoice object |

#### Internal Logic
- Creates a new `V1::InvoiceSerializer` instance with the following options:
  - `object`: The invoice object
  - `root_name`: Set to 'invoice'
  - `includes`: An array of symbols [:customer, :fees] to include related data

### `webhook_type`
#### Description
Defines the type of webhook event as a string.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| webhook_type | String | The type of webhook event |

### `object_type`
#### Description
Specifies the type of object involved in the webhook as a string.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| object_type | String | The type of object involved in the webhook |

## Dependencies
This code depends on the `V1::InvoiceSerializer` class for serializing invoice data.

## API/Interface Reference
While not explicitly defining an API, this service class is part of a webhook system. It's likely used in conjunction with other components to process and send webhook notifications when an invoice's payment status is updated.

| Method | Purpose | Description |
|:-------|:--------|:------------|
| `current_organization` | Data Retrieval | Gets the organization associated with the invoice |
| `object_serializer` | Data Serialization | Creates a serializer for the invoice object |
| `webhook_type` | Event Identification | Defines the type of webhook event |
| `object_type` | Object Identification | Specifies the type of object involved |

These methods are likely called by the parent `Webhooks::BaseService` class or other components in the webhook system to gather necessary information for processing and sending the webhook notification.