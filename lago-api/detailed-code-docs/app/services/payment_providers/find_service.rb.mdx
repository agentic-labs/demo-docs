---
title: "find_service.rb"
---

## High-level description
This code defines the `PaymentProviders::FindService` class, which is responsible for finding a payment provider based on given criteria such as organization ID, code, ID, and payment provider type. It handles various scenarios and returns appropriate results or errors.

## Code Structure
The `FindService` class inherits from `BaseService` and contains a single public method `call`. It initializes with organization ID, code, ID, and payment provider type, and uses these to build a scope for querying payment providers.

## Symbols

### PaymentProviders::FindService
#### Description
This service class is responsible for finding a payment provider based on given criteria.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization_id | UUID | The ID of the organization |
| code | String | The code of the payment provider (optional) |
| id | UUID | The ID of the payment provider (optional) |
| payment_provider_type | String | The type of payment provider (optional) |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | BaseService::Result | Contains the found payment provider or error information |

#### Internal Logic
1. Initializes the service with the given parameters and builds a scope for querying payment providers.
2. If a payment provider type is provided, it narrows down the scope to that specific type.
3. In the `call` method, it first checks if an ID is provided and tries to find the payment provider by ID.
4. If no ID is provided or no provider is found by ID, it checks if a code is provided.
5. If no code is provided and there are multiple providers, it returns an error.
6. If a code is provided, it narrows down the scope to providers with that code.
7. If no providers are found in the final scope, it returns an error.
8. If a provider is found, it returns the provider in the result.

## Dependencies
This service depends on the `BaseService` class and the `PaymentProviders::BaseProvider` model.

## Error Handling
The service handles various error scenarios:
- If no payment provider is found by ID, it continues to search by code.
- If no code is provided and there are multiple providers, it returns a "Code is missing" error.
- If no payment provider is found in the final scope, it returns a "Payment provider not found" error.

## Performance Considerations
The service uses database queries to find the payment provider, so its performance depends on the database's efficiency and the number of payment providers in the organization.