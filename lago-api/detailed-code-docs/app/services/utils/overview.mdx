---
title: "Overview"
---

## High-level description
The `app/services/utils` directory contains utility classes and modules that provide various helper functions and services used throughout the application. These utilities handle tasks such as datetime operations, money calculations with high precision, PDF generation, event tracking, and timezone conversions.

## What does it do?
This directory provides a set of tools that support different aspects of the application:

1. Datetime handling: It offers methods to validate datetime formats and calculate date differences while considering timezones.

2. Money calculations: It extends the Money class to provide high-precision monetary calculations, which is crucial for financial operations.

3. PDF generation: It includes a service for generating PDF documents from HTML templates, using external services for the conversion.

4. Event tracking: It provides methods to track specific events related to invoices and refunds using Segment analytics.

5. Timezone operations: It offers methods to handle timezone-related SQL operations, particularly for converting dates and timestamps to a customer's timezone in PostgreSQL queries.

These utilities are designed to be used across different parts of the application to ensure consistent handling of common tasks and to provide reusable functionality.

## Key Files

1. `datetime.rb`: Contains the `Utils::Datetime` module with methods for datetime validation and date difference calculations.

2. `money_with_precision.rb`: Defines the `Utils::MoneyWithPrecision` class, extending the `Money` class with infinite precision for accurate financial calculations.

3. `pdf_generator.rb`: Implements the `Utils::PdfGenerator` class for generating PDF documents from HTML templates.

4. `segment_track.rb`: Provides the `Utils::SegmentTrack` class with methods to track specific events using Segment analytics.

5. `timezone.rb`: Contains the `Utils::Timezone` class with methods for handling timezone-related SQL operations.

## Dependencies
The utilities in this directory rely on several external libraries and frameworks:

1. ActiveSupport: Used for various helper methods and extensions, particularly in datetime handling.
2. Money: The base class extended by `MoneyWithPrecision` for monetary calculations.
3. Slim: Used for rendering HTML templates in the PDF generator.
4. LagoHttpClient: A custom HTTP client used for making requests to external services.
5. Segment: Used for analytics tracking.
6. ActiveRecord: Utilized for SQL sanitization in timezone operations.

## Configuration
Some of the utilities require configuration:

1. PDF Generator:
   - `LAGO_PDF_URL`: The URL of the PDF conversion service.

2. Segment Track:
   - Requires proper configuration of the Segment analytics service.

3. Timezone:
   - Relies on the presence of `applicable_timezone` methods on customer and organization models.

These utilities play a crucial role in supporting various features of the application, from financial calculations to analytics tracking and report generation. They encapsulate common functionality, promoting code reuse and maintaining consistency across the application.