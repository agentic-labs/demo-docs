---
title: "base_service.rb"
---

## High-level description
This code defines a base service class for handling invoice-related operations in an aggregator integration system. It provides common functionality and structure for invoice processing across different integration types.

## Code Structure
The `BaseService` class is part of the `Integrations::Aggregator::Invoices` module. It inherits from `Integrations::Aggregator::BaseService` and sets up the foundation for invoice-specific services. The class initializes with an invoice and provides methods for handling headers, integration, and payload generation.

## Symbols

### `Integrations::Aggregator::Invoices::BaseService`
#### Description
This class serves as a base for invoice-related services in the aggregator integration system. It sets up common functionality such as header generation, integration retrieval, and payload creation.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| invoice | Invoice | The invoice object to be processed |

#### Internal Logic
1. Initializes with an invoice and sets up the integration.
2. Provides methods for generating headers, retrieving integration and integration customer.
3. Offers a method for creating payloads based on the invoice and integration customer.

### `headers`
#### Description
Generates the headers required for API requests to the aggregator service.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| headers | Hash | A hash containing the necessary headers for API requests |

### `integration`
#### Description
Retrieves the integration associated with the invoice's customer.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| integration | Integration | The integration object associated with the customer, or nil if not found |

### `integration_customer`
#### Description
Retrieves the first accounting-type integration customer associated with the invoice's customer.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| integration_customer | IntegrationCustomer | The first accounting-type integration customer, or nil if not found |

### `payload`
#### Description
Generates a payload for the given type using the Payloads::Factory.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| type | Symbol | The type of payload to generate |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| payload | Hash | The generated payload for the specified type |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| Integrations::Aggregator::BaseService | Parent class providing common functionality for aggregator services |
| Integrations::Aggregator::Invoices::Payloads::Factory | Factory for creating invoice-related payloads |

## References
This class is referenced and used by other services in the Integrations::Aggregator module, such as:
- Integrations::Aggregator::CreditNotes::CreateService
- Integrations::Aggregator::SalesOrders::CreateService
- Integrations::Aggregator::Payments::CreateService

These services inherit from BaseService and utilize its functionality for their specific operations.