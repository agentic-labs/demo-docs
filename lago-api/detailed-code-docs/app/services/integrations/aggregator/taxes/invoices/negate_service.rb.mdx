---
title: "negate_service.rb"
---

## High-level description
This code defines a `NegateService` class within the `Integrations::Aggregator::Taxes::Invoices` module. Its primary purpose is to negate invoices for the Anrok integration by making an HTTP POST request to a specific endpoint with invoice data.

## Code Structure
The `NegateService` class inherits from `BaseService` and contains methods for defining the action path, making the API call, and processing the response. It also includes error handling for HTTP errors.

## Symbols

### `NegateService`
#### Description
This class is responsible for negating invoices through the Anrok integration. It sends a POST request to a specific endpoint with invoice data and processes the response.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| invoice | Invoice | The invoice object to be negated (implicitly passed) |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Result | An instance of the Result class containing the operation outcome |

#### Internal Logic
1. Checks if the integration exists and is of type 'Integrations::AnrokIntegration'.
2. Constructs the payload with invoice data.
3. Sends a POST request to the specified endpoint.
4. Parses the response and processes it using `process_void_response`.
5. Handles any HTTP errors that may occur during the request.

### `action_path`
#### Description
Defines the API endpoint path for negating invoices.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| path | String | The API endpoint path |

### `call`
#### Description
The main method that executes the invoice negation process.

#### Internal Logic
1. Checks for the existence of the integration and its type.
2. Makes an HTTP POST request with the payload.
3. Processes the response.
4. Handles any HTTP errors.

### `payload`
#### Description
Constructs the payload for the API request.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| payload | Array | An array containing a hash with invoice data |

## Error Handling
The `call` method includes a `rescue` block to handle `LagoHttpClient::HttpError` exceptions. It extracts the error code and message, then updates the result with a service failure.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| BaseService | Parent class providing common functionality |
| LagoHttpClient | HTTP client for making API requests |

## Notes
- The class assumes the existence of a `provider` method, which is not defined in the provided code.
- The `process_void_response` method is called but not defined in the provided code.
- The `http_client` object is used but not defined in the provided code.
- The class is specifically designed to work with the Anrok integration.