---
title: "factory.rb"
---

## High-level description
This code defines a Factory class within the Integrations::Aggregator::Contacts::Payloads module. Its purpose is to create instances of specific payload classes based on the type of integration provided. It supports three types of integrations: Netsuite, Xero, and Anrok.

## Code Structure
The Factory class contains a single class method `new_instance` which determines the appropriate payload class to instantiate based on the integration type. The payload classes (Netsuite, Xero, and Anrok) are not defined in this file but are referenced and instantiated.

## References
This code references the following classes:
- `Integrations::Aggregator::Contacts::Payloads::Netsuite`
- `Integrations::Aggregator::Contacts::Payloads::Xero`
- `Integrations::Aggregator::Contacts::Payloads::Anrok`

## Symbols

### `Factory.new_instance`
#### Description
This class method creates and returns an instance of a specific payload class based on the provided integration type.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| integration | Object | The integration object containing the type information |
| customer | Object | The customer object |
| integration_customer | Object | The integration customer object |
| subsidiary_id | String/Integer | The subsidiary ID |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| payload_instance | Object | An instance of the appropriate payload class |

#### Internal Logic
1. The method uses a case statement to check the `integration.type.to_s`.
2. Based on the integration type, it instantiates and returns the corresponding payload class (Netsuite, Xero, or Anrok).
3. If the integration type doesn't match any known types, it raises a `NotImplementedError`.

## Dependencies
This code relies on the existence of the following classes:
- `Integrations::Aggregator::Contacts::Payloads::Netsuite`
- `Integrations::Aggregator::Contacts::Payloads::Xero`
- `Integrations::Aggregator::Contacts::Payloads::Anrok`

These classes are not defined in the provided code but are expected to exist in the project structure.

## Error Handling
The code implements basic error handling by raising a `NotImplementedError` when an unknown integration type is encountered.

## API/Interface Reference
While not an API in the traditional sense, this Factory class provides an interface for creating payload instances:

| Method | Inputs | Output | Description |
|:-------|:-------|:-------|:------------|
| `Factory.new_instance` | integration, customer, integration_customer, subsidiary_id | Payload instance | Creates and returns an instance of the appropriate payload class based on the integration type |

## Additional Notes
1. The code uses Ruby's module nesting to organize related classes and modules.
2. The factory pattern is implemented here to create different types of payload objects based on the integration type.
3. The code assumes that all payload classes (Netsuite, Xero, Anrok) have the same constructor signature, accepting integration, customer, integration_customer, and subsidiary_id as parameters.
4. From the related code snippets, we can see that Xero and Anrok payload classes are defined and inherit from a BasePayload class. The Netsuite payload class is not provided in the related snippets but is expected to exist and follow a similar pattern.
5. The UpdateService class in the related snippets uses this Factory to create payload instances, specifically calling the `update_body` method on the created instance.