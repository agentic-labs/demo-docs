---
title: "base_payload.rb"
---

## High-level description
This code defines a `BasePayload` class within the `Integrations::Aggregator` module. It provides a foundation for handling various types of items (billable metrics, add-ons, accounts, taxes, etc.) in the context of integrations, likely for a billing or invoicing system.

## Code Structure
The `BasePayload` class contains methods for retrieving different types of items (billable metrics, add-ons, accounts, taxes, etc.) associated with an integration. It also includes utility methods for amount calculation and collection mapping.

## Symbols

### `Integrations::Aggregator::BasePayload`
#### Description
This class serves as a base for handling various types of items in integrations. It initializes with an integration object and provides methods to retrieve different types of items and perform related operations.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| integration | Object | The integration object associated with this payload |

#### Internal Logic
- The class provides methods to retrieve various types of items (billable metrics, add-ons, accounts, taxes, etc.) using integration mappings.
- It implements caching for some item retrievals using instance variables.
- The `amount` method calculates the amount in the appropriate currency.
- The `collection_mapping` method retrieves integration collection mappings.

### `billable_metric_item(fee)`
#### Description
Retrieves the integration mapping for a billable metric associated with a fee.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| fee | Object | The fee object containing the billable metric |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mapping | Object | The integration mapping for the billable metric or a fallback item |

### `add_on_item(fee)`
#### Description
Retrieves the integration mapping for an add-on associated with a fee.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| fee | Object | The fee object containing the add-on |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mapping | Object | The integration mapping for the add-on or a fallback item |

### `account_item`, `tax_item`, `commitment_item`, `subscription_item`, `coupon_item`, `credit_item`, `credit_note_item`
#### Description
These methods retrieve and cache integration collection mappings for various item types.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mapping | Object | The integration collection mapping for the specific item type or a fallback item |

### `fallback_item`
#### Description
Retrieves and caches the fallback item mapping.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mapping | Object | The integration collection mapping for the fallback item |

### `amount(amount_cents, resource:)`
#### Description
Calculates the amount in the appropriate currency based on the provided cents and resource.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| amount_cents | Integer | The amount in cents |
| resource | Object | The resource object containing the currency information |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| amount | Float | The calculated amount in the appropriate currency |

### `collection_mapping(type)`
#### Description
Retrieves the integration collection mapping for a specific type.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| type | Symbol | The type of collection mapping to retrieve |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mapping | Object | The integration collection mapping for the specified type |

## Dependencies
This code relies on the presence of an `integration` object with associated `integration_mappings` and `integration_collection_mappings`.

## Error Handling
The code does not implement explicit error handling. It uses the `||` operator to provide fallback values in case of nil results.