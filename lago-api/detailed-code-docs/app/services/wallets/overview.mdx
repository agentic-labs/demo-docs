---
title: "Overview"
---

## High-level description
The `app/services/wallets` directory contains a collection of service classes responsible for managing various aspects of wallet functionality in a financial application. These services handle operations such as creating, updating, and terminating wallets, managing wallet balances, creating and validating recurring transaction rules, and performing threshold-based top-ups.

## What does it do?
This directory implements a comprehensive set of services that work together to manage wallets and their associated transactions in a financial system. Here's a breakdown of the main functionalities:

1. Wallet Creation and Management: Services for creating new wallets, updating existing ones, and terminating wallets when necessary.

2. Balance Management: Services for increasing and decreasing wallet balances, refreshing ongoing balances, and updating balances based on usage credits.

3. Recurring Transaction Rules: Services for creating, updating, and validating recurring transaction rules, which automate regular transactions or balance adjustments.

4. Interval-based Transactions: A service for creating wallet transactions based on recurring transaction rules at specified intervals (weekly, monthly, quarterly, yearly).

5. Threshold-based Top-ups: A service that automatically tops up a wallet's balance when it falls below a specified threshold.

6. Validation: Services for validating various aspects of wallet operations, including input parameters, recurring transaction rules, and metadata.

These services work together to provide a robust system for managing wallets, automating transactions, and maintaining accurate balances in response to various financial activities within the application.

## Entry points
The main entry points for this directory are the service classes:

1. `CreateService`: Used for creating new wallets.
2. `UpdateService`: Used for updating existing wallets.
3. `TerminateService`: Used for terminating active wallets.
4. `ApplyPaidCreditsService`: Used for applying paid credits to a wallet.
5. `CreateIntervalWalletTransactionsService`: Used for creating transactions based on recurring rules.
6. `ThresholdTopUpService`: Used for automatic top-ups when balance falls below a threshold.

The `balance` subdirectory contains services for managing wallet balances:

1. `DecreaseService`: Used for decreasing a wallet's balance.
2. `IncreaseService`: Used for increasing a wallet's balance.
3. `RefreshOngoingService`: Used for recalculating and updating the ongoing balance.
4. `UpdateOngoingService`: Used for updating the ongoing balance based on usage credits.

The `recurring_transaction_rules` subdirectory contains services for managing recurring transaction rules:

1. `CreateService`: Used for creating new recurring transaction rules.
2. `UpdateService`: Used for updating existing recurring transaction rules.
3. `ValidateService`: Used for validating recurring transaction rule parameters.

## Dependencies
The services in this directory depend on several external components and internal modules:

1. `BaseService` and `BaseValidator`: Parent classes providing common functionality for service objects and validators.
2. `ActiveRecord` and `ActiveModel`: For database interactions and data validation.
3. `License`: Used to check if premium features are available.
4. Various job classes (e.g., `WalletTransactions::CreateJob`, `SendWebhookJob`): For asynchronous processing of certain operations.
5. Validator services (e.g., `Validators::DecimalAmountService`, `Validators::MetadataValidator`): For validating specific types of data.
6. Utility classes (e.g., `Utils::Datetime`): For common operations like date parsing and formatting.

## Configuration
While there are no explicit configuration files in this directory, the services use various parameters and settings that affect their behavior:

1. Premium license: Some features are only available with an active premium license.
2. Wallet rate: Used in calculations to convert between credits and monetary amounts.
3. Depletion threshold: Used to determine when a wallet is considered depleted.
4. Webhook settings: Configuration for sending webhooks when certain events occur.
5. Threshold top-up settings: Configuration for when and how to perform automatic top-ups.
6. Valid intervals for recurring rules: Predefined set of valid intervals for recurring transaction rules.

These parameters are likely defined elsewhere in the application, possibly in environment variables or database settings associated with each wallet or organization.

In summary, the `app/services/wallets` directory provides a comprehensive set of services for managing all aspects of wallets in a financial application. These services handle wallet creation, updates, termination, balance management, recurring transactions, and various validation tasks, forming a robust system for automating financial operations within the application.