---
title: "grouped_standard_service.rb"
---

## High-level description
The `GroupedStandardService` class is a part of the Charges module and ChargeModels submodule. It extends the `BaseService` class and is designed to handle grouped standard charge calculations. This service applies the standard charge model to each group in the aggregation result and combines them into a single result.

## Code Structure
The `GroupedStandardService` class inherits from `BaseService` and defines three main methods: `self.apply`, `initialize`, and `apply`. The class works with charge, aggregation_result, and properties as its main attributes.

## References
This code references the `Charges::ChargeModels::StandardService` class, which is used to calculate charges for individual groups.

## Symbols

### GroupedStandardService
#### Description
This class handles the calculation of grouped standard charges. It processes each group in the aggregation result separately using the `StandardService` and combines the results.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| charge | Object | The charge object containing charge-related information |
| aggregation_result | Object | The result of aggregation, containing grouped data |
| properties | Hash | Additional properties for charge calculation |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Object | An object containing the grouped results of charge calculations |

#### Internal Logic
1. Initializes the service with charge, aggregation_result, and properties.
2. In the `apply` method, it iterates through each aggregation in the aggregation_result.
3. For each aggregation, it applies the `StandardService` to calculate the charge.
4. It sets the `grouped_by` attribute for each group result.
5. Combines all group results into the `grouped_results` attribute of the final result.

### self.apply
#### Description
A class method that creates a new instance of `GroupedStandardService` and calls its `apply` method.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| ... | Any | Accepts any number of arguments to be passed to the initializer |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Object | The result of calling the `apply` method on a new instance |

### initialize
#### Description
Initializes a new instance of `GroupedStandardService` with the given charge, aggregation_result, and properties.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| charge | Object | The charge object |
| aggregation_result | Object | The result of aggregation |
| properties | Hash | Additional properties for charge calculation |

### apply
#### Description
Applies the grouped standard charge model calculation.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Object | An object containing the grouped results of charge calculations |

#### Internal Logic
1. Iterates through each aggregation in the aggregation_result.
2. Applies the `StandardService` to each aggregation.
3. Sets the `grouped_by` attribute for each group result.
4. Combines all group results into the `grouped_results` attribute of the final result.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| Charges::ChargeModels::StandardService | Used to calculate charges for individual groups |
| Charges::ChargeModels::BaseService | Parent class providing basic functionality |

This code is part of a larger charge calculation system, where different charge models can be applied based on the charge type and aggregation results. The `GroupedStandardService` specifically handles cases where the standard charge model needs to be applied to grouped data.