---
title: "Overview"
---

## High-level description
This directory contains services related to managing commitments in a subscription billing system. It includes functionality for applying taxes, calculating amounts, handling date-related operations, fetching invoices, and overriding existing commitments. The services are designed to work with both pay-in-advance and pay-in-arrears billing models.

## What does it do?
The services in this directory work together to handle various aspects of commitment management in a subscription billing system:

1. Tax Application: The `ApplyTaxesService` applies or removes taxes to a given commitment based on provided tax codes.

2. Amount Calculation: The `CalculateAmountService` calculates the prorated amount for a commitment based on the given commitment and invoice subscription.

3. Prorated Coefficient Calculation: The `CalculateProratedCoefficientService` calculates a prorated coefficient for a given commitment and invoice subscription, used to determine the appropriate amount to charge for a partial billing period.

4. Date Management: The `DatesService` manages date-related operations for commitments and invoice subscriptions, handling both active and terminated subscriptions.

5. Invoice Fetching: The `FetchInvoicesService` retrieves invoices related to a commitment and invoice subscription, with specific implementations for pay-in-advance and pay-in-arrears scenarios.

6. Minimum Commitment Handling: The `minimum` subdirectory contains services for managing minimum commitments, including true-up fee calculations and specialized date and invoice fetching operations for both in-advance and in-arrears payment scenarios.

7. Commitment Override: The `OverrideService` allows creating a new commitment by duplicating an existing one and applying specified changes.

These services work together to ensure accurate billing, prorations, and commitment management within the larger subscription and invoicing system.

## Key Files
1. `apply_taxes_service.rb`: Handles the application and removal of taxes for commitments.
2. `calculate_amount_service.rb`: Calculates prorated amounts for commitments.
3. `calculate_prorated_coefficient_service.rb`: Computes prorated coefficients for partial billing periods.
4. `dates_service.rb`: Manages date-related operations for commitments and subscriptions.
5. `fetch_invoices_service.rb`: Retrieves relevant invoices for commitments and subscriptions.
6. `override_service.rb`: Creates new commitments based on existing ones with modifications.
7. `minimum/` directory: Contains services specific to minimum commitment handling, including true-up fee calculations and specialized date and invoice fetching operations.

## Dependencies
The services in this directory rely on several external libraries and internal components:

1. ActiveRecord: Used for database operations and transactions.
2. Money: Utilized for currency calculations.
3. BaseService: A parent class providing common functionality for service objects.
4. License: Used to check for premium feature availability.
5. Various internal services and models: Such as `Subscriptions::DatesService`, `Subscriptions::TerminatedDatesService`, `Fee`, `Subscription`, `Plan`, `Charge`, `BillableMetric`, `Invoice`, and `InvoiceSubscription`.

## Configuration
While there are no explicit configuration files in this directory, the behavior of these services may be influenced by configuration settings in the broader application context:

1. Database configuration: Essential for the database queries performed by these services.
2. Billing cycle configurations: May affect how invoices are fetched and dates are calculated.
3. Fee calculation settings: Could influence how different types of fees are calculated and applied.
4. License configuration: Determines the availability of premium features.

These configuration aspects are likely managed at a higher level in the application, with the services in this directory consuming those configurations rather than defining them directly.

In conclusion, this directory contains a set of interconnected services that manage various aspects of commitments within a subscription billing system. These services handle tasks such as tax application, amount calculation, date management, invoice fetching, and minimum commitment processing, supporting both pay-in-advance and pay-in-arrears billing models.