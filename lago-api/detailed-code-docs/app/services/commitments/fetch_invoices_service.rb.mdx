---
title: "fetch_invoices_service.rb"
---

## High-level description
The `Commitments::FetchInvoicesService` is a service class responsible for fetching invoices related to a commitment and invoice subscription. It provides a factory method to create the appropriate instance based on the payment schedule (in advance or in arrears) of the subscription plan.

## Code Structure
The main class `FetchInvoicesService` contains a factory method `new_instance` and an abstract `call` method. Two concrete implementations, `Commitments::Minimum::InAdvance::FetchInvoicesService` and `Commitments::Minimum::InArrears::FetchInvoicesService`, inherit from this base class to provide specific invoice fetching logic.

## Symbols

### `Commitments::FetchInvoicesService`
#### Description
This is the base class for fetching invoices related to commitments. It provides a factory method and defines the basic structure for its subclasses.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| commitment | Commitment | The commitment object |
| invoice_subscription | InvoiceSubscription | The invoice subscription object |

#### Internal Logic
1. The `new_instance` class method determines which subclass to instantiate based on the payment schedule of the subscription plan.
2. The `call` method fetches invoices and stores them in the result object.

### `self.new_instance`
#### Description
A factory method that creates and returns an instance of the appropriate subclass based on the payment schedule of the subscription plan.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| commitment | Commitment | The commitment object |
| invoice_subscription | InvoiceSubscription | The invoice subscription object |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| instance | FetchInvoicesService | An instance of the appropriate subclass |

### `call`
#### Description
Fetches invoices and stores them in the result object.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Result | An object containing the fetched invoices |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| BaseService | Parent class providing common functionality for services |

## References
- `Commitments::Minimum::InAdvance::FetchInvoicesService`
- `Commitments::Minimum::InArrears::FetchInvoicesService`

These subclasses implement the specific logic for fetching invoices based on the payment schedule (in advance or in arrears). They are not directly defined in this file but are referenced in the `new_instance` method.