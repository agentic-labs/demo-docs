---
title: "payment_dispute_lost_serializer.rb"
---

## High-level description
The `PaymentDisputeLostSerializer` class is a custom serializer responsible for formatting the data of an invoice when a payment dispute is lost into a JSON structure suitable for API responses. It includes details about the invoice and optionally, a provider error message.

## Code Structure
The `PaymentDisputeLostSerializer` inherits from `ModelSerializer` and utilizes `InvoiceSerializer` to format the invoice data. It overrides the `serialize` method to customize the output structure.

## References
- `V1::InvoiceSerializer`: Used to serialize the invoice object.
- `ModelSerializer`: Parent class providing basic serialization functionality.

## Symbols

### `PaymentDisputeLostSerializer`
#### Description
This class serializes an invoice object when a payment dispute associated with it is lost. It includes the serialized invoice data and an optional `provider_error` field.

#### Inputs
The `initialize` method accepts the following inputs:
| Name | Type | Description |
|:-----|:-----|:------------|
| model | Invoice | The invoice object to be serialized. |
| options | Hash | A hash containing optional parameters, including `provider_error`. |

#### Outputs
The `serialize` method returns a hash containing:
| Name | Type | Description |
|:-----|:-----|:------------|
| invoice | Hash | The serialized invoice data. |
| provider_error | String | An optional error message from the payment provider. |

#### Internal Logic
1. **`serialize` method:**
    - Initializes a `result` hash with the serialized `invoice`.
    - Conditionally adds the `provider_error` to the `result` hash if present in the `options`.
    - Returns the `result` hash.

2. **`invoice` method:**
    - Creates a new instance of `V1::InvoiceSerializer` with the `model` and includes `customer`.
    - Calls the `serialize` method on the `InvoiceSerializer` instance to get the serialized invoice data.
    - Returns the serialized invoice data.

## Dependencies
- `active_model_serializers`: Provides the `ModelSerializer` base class and serialization utilities.

## Error Handling
This serializer doesn't implement specific error handling. It relies on the standard exception handling mechanism.

## API/Interface Reference
This serializer is not directly exposed as an API endpoint. It is used internally to format data for API responses.
