---
title: "payment_provider_refund_error_serializer.rb"
---

## High-level description
The `V1::CreditNotes::PaymentProviderRefundErrorSerializer` class is a custom serializer responsible for formatting data related to credit note refund failures for webhook consumption. It structures the output to include relevant credit note, customer, and error information.

## Code Structure
The `PaymentProviderRefundErrorSerializer` inherits from `ModelSerializer` and overrides the `serialize` method to define a custom JSON structure. It utilizes the provided `credit_note` (an alias for the `model`) and `options` to construct the output.

## References
- `ModelSerializer`: The parent class providing basic serialization functionality.

## Symbols
### `PaymentProviderRefundErrorSerializer`
#### Description
This class serializes data related to credit note refund failures into a specific JSON format for webhook delivery.

#### Inputs
The constructor (`initialize`) accepts:
| Name | Type | Description |
|:-----|:-----|:------------|
| model | CreditNote | The credit note object associated with the refund failure. |
| options | Hash | Additional options containing provider error details and provider customer ID. |

#### Outputs
The `serialize` method returns:
| Name | Type | Description |
|:-----|:-----|:------------|
| serialized_data | Hash | A hash containing structured data about the credit note refund failure. |

#### Internal Logic
The `serialize` method constructs a hash containing:
- `lago_credit_note_id`: The ID of the credit note.
- `lago_customer_id`: The ID of the customer associated with the credit note.
- `external_customer_id`: The external ID of the customer.
- `provider_customer_id`: The ID of the customer within the payment provider's system.
- `payment_provider`: The name of the payment provider.
- `payment_provider_code`: The code of the payment provider.
- `provider_error`: The error message received from the payment provider.

## Dependencies
- `ModelSerializer`: Provides basic serialization functionality.

## Error Handling
This serializer doesn't implement specific error handling. It relies on the parent class and standard Ruby exception handling.
