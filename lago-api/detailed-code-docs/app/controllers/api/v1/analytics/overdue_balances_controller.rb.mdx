---
title: "overdue_balances_controller.rb"
---

## High-level description
This code defines the `OverdueBalancesController` within the `Api::V1::Analytics` module. It handles requests for overdue balances analytics, utilizing a service object to fetch and process the data. The controller provides an index action that returns the overdue balances data based on optional filters.

## Code Structure
The `OverdueBalancesController` inherits from `BaseController` and defines an `index` action. It uses the `::Analytics::OverdueBalancesService` to fetch the data and relies on the superclass's `index` method for rendering the response.

## References
- `::Analytics::OverdueBalancesService`
- `Api::V1::Analytics::BaseController`

## Symbols

### `Api::V1::Analytics::OverdueBalancesController`
#### Description
This controller handles requests for overdue balances analytics. It uses the `::Analytics::OverdueBalancesService` to fetch and process the data, applying optional filters based on the request parameters.

#### Inputs
No direct inputs, but it uses request parameters for filtering.

#### Outputs
The controller doesn't directly output anything, but it sets up the `@result` instance variable, which is used by the superclass to render the response.

#### Internal Logic
1. In the `index` action, it creates a new instance of `::Analytics::OverdueBalancesService` with the current organization and filters.
2. It calls the service object to fetch the overdue balances data.
3. It calls the superclass's `index` method to handle the rendering of the response.

### `index`
#### Description
This action fetches the overdue balances data using the `::Analytics::OverdueBalancesService` and sets up the `@result` instance variable.

#### Internal Logic
1. Creates a new instance of `::Analytics::OverdueBalancesService` with the current organization and filters.
2. Calls the `call` method on the service object to fetch the data.
3. Assigns the result to the `@result` instance variable.
4. Calls the superclass's `index` method to handle the rendering of the response.

### `filters` (private)
#### Description
This method prepares the filter parameters to be passed to the `::Analytics::OverdueBalancesService`.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| filters | Hash | A hash containing the filter parameters |

#### Internal Logic
1. Extracts `external_customer_id`, `currency`, and `months` from the request parameters.
2. Converts the `currency` parameter to uppercase if present.
3. Returns a hash with these filter parameters.

## Dependencies
The controller depends on the following:
| Dependency | Purpose |
|:-----------|:--------|
| `::Analytics::OverdueBalancesService` | Service object for fetching and processing overdue balances data |
| `Api::V1::Analytics::BaseController` | Base controller providing common functionality for analytics controllers |

## Error Handling
Error handling is not explicitly implemented in this controller. It relies on the superclass's `index` method to handle rendering errors if the `@result` is not successful.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| /api/v1/analytics/overdue_balances | GET | Query parameters: external_customer_id, currency, months | JSON response with overdue balances data | Fetches overdue balances analytics data based on optional filters |

Note: The actual response format is determined by the `::V1::Analytics::OverdueBalancesSerializer` (not provided in the given code snippets).