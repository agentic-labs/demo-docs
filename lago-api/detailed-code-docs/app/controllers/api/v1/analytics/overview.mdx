---
title: "Overview"
---

## High-level description
This directory contains controllers for the Analytics API (v1) in a Ruby on Rails application. It provides endpoints for various analytics-related data, including gross revenues, invoice collections, invoiced usages, monthly recurring revenues (MRRs), and overdue balances. The controllers in this directory handle incoming API requests, process filters, and utilize corresponding service objects to fetch and return the requested analytics data.

## What does it do?
The controllers in this directory work together to provide a comprehensive analytics API for a SaaS or subscription-based business. Here's a breakdown of the main functionalities:

1. Gross Revenues: Provides data on the total revenue generated by the business.
2. Invoice Collections: Offers analytics on the collection of invoices, helping to track payment trends.
3. Invoiced Usages: Gives insights into the usage-based billing aspects of the business.
4. Monthly Recurring Revenue (MRR): Tracks the predictable and recurring revenue generated on a monthly basis.
5. Overdue Balances: Provides information on unpaid invoices and outstanding balances.

Each controller processes incoming requests, applies filters based on parameters like currency and time period, and uses dedicated service objects to fetch and process the relevant data. The controllers then prepare this data for rendering as a JSON response, which can be consumed by front-end applications or other services for reporting and analysis purposes.

## Entry points
The main entry point for this API is the `BaseController`, which provides common functionality for all the analytics controllers. Each specific analytics controller (e.g., `GrossRevenuesController`, `InvoiceCollectionsController`) inherits from this base controller and implements its own `index` action.

The data flow typically follows this pattern:
1. An API request comes in to a specific analytics endpoint.
2. The corresponding controller processes the request parameters.
3. The controller instantiates and calls a service object to fetch the required data.
4. The result is stored in an instance variable.
5. The `BaseController`'s rendering logic is invoked to format and return the response.

## Key Files
1. `base_controller.rb`: Provides common functionality for all analytics controllers, including the `index` action and result rendering logic.
2. `gross_revenues_controller.rb`: Handles requests for gross revenue analytics.
3. `invoice_collections_controller.rb`: Manages requests for invoice collection data.
4. `invoiced_usages_controller.rb`: Processes requests for invoiced usage analytics.
5. `mrrs_controller.rb`: Handles requests for Monthly Recurring Revenue (MRR) data.
6. `overdue_balances_controller.rb`: Manages requests for overdue balance analytics.

Each of these controllers follows a similar pattern, utilizing a specific service object to fetch and process the requested data.

## Dependencies
The controllers in this directory rely on several external dependencies and services:

1. Ruby on Rails framework (version not specified)
2. Service objects (e.g., `::Analytics::GrossRevenuesService`, `::Analytics::InvoiceCollectionsService`)
3. `CollectionSerializer` for formatting the response data
4. `Api::BaseController` (parent of the `BaseController` in this directory)

These dependencies are crucial for the functioning of the analytics API, providing data processing, serialization, and common controller functionality.

## Configuration
While there are no explicit configuration files mentioned in the provided code snippets, the controllers use several configuration-like elements:

1. API versioning: The controllers are namespaced under `Api::V1`, indicating a versioned API structure.
2. Organization scoping: The use of `current_organization` suggests that requests are scoped to specific organizations, likely determined through authentication or request context.
3. Filters: Each controller processes request parameters to create filters, typically including:
   - `currency`: Often converted to uppercase
   - `months`: A time period for the requested data
   - `external_customer_id`: Used in some controllers for customer-specific data

These elements allow for flexible and customizable analytics queries while maintaining a consistent API structure across different types of analytics data.