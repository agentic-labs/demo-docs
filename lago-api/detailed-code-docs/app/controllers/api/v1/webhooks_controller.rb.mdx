---
title: "webhooks_controller.rb"
---

## High-level description
This code defines a WebhooksController within the Api::V1 namespace, which is responsible for handling webhook-related API endpoints. The controller provides methods to retrieve the public key used for webhook signature verification, both in a deprecated plain text format and a newer JSON format.

## Code Structure
The WebhooksController inherits from Api::BaseController and contains two methods: `public_key` (deprecated) and `json_public_key`. Both methods serve the same purpose of providing the public key, but with different response formats.

## References
- `Api::BaseController`: The parent controller class that WebhooksController inherits from.
- `RsaPublicKey`: A constant defined elsewhere (likely in an initializer) that holds the RSA public key.

## Symbols

### `WebhooksController`
#### Description
This controller handles webhook-related API endpoints, specifically for retrieving the public key used in webhook signature verification.

#### Internal Logic
The controller inherits from `Api::BaseController`, which likely provides common functionality for API controllers, such as authentication and error handling.

### `public_key`
#### Description
A deprecated method that returns the base64-encoded public key as plain text.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Response | String | Base64-encoded public key as plain text |

#### Internal Logic
1. Converts the `RsaPublicKey` to a string
2. Encodes the resulting string using Base64
3. Renders the encoded string as plain text

### `json_public_key`
#### Description
Returns the base64-encoded public key in a JSON format.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Response | JSON | Object containing the base64-encoded public key |

#### Internal Logic
1. Converts the `RsaPublicKey` to a string
2. Encodes the resulting string using Base64
3. Constructs a JSON object with the encoded public key
4. Renders the JSON object with a status of `:ok`

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| Base64 | Used for encoding the public key |

## Error Handling
This controller doesn't implement any specific error handling. However, it inherits from `Api::BaseController`, which includes the `ApiErrors` module and rescues from `ActionController::ParameterMissing` errors.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| /api/v1/webhooks/public_key | GET | N/A | Plain text | Returns the base64-encoded public key (Deprecated) |
| /api/v1/webhooks/json_public_key | GET | N/A | JSON | Returns the base64-encoded public key in JSON format |

## TODOs
- Consider removing the deprecated `public_key` method in future versions.
- Update API documentation to reflect the deprecation of the `public_key` endpoint and encourage the use of `json_public_key`.