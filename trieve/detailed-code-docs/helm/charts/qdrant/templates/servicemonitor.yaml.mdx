---
title: "servicemonitor.yaml"
---

## High-level description
This code defines a Kubernetes ServiceMonitor resource for the Qdrant application using the Helm templating language. This ServiceMonitor is responsible for scraping metrics from Qdrant pods and sending them to a Prometheus server. It is conditionally deployed based on the `metrics.serviceMonitor.enabled` configuration value.

## References
- `qdrant.labels`: Refers to a Helm template that defines labels for Qdrant resources.
- `qdrant.fullname`: Refers to a Helm template that generates the full name of the Qdrant deployment.

## Symbols
### `servicemonitor.yaml`
#### Description
This file defines a Kubernetes ServiceMonitor resource for monitoring Qdrant.

#### Inputs
This template uses values from `Values` object passed to it by Helm.
Most important values are:
- `.Values.metrics.serviceMonitor.enabled`: A boolean value indicating whether the ServiceMonitor should be created.
- `.Values.metrics.serviceMonitor.additionalLabels`:  A dictionary of additional labels to apply to the ServiceMonitor.
- `.Values.metrics.serviceMonitor.scrapeInterval`:  The interval at which metrics should be scraped.
- `.Values.metrics.serviceMonitor.targetPath`: The path on the Qdrant pods where the metrics endpoint is exposed.
- `.Values.metrics.serviceMonitor.targetPort`: The port on the Qdrant pods where the metrics endpoint is exposed.
- `.Values.metrics.serviceMonitor.scrapeTimeout`: The timeout for scraping metrics.
- `.Values.metrics.serviceMonitor.metricRelabelings`: A list of metric relabeling rules to apply.
- `.Values.metrics.serviceMonitor.relabelings`: A list of relabeling rules to apply to discovered targets.
- `.Values.apiKey`: The name of the Kubernetes secret containing the API key for accessing the metrics endpoint.
- `.Values.readOnlyApiKey`: The name of the Kubernetes secret containing the read-only API key for accessing the metrics endpoint.

#### Outputs
A Kubernetes YAML definition of a ServiceMonitor resource.

#### Internal Logic
The template first checks if `.Values.metrics.serviceMonitor.enabled` is set to true. If it is, it creates a ServiceMonitor resource with the specified configuration. 

The ServiceMonitor is configured to:
- Scrape metrics from pods with labels matching `qdrant.labels`.
- Use the specified `scrapeInterval`, `targetPath`, `targetPort`, and `scrapeTimeout`.
- Apply any specified `metricRelabelings` and `relabelings`.
- If an `apiKey` or `readOnlyApiKey` is provided, it configures the ServiceMonitor to use Bearer authentication with the specified API key.

## Dependencies
This code depends on the following Helm libraries:
| Dependency | Purpose |
|:-----------|:--------|
| `monitoring.coreos.com/v1` | Provides the API version for the ServiceMonitor resource. |

## Configuration
This template relies on Helm values for configuration. See "Inputs" section for details.
