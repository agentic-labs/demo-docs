---
title: "statefulset.yaml"
---

## High-level description
This YAML file defines a Kubernetes StatefulSet for deploying and managing Qdrant, a vector database. It configures the deployment, including container specifications, volume mounts, security contexts, probes, and persistent storage for Qdrant instances.

## Code Structure
The YAML file is structured as a Kubernetes StatefulSet resource, with various nested fields defining the deployment configuration. It uses Helm templating to allow for customization of the deployment based on values provided in the Helm chart.

## Symbols

### StatefulSet
#### Description
Defines a StatefulSet resource for deploying Qdrant instances with stable network identities and persistent storage.

#### Internal Logic
1. Sets up metadata, including name and labels
2. Configures the number of replicas and pod management policy
3. Defines the pod template, including:
   - Annotations for configuration checksums
   - Labels for pod identification
   - Container specifications (main Qdrant container and optional sidecars)
   - Volume mounts for storage, configuration, and snapshots
   - Security contexts
   - Probes for liveness, readiness, and startup checks
   - Resource requests and limits
4. Configures persistent volume claims for Qdrant storage

### Container Specification
#### Description
Defines the main Qdrant container, including its image, environment variables, ports, probes, and volume mounts.

#### Internal Logic
1. Sets the container image and pull policy
2. Configures environment variables
3. Defines container ports for HTTP and gRPC
4. Sets up liveness, readiness, and startup probes
5. Configures resource requests and limits
6. Mounts volumes for storage, configuration, and snapshots

### Volume Mounts
#### Description
Defines the volumes and volume mounts used by the Qdrant container.

#### Internal Logic
1. Mounts persistent storage for Qdrant data
2. Mounts ConfigMap for Qdrant configuration
3. Optionally mounts a Secret for API keys
4. Mounts a volume for snapshots (either persistent or emptyDir)
5. Mounts an emptyDir volume for initialization

### Probes
#### Description
Configures liveness, readiness, and startup probes for the Qdrant container.

#### Internal Logic
1. Sets up HTTP or gRPC probes based on the service configuration
2. Configures probe parameters (delays, timeouts, thresholds)
3. Adapts probe configuration based on Qdrant version and TLS settings

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| Kubernetes | The target platform for deploying the StatefulSet |
| Helm | Used for templating and customization of the deployment |

## Configuration
The StatefulSet configuration can be customized using Helm values. Key configuration options include:

| Option | Type | Description |
|:-------|:-----|:------------|
| replicaCount | Integer | Number of Qdrant replicas to deploy |
| image.repository | String | Docker image repository for Qdrant |
| image.tag | String | Docker image tag for Qdrant |
| persistence.size | String | Size of the persistent volume for Qdrant storage |
| resources | Object | CPU and memory requests/limits for the Qdrant container |

## Error Handling
Error handling is primarily managed through Kubernetes probes (liveness, readiness, and startup) which can detect and respond to various failure scenarios.

## API/Interface Reference
The StatefulSet exposes Qdrant's HTTP and gRPC interfaces:

| Endpoint | Method | Description |
|:---------|:-------|:------------|
| HTTP | Various | Qdrant HTTP API for vector search operations |
| gRPC | Various | Qdrant gRPC API for vector search operations |

Note: Specific API endpoints and methods are defined by the Qdrant application itself, not in this StatefulSet configuration.