---
title: "statefulset.yaml"
---

## High-level description
This code defines a Kubernetes StatefulSet for deploying the Qdrant vector search engine. It specifies the container image, storage, networking, and other configuration options for the Qdrant pods. The StatefulSet ensures that each Qdrant pod has a stable, unique network identity and persistent storage.

## Code Structure
The code defines a single Kubernetes StatefulSet resource. It uses various nested fields to specify the desired state of the Qdrant deployment, including:

- **metadata**: Defines metadata about the StatefulSet, such as its name and labels.
- **spec**: Defines the desired state of the StatefulSet, including the number of replicas, pod template, and volume claim templates.
- **template**: Defines the pod template used to create the Qdrant pods. This includes container specifications, volume mounts, and other pod-level configurations.
- **volumeClaimTemplates**: Defines the PersistentVolumeClaim templates used to provision persistent storage for the Qdrant pods.

## References
This code references other files in the chart through the `include` function, such as:

- `qdrant.fullname`: Returns the full name of the Qdrant release, which is used for naming resources.
- `qdrant.labels`: Returns a set of labels to apply to the StatefulSet and its pods.
- `qdrant.selectorLabels`: Returns a set of labels used to select the Qdrant pods.
- `configmap.yaml`: Defines a ConfigMap containing configuration files for Qdrant.
- `secret.yaml`: Defines a Secret containing API keys for Qdrant.

## Symbols

### `StatefulSet`
#### Description
This symbol defines a Kubernetes StatefulSet resource named "qdrant" that manages the deployment and scaling of Qdrant pods.

#### Inputs
This symbol does not have explicit inputs. It relies on values passed from the Helm chart and Kubernetes environment.

#### Outputs
This symbol does not have explicit outputs. It creates and manages Qdrant pods within the Kubernetes cluster.

#### Internal Logic
The StatefulSet definition specifies various configuration options for the Qdrant deployment, including:

- **replicas**: Defines the number of Qdrant pods to maintain.
- **podManagementPolicy**: Specifies how the StatefulSet should manage pod termination and creation.
- **serviceName**: Specifies the headless service associated with the StatefulSet.
- **template**: Defines the pod template used to create the Qdrant pods.
- **volumeClaimTemplates**: Defines the PersistentVolumeClaim templates used to provision persistent storage for the Qdrant pods.

The pod template specifies the Qdrant container image, environment variables, command, ports, resource limits, security context, volume mounts, and lifecycle hooks. It also defines liveness, readiness, and startup probes to monitor the health of the Qdrant pods.

The volume claim templates define the storage requirements for the Qdrant pods, including the storage class, access modes, and storage capacity.

## Side Effects
This code, when applied to a Kubernetes cluster, will:

- Create a StatefulSet resource named "qdrant".
- Create and manage the specified number of Qdrant pods.
- Create PersistentVolumeClaims for each pod to provide persistent storage.
- Expose the Qdrant service on the specified ports.

## Dependencies
This code depends on the following Kubernetes resources:

| Dependency | Purpose |
|:-----------|:--------|
| ConfigMap | Provides configuration files for Qdrant. |
| Secret | Stores API keys for Qdrant. |
| PersistentVolumeClaim | Provides persistent storage for Qdrant data. |
| Service | Exposes the Qdrant service to other applications. |

### Configuration
This code relies on various configuration options passed from the Helm chart, including:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `replicaCount` | int | 1 | Number of Qdrant pods to deploy. |
| `image.repository` | string | "qdrant/qdrant" | Docker image repository for Qdrant. |
| `image.tag` | string | Chart app version | Docker image tag for Qdrant. |
| `persistence.storageClassName` | string | "" | Name of the storage class to use for persistent volumes. |
| `persistence.size` | string | "1Gi" | Size of the persistent volume claim. |
| `service.ports` | list | [ { name: "http", port: 6333, targetPort: 6333, protocol: "TCP" } ] | List of ports to expose for the Qdrant service. |

## Error Handling
This code does not implement specific error handling mechanisms. It relies on Kubernetes to manage pod and container failures.

## Logging
This code does not implement specific logging mechanisms. It relies on the Qdrant application to handle logging.
