---
title: "Overview"
---

## High-level description
This code defines a Kubernetes Pod and ConfigMap for running integration tests that verify the interaction between a Qdrant service and its database. The tests create a collection, insert data points, and execute a search query, validating the responses.

## Code Structure
The code defines two Kubernetes resources: a Pod and a ConfigMap. The Pod runs a test script defined in the ConfigMap. The script interacts with the Qdrant service using curl commands.

## Symbols

### `helm/charts/qdrant/templates/tests/test-db-interaction.yaml`
#### Description
This file defines a Kubernetes Pod and ConfigMap for running integration tests that verify the interaction between a Qdrant service and its database.

#### Inputs
This template uses values from `Values` object, including:
- `.Values.service.ports`: List of service ports. Used to determine the HTTP/HTTPS port for Qdrant.
- `.Values.apiKey`: API key for Qdrant. Used for authentication.
- `.Values.readOnlyApiKey`: Read-only API key for Qdrant. Used for authentication if `apiKey` is not set.
- `.Values.additionalVolumeMounts`: Additional volume mounts for the test pod.
- `.Values.additionalVolumes`: Additional volumes for the test pod.

#### Internal Logic
The code defines two Kubernetes resources:

1. **Pod:**
    - The Pod runs a test script defined in a ConfigMap.
    - It mounts the ConfigMap as a volume.
    - It uses the `registry.suse.com/bci/bci-base:latest` image.
    - It sets the service account to the Qdrant service account.
2. **ConfigMap:**
    - The ConfigMap contains the test script (`entrypoint.sh`).
    - The script performs the following actions:
        - Sets up curl for retries.
        - Configures CA certificates if necessary.
        - Determines the Qdrant URL based on service ports and TLS configuration.
        - Sets the API key header for authentication.
        - Deletes the test collection if it exists.
        - Creates a new test collection.
        - Inserts data points into the collection.
        - Executes a search query against the collection.

#### Side Effects
- Creates, populates, and deletes a collection in the Qdrant database.
- Sends HTTP requests to the Qdrant service.

## Dependencies
- Kubernetes
- curl

## Configuration
This template uses values from `Values` object, including:
- `.Values.service.ports`: List of service ports. Used to determine the HTTP/HTTPS port for Qdrant.
- `.Values.apiKey`: API key for Qdrant. Used for authentication.
- `.Values.readOnlyApiKey`: Read-only API key for Qdrant. Used for authentication if `apiKey` is not set.
- `.Values.additionalVolumeMounts`: Additional volume mounts for the test pod.
- `.Values.additionalVolumes`: Additional volumes for the test pod.
