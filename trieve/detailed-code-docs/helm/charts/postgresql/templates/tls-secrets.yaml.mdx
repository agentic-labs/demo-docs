---
title: "tls-secrets.yaml"
---

## High-level description
This Helm chart template generates a Kubernetes TLS Secret for PostgreSQL. It creates a self-signed CA certificate and a server certificate with appropriate Subject Alternative Names (SANs) for various PostgreSQL service endpoints. The template conditionally creates this secret based on certain criteria.

## Code Structure
The template uses several helper functions and variables to generate the necessary certificate data and construct the Secret resource. It leverages Helm's built-in certificate generation functions and custom template functions for naming and conditional logic.

## Symbols

### TLS Secret Generation
#### Description
This template generates a Kubernetes Secret of type `kubernetes.io/tls` containing TLS certificates for PostgreSQL.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| . | Context | The Helm template context |

#### Internal Logic
1. Checks if the TLS secret should be created using the `postgresql.v1.createTlsSecret` helper function.
2. Generates a CA certificate valid for 365 days.
3. Constructs a list of Subject Alternative Names (SANs) for the server certificate.
4. Generates a signed server certificate valid for 365 days using the CA.
5. Creates a Kubernetes Secret resource with the generated certificates.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common | Provides helper functions for naming, labels, and secret lookups |

## Configuration
The template uses several values from the Helm release:

| Option | Type | Description |
|:-------|:-----|:------------|
| .Release.Namespace | string | Namespace where the secret will be created |
| .Values.clusterDomain | string | Kubernetes cluster domain |
| .Values.commonLabels | map | Custom labels to add to the secret |
| .Values.commonAnnotations | map | Custom annotations to add to the secret |

## Error Handling
The template uses the `include "common.secrets.lookup"` function, which likely implements error handling for secret data retrieval.

## API/Interface Reference
The generated Secret resource:

| Field | Description |
|:------|:------------|
| metadata.name | Name of the secret, format: "&lt;fullname&gt;-crt" |
| metadata.namespace | Namespace of the Helm release |
| type | kubernetes.io/tls |
| data.tls.crt | Base64-encoded server certificate |
| data.tls.key | Base64-encoded server private key |
| data.ca.crt | Base64-encoded CA certificate |