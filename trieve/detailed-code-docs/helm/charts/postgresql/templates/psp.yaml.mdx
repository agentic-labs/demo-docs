---
title: "psp.yaml"
---

## High-level description
This code defines a Kubernetes Pod Security Policy (PSP) for PostgreSQL deployments using Helm. It sets security constraints for pods, controlling aspects like volume usage, host access, user permissions, and more. The PSP is applied only if enabled in the Helm values and the cluster supports PSPs.

## References
* `common.capabilities.psp.supported`: This function likely checks if the Kubernetes cluster supports Pod Security Policies.
* `common.names.fullname`: This function probably generates the full name for the PSP resource based on the Helm release and chart name.
* `common.labels.standard`: This function likely generates standard labels for the PSP resource.
* `common.tplvalues.render`: This function probably renders the provided annotations with the given context.

## Symbols
### `psp.yaml`
#### Description
This code defines a Kubernetes Pod Security Policy resource in YAML format. It specifies various security restrictions for pods created within its scope.

#### Inputs
This code snippet doesn't define a function and therefore doesn't have explicit inputs. It relies on Helm values passed during deployment.

#### Outputs
This code defines a Kubernetes Pod Security Policy resource that will be applied to the cluster.

#### Internal Logic
The code uses conditional logic to determine whether the PSP should be created:
* It checks if the `psp.create` value is set to true.
* It verifies if the cluster supports Pod Security Policies using the `common.capabilities.psp.supported` function.

If both conditions are met, the PSP is defined with the following specifications:
* **Basic Settings:** Disables privileged mode, host networking, IPC, and PID sharing.
* **Volumes:** Allows specific volume types like ConfigMaps, Secrets, PersistentVolumeClaims, EmptyDirs, and Projected volumes.
* **User and Group IDs:** Allows running containers as any user and group but enforces that supplemental groups and fsGroup must be within a specific range.
* **Other:** Disables read-only root filesystem and sets default SELinux rules.

## Dependencies
This code depends on Helm for templating and rendering the YAML manifest. It also relies on several custom functions likely defined within the Helm chart or a common library.

### Configuration
The PSP creation and its specifications can be configured using Helm values:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `psp.create` | boolean |  | Enables or disables the creation of the Pod Security Policy. |
| `commonLabels` | object |  | Allows adding custom labels to the PSP resource. |
| `commonAnnotations` | object |  | Allows adding custom annotations to the PSP resource. | 
