---
title: "Overview"
---

## High-level description
This directory contains Helm chart templates for deploying and managing PostgreSQL read replicas in a Kubernetes environment. The templates define various Kubernetes resources such as ConfigMaps, Services, StatefulSets, and NetworkPolicies specifically tailored for read replicas in a PostgreSQL replication setup.

## What does it do?
The templates in this directory work together to:

1. Deploy PostgreSQL read replicas as StatefulSets.
2. Expose the read replicas through Kubernetes Services, including a headless service for direct pod access.
3. Configure metrics collection and monitoring using Prometheus ServiceMonitor.
4. Set up network policies to control traffic to and from the read replicas.
5. Manage custom configurations and metrics settings through ConfigMaps.

These resources are designed to work in conjunction with a primary PostgreSQL instance, forming a complete replication architecture.

## Entry points
The main entry point for deploying read replicas is the `statefulset.yaml` file. This file defines the core deployment configuration for the read replicas, including container specifications, volume mounts, and scaling parameters.

Other key files include:
- `svc.yaml` and `svc-headless.yaml`: Define services for accessing the read replicas.
- `networkpolicy.yaml`: Controls network access to and from the read replicas.
- `metrics-svc.yaml` and `servicemonitor.yaml`: Set up metrics collection and monitoring.

The flow of control typically starts with the StatefulSet deployment, followed by the creation of associated services and network policies. Metrics collection is set up last if enabled.

## Key Files
1. `statefulset.yaml`: Defines the StatefulSet for deploying PostgreSQL read replicas.
2. `svc.yaml`: Creates a Kubernetes Service for accessing the read replicas.
3. `svc-headless.yaml`: Defines a headless service for direct pod-to-pod communication.
4. `networkpolicy.yaml`: Sets up network policies to control traffic to/from read replicas.
5. `metrics-svc.yaml`: Creates a service for exposing metrics from read replicas.
6. `servicemonitor.yaml`: Defines a Prometheus ServiceMonitor for scraping metrics.
7. `extended-configmap.yaml`: Manages custom configuration overrides for read replicas.
8. `metrics-configmap.yaml`: Stores custom metrics configuration.

## Dependencies
The templates in this directory rely on several external dependencies:

1. Kubernetes: These templates are designed to work with Kubernetes clusters and use Kubernetes API resources.
2. Helm: The templating system used is part of the Helm package manager.
3. Prometheus Operator: For metrics collection and monitoring (optional, used if metrics are enabled).
4. PostgreSQL: The underlying database system being deployed and managed.

## Configuration
The behavior of these templates can be extensively customized through Helm values. Key configuration options include:

1. `architecture`: Must be set to "replication" for these templates to be applied.
2. `readReplicas.replicaCount`: Number of read replica pods to deploy.
3. `metrics.enabled`: Enables or disables metrics collection.
4. `readReplicas.networkPolicy.enabled`: Enables or disables network policies.
5. `readReplicas.service`: Configures the Kubernetes Service for read replicas.
6. `readReplicas.podLabels`: Custom labels for read replica pods.
7. `commonLabels` and `commonAnnotations`: Labels and annotations applied to all resources.

These templates use various helper functions from a common chart, which provide standardized ways to generate labels, render values, and handle capabilities across different Kubernetes versions.

The configuration allows for fine-tuning of resource allocation, security settings, networking, and monitoring aspects of the PostgreSQL read replicas deployment.