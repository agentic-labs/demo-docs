---
title: "prometheusrule.yaml"
---

## High-level description
This code defines a Kubernetes PrometheusRule object for monitoring a PostgreSQL database deployed using a Helm chart. It sets up a PrometheusRule resource with rules for collecting and alerting on PostgreSQL metrics, but only if metrics and PrometheusRule are enabled in the chart's values.

## Code Structure
The code uses conditional logic to determine whether to create the PrometheusRule object based on the values of `metrics.enabled` and `metrics.prometheusRule.enabled`. If both are true, it defines the PrometheusRule with metadata and spec. The `spec` includes a group named after the Helm release and applies rules defined in `values.yaml`.

## References
* `common.names.fullname`: A template function that likely generates the full name of the release.
* `common.tplvalues.merge`: A template function that likely merges multiple dictionaries of labels.
* `common.labels.standard`: A template function that likely generates standard Kubernetes labels.
* `common.tplvalues.render`: A template function that likely renders a value from a dictionary.

## Symbols
### `helm/charts/postgresql/templates/prometheusrule.yaml`
#### Description
This code defines a Kubernetes manifest for a PrometheusRule object. This object is used to define rules for collecting and alerting on PostgreSQL metrics.

#### Inputs
This code uses values from the Helm chart's `values.yaml` file. The relevant values are:
* `metrics.enabled`: A boolean value indicating whether metrics collection is enabled.
* `metrics.prometheusRule.enabled`: A boolean value indicating whether the PrometheusRule object should be created.
* `metrics.prometheusRule.namespace`: The namespace where the PrometheusRule object should be created.
* `metrics.prometheusRule.labels`: A dictionary of labels to apply to the PrometheusRule object.
* `commonLabels`: A dictionary of common labels to apply to the PrometheusRule object.
* `metrics.prometheusRule.rules`: A list of Prometheus rules to apply.

#### Outputs
This code generates a Kubernetes manifest for a PrometheusRule object.

#### Internal Logic
1. **Conditional Creation:** The code first checks if both `metrics.enabled` and `metrics.prometheusRule.enabled` are set to `true`. If not, the PrometheusRule object is not created.
2. **Metadata Definition:** If the conditions are met, the code defines the metadata for the PrometheusRule object, including its name, namespace, and labels.
3. **Spec Definition:** The code then defines the `spec` for the PrometheusRule object. This includes a group named after the Helm release and the Prometheus rules defined in `values.yaml`.

## Dependencies
This code depends on the following Helm template functions:
| Dependency | Purpose |
|:-----------|:--------|
| `include` | Used to include other templates. |
| `quote` | Used to quote a string. |
| `nindent` | Used to indent a string. |

## Configuration
This code uses the following configuration options from the Helm chart's `values.yaml` file:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `metrics.enabled` | boolean | `false` | Enables/disables metrics collection. |
| `metrics.prometheusRule.enabled` | boolean | `false` | Enables/disables the creation of the PrometheusRule object. |
| `metrics.prometheusRule.namespace` | string | `Release.Namespace` | The namespace where the PrometheusRule object should be created. |
| `metrics.prometheusRule.labels` | dictionary | `{}` | A dictionary of labels to apply to the PrometheusRule object. |
| `commonLabels` | dictionary | `{}` | A dictionary of common labels to apply to the PrometheusRule object. |
| `metrics.prometheusRule.rules` | list | `[]` | A list of Prometheus rules to apply. |
