---
title: "pvc.yaml"
---

## High-level description
This code defines a Kubernetes PersistentVolumeClaim (PVC) for storing PostgreSQL database backups. It is used in conjunction with a cronjob that performs the backups. The PVC ensures that storage is provisioned and available for the backup process.

## Code Structure
This code is a single YAML template that defines a Kubernetes PersistentVolumeClaim. It uses conditional logic to determine whether the PVC should be created based on the values provided in the Helm chart.

## References
This code references several values from a Helm chart, including:
- `.Values.backup.enabled`: A boolean value indicating whether backups are enabled.
- `.Values.backup.cronjob.storage.enabled`: A boolean value indicating whether to use a PersistentVolumeClaim for backup storage.
- `.Values.backup.cronjob.storage.existingClaim`: A string value specifying the name of an existing PVC to use for backups.
- `.Values.backup.cronjob.storage.accessModes`: A list of access modes for the PVC.
- `.Values.backup.cronjob.storage.size`: The desired size of the PVC.
- `.Values.backup.cronjob.storage.resourcePolicy`: The resource policy to apply to the PVC.
- `.Values.backup.cronjob.labels`: A map of labels to apply to the PVC.
- `.Values.backup.cronjob.annotations`: A map of annotations to apply to the PVC.
- `.Values.commonLabels`: A map of common labels to apply to the PVC.
- `.Values.commonAnnotations`: A map of common annotations to apply to the PVC.
- `.Release.Namespace`: The namespace where the PVC will be created.

## Symbols
### `pvc.yaml`
#### Description
This YAML template defines a Kubernetes PersistentVolumeClaim for storing PostgreSQL database backups.

#### Inputs
This template uses values passed in from a Helm chart. See the "References" section for a list of referenced values.

#### Outputs
This template renders a Kubernetes PersistentVolumeClaim object.

#### Internal Logic
The template uses conditional logic to determine whether the PVC should be created. The PVC is only created if all of the following conditions are true:
- Backups are enabled (`.Values.backup.enabled` is true).
- Using a PersistentVolumeClaim for backup storage is enabled (`.Values.backup.cronjob.storage.enabled` is true).
- An existing PVC is not being used for backups (`.Values.backup.cronjob.storage.existingClaim` is not set).

If the PVC is created, the following attributes are configured:
- `metadata.name`: The name of the PVC is set to `&lt;release-name&gt;-pgdumpall`.
- `metadata.namespace`: The namespace of the PVC is set to the release namespace.
- `metadata.labels`: Labels are applied to the PVC based on the values provided in the Helm chart.
- `metadata.annotations`: Annotations are applied to the PVC based on the values provided in the Helm chart.
- `spec.accessModes`: The access modes of the PVC are set based on the values provided in the Helm chart.
- `spec.resources.requests.storage`: The requested storage size of the PVC is set based on the value provided in the Helm chart.
- `spec.storageClassName`: The storage class of the PVC is set based on the values provided in the Helm chart.

## Dependencies
This code depends on the Kubernetes API for creating PersistentVolumeClaims. It also depends on Helm for templating and value substitution.

## Configuration
This code is configured using values passed in from a Helm chart. See the "References" section for a list of configurable values.
