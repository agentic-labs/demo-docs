---
title: "cronjob.yaml"
---

Here's a high-level description and documentation of the provided Helm chart template for PostgreSQL:

## High-level description

This Helm chart template defines a CronJob for performing PostgreSQL backups using pg_dumpall. It's designed to work with a PostgreSQL deployment in Kubernetes, providing scheduled backups of the entire database cluster.

## Code Structure

The template is structured as a Kubernetes CronJob resource, with various configurations pulled from Helm values. It includes settings for scheduling, job history, container specifications, and volume mounts.

## Symbols

### CronJob
#### Description
Defines a Kubernetes CronJob resource for scheduled PostgreSQL backups.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.backup.enabled | boolean | Determines if the backup CronJob should be created |
| .Values.backup.cronjob.schedule | string | Cron schedule for the backup job |
| .Values.backup.cronjob.concurrencyPolicy | string | Specifies how to treat concurrent executions of the job |
| .Values.backup.cronjob.failedJobsHistoryLimit | integer | Number of failed jobs to keep in history |
| .Values.backup.cronjob.successfulJobsHistoryLimit | integer | Number of successful jobs to keep in history |

#### Internal Logic
1. Creates a CronJob with the specified schedule and job history limits.
2. Sets up a pod template for the job, including:
   - Container with PostgreSQL image
   - Environment variables for database connection
   - Command to run pg_dumpall
   - Volume mounts for storing backups and certificates (if TLS is enabled)
3. Configures security context and resource limits for the pod and container.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| PostgreSQL | The database being backed up |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| backup.enabled | boolean | false | Enable or disable the backup CronJob |
| backup.cronjob.schedule | string | | Cron schedule for the backup job |
| backup.cronjob.storage.mountPath | string | | Mount path for backup storage |
| backup.cronjob.storage.enabled | boolean | | Enable persistent storage for backups |

## Error Handling
The template doesn't include explicit error handling. Errors would be managed by Kubernetes based on the job's exit code.

## Logging
Logging is not explicitly configured in this template. Logs would be available through standard Kubernetes pod logs.

This CronJob template provides a flexible way to schedule and manage PostgreSQL backups in a Kubernetes environment, with various configuration options available through Helm values.