---
title: "Overview"
---

## High-level description
This directory contains Kubernetes resource definitions for implementing a backup system for a PostgreSQL database using Helm charts. The main components include a CronJob for scheduled backups, a NetworkPolicy for controlling network access, and a PersistentVolumeClaim (PVC) for storing the backups.

## What does it do?
This backup system performs the following tasks:

1. Schedules regular backups of the PostgreSQL database using a CronJob.
2. Executes the `pg_dumpall` utility to create a full database backup.
3. Stores the backup data in a persistent volume.
4. Controls network access to the backup process using a NetworkPolicy.
5. Manages storage resources for backups using a PersistentVolumeClaim.

The backup process is highly configurable, allowing users to adjust schedules, resource allocations, storage settings, and security policies through Helm values.

## Key Files

1. **cronjob.yaml**: Defines a Kubernetes CronJob resource that schedules and executes the PostgreSQL backup process. It uses the `pg_dumpall` utility to create a full database dump and stores it in a persistent volume.

2. **networkpolicy.yaml**: Creates a Kubernetes NetworkPolicy resource to control network traffic for the backup process. It specifically allows egress traffic on port 5432 (the standard PostgreSQL port) to facilitate backups.

3. **pvc.yaml**: Defines a Kubernetes PersistentVolumeClaim (PVC) resource for allocating and managing storage for the database backups.

## Configuration
The backup system is highly configurable through Helm values. Key configuration options include:

- `.Values.backup.enabled`: Enables or disables the entire backup system.
- `.Values.backup.cronjob.schedule`: Sets the backup schedule using cron syntax.
- `.Values.backup.cronjob.storage.*`: Configures storage settings for backups, including size and access modes.
- `.Values.backup.cronjob.networkPolicy.enabled`: Enables or disables the NetworkPolicy for backups.
- `.Values.auth.*`: Provides authentication details for accessing the PostgreSQL database.
- `.Values.tls.enabled`: Indicates whether TLS is enabled for the PostgreSQL connection.

For a complete list of configuration options, refer to the `values.schema.json` file in the chart.

## Dependencies
This backup system relies on the following Kubernetes APIs:
- `batch/v1`: For defining CronJob resources.
- `networking.k8s.io/v1`: For defining NetworkPolicy resources.
- `v1`: For defining PersistentVolumeClaim and other core resources.

The system also depends on the PostgreSQL image specified in the Helm values for running the `pg_dumpall` utility.

## Error Handling and Logging
Error handling and logging are primarily managed by Kubernetes. Errors during CronJob execution, such as failures in connecting to the database or writing the backup, will be handled by Kubernetes and can be viewed in the container logs. The backup system does not implement additional error handling or logging mechanisms beyond what is provided by Kubernetes.

In conclusion, this directory provides a comprehensive and configurable backup solution for PostgreSQL databases deployed in a Kubernetes environment using Helm charts. It ensures data safety through scheduled backups, manages storage efficiently, and implements network security measures for the backup process.