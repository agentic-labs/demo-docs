---
title: "initialization-configmap.yaml"
---

## High-level description
This Helm chart template generates a Kubernetes ConfigMap for PostgreSQL initialization scripts. It's designed to create a ConfigMap containing user-defined scripts that will be executed during the initialization of the primary PostgreSQL instance.

## Code Structure
The template is a single YAML file that conditionally creates a ConfigMap based on the presence of initialization scripts and the absence of a pre-existing ConfigMap for these scripts.

## Symbols

### Conditional Statement
#### Description
The entire ConfigMap is wrapped in a conditional statement that checks for the presence of initialization scripts and the absence of a pre-existing ConfigMap.

```yaml
{{- if and .Values.primary.initdb.scripts (not .Values.primary.initdb.scriptsConfigMap) }}
...
{{- end }}
```

This ensures that the ConfigMap is only created when necessary.

### ConfigMap Metadata
#### Description
Defines the metadata for the ConfigMap, including its name, namespace, labels, and annotations.

#### Internal Logic
- The name is generated using a helper function `postgresql.v1.primary.fullname` with a "-init-scripts" suffix.
- The namespace is set to the release namespace.
- Labels are set using a common helper function `common.labels.standard`.
- Annotations are conditionally added if `commonAnnotations` are defined in the values.

### ConfigMap Data
#### Description
Populates the ConfigMap with the initialization scripts defined in the Helm values.

#### Internal Logic
The `data` field is populated using the `common.tplvalues.render` helper function, which renders the scripts defined in `.Values.primary.initdb.scripts`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.labels.standard | Helper function to generate standard Kubernetes labels |
| common.tplvalues.render | Helper function to render template values |
| postgresql.v1.primary.fullname | Helper function to generate the full name for the primary PostgreSQL instance |

## Configuration
The template relies on the following configuration options:

| Option | Type | Description |
|:-------|:-----|:------------|
| .Values.primary.initdb.scripts | map | Map of initialization scripts to be included in the ConfigMap |
| .Values.primary.initdb.scriptsConfigMap | string | Name of an existing ConfigMap containing initialization scripts |
| .Values.commonLabels | map | Common labels to be applied to all resources |
| .Values.commonAnnotations | map | Common annotations to be applied to all resources |

Note: The ConfigMap is only created if `.Values.primary.initdb.scripts` is defined and `.Values.primary.initdb.scriptsConfigMap` is not defined.

This template provides a flexible way to include custom initialization scripts for a PostgreSQL deployment using Helm, allowing users to easily configure and manage the initialization process of their database instances.