---
title: "svc.yaml"
---

## High-level description
This YAML file defines a Kubernetes Service resource for the primary PostgreSQL instance in a Helm chart. It configures various aspects of the service, including its type, ports, and selectors, with many options customizable through Helm values.

## Code Structure
The file is structured as a single Kubernetes Service resource, with various sections controlled by conditional statements based on Helm values. It uses several Helm template functions to include common labels, merge values, and render template strings.

## Symbols

### Service Resource
#### Description
Defines a Kubernetes Service for the primary PostgreSQL instance.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values | Object | Helm values passed to the template |
| .Release | Object | Helm release information |

#### Internal Logic
1. Sets the service name using a template function
2. Defines labels and annotations
3. Configures the service type and related settings based on the type
4. Sets up the service ports
5. Defines the selector for the service

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common | Provides helper templates for labels, annotations, and value merging |

### Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| primary.service.type | string | N/A | Type of the Kubernetes service (e.g., ClusterIP, LoadBalancer) |
| primary.service.externalTrafficPolicy | string | N/A | External traffic policy for LoadBalancer or NodePort types |
| primary.service.loadBalancerSourceRanges | list | N/A | Source IP ranges for LoadBalancer type |
| primary.service.loadBalancerIP | string | N/A | Static IP for LoadBalancer type |
| primary.service.clusterIP | string | N/A | Static cluster IP for ClusterIP type |
| primary.service.sessionAffinity | string | N/A | Session affinity setting |
| primary.service.sessionAffinityConfig | object | N/A | Configuration for session affinity |
| primary.service.nodePorts.postgresql | number | N/A | Node port for PostgreSQL when using NodePort type |
| primary.service.extraPorts | list | N/A | Additional ports to expose on the service |

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| tcp-postgresql | TCP | N/A | N/A | Main port for PostgreSQL connections |

This service definition provides a flexible way to expose a PostgreSQL primary instance in a Kubernetes cluster, with various configuration options to suit different deployment scenarios.