---
title: "metrics-configmap.yaml"
---

## High-level description
This Kubernetes YAML file defines a ConfigMap resource that holds custom metrics configuration for a PostgreSQL primary instance deployed using a Helm chart. It is conditionally created only if metrics are enabled and custom metrics are defined in the chart values.

## Symbols
### `helm/charts/postgresql/templates/primary/metrics-configmap.yaml`
#### Description
This code defines a Kubernetes ConfigMap named `&lt;release-name&gt;-metrics` in the specified namespace. It stores custom metrics configuration for a PostgreSQL primary instance. The ConfigMap is created only if `metrics.enabled` and `metrics.customMetrics` values are set in the Helm chart values.

#### Inputs
This code snippet doesn't have explicit inputs. It uses values from the Helm chart values during deployment.

#### Outputs
This code generates a Kubernetes ConfigMap resource configuration in YAML format.

#### Internal Logic
1. **Conditional Creation:** The ConfigMap is created only if both `.Values.metrics.enabled` and `.Values.metrics.customMetrics` are true.
2. **Name and Namespace:** The ConfigMap name is generated using the release name and a suffix "-metrics". It is placed in the namespace specified in the Helm chart values.
3. **Labels:** Standard labels and any custom labels defined in `Values.commonLabels` are applied to the ConfigMap.
4. **Annotations:** If `Values.commonAnnotations` are defined, they are added to the ConfigMap.
5. **Data:** The `custom-metrics.yaml` key in the ConfigMap data holds the YAML representation of the `Values.metrics.customMetrics` object.

## Dependencies
This code depends on the following Helm template functions:
| Dependency | Purpose |
|:-----------|:--------|
| `and` | Checks if both arguments are true. |
| `printf` | Formats a string using the given format and arguments. |
| `include` | Includes another template and passes the context. |
| `quote` | Quotes the given string. |
| `nindent` | Indents the given string by the specified number of spaces. |
| `toYaml` | Converts the given object to YAML format. |

## Configuration
This code relies on the following configuration options from the Helm chart values:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `Values.metrics.enabled` | boolean | false | Enables or disables metrics collection. |
| `Values.metrics.customMetrics` | object | {} | Defines custom metrics configuration. |
| `Values.commonLabels` | object | {} | Defines custom labels to be applied to the ConfigMap. |
| `Values.commonAnnotations` | object | {} | Defines custom annotations to be applied to the ConfigMap. |

## Error Handling
This code doesn't implement specific error handling. Any errors during template rendering will be handled by the Helm engine.
