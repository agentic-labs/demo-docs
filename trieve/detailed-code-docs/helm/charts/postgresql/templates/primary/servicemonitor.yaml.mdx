---
title: "servicemonitor.yaml"
---

## High-level description
This YAML file defines a ServiceMonitor resource for monitoring PostgreSQL metrics in a Kubernetes environment. It is part of a Helm chart and is conditionally created based on the values of `.Values.metrics.enabled` and `.Values.metrics.serviceMonitor.enabled`.

## Code Structure
The file consists of a single ServiceMonitor resource definition with various metadata and spec configurations. It uses Helm templating to dynamically generate values based on the chart's values and built-in functions.

## Symbols

### ServiceMonitor
#### Description
Defines a ServiceMonitor resource for Prometheus Operator to scrape metrics from the PostgreSQL service.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.metrics.enabled | boolean | Enables metrics collection |
| .Values.metrics.serviceMonitor.enabled | boolean | Enables ServiceMonitor creation |
| .Values.metrics.serviceMonitor.namespace | string | Namespace for the ServiceMonitor |
| .Values.metrics.serviceMonitor.labels | map | Additional labels for the ServiceMonitor |
| .Values.commonLabels | map | Common labels to be applied |
| .Values.commonAnnotations | map | Common annotations to be applied |
| .Values.metrics.serviceMonitor.jobLabel | string | Job label for the ServiceMonitor |
| .Values.metrics.serviceMonitor.selector | map | Selector for targeting services |
| .Values.metrics.serviceMonitor.interval | string | Scrape interval |
| .Values.metrics.serviceMonitor.scrapeTimeout | string | Scrape timeout |
| .Values.metrics.serviceMonitor.relabelings | list | Relabeling configurations |
| .Values.metrics.serviceMonitor.metricRelabelings | list | Metric relabeling configurations |
| .Values.metrics.serviceMonitor.honorLabels | boolean | Honor labels configuration |

#### Internal Logic
1. Checks if metrics and ServiceMonitor are enabled.
2. Sets metadata including name, namespace, labels, and annotations.
3. Configures the spec with job label, selector, endpoints, and namespace selector.
4. Uses various Helm templating functions to merge and render values.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| monitoring.coreos.com/v1 | API version for ServiceMonitor resource |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| metrics.enabled | boolean | - | Enables metrics collection |
| metrics.serviceMonitor.enabled | boolean | - | Enables ServiceMonitor creation |
| metrics.serviceMonitor.namespace | string | .Release.Namespace | Namespace for the ServiceMonitor |
| metrics.serviceMonitor.labels | map | - | Additional labels for the ServiceMonitor |
| metrics.serviceMonitor.jobLabel | string | - | Job label for the ServiceMonitor |
| metrics.serviceMonitor.selector | map | - | Selector for targeting services |
| metrics.serviceMonitor.interval | string | - | Scrape interval |
| metrics.serviceMonitor.scrapeTimeout | string | - | Scrape timeout |
| metrics.serviceMonitor.relabelings | list | - | Relabeling configurations |
| metrics.serviceMonitor.metricRelabelings | list | - | Metric relabeling configurations |
| metrics.serviceMonitor.honorLabels | boolean | - | Honor labels configuration |

This YAML template is part of a Helm chart for PostgreSQL and specifically handles the creation of a ServiceMonitor resource for Prometheus Operator. It allows for flexible configuration of metrics collection and monitoring in a Kubernetes environment.