---
title: "statefulset.yaml"
---

## High-level description
This code defines a Kubernetes StatefulSet for deploying a primary PostgreSQL instance. It configures various aspects of the deployment, including container images, resource limits, persistence, networking, security, and probes. The StatefulSet ensures that the primary instance has a stable network identity and persistent storage.

## Code Structure
This code is a YAML definition of a Kubernetes StatefulSet. It doesn't define any custom symbols but uses various built-in Kubernetes objects and parameters to configure the deployment.

## References
This code references various other parts of the codebase, including:

* `postgresql.v1.primary.fullname`: Returns the full name of the primary PostgreSQL instance.
* `postgresql.v1.primary.svc.headless`: Returns the headless service name for the primary instance.
* `postgresql.v1.primary.createConfigmap`: Checks if a ConfigMap for configuration should be created.
* `postgresql.v1.primary.createExtendedConfigmap`: Checks if a ConfigMap for extended configuration should be created.
* `postgresql.v1.serviceAccountName`: Returns the service account name for the PostgreSQL instance.
* `postgresql.v1.imagePullSecrets`: Returns the image pull secrets for the PostgreSQL instance.
* `postgresql.v1.volumePermissions.image`: Returns the image used for setting volume permissions.
* `postgresql.v1.tlsCertKey`: Returns the path to the TLS certificate key file.
* `postgresql.v1.image`: Returns the PostgreSQL image name.
* `postgresql.v1.adminPasswordKey`: Returns the key for the admin password in the secret.
* `postgresql.v1.secretName`: Returns the name of the secret containing PostgreSQL credentials.
* `postgresql.v1.userPasswordKey`: Returns the key for the user password in the secret.
* `postgresql.v1.database`: Returns the name of the database to be created.
* `postgresql.v1.replicationPasswordKey`: Returns the key for the replication password in the secret.
* `postgresql.v1.ldap.tls.enabled`: Checks if LDAP TLS is enabled.
* `postgresql.v1.tlsCert`: Returns the path to the TLS certificate file.
* `postgresql.v1.tlsCACert`: Returns the path to the TLS CA certificate file.
* `postgresql.v1.tlsCRL`: Returns the path to the TLS CRL file.
* `postgresql.v1.metrics.image`: Returns the image name for the PostgreSQL metrics exporter.
* `postgresql.v1.service.port`: Returns the PostgreSQL service port.
* `postgresql.v1.initdb.scriptsCM`: Returns the name of the ConfigMap containing initdb scripts.
* `postgresql.v1.tlsSecretName`: Returns the name of the secret containing TLS certificates.
* `common.tplvalues.merge`: Merges multiple values into a single dictionary.
* `common.labels.standard`: Generates standard labels for Kubernetes resources.
* `common.labels.matchLabels`: Generates matchLabels for Kubernetes selectors.
* `common.affinities.pods`: Generates pod affinity and anti-affinity rules.
* `common.affinities.nodes`: Generates node affinity rules.
* `common.compatibility.renderSecurityContext`: Renders the security context for different Kubernetes versions.
* `common.resources.preset`: Returns resource requests and limits based on a preset.
* `common.tplvalues.render`: Renders a template with given values.
* `common.storage.class`: Determines the storage class to use for persistent volumes.
* `postgresql.v1.readinessProbeCommand`: Returns the command for the PostgreSQL readiness probe.

## Dependencies
This code depends on Kubernetes and Helm for deployment and configuration. It also relies on various other charts and templates within the codebase for common functionality and configurations.

## Configuration
This code defines numerous configuration options for the PostgreSQL primary instance deployment. These options control aspects such as authentication, replication, LDAP integration, TLS configuration, resource limits, persistence, networking, security context, probes, and more. Refer to the `values.yaml` file and the comments within the code for detailed explanations of each configuration option and its default value.
