---
title: "role.yaml"
---

## High-level description
This code defines a Kubernetes Role resource for managing permissions related to a PostgreSQL deployment. It allows customization of the role based on configuration values and includes rules for using Pod Security Policies and other custom rules.

## Code Structure
The code uses conditional logic to determine whether to create the Role resource and include specific rules based on configuration values. It leverages template functions and includes to generate resource names, labels, and annotations.

## References
* `common.capabilities.rbac.apiVersion`: Returns the appropriate RBAC API version.
* `common.names.fullname`: Generates the full name for the resource.
* `common.labels.standard`: Generates standard labels for the resource.
* `common.tplvalues.render`: Renders template values.
* `common.capabilities.psp.supported`: Checks if Pod Security Policies are supported.
* `common.names.fullname`: Generates the full name for the resource.

## Symbols
### `role.yaml`
#### Description
This code defines a Kubernetes Role resource that governs permissions for a PostgreSQL deployment. It uses conditional logic to include rules based on configuration values.

#### Inputs
This code snippet doesn't have explicit input parameters. It relies on values passed to the template from the Helm chart.

#### Outputs
A Kubernetes Role resource definition in YAML format.

#### Internal Logic
1. **Conditional Role Creation:** The code first checks if `.Values.rbac.create` is true. If true, it proceeds to create the Role resource.
2. **Metadata Generation:** It sets the `name`, `namespace`, `labels`, and `annotations` for the Role resource using template functions and values from the Helm chart.
3. **Rule Definition:**
    * **Pod Security Policy Rule:** If Pod Security Policies are supported and enabled (`.Values.psp.create`), a rule is added to allow the role to use the Pod Security Policy with the same name as the release.
    * **Custom Rules:** If `.Values.rbac.rules` is defined, it includes additional custom rules defined in the Helm chart.

## Dependencies
* This code depends on the Helm templating engine and functions provided by the chart.

## Configuration
This code relies on configuration values passed through the Helm chart. Key configuration options include:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `rbac.create` | boolean |  | Determines whether to create the Role resource. |
| `psp.create` | boolean |  | Determines whether to create a rule for using a Pod Security Policy. |
| `rbac.rules` | array |  | Allows defining custom rules for the Role. |
| `commonLabels` | object |  | Custom labels to apply to the Role resource. |
| `commonAnnotations` | object |  | Custom annotations to apply to the Role resource. |

## Error Handling
This code snippet doesn't implement specific error handling. Errors during template rendering will be handled by the Helm engine.
