---
title: "Overview"
---

## High-level description
This directory contains Helm chart templates for deploying and configuring a PostgreSQL database in a Kubernetes environment. It includes templates for various Kubernetes resources such as ConfigMaps, Secrets, Services, StatefulSets, NetworkPolicies, and monitoring resources for both primary and read replica instances.

## What does it do?
The templates in this directory work together to:

1. Deploy PostgreSQL primary and read replica instances as StatefulSets.
2. Set up secure authentication and TLS encryption for the database.
3. Configure network policies to control traffic to and from PostgreSQL pods.
4. Create services for accessing the PostgreSQL instances.
5. Set up monitoring and metrics collection using Prometheus.
6. Manage custom configurations and initialization scripts through ConfigMaps.
7. Handle backups of the PostgreSQL database.
8. Define RBAC resources for proper permissions within the Kubernetes cluster.

## Entry points
The main entry points for deploying PostgreSQL are:

1. `primary/statefulset.yaml`: Defines the StatefulSet for the primary PostgreSQL instance.
2. `read/statefulset.yaml`: Defines the StatefulSet for read replica instances (if using replication architecture).
3. `secrets.yaml`: Creates secrets for storing sensitive information like passwords.
4. `serviceaccount.yaml`: Sets up the service account for PostgreSQL pods.

The deployment process typically starts with creating the necessary secrets and service accounts, followed by deploying the StatefulSets for primary and read replicas (if applicable). Services, network policies, and monitoring resources are then set up to complete the deployment.

## Key Files
1. `primary/statefulset.yaml`: Defines the primary PostgreSQL instance deployment.
2. `read/statefulset.yaml`: Defines read replica deployments for replication setups.
3. `secrets.yaml`: Manages sensitive information like passwords and TLS certificates.
4. `serviceaccount.yaml`: Creates the service account for PostgreSQL pods.
5. `psp.yaml`: Defines Pod Security Policies for enhanced security.
6. `role.yaml` and `rolebinding.yaml`: Set up RBAC for PostgreSQL pods.
7. `prometheusrule.yaml`: Defines Prometheus alerting rules for PostgreSQL.
8. `backup/cronjob.yaml`: Sets up scheduled backups for the database.
9. `tls-secrets.yaml`: Manages TLS certificates for secure communications.

## Dependencies
The templates in this directory rely on several external dependencies:

1. Kubernetes: These templates are designed to work with Kubernetes clusters.
2. Helm: The templating system used is part of the Helm package manager.
3. Prometheus Operator: For metrics collection and monitoring (optional).
4. PostgreSQL: The underlying database system being deployed and managed.

## Configuration
The behavior of these templates can be extensively customized through Helm values. Key configuration options include:

1. `architecture`: Determines whether to use a standalone or replication setup.
2. `auth`: Configures authentication methods and credentials.
3. `tls`: Enables and configures TLS encryption.
4. `metrics`: Enables and configures Prometheus metrics collection.
5. `networkPolicy`: Configures network access controls.
6. `backup`: Sets up and configures database backups.
7. `psp`: Configures Pod Security Policies.
8. `rbac`: Manages role-based access control settings.

These templates use various helper functions from a common chart, which provide standardized ways to generate labels, render values, and handle capabilities across different Kubernetes versions.

The configuration allows for fine-tuning of resource allocation, security settings, networking, monitoring, and backup aspects of the PostgreSQL deployment.