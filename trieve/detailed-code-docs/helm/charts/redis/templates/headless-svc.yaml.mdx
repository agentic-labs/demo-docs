---
title: "headless-svc.yaml"
---

## High-level description
This code defines a Kubernetes Service of type `ClusterIP` with `clusterIP` set to `None`, which creates a headless service. This service is intended to provide a stable DNS endpoint for accessing individual Redis pods, particularly in a Redis Sentinel setup. 

## Code Structure
The code uses a combination of YAML templating and Go template functions to define the service. It leverages common templates and values from other files to construct the service definition.

## References
* `common.names.fullname`: Template function to generate the full name of the service.
* `common.names.namespace`: Template function to get the namespace for the service.
* `common.labels.standard`: Template function to generate standard labels for the service.
* `common.tplvalues.merge`: Template function to merge multiple annotation values.
* `common.tplvalues.render`: Template function to render annotation values.
* `redis.externalDNS.annotations`: Template function to include external DNS annotations.
* `common.labels.matchLabels`: Template function to generate labels for pod selection.

## Symbols
### `helm/charts/redis/templates/headless-svc.yaml`
#### Description
This YAML file defines a Kubernetes Service resource for a Redis deployment. It uses templating to dynamically generate the service definition based on provided values.

#### Inputs
This template uses values passed to the Helm chart during installation or upgrade. Key input values include:

| Name | Type | Description |
|:-----|:-----|:------------|
| `.Values.sentinel.enabled` | boolean | Determines if Redis Sentinel is enabled. |
| `.Values.sentinel.service.headless.annotations` | map | Custom annotations for the headless service when Sentinel is enabled. |
| `.Values.commonAnnotations` | map | Common annotations to be applied to the service. |
| `.Values.sentinel.service.ports.redis` | integer | Port for Redis server when Sentinel is enabled. |
| `.Values.master.service.ports.redis` | integer | Port for Redis server when Sentinel is disabled. |
| `.Values.sentinel.service.ports.sentinel` | integer | Port for Redis Sentinel. |
| `.Values.commonLabels` | map | Common labels to be applied to the service and its selector. |

#### Internal Logic
The template defines a Service resource with the following key features:

* **Headless Service:** The `clusterIP` is set to `None`, making it a headless service.
* **Conditional Sentinel Configuration:** The service definition includes logic to conditionally configure ports and annotations based on whether Redis Sentinel is enabled.
* **Dynamic Labels and Annotations:** The template uses functions to dynamically generate labels and annotations based on provided values.
* **Port Definitions:** The service exposes ports for Redis and optionally for Redis Sentinel.
* **Pod Selector:** The service uses labels to select pods belonging to the Redis deployment.

## Side Effects
This code, when deployed as part of a Helm chart, will create a headless Kubernetes Service. This service will be exposed within the cluster and will provide a stable DNS endpoint for accessing individual Redis pods.

## Dependencies
This code depends on the following Helm template functions:

| Dependency | Purpose |
|:-----------|:--------|
| `common.names.fullname` | Generates the full name of the service. |
| `common.names.namespace` | Gets the namespace for the service. |
| `common.labels.standard` | Generates standard labels for the service. |
| `common.tplvalues.merge` | Merges multiple annotation values. |
| `common.tplvalues.render` | Renders annotation values. |
| `redis.externalDNS.annotations` | Includes external DNS annotations. |
| `common.labels.matchLabels` | Generates labels for pod selection. | 
