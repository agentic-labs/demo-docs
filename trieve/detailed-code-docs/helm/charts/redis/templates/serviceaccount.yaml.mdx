---
title: "serviceaccount.yaml"
---

## High-level description
This code defines a Kubernetes ServiceAccount named `redis` in a Helm chart for deploying Redis. It is conditionally created only if both `serviceAccount.create` and `sentinel.enabled` values are true in the chart's values.yaml. The ServiceAccount is used to provide an identity for Redis pods to interact with the Kubernetes API.

## Code Structure
The code uses conditional logic (`if`) to determine whether to create the ServiceAccount based on the values provided in the Helm chart. It utilizes various Helm template functions like `template`, `include`, and `dict` to generate the final YAML manifest.

## References
* `redis.serviceAccountName`: Refers to a template function that generates the name for the ServiceAccount.
* `common.names.namespace`: Refers to a template function that provides the namespace for the deployment.
* `common.labels.standard`: Refers to a template function that generates standard labels for the ServiceAccount.
* `common.tplvalues.merge`: Refers to a template function that merges annotations from different sources.
* `common.tplvalues.render`: Refers to a template function that renders the final annotations.

## Symbols
### `serviceaccount.yaml`
#### Description
This file defines a Kubernetes ServiceAccount resource for a Redis deployment using Helm templating.

#### Inputs
This template uses values from the `Values` object passed to the Helm chart, specifically:
* `Values.serviceAccount.create`: Boolean value indicating whether to create the ServiceAccount.
* `Values.sentinel.enabled`: Boolean value indicating whether Redis Sentinel is enabled.
* `Values.serviceAccount.automountServiceAccountToken`: Boolean value indicating whether to automatically mount the service account token.
* `Values.commonLabels`: A dictionary of common labels to apply to the ServiceAccount.
* `Values.serviceAccount.annotations`: A dictionary of annotations specific to the ServiceAccount.
* `Values.commonAnnotations`: A dictionary of common annotations to apply to the ServiceAccount.

#### Outputs
The template renders a YAML manifest for a Kubernetes ServiceAccount resource if both `Values.serviceAccount.create` and `Values.sentinel.enabled` are true.

#### Internal Logic
1. **Conditional Creation:** The template first checks if both `Values.serviceAccount.create` and `Values.sentinel.enabled` are true. If not, the template renders nothing.
2. **Resource Definition:** If the conditions are met, it defines a ServiceAccount resource with the following:
    * `apiVersion`: v1
    * `kind`: ServiceAccount
    * `automountServiceAccountToken`: Value from `Values.serviceAccount.automountServiceAccountToken`.
    * `metadata`:
        * `name`: Generated using the `redis.serviceAccountName` template function.
        * `namespace`: Obtained from the `common.names.namespace` template function.
        * `labels`: Generated using the `common.labels.standard` template function, including standard labels and any custom labels provided in `Values.commonLabels`.
        * `annotations`: 
            * If either `Values.commonAnnotations` or `Values.serviceAccount.annotations` are provided, the annotations are merged using `common.tplvalues.merge` and rendered using `common.tplvalues.render`.

## Dependencies
* This template utilizes the Kubernetes API version `v1` for defining the ServiceAccount resource.
* It depends on various Helm template functions like `template`, `include`, and `dict` for generating the final YAML manifest. 
