---
title: "podmonitor.yaml"
---

## High-level description
This code defines a Kubernetes PodMonitor resource for monitoring Redis pods using Prometheus. It configures various aspects of the monitoring process, such as the endpoint to scrape, scraping interval, and label matching. The PodMonitor is only created if metrics and PodMonitor are enabled in the values.

## Code Structure
The code uses conditional logic to dynamically generate a PodMonitor resource based on values provided in the Helm chart. It leverages various template functions and includes to assemble the final YAML definition.

## References
* `common.names.fullname`: Generates the full name of the resource.
* `common.names.namespace`: Retrieves the namespace for the resource.
* `common.labels.standard`: Includes standard labels for the resource.
* `common.tplvalues.render`: Renders template values.
* `common.labels.matchLabels`: Includes labels for matching pods.

## Symbols
### `helm/charts/redis/templates/podmonitor.yaml`
#### Description
This code defines a Kubernetes PodMonitor resource for monitoring Redis pods using Prometheus. It allows customization of various monitoring parameters through Helm values.

#### Inputs
This code snippet doesn't define a function or method, thus it doesn't have explicit inputs. It relies on Helm values passed to the template. Below are some of the key values used:

| Name | Type | Description |
|:-----|:-----|:------------|
| `.Values.metrics.enabled` | boolean | Enables/disables metrics collection. |
| `.Values.metrics.podMonitor.enabled` | boolean | Enables/disables the PodMonitor creation. |
| `.Values.metrics.podMonitor.namespace` | string | Namespace to deploy the PodMonitor to. |
| `.Values.metrics.podMonitor.additionalLabels` | map | Additional labels for the PodMonitor. |
| `.Values.commonAnnotations` | map | Common annotations for the PodMonitor. |
| `.Values.metrics.podMonitor.interval` | string | Scraping interval for the endpoint. |
| `.Values.metrics.podMonitor.scrapeTimeout` | string | Timeout for scraping the endpoint. |
| `.Values.metrics.podMonitor.honorLabels` | boolean | Whether to honor existing labels on the target. |
| `.Values.metrics.podMonitor.relabellings` | list | Relabeling rules for the target. |
| `.Values.metrics.podMonitor.metricRelabelings` | list | Relabeling rules for metrics. |
| `.Values.metrics.podMonitor.additionalEndpoints` | list | Additional endpoints to monitor. |
| `.Values.metrics.serviceMonitor.podTargetLabels` | map | Labels to select target pods. |
| `.Values.metrics.podMonitor.sampleLimit` | int | Sample limit for metrics. |
| `.Values.metrics.podMonitor.targetLimit` | int | Target limit for scraping. |
| `.Values.commonLabels` | map | Common labels for matching pods. |

#### Outputs
The code generates a YAML definition of a Kubernetes PodMonitor resource.

#### Internal Logic
1. **Conditional Creation:** The PodMonitor is created only if both `.Values.metrics.enabled` and `.Values.metrics.podMonitor.enabled` are true.
2. **Metadata:** Sets standard metadata like name, namespace, and labels using template functions and includes.
3. **Pod Metrics Endpoints:** Defines the primary endpoint for scraping metrics. It allows customization of the scraping interval, timeout, label honoring, and relabeling rules.
4. **Additional Endpoints:** Iterates through `.Values.metrics.podMonitor.additionalEndpoints` to define additional endpoints for monitoring.
5. **Pod Target Labels:** Sets labels to select target pods using `.Values.metrics.serviceMonitor.podTargetLabels`.
6. **Sample and Target Limits:** Configures sample and target limits for scraping.
7. **Namespace and Pod Selectors:** Defines selectors to match the PodMonitor with the target Redis pods based on namespace and labels.

## Dependencies
This code snippet doesn't have external library dependencies. However, it depends on the Helm templating engine and Kubernetes APIs for functionality.
