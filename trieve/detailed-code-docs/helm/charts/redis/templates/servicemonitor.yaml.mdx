---
title: "servicemonitor.yaml"
---

## High-level description
This code defines a Kubernetes ServiceMonitor resource for monitoring Redis using Prometheus. It configures scraping of Redis metrics endpoint and allows customization of various parameters like interval, labels, and relabeling rules. The ServiceMonitor is only created if metrics and serviceMonitor are enabled in the values.

## Code Structure
The code is a single YAML template that defines a ServiceMonitor resource. It uses conditional logic to include or exclude certain sections based on the values provided in the `Values` object. 

## References
This template references several other templates and functions:
* `template "common.names.fullname" .`: Generates the full name of the ServiceMonitor.
* `include "common.names.namespace" .`: Includes the namespace for the ServiceMonitor.
* `include "common.labels.standard" ...`: Includes standard labels for the ServiceMonitor.
* `include "common.tplvalues.render" ...`: Renders template values.
* `include "common.labels.matchLabels" ...`: Includes match labels for the ServiceMonitor.

## Symbols
### `helm/charts/redis/templates/servicemonitor.yaml`
#### Description
This YAML template defines a Kubernetes ServiceMonitor resource for monitoring Redis using Prometheus. It allows customization of various parameters like namespace, labels, endpoints, and selectors.

#### Inputs
This template uses values from the `Values` object, which is passed to it during rendering. Some of the key values used include:
* `Values.metrics.enabled`: Enables or disables metrics collection.
* `Values.metrics.serviceMonitor.enabled`: Enables or disables the ServiceMonitor.
* `Values.metrics.serviceMonitor.namespace`: Namespace for the ServiceMonitor.
* `Values.metrics.serviceMonitor.additionalLabels`: Additional labels for the ServiceMonitor.
* `Values.commonLabels`: Common labels to be applied to the ServiceMonitor.
* `Values.commonAnnotations`: Common annotations to be applied to the ServiceMonitor.
* `Values.metrics.serviceMonitor.interval`: Interval for scraping metrics.
* `Values.metrics.serviceMonitor.scrapeTimeout`: Timeout for scraping metrics.
* `Values.metrics.serviceMonitor.honorLabels`: Whether to honor existing labels on the target.
* `Values.metrics.serviceMonitor.relabellings`: Relabeling rules for the ServiceMonitor.
* `Values.metrics.serviceMonitor.metricRelabelings`: Metric relabeling rules for the ServiceMonitor.
* `Values.metrics.serviceMonitor.additionalEndpoints`: Additional endpoints to scrape.
* `Values.metrics.serviceMonitor.podTargetLabels`: Labels to select target pods.
* `Values.metrics.serviceMonitor.sampleLimit`: Sample limit for the ServiceMonitor.
* `Values.metrics.serviceMonitor.targetLimit`: Target limit for the ServiceMonitor.

#### Outputs
This template renders a Kubernetes ServiceMonitor resource in YAML format.

#### Internal Logic
The template uses conditional logic (`{{- if ... }}`) to include or exclude certain sections based on the values provided in the `Values` object. For example, the `additionalLabels` section is only included if `Values.metrics.serviceMonitor.additionalLabels` is defined.

## Side Effects
This template, when applied, creates a ServiceMonitor resource in the Kubernetes cluster. This allows Prometheus to discover and scrape metrics from the Redis deployment.

## Dependencies
This template depends on the following Kubernetes APIs:
* `monitoring.coreos.com/v1`: For the ServiceMonitor resource.

## Configuration
This template is configured using values provided in the `Values` object. See the "Inputs" section for a list of configurable values.

## Error Handling
This template does not implement specific error handling. Errors during rendering will be reported by the Helm engine.

## Logging
This template does not implement logging.
