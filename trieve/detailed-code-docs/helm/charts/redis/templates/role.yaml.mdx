---
title: "role.yaml"
---

## High-level description
This YAML file defines a Kubernetes Role resource for a Redis deployment using Helm. It creates RBAC (Role-Based Access Control) rules for the Redis pods, including optional Pod Security Policy (PSP) permissions and custom rules defined in the Helm values.

## Code Structure
The file uses Helm templating to dynamically generate the Role resource based on the provided values and capabilities of the Kubernetes cluster.

## Symbols

### Role Resource
#### Description
Defines a Kubernetes Role resource with specific permissions for Redis pods.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.rbac.create | boolean | Determines if the Role should be created |
| .Values.commonLabels | map | Custom labels to be added to the Role |
| .Values.commonAnnotations | map | Custom annotations to be added to the Role |
| .Values.podSecurityPolicy.enabled | boolean | Enables Pod Security Policy rules |
| .Values.rbac.rules | list | Additional custom RBAC rules |

#### Internal Logic
1. Checks if RBAC creation is enabled
2. Sets the API version using a common capability function
3. Defines metadata including name, namespace, labels, and annotations
4. Adds Pod Security Policy rules if enabled and supported
5. Includes additional custom RBAC rules if provided

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.capabilities.rbac.apiVersion | Determines the appropriate RBAC API version |
| common.names.fullname | Generates the full name for the Role |
| common.names.namespace | Retrieves the namespace |
| common.labels.standard | Generates standard labels |
| common.tplvalues.render | Renders template values |
| common.capabilities.psp.supported | Checks if Pod Security Policies are supported |
| podSecurityPolicy.apiGroup | Retrieves the PSP API group |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| rbac.create | boolean | - | Enables creation of RBAC resources |
| podSecurityPolicy.enabled | boolean | - | Enables Pod Security Policy rules |
| rbac.rules | list | - | Additional custom RBAC rules |

## Notes
1. The file is part of a Helm chart for Redis deployment.
2. It uses conditional logic to include or exclude certain rules based on the provided values and cluster capabilities.
3. The Role is only created if `.Values.rbac.create` is set to true.
4. Pod Security Policy rules are included if PSP is supported and enabled in the values.
5. Additional custom RBAC rules can be added through `.Values.rbac.rules`.