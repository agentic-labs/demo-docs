---
title: "role.yaml"
---

## High-level description
This code defines a Kubernetes Role resource for managing permissions related to a Redis deployment using Helm. It allows customization of the Role's rules, labels, and annotations based on provided values.

## Code Structure
The code uses conditional logic to determine whether to create the Role and include specific rules based on the provided values. It leverages Helm templating to dynamically generate the Role definition.

## References
* `common.capabilities.rbac.apiVersion`: Retrieves the appropriate API version for RBAC resources.
* `common.names.fullname`: Generates the full name for the Role resource.
* `common.names.namespace`: Determines the namespace for the Role resource.
* `common.labels.standard`: Generates standard labels for the Role resource.
* `common.tplvalues.render`: Renders template values for annotations and rules.
* `common.capabilities.psp.supported`: Checks if Pod Security Policies are supported.
* `podSecurityPolicy.apiGroup`: Retrieves the API group for Pod Security Policies.

## Symbols
### `role.yaml`
#### Description
This code defines a Kubernetes Role resource for managing permissions related to a Redis deployment. It uses Helm templating to dynamically generate the Role definition based on provided values.

#### Inputs
This code uses values from the `Values` object passed to the Helm template. Relevant values include:
* `Values.rbac.create`: Boolean value indicating whether to create the Role resource.
* `Values.commonLabels`: A dictionary of custom labels to apply to the Role.
* `Values.commonAnnotations`: A dictionary of annotations to apply to the Role.
* `Values.podSecurityPolicy.enabled`: Boolean value indicating whether Pod Security Policies are enabled.
* `Values.rbac.rules`: A list of custom rules to apply to the Role.

#### Outputs
This code generates a Kubernetes Role resource definition in YAML format.

#### Internal Logic
1. **Conditional Role Creation:** The code first checks if `Values.rbac.create` is true. If not, the Role resource is not created.
2. **Metadata Generation:** If the Role is created, the code generates its metadata, including name, namespace, labels, and annotations.
3. **Rule Generation:** The code includes rules based on the provided values:
    * **Pod Security Policy Rule:** If Pod Security Policies are enabled (`Values.podSecurityPolicy.enabled`), a rule is added to allow using the `podsecuritypolicies` resource with the generated resource name.
    * **Custom Rules:** If `Values.rbac.rules` is provided, it is rendered and included in the Role's rules.

## Dependencies
* This code depends on the Helm templating engine for rendering the YAML definition.

## Configuration
This code relies on values passed to the Helm template for configuration. See the "Inputs" section for details on the configurable values.
