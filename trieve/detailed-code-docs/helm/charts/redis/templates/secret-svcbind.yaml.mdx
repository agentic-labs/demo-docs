---
title: "secret-svcbind.yaml"
---

## High-level description
This code defines a Kubernetes Secret manifest for storing Redis connection details used by service bindings. It generates a secret containing the host, port, password, and URI for connecting to a Redis instance, depending on whether Sentinel is enabled. This secret is used to facilitate secure communication between applications and the Redis service.

## Code Structure
The code uses conditional logic based on Helm values to determine the appropriate configuration for the Redis connection details. It first checks if service bindings are enabled and then determines the host and port based on whether Sentinel is enabled. Finally, it constructs the secret data with the appropriate connection details.

## Symbols
### `helm/charts/redis/templates/secret-svcbind.yaml`
#### Description
This code defines a Kubernetes Secret manifest for storing Redis connection details used by service bindings. It generates a secret containing the host, port, password, and URI for connecting to a Redis instance.

#### Inputs
This code utilizes values from a Helm chart, including:
* `.Values.serviceBindings.enabled`: Boolean value indicating whether service bindings are enabled.
* `.Values.sentinel.enabled`: Boolean value indicating whether Redis Sentinel is enabled.
* `.Values.master.service.ports.redis`: Port number for the Redis master service.
* `.Values.sentinel.service.ports.redis`: Port number for the Redis Sentinel service.
* `.Values.commonLabels`: A dictionary of common labels to apply to the secret.
* `.Values.commonAnnotations`: A dictionary of common annotations to apply to the secret.

#### Outputs
The code generates a Kubernetes Secret manifest in YAML format. The secret contains the following data:
* `provider`: "bitnami"
* `type`: "redis"
* `host`: Hostname of the Redis instance.
* `port`: Port number of the Redis instance.
* `password`: Password for the Redis instance.
* `uri`: Connection URI for the Redis instance.

#### Internal Logic
1. **Conditional Rendering**: The template first checks if service bindings are enabled using `{{- if .Values.serviceBindings.enabled }}`. If not, the template renders nothing.
2. **Host and Port Determination**: It then determines the appropriate host and port based on whether Sentinel is enabled. If Sentinel is enabled, it uses the Sentinel service's hostname and port; otherwise, it uses the master service's hostname and port.
3. **Password Retrieval**: The code retrieves the Redis password using `{{- $password := include "redis.password" . }}`.
4. **Secret Data Generation**: Finally, it constructs the secret data with the determined host, port, password, and a generated connection URI. The URI is constructed differently depending on whether a password is set.

## Dependencies
This code depends on the following Helm template:
* `common.names.fullname`: Returns the full name of the release.
* `common.names.namespace`: Returns the namespace of the release.
* `common.labels.standard`: Returns a standard set of labels.
* `common.tplvalues.render`: Renders a template with the given values.
* `redis.password`: Returns the password for the Redis instance.

## Error Handling
This code does not implement specific error handling. Any errors during template rendering will be handled by the Helm engine. 
