---
title: "statefulset.yaml"
---

## High-level description
This YAML file defines a Kubernetes StatefulSet for deploying Redis Sentinel nodes in a replication architecture. It configures containers for the Redis server, Redis Sentinel, and optionally a Prometheus metrics exporter. The StatefulSet ensures each Redis Sentinel node has a unique identity and persistent storage.

## Code Structure
This code defines a Kubernetes StatefulSet resource using a YAML configuration file. It leverages various template functions and includes to dynamically generate resource specifications based on provided values. The StatefulSet defines containers for Redis, Sentinel, and optionally Prometheus metrics. It also configures volumes, probes, and other settings for these containers.

## References
This code references various template files and values from the Helm chart's values.yaml file. Some key references include:

* `common.capabilities.statefulset.apiVersion`: Determines the appropriate API version for the StatefulSet.
* `common.names.fullname`: Generates the full name of the release.
* `common.labels.standard`: Includes standard labels for the StatefulSet and its pods.
* `redis.image`: Retrieves the Docker image for the Redis container.
* `redis.sentinel.image`: Retrieves the Docker image for the Redis Sentinel container.
* `redis.metrics.image`: Retrieves the Docker image for the Prometheus metrics exporter container.
* `redis.secretName`: Retrieves the name of the secret containing the Redis password.
* `redis.tlsSecretName`: Retrieves the name of the secret containing TLS certificates.
* `common.tplvalues.render`: Renders template values based on the provided context.
* `common.affinities.pods`: Includes pod affinity and anti-affinity rules.
* `common.storage.class`: Includes storage class configuration for persistent volumes.

## Symbols
### `helm/charts/redis/templates/sentinel/statefulset.yaml`
#### Description
This YAML file defines a Kubernetes StatefulSet for deploying Redis Sentinel nodes. It configures two containers: one for the Redis server and one for Redis Sentinel. The StatefulSet ensures each Redis Sentinel node has a unique identity and persistent storage.

#### Inputs
This template uses values from `values.yaml`, including:

* `.Values.sentinel.enabled`: Whether Sentinel is enabled.
* `.Values.replica.replicaCount`: Number of Redis replicas and Sentinel instances.
* `.Values.replica.persistence`: Configuration for persistent storage of Redis data.
* `.Values.sentinel.persistence`: Configuration for persistent storage of Sentinel data.
* `.Values.auth.enabled`: Whether authentication is enabled.
* `.Values.tls.enabled`: Whether TLS is enabled.
* `.Values.metrics.enabled`: Whether Prometheus metrics are enabled.

#### Outputs
This template renders a Kubernetes YAML file defining a StatefulSet for Redis Sentinel.

#### Internal Logic
The template uses conditional logic to include or exclude certain sections based on the provided values. For example, it includes the Prometheus metrics container only if `.Values.metrics.enabled` is true. It also uses template functions to dynamically generate values, such as the image name and secret names.

## Dependencies
This code depends on the following Helm charts and Kubernetes resources:

| Dependency | Purpose |
|:-----------|:--------|
| `common` Helm chart | Provides common templates and functions for generating Kubernetes resources. |
| `redis` Helm chart | Provides templates and values specific to Redis deployment. |
| `StatefulSet` Kubernetes resource | Defines a set of pods with unique identities and persistent storage. |
| `ConfigMap` Kubernetes resource | Provides configuration data to pods. |
| `Secret` Kubernetes resource | Stores sensitive data, such as passwords and certificates. |
| `PersistentVolumeClaim` Kubernetes resource | Requests storage volumes for pods. |

### Configuration
This template uses values from `values.yaml` to configure the StatefulSet. Some key configuration options include:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `replica.replicaCount` | integer | `3` | Number of Redis replicas and Sentinel instances. |
| `replica.persistence.enabled` | boolean | `false` | Whether to enable persistent storage for Redis data. |
| `replica.persistence.size` | string | `10Gi` | Size of the persistent volume claim for Redis data. |
| `sentinel.persistence.enabled` | boolean | `false` | Whether to enable persistent storage for Sentinel data. |
| `sentinel.persistence.size` | string | `1Gi` | Size of the persistent volume claim for Sentinel data. |
| `auth.enabled` | boolean | `false` | Whether to enable password authentication. |
| `auth.password` | string | (random) | Password for Redis authentication. |
| `tls.enabled` | boolean | `false` | Whether to enable TLS. |
| `metrics.enabled` | boolean | `false` | Whether to enable Prometheus metrics. |


## Error Handling
This code does not implement specific error handling mechanisms. It relies on Kubernetes to handle errors during resource creation and deployment.

## Logging
This code does not implement specific logging mechanisms. It relies on the logging configurations of the deployed containers and Kubernetes.
