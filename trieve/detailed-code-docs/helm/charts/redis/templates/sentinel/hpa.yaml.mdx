---
title: "hpa.yaml"
---

## High-level description
This YAML file defines a Horizontal Pod Autoscaler (HPA) for Redis replica nodes in a Kubernetes cluster. It's designed to automatically scale the number of Redis replica pods based on CPU and memory utilization metrics.

## Code Structure
The file is a Kubernetes resource definition using Helm templating. It creates an HPA resource with metadata and spec sections, defining scaling parameters and metrics for Redis replica nodes.

## Symbols

### HorizontalPodAutoscaler
#### Description
Defines a Kubernetes HorizontalPodAutoscaler resource for Redis replica nodes.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| .Values.replica.autoscaling.enabled | boolean | Enables/disables autoscaling for replica nodes |
| .Values.sentinel.enabled | boolean | Enables/disables Redis Sentinel |
| .Values.replica.autoscaling.minReplicas | integer | Minimum number of replica pods |
| .Values.replica.autoscaling.maxReplicas | integer | Maximum number of replica pods |
| .Values.replica.autoscaling.targetMemory | integer | Target memory utilization percentage |
| .Values.replica.autoscaling.targetCPU | integer | Target CPU utilization percentage |

#### Internal Logic
1. Checks if both replica autoscaling and sentinel are enabled.
2. Sets metadata including name, namespace, labels, and annotations.
3. Defines the scale target as a StatefulSet for Redis replica nodes.
4. Specifies min and max replicas for scaling.
5. Configures scaling metrics based on memory and CPU utilization.
6. Adapts metric configuration based on Kubernetes version for compatibility.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| common.capabilities.hpa.apiVersion | Determines the appropriate API version for HPA |
| common.names.fullname | Generates the full name for resources |
| common.names.namespace | Retrieves the namespace |
| common.labels.standard | Generates standard labels |
| common.tplvalues.render | Renders template values |
| common.capabilities.deployment.apiVersion | Determines the appropriate API version for Deployment |
| common.capabilities.kubeVersion | Retrieves the Kubernetes version |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| replica.autoscaling.enabled | boolean | - | Enables autoscaling for replica nodes |
| sentinel.enabled | boolean | - | Enables Redis Sentinel |
| replica.autoscaling.minReplicas | integer | - | Minimum number of replica pods |
| replica.autoscaling.maxReplicas | integer | - | Maximum number of replica pods |
| replica.autoscaling.targetMemory | integer | - | Target memory utilization percentage |
| replica.autoscaling.targetCPU | integer | - | Target CPU utilization percentage |
| commonLabels | object | - | Additional labels to add to all resources |
| commonAnnotations | object | - | Additional annotations to add to all resources |

Note: This YAML template is part of a Helm chart for Redis, specifically for configuring autoscaling of Redis replica nodes when using Redis Sentinel. It provides flexible configuration options through Helm values and adapts to different Kubernetes versions for compatibility.