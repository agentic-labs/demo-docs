---
title: "hpa.yaml"
---

## High-level description
This code defines a Horizontal Pod Autoscaler (HPA) for Redis Sentinel nodes in a Kubernetes cluster. It scales the number of Sentinel replicas based on CPU or memory usage. The HPA is applied only if both replica autoscaling and Sentinel are enabled in the values.

## References
This code references several template helpers from the common library chart:
- `include "common.capabilities.hpa.apiVersion"`: Gets the appropriate API version for the HPA resource.
- `include "common.names.fullname"`: Generates the full name of the resource.
- `include "common.names.namespace"`: Gets the namespace for the resource.
- `include "common.labels.standard"`: Generates standard labels for the resource.
- `include "common.tplvalues.render"`: Renders template values.
- `include "common.capabilities.deployment.apiVersion"`: Gets the API version for deployments.
- `include "common.capabilities.kubeVersion"`: Gets the Kubernetes version.

## Symbols
### `hpa.yaml`
#### Description
This code defines a Horizontal Pod Autoscaler (HPA) for Redis Sentinel nodes. It scales the number of replicas based on CPU or memory usage, depending on the configuration.

#### Inputs
This code uses values from the `Values` object passed to the template. The relevant values are:
| Name | Type | Description |
|:-----|:-----|:------------|
| `.Values.replica.autoscaling.enabled` | boolean | Whether autoscaling for replicas is enabled. |
| `.Values.sentinel.enabled` | boolean | Whether Sentinel is enabled. |
| `.Values.replica.autoscaling.minReplicas` | integer | Minimum number of replicas. |
| `.Values.replica.autoscaling.maxReplicas` | integer | Maximum number of replicas. |
| `.Values.replica.autoscaling.targetMemory` | integer | Target memory utilization percentage. |
| `.Values.replica.autoscaling.targetCPU` | integer | Target CPU utilization percentage. |

#### Internal Logic
- The HPA is created only if both `.Values.replica.autoscaling.enabled` and `.Values.sentinel.enabled` are true.
- It targets the StatefulSet responsible for Redis Sentinel nodes.
- It defines scaling limits based on `minReplicas` and `maxReplicas`.
- It can scale based on either memory or CPU utilization, or both, depending on the values of `targetMemory` and `targetCPU`.
- The code uses `semverCompare` to determine the Kubernetes version and adjust the resource metric definition accordingly.

## Dependencies
This code depends on the common library chart for template helpers.

## Configuration
This code doesn't define any specific configuration options. It relies on the values passed to the template for configuration.
