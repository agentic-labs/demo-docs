---
title: "service.yaml"
---

## High-level description
This code defines a Kubernetes Service for Redis replicas in a replication architecture. It exposes the Redis replicas on a configurable port and allows for customization of service type, load balancing, session affinity, and other parameters. This service is only created if the architecture is set to "replication" and Sentinel is not enabled.

## Code Structure
This code defines a single Kubernetes Service resource. It uses conditional logic to include or exclude certain sections based on the values of configuration parameters.

## References
* `common.names.fullname`: Used to construct the service name.
* `common.names.namespace`: Used to specify the Kubernetes namespace.
* `common.labels.standard`: Used to generate standard labels for the service.
* `common.tplvalues.merge`: Used to merge annotations and pod labels.
* `common.tplvalues.render`: Used to render values from the provided context.
* `common.capabilities.kubeVersion`: Used to check the Kubernetes version.
* `common.labels.matchLabels`: Used to generate label selectors for the service.

## Symbols
### `helm/charts/redis/templates/replicas/service.yaml`
#### Description
This code defines a Kubernetes Service resource for Redis replicas. It is a template file that is rendered by Helm to generate the actual YAML manifest.

#### Inputs
This code uses values from the `Values` object, which is passed in by Helm during template rendering. Some of the key input values include:

| Name | Type | Description |
|:-----|:-----|:------------|
| `.Values.architecture` | string | The Redis architecture to use ("replication" or "standalone"). |
| `.Values.sentinel.enabled` | boolean | Whether Sentinel is enabled. |
| `.Values.replica.service.type` | string | The type of Kubernetes Service to create (e.g., "ClusterIP", "NodePort", "LoadBalancer"). |
| `.Values.replica.service.ports.redis` | int | The port number to expose Redis on. |
| `.Values.replica.service.nodePorts.redis` | int | The node port to use if `service.type` is "NodePort" or "LoadBalancer". |
| `.Values.replica.service.externalTrafficPolicy` | string | The external traffic policy to use for the service. |
| `.Values.replica.service.internalTrafficPolicy` | string | The internal traffic policy to use for the service. |
| `.Values.replica.service.loadBalancerIP` | string | The static IP address to assign to the service if `service.type` is "LoadBalancer". |
| `.Values.replica.service.loadBalancerClass` | string | The load balancer class to use if `service.type` is "LoadBalancer". |
| `.Values.replica.service.loadBalancerSourceRanges` | list | A list of IP address ranges that are allowed to access the service if `service.type` is "LoadBalancer". |
| `.Values.replica.service.clusterIP` | string | The cluster IP address to assign to the service if `service.type` is "ClusterIP". |
| `.Values.replica.service.sessionAffinity` | string | The session affinity mode to use for the service. |
| `.Values.replica.service.sessionAffinityConfig` | map | Configuration options for session affinity. |
| `.Values.replica.service.extraPorts` | list | A list of additional ports to expose on the service. |
| `.Values.replica.podLabels` | map | Custom labels to apply to the Redis replica pods. |
| `.Values.commonLabels` | map | Common labels to apply to all resources. |
| `.Values.commonAnnotations` | map | Common annotations to apply to all resources. |

#### Outputs
This code generates a Kubernetes Service resource definition in YAML format.

#### Internal Logic
The code uses conditional logic (if statements) to include or exclude certain sections of the service definition based on the values of configuration parameters. For example, the `nodePort` field is only included if the `service.type` is set to "NodePort" or "LoadBalancer".

## Side Effects
This code defines a Kubernetes Service resource, which will be created in the cluster when the Helm chart is deployed.

## Dependencies
* Kubernetes

### Configuration
This code relies on configuration values passed in through the `Values` object. See the "Inputs" section for a description of the available configuration options.
