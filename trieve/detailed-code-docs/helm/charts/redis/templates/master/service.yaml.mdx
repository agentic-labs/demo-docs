---
title: "service.yaml"
---

## High-level description
This code defines a Kubernetes Service for Redis master nodes. It exposes the Redis master nodes on a configurable service type (ClusterIP, NodePort, or LoadBalancer) and allows for customization of service parameters like external traffic policy, load balancer configuration, and session affinity. The service is only created if Sentinel is disabled and there is at least one Redis master node.

## Code Structure
The code uses a series of nested `if` statements to conditionally render different parts of the service definition based on the provided values. It leverages various template functions like `include`, `printf`, `semverCompare`, and `toYaml` to generate the final YAML output.

## References
* `common.names.fullname`: Generates the full name of the service.
* `common.names.namespace`: Retrieves the namespace for the service.
* `common.labels.standard`: Generates standard labels for the service.
* `common.tplvalues.merge`: Merges multiple values into a single dictionary.
* `common.tplvalues.render`: Renders a template value.
* `common.capabilities.kubeVersion`: Retrieves the Kubernetes version.
* `common.labels.matchLabels`: Generates label selectors for the service.

## Symbols
### `helm/charts/redis/templates/master/service.yaml`
#### Description
This file defines a Kubernetes Service resource for Redis master nodes. It allows for customization of various service parameters through values passed to the Helm chart.

#### Inputs
This code snippet doesn't have explicit input parameters. It relies on values passed to the Helm chart during deployment.

#### Outputs
The code generates a Kubernetes YAML manifest for a Service object.

#### Internal Logic
1. **Conditional Rendering:** The code uses multiple `if` statements to conditionally render different parts of the service definition based on the provided values.
2. **Template Functions:** It leverages various template functions like `include`, `printf`, `semverCompare`, and `toYaml` to generate the final YAML output.
3. **Service Configuration:** The code configures the service type, external traffic policy, load balancer settings, session affinity, and ports based on the provided values.
4. **Labels and Selectors:** It uses template functions to generate standard labels and selectors for the service, ensuring proper identification and routing of traffic.

## Side Effects
This code, when deployed, will create a new Kubernetes Service object in the specified namespace.

## Dependencies
* Kubernetes

## Configuration
This code relies on values passed to the Helm chart during deployment. Some of the key configurable options include:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `sentinel.enabled` | bool |  | Enables or disables Redis Sentinel. The service is only created if Sentinel is disabled. |
| `master.count` | int | | Number of Redis master nodes. The service is only created if there is at least one master node. |
| `master.service.type` | string | | Type of Kubernetes service (e.g., ClusterIP, NodePort, LoadBalancer). |
| `master.service.externalTrafficPolicy` | string | | Policy for external traffic routing (e.g., Cluster, Local). |
| `master.service.internalTrafficPolicy` | string | | Policy for internal traffic routing (e.g., Cluster, Local). Available in Kubernetes 1.22+. |
| `master.service.loadBalancerIP` | string | | Static IP address to assign to the load balancer. |
| `master.service.loadBalancerClass` | string | | Load balancer class to use for the service. |
| `master.service.loadBalancerSourceRanges` | list | | List of IP CIDR ranges allowed to access the load balancer. |
| `master.service.clusterIP` | string | | ClusterIP address to assign to the service. |
| `master.service.sessionAffinity` | string | | Session affinity mode (e.g., None, ClientIP). |
| `master.service.sessionAffinityConfig` | map | | Configuration for session affinity. |
| `master.service.externalIPs` | list | | List of external IPs to assign to the service. |
| `master.service.ports.redis` | int | | Port number for the Redis service. |
| `master.service.nodePorts.redis` | int | | NodePort to expose the Redis service on. |
| `master.service.extraPorts` | list | | List of additional ports to expose on the service. |
| `master.podLabels` | map | | Custom labels to apply to the Redis master pods. |
| `commonLabels` | map | | Common labels to apply to all resources. |

## Error Handling
This code snippet doesn't implement specific error handling.

## Logging
This code snippet doesn't implement logging.
