---
title: "serviceaccount.yaml"
---

## High-level description
This code defines a Kubernetes ServiceAccount named `redis.masterServiceAccountName` for the Redis master pod in a Helm chart. It's conditionally created based on chart values: it's created only if `master.serviceAccount.create` is true, the architecture is "replication", and Sentinel is not enabled.

## Code Structure
The code uses conditional logic to determine whether to create the ServiceAccount resource. It leverages Helm templating to dynamically generate resource names, labels, and annotations.

## References
* `redis.masterServiceAccountName`: Refers to a Helm template that generates the service account name.
* `common.names.namespace`: Refers to a Helm template that provides the target namespace.
* `common.labels.standard`: Refers to a Helm template that generates standard labels.
* `common.tplvalues.merge`: Refers to a Helm template that merges annotations.
* `common.tplvalues.render`: Refers to a Helm template that renders annotation values.

## Symbols
### `serviceaccount.yaml`
#### Description
This code defines a Kubernetes ServiceAccount resource for the Redis master pod. It uses Helm templating to dynamically generate resource values based on chart configuration.

#### Inputs
This code snippet doesn't have explicit input parameters. It relies on values passed to the Helm chart.

#### Outputs
A Kubernetes YAML manifest defining a ServiceAccount resource if the conditions are met.

#### Internal Logic
1. **Conditional Creation:** The ServiceAccount is created only if:
    * `Values.master.serviceAccount.create` is true.
    * `Values.architecture` is "replication".
    * `Values.sentinel.enabled` is false.
2. **Resource Definition:** If the conditions are met, it defines a ServiceAccount resource with the following:
    * `apiVersion`: v1
    * `kind`: ServiceAccount
    * `automountServiceAccountToken`: Value from `Values.master.serviceAccount.automountServiceAccountToken`.
    * `metadata`:
        * `name`: Generated using the `redis.masterServiceAccountName` template.
        * `namespace`: Fetched using the `common.names.namespace` template.
        * `labels`: Generated using the `common.labels.standard` template.
        * `annotations`: Merged and rendered from `Values.master.serviceAccount.annotations` and `Values.commonAnnotations` if either is provided.

## Dependencies
This code depends on the Helm templating engine for rendering the final YAML manifest.

## Configuration
This code relies on the following configuration options passed via Helm values:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `master.serviceAccount.create` | boolean |  | Whether to create the ServiceAccount. |
| `architecture` | string |  | The Redis deployment architecture ("replication" or other). |
| `sentinel.enabled` | boolean |  | Whether Redis Sentinel is enabled. |
| `master.serviceAccount.automountServiceAccountToken` | boolean |  | Whether to automatically mount the service account token. |
| `master.serviceAccount.annotations` | object |  | Custom annotations for the ServiceAccount. |
| `commonAnnotations` | object |  | Common annotations to be applied to resources. |
