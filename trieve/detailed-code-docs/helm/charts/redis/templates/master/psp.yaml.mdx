---
title: "psp.yaml"
---

## High-level description
This code defines a Kubernetes Pod Security Policy (PSP) for Redis master pods in a Helm chart. It specifies security restrictions like disallowing privilege escalation, enforcing specific user and group IDs, and limiting allowed volume types. This policy enhances the security posture of deployed Redis master instances.

## References
This code references other parts of the Helm chart, including:
* `"common.capabilities.psp.supported"`: Checks if PSPs are supported in the current environment.
* `"common.names.fullname"`: Retrieves the full name for the Redis deployment.
* `"common.names.namespace"`: Retrieves the namespace for the Redis deployment.
* `"common.labels.standard"`: Includes standard labels for the Redis deployment.
* `"common.tplvalues.render"`: Renders template values for annotations.
* `.Values.podSecurityPolicy.create`: Checks if the PSP should be created.
* `.Values.commonLabels`: Retrieves custom labels for the deployment.
* `.Values.commonAnnotations`: Retrieves custom annotations for the deployment.
* `.Values.master.podSecurityContext.fsGroup`: Retrieves the desired fsGroup for Redis master pods.
* `.Values.master.containerSecurityContext.runAsUser`: Retrieves the desired user ID for running the Redis master container.

## Symbols
### `psp.yaml`
#### Description
This YAML file defines a Pod Security Policy named `&lt;release-name&gt;-master` for Redis master pods. It enforces various security constraints to limit the pod's privileges and capabilities.

#### Inputs
This code snippet doesn't have explicit input parameters. It relies on values passed from the Helm chart engine during deployment.

#### Outputs
This code defines a Kubernetes PodSecurityPolicy object. When applied, it enforces the defined security restrictions on any Redis master pod created within the specified namespace.

#### Internal Logic
The policy definition includes:
* **Disabling privilege escalation:** `allowPrivilegeEscalation: false` prevents containers from gaining more privileges than their assigned user.
* **Restricting fsGroup:** `fsGroup` enforces that the pod must run with a specific group ID, limiting access to shared volumes.
* **Disabling host resources:** `hostIPC`, `hostNetwork`, and `hostPID` are set to `false` to prevent the pod from accessing host resources directly.
* **Disabling privileged mode:** `privileged: false` prevents the pod from running with root privileges.
* **Enforcing read-only root filesystem:** `readOnlyRootFilesystem: false` allows write access to the root filesystem within the pod.
* **Dropping capabilities:** `requiredDropCapabilities` drops all Linux capabilities from the container, further reducing its privileges.
* **Restricting runAsUser:** `runAsUser` enforces that the container must run with a specific user ID.
* **Allowing any SELinux context:** `seLinux` allows the pod to run with any SELinux context.
* **Restricting supplemental groups:** `supplementalGroups` limits the additional groups the pod can belong to.
* **Allowing specific volume types:** `volumes` whitelists the allowed volume types for the pod.

## Dependencies
This code depends on the Kubernetes API version `policy/v1beta1` for the PodSecurityPolicy object definition.

## Configuration
This code relies on values passed from the Helm chart during deployment. These values, prefixed with `.Values`, configure various aspects of the Pod Security Policy, such as user IDs, group IDs, and allowed volume types.
