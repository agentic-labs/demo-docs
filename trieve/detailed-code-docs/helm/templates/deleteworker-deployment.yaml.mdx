---
title: "deleteworker-deployment.yaml"
---

## High-level description
This code defines a Kubernetes Deployment for a "delete-worker" service. It specifies the container image, environment variables, and resource requirements for the service. The deployment is configured to run in different environments (local, gcloud) with specific settings for each.

## Code Structure
The code is a single YAML file defining a Kubernetes Deployment resource. It includes metadata, specifications for pod selection, and a template for the pod itself. The template defines container specifications, environment variables, and optional sidecar containers based on the environment.

## Symbols
### `deleteworker-deployment.yaml`
#### Description
This YAML file defines a Kubernetes Deployment for the "delete-worker" service. It specifies the container image, environment variables, and resource requirements for the service. The deployment is configured to run in different environments (local, gcloud) with specific settings for each.

#### Inputs
This YAML file takes input from Helm values defined in `values.yaml`.

#### Outputs
This file generates a Kubernetes Deployment object.

#### Internal Logic
- **Metadata:** Defines the name and labels for the deployment.
- **Selector:** Specifies how to select pods belonging to this deployment using labels.
- **Template:** Defines the pod template for the deployment, including:
    - **Metadata:** Labels for the pod.
    - **Spec:** Pod specifications, including:
        - **Service Account:** Specifies the service account to use for the pod (for gcloud environment).
        - **Containers:** Defines the containers to run in the pod:
            - **delete-worker:** The main container for the delete-worker service.
                - **Image:** Specifies the container image to use, dynamically built based on the environment.
                - **Env:** Defines environment variables for the container, including API keys, server URLs, database connection details, and other configuration parameters.
            - **cloud-sql-proxy:** An optional sidecar container for connecting to Cloud SQL (for gcloud environment).
                - **Image:** Specifies the Cloud SQL Proxy image.
                - **Args:** Arguments for the Cloud SQL Proxy, including authentication and connection details.
                - **Security Context:** Runs the container as a non-root user.
                - **Resources:** Resource requests and limits for the container.

## Dependencies
This deployment relies on the following external dependencies:

| Dependency | Purpose |
|:-----------|:--------|
| `trieve/delete_worker` | The Docker image for the delete-worker service. |
| `gcr.io/cloud-sql-connectors/cloud-sql-proxy` | The Cloud SQL Proxy image for connecting to Cloud SQL in the gcloud environment. |

## Configuration
The deployment is configured using Helm values defined in `values.yaml`. These values include:

- **environment:** The environment in which the deployment is running (local, gcloud).
- **containers.delete_worker.tag:** The tag for the delete-worker container image.
- **config:** Configuration parameters for various services, including Trieve, Redis, Qdrant, PostgreSQL, SMTP, OpenAI, S3, Stripe, and OIDC.

## Error Handling
The deployment does not implement specific error handling mechanisms beyond the standard Kubernetes pod lifecycle management.

## Logging
The deployment does not define specific logging mechanisms. Logging is handled by the containers themselves.
