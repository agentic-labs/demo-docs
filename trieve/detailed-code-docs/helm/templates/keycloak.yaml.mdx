---
title: "keycloak.yaml"
---

## High-level description
This code defines the Kubernetes configuration for deploying a Keycloak instance in a local development environment. It includes a Service, Deployment, and Ingress resource for exposing Keycloak.

## Code Structure
The code uses conditional logic to apply the configuration only when the `environment` value is set to "local". It defines a Service to expose Keycloak internally, a Deployment to manage the Keycloak pod, and an Ingress to make Keycloak accessible externally.

## References
This code references the following values from the `values.yaml` file:
- `.Values.environment`: Used to determine if the configuration should be applied.
- `.Values.domain`: Used to construct the `KC_HOSTNAME` environment variable.

## Symbols
### `keycloak` (Service)
#### Description
This Service exposes the Keycloak deployment on port 80 using a LoadBalancer.

#### Inputs
N/A

#### Outputs
N/A

### `keycloak` (Deployment)
#### Description
This Deployment manages a single replica of the Keycloak pod. It mounts a ConfigMap named `keycloak-realm-export` to `/opt/keycloak/data/import` for importing realm configurations.

#### Inputs
N/A

#### Outputs
N/A

#### Internal Logic
- Uses the `quay.io/keycloak/keycloak:25.0.2` image for the Keycloak container.
- Starts Keycloak in development mode (`start-dev`) and imports realm configurations (`--import-realm`).
- Sets environment variables for Keycloak configuration, including database connection details and hostname settings.
- Defines a readiness probe that checks the `/realms/master` path on port 8080.

### `keycloak-ingress` (Ingress)
#### Description
This Ingress resource exposes the Keycloak service externally using the `nginx` ingress controller.

#### Inputs
N/A

#### Outputs
N/A

#### Internal Logic
- Uses the hostname `auth.localtrieve.com` to route traffic to the Keycloak service.
- Forwards all traffic (`/`) to the `keycloak` service on port 8080.

## Dependencies
N/A

## Configuration
This code relies on values defined in the `values.yaml` file:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| environment | string | N/A | Determines if this configuration is applied (must be "local"). |
| domain | string | N/A | Used to construct the `KC_HOSTNAME` environment variable. |

## Error Handling
N/A

## Logging
N/A

## API/Interface Reference
N/A
