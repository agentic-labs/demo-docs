---
title: "ingress-gcloud.yaml"
---

## High-level description
This code defines Kubernetes Ingress resources and NetworkPolicy resources for a Google Cloud environment. It sets up routing rules for various services (dashboard, chat, server, search) based on the hostnames and paths of incoming HTTP requests. Additionally, it configures network policies to allow all ingress and egress traffic for all pods.

## Code Structure
This code defines multiple Kubernetes YAML resources within a single file. Each resource is defined within a "---" separator. The resources are conditionally deployed based on the value of the "environment" variable. If the environment is "gcloud", then all the resources are deployed.

## Symbols
### `ingress-dashboard`
#### Description
This section defines an Ingress resource named "ingress-dashboard" that routes traffic to the "dashboard-service" on port 80. It's intended for a Google Cloud environment and uses the "gce" ingress class.

#### Inputs
This resource takes input from the `values.yaml` file.
| Name | Type | Description |
|:-----|:-----|:------------|
| domain | string | The domain name used for routing traffic. |

#### Internal Logic
The Ingress resource uses the `dashboard.{{ $domain }}` hostname to match incoming requests. When a request matches, it forwards the traffic to the `dashboard-service` on port 80.

### `ingress-chat`
#### Description
This section defines an Ingress resource named "ingress-chat" that routes traffic to the "chat-service" on port 3000. It's intended for a Google Cloud environment and uses the "gce" ingress class.

#### Inputs
This resource takes input from the `values.yaml` file.
| Name | Type | Description |
|:-----|:-----|:------------|
| domain | string | The domain name used for routing traffic. |

#### Internal Logic
The Ingress resource uses the `chat.{{ $domain }}` hostname to match incoming requests. When a request matches, it forwards the traffic to the `chat-service` on port 3000.

### `ingress-server`
#### Description
This section defines an Ingress resource named "ingress-server" that routes traffic to the "server-service" on port 8090. It's intended for a Google Cloud environment and uses the "gce" ingress class.

#### Inputs
This resource takes input from the `values.yaml` file.
| Name | Type | Description |
|:-----|:-----|:------------|
| domain | string | The domain name used for routing traffic. |

#### Internal Logic
The Ingress resource uses the `api.{{ $domain }}` hostname to match incoming requests. When a request matches, it forwards the traffic to the `server-service` on port 8090.

### `ingress-search`
#### Description
This section defines an Ingress resource named "ingress-search" that routes traffic to the "search-service" on port 3001. It's intended for a Google Cloud environment and uses the "gce" ingress class.

#### Inputs
This resource takes input from the `values.yaml` file.
| Name | Type | Description |
|:-----|:-----|:------------|
| domain | string | The domain name used for routing traffic. |

#### Internal Logic
The Ingress resource uses the `search.{{ $domain }}` hostname to match incoming requests. When a request matches, it forwards the traffic to the `search-service` on port 3001.

### `allow-all-ingress`
#### Description
This section defines a NetworkPolicy resource named "allow-all-ingress" that allows all ingress traffic to all pods.

#### Internal Logic
The NetworkPolicy resource uses an empty `podSelector` to select all pods and an empty ingress rule to allow all incoming traffic.

### `allow-all-egress`
#### Description
This section defines a NetworkPolicy resource named "allow-all-egress" that allows all egress traffic from all pods.

#### Internal Logic
The NetworkPolicy resource uses an empty `podSelector` to select all pods and an empty egress rule to allow all outgoing traffic.

## Configuration
This code snippet uses values from a `values.yaml` file. The following table describes the configuration options:

| Option | Type | Description |
|:-------|:-----|:------------|
| domain | string | The base domain name used for routing traffic to different services. |
| environment | string | The environment this configuration is for. This code is applied only when the environment is "gcloud". |
