---
title: "clustering-cronjob.yaml"
---

## High-level description
This code defines a Kubernetes CronJob named `clustering-cronjob` that runs a containerized task on an hourly schedule. The task, using the image `trieve/clickhouse-clustering:latest`, is designed to perform clustering operations, likely related to data management within a ClickHouse database.

## Symbols
### `clustering-cronjob`
#### Description
This symbol defines a Kubernetes CronJob resource responsible for scheduling and running a containerized task on an hourly basis.

#### Inputs
This symbol does not take direct inputs. It relies on configuration values provided through Helm values (`.Values`) when the YAML file is deployed.

#### Outputs
This symbol does not produce direct outputs. It creates a Kubernetes CronJob object upon deployment.

#### Internal Logic
- **`schedule: "0 * * * *"`**: This Cron expression defines the job's schedule, which translates to running the job every hour at the 0th minute.
- **`jobTemplate`**: This section defines the template for the Jobs that the CronJob creates.
    - **`spec.template.spec.containers`**: This section defines the container to be run within the Job's Pod.
        - **`name: clustering-task`**:  Assigns the name "clustering-task" to the container.
        - **`image: trieve/clickhouse-clustering:latest`**: Specifies the Docker image to be used for the container.
        - **`imagePullPolicy: IfNotPresent`**: Instructs Kubernetes to pull the image only if it's not already present in the local repository.
        - **`env`**: Defines environment variables for the container.
            - **`ANTHROPIC_API_KEY`**:  An API key, likely for Anthropic services, passed from the Helm values (`.Values.config.trieve.anthropicAPIKey`).
            - **`CLICKHOUSE_DSN`**:  A ClickHouse Data Source Name, passed from the Helm values (`.Values.config.trieve.clickhouseDSN`), used to connect to a ClickHouse database.
- **`restartPolicy: OnFailure`**: This setting ensures that the Job's Pod will be restarted if the container exits with a non-zero exit code, indicating a failure.

## Dependencies
- **Kubernetes:** This code defines Kubernetes resources (CronJob) and relies on Kubernetes for scheduling and execution.
- **Helm:** The code uses Helm templating syntax (e.g., `.Values`) to inject configuration values during deployment.

## Configuration
This code relies on Helm values for configuration. The following values are used:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `.Values.config.trieve.anthropicAPIKey` | string | N/A | API key for Anthropic services. |
| `.Values.config.trieve.clickhouseDSN` | string | N/A | ClickHouse Data Source Name for database connection. |
