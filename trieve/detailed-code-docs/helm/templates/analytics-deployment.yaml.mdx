---
title: "analytics-deployment.yaml"
---

## High-level description
This code defines a Kubernetes Deployment for an "analytics" service. It specifies how the service should be deployed, including container image, ports, and environment variables. The deployment is configured using values from a Helm chart, allowing for customization based on the environment.

## References
This code references values from a Helm chart, including:
- `.Release.Name`: The name of the Helm release.
- `.Values.environment`: The target environment (e.g., "local").
- `.Values.containers.analytics.tag`: The Docker tag for the analytics container image.
- `.Values.config.vite.apiHost`: The hostname of the API used by the analytics service.
- `.Values.config.vite.dashboardUrl`: The URL of the dashboard used by the analytics service.

## Symbols
### `analytics` Deployment
#### Description
This deployment defines how the "analytics" service should be deployed to a Kubernetes cluster. It specifies the container image, port mappings, environment variables, and other configuration options.

#### Inputs
This deployment does not take direct inputs. It relies on values provided by a Helm chart during deployment.

#### Outputs
This deployment creates a Kubernetes Deployment object that manages the lifecycle of the "analytics" service pods.

#### Internal Logic
The deployment uses a selector to identify pods labeled with `app.kubernetes.io/name: analytics` and `app.kubernetes.io/instance: {{ .Release.Name }}`. It defines a single container named "analytics" with the following specifications:
- **Image:** The image is dynamically constructed based on the environment. For the "local" environment, it uses `localhost:5001/analytics-site`, otherwise it uses `trieve/analytics-site`. The image tag is appended from `.Values.containers.analytics.tag`.
- **Ports:** Exposes container port 80.
- **Environment Variables:**
    - `VITE_API_HOST`: Sets the API hostname from `.Values.config.vite.apiHost`.
    - `VITE_DASHBOARD_URL`: Sets the dashboard URL from `.Values.config.vite.dashboardUrl`.

## Dependencies
This code depends on Kubernetes and Helm.

### Configuration
This deployment is configured using values from a Helm chart. The following values are used:
| Option | Type | Description |
|:-------|:-----|:------------|
| `.Release.Name` | string | The name of the Helm release. |
| `.Values.environment` | string | The target environment (e.g., "local"). |
| `.Values.containers.analytics.tag` | string | The Docker tag for the analytics container image. |
| `.Values.config.vite.apiHost` | string | The hostname of the API used by the analytics service. |
| `.Values.config.vite.dashboardUrl` | string | The URL of the dashboard used by the analytics service. |
