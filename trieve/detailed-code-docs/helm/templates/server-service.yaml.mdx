---
title: "server-service.yaml"
---

## High-level description
This code defines a Kubernetes Service named "server-service" that exposes a server application running in a Kubernetes cluster. It also conditionally creates a Google Cloud BackendConfig for health checks when deployed to Google Cloud Platform (GCP).

## Code Structure
The code uses conditional logic to define a BackendConfig resource only when the `environment` value is set to "gcloud". The BackendConfig is then referenced in the Service's annotations to configure health checks.

## Symbols

### `server-service.yaml`
#### Description
This code defines a Kubernetes Service and, conditionally, a Google Cloud BackendConfig. The service exposes a server application on port 8090, and the BackendConfig configures health checks for the service when deployed to GCP.

#### Inputs
This code snippet takes its input from values passed in by Helm during deployment. The most important input is:

| Name | Type | Description |
|:-----|:-----|:------------|
| $.Values.environment | string | The deployment environment. If set to "gcloud", a BackendConfig is created. |

#### Outputs
This code defines two Kubernetes resources:

* **Service:** Exposes the server application on port 8090 within the cluster.
* **BackendConfig (conditional):** Configures health checks for the service when deployed to GCP.

#### Internal Logic
1. **Define template variables:**
   - `$name`: Sets the name of the service to "server-service".
   - `$selector`: Sets the selector label to "server".
2. **Conditional BackendConfig creation:**
   - An `if` block checks if `$.Values.environment` is equal to "gcloud".
   - If true, it defines a BackendConfig resource named "server-backend-config" with a health check on port 8090 at the path "/api/health".
3. **Service definition:**
   - Defines a Service resource named "server-service".
   - Sets annotations to link the service with the BackendConfig (if created) for health checks.
   - Sets labels for service identification.
   - Specifies `ClusterIP` type to expose the service internally within the cluster.
   - Defines a port mapping for the service (port 8090).
   - Sets selectors to target pods with specific labels.

## Dependencies
This code depends on Kubernetes and, conditionally, Google Cloud Platform.

### Configuration
The code's behavior can be configured using Helm values:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| environment | string | N/A | Determines whether a BackendConfig is created. Set to "gcloud" to enable. |


## API/Interface Reference
This code does not define an API or public interface. It defines Kubernetes resources. 
