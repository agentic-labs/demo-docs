---
title: "ingress-aws.yaml"
---

## High-level description
This Kubernetes YAML file defines Ingress resources for a Trive application deployed on AWS using an Application Load Balancer (ALB). It also includes NetworkPolicy resources to allow all ingress and egress traffic. The Ingress resources route traffic from specific hostnames to corresponding services within the cluster.

## Code Structure
This code defines multiple Kubernetes objects within a single YAML file. Each object is delimited by `---`. The objects are:
- **Ingress:** Defines rules for routing external traffic to services within the cluster. There are five Ingress objects defined, one for each of the following services: `dashboard-service`, `chat-service`, `server-service`, and `search-service`.
- **NetworkPolicy:** Defines network traffic rules for pods in the cluster. There are two NetworkPolicy objects defined, one to allow all ingress traffic and one to allow all egress traffic.

## Symbols
### `ingress-dashboard`
#### Description
This Ingress resource configures an ALB to route traffic from `dashboard.{domain}` to the `dashboard-service` service on port 80.

#### Inputs
This Ingress resource takes the following input from values:
| Name | Type | Description |
|:-----|:-----|:------------|
| domain | string | The domain name used for the application. |

#### Internal Logic
- It sets the Ingress class to `alb` to use an ALB.
- It sets the target type to `ip` to route traffic to the service's IP address.
- It sets the scheme to `internet-facing` to make the service accessible from the internet.
- It uses an annotation to set the hostname for external DNS to `dashboard.{domain}`.
- It defines a rule that matches the hostname `dashboard.{domain}` and routes traffic to the root path `/` on the `dashboard-service` service.

### `ingress-chat`
#### Description
This Ingress resource configures an ALB to route traffic from `chat.{domain}` to the `chat-service` service on port 3000.

#### Inputs
This Ingress resource takes the following input from values:
| Name | Type | Description |
|:-----|:-----|:------------|
| domain | string | The domain name used for the application. |

#### Internal Logic
- It sets the Ingress class to `alb` to use an ALB.
- It sets the target type to `ip` to route traffic to the service's IP address.
- It sets the scheme to `internet-facing` to make the service accessible from the internet.
- It uses an annotation to set the hostname for external DNS to `chat.{domain}`.
- It defines a rule that matches the hostname `chat.{domain}` and routes traffic to the root path `/` on the `chat-service` service.

### `ingress-server`
#### Description
This Ingress resource configures an ALB to route traffic from `api.{domain}` to the `server-service` service on port 8090. It also configures a health check path and port for the ALB.

#### Inputs
This Ingress resource takes the following input from values:
| Name | Type | Description |
|:-----|:-----|:------------|
| domain | string | The domain name used for the application. |

#### Internal Logic
- It sets the Ingress class to `alb` to use an ALB.
- It sets the target type to `ip` to route traffic to the service's IP address.
- It sets the scheme to `internet-facing` to make the service accessible from the internet.
- It uses annotations to set the hostname for external DNS to `api.{domain}`, the health check path to `/api/health`, and the health check port to `8090`.
- It defines a rule that matches the hostname `api.{domain}` and routes traffic to the root path `/` on the `server-service` service.

### `ingress-search`
#### Description
This Ingress resource configures an ALB to route traffic from `search.{domain}` to the `search-service` service on port 3001.

#### Inputs
This Ingress resource takes the following input from values:
| Name | Type | Description |
|:-----|:-----|:------------|
| domain | string | The domain name used for the application. |

#### Internal Logic
- It sets the Ingress class to `alb` to use an ALB.
- It sets the target type to `ip` to route traffic to the service's IP address.
- It sets the scheme to `internet-facing` to make the service accessible from the internet.
- It uses an annotation to set the hostname for external DNS to `search.{domain}`.
- It defines a rule that matches the hostname `search.{domain}` and routes traffic to the root path `/` on the `search-service` service.

### `allow-all-ingress`
#### Description
This NetworkPolicy resource allows all ingress traffic to all pods in the cluster.

#### Internal Logic
- It selects all pods with an empty pod selector.
- It allows ingress traffic from all sources with an empty ingress rule.

### `allow-all-egress`
#### Description
This NetworkPolicy resource allows all egress traffic from all pods in the cluster.

#### Internal Logic
- It selects all pods with an empty pod selector.
- It allows egress traffic to all destinations with an empty egress rule.

## Configuration
This code snippet uses a conditional statement `{{- if (eq .Values.environment "aws") }}` to apply the Ingress and NetworkPolicy resources only when the `environment` value is set to `aws`. This suggests that there might be different configurations for other environments.

## Dependencies
This code depends on the following Kubernetes resources:
- **Application Load Balancer (ALB) Ingress Controller:** It uses annotations specific to the ALB Ingress Controller to configure the load balancer.
- **External DNS:** It uses annotations to manage DNS records for the defined hostnames.

## Error Handling
This code does not implement specific error handling mechanisms.

## Logging
This code does not implement logging.
