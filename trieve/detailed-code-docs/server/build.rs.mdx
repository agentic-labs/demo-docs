---
title: "build.rs"
---

## High-level description
This code is a build script for a Rust project that sets environment variables for the compiler using values from a `.env` file. It conditionally executes different logic based on the presence of a feature flag `runtime-env`.

## Code Structure
The code consists of two `main` functions, each conditionally compiled based on the `runtime-env` feature flag. The non-runtime-env version reads environment variables from a `.env` file and sets them for the Rust compiler. The runtime-env version does nothing.

## Symbols

### `main`
#### Description
This function is the entry point for the build script. It reads environment variables from a `.env` file and sets them as `cargo:rustc-env` variables, which makes them accessible to the Rust compiler during build time.

#### Inputs
None

#### Outputs
- Prints `cargo:rustc-env={key}={value}` for each environment variable read from the `.env` file.
- Prints `cargo:rerun-if-changed=.env` to trigger a rebuild if the `.env` file changes.

#### Internal Logic
1. **Read environment variables:** Uses the `dotenvy` crate to read environment variables from a `.env` file located in the project root.
2. **Set environment variables for the compiler:** Iterates through the read environment variables and prints them in the format `cargo:rustc-env={key}={value}`. This makes these variables accessible to the Rust compiler during the build process.
3. **Trigger rebuild on `.env` file change:** Prints `cargo:rerun-if-changed=.env` to instruct Cargo to rebuild the project if the `.env` file is modified.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| `dotenv` | Used to read environment variables from a `.env` file. |

## Configuration
This build script relies on a `.env` file in the project root for configuration. The format of the `.env` file follows the standard key-value pair format, e.g., `KEY=value`.

## Error Handling
The code uses `expect` for error handling, which will terminate the build process and print an error message if the `.env` file is not found or cannot be read.
