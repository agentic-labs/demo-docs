---
title: "event_operator.rs"
---

## High-level description
This code defines the `get_events` function, which is an API endpoint handler for retrieving events associated with a specific dataset. It processes the request parameters, calls the `get_events_query` function to fetch the events, and returns the results as a JSON response.

## Code Structure
The main function `get_events` takes several parameters including user authentication, dataset information, request data, and a Clickhouse client. It uses these to fetch and return events based on the specified criteria.

## Symbols

### `GetEventsData`
#### Description
A struct that represents the request payload for getting events.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| page | Option&lt;i64&gt; | The page number to get (optional, default is 1) |
| page_size | Option&lt;i64&gt; | The number of items per page (optional, default is 10) |
| event_types | Option&lt;Vec&lt;EventTypeRequest&gt;&gt; | The types of events to get (optional) |

### `get_events`
#### Description
An asynchronous function that handles the GET request for events.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| _user | LoggedUser | The authenticated user (unused in the function body) |
| dataset_org_plan_sub | DatasetAndOrgWithSubAndPlan | Dataset and organization information |
| get_events_data | web::Json&lt;GetEventsData&gt; | The request payload |
| clickhouse_client | web::Data&lt;clickhouse::Client&gt; | The Clickhouse database client |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Result | Result&lt;HttpResponse, actix_web::Error&gt; | HTTP response with events or an error |

#### Internal Logic
1. Determine the event types to fetch based on the request payload.
2. Call `get_events_query` with the dataset ID, pagination parameters, event types, and Clickhouse client.
3. Return the events as a JSON response or an error if the query fails.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| actix_web | Web framework for handling HTTP requests and responses |
| serde | Serialization and deserialization of structs |
| utoipa | API documentation generation |

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| /api/events | POST | GetEventsData | EventReturn | Get events for the specified dataset |

Note: The endpoint uses POST method despite being a read operation, likely to accommodate complex query parameters.