---
title: "search_operator.rs"
---

Here's a high-level description and documentation of the `search_operator.rs` file:

## High-level description
This file contains the core search functionality for the Trieve server. It implements various search methods including semantic, full-text, and hybrid searches. The code handles the interaction with the Qdrant vector database, processes search queries, and manages the retrieval and ranking of search results.

## Code Structure
The file defines several key structures and functions that work together to perform search operations:

1. `SearchResult`: Represents a single search result with a score and point ID.
2. `SearchChunkQueryResult`: Contains search results, total pages, and batch lengths.
3. `QdrantSearchQuery`: Defines parameters for a Qdrant search query.
4. `RetrievePointQuery`: Represents a query to retrieve points from Qdrant.
5. Various functions to handle different aspects of the search process, such as assembling filters, retrieving points, and reranking results.

## Symbols

### `assemble_qdrant_filter`
#### Description
Assembles a Qdrant filter based on provided filters, quote words, negated words, and dataset ID.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| filters | Option&lt;ChunkFilter&gt; | Optional filters for the search |
| quote_words | Option&lt;Vec&lt;String&gt;&gt; | Words to be quoted in the search |
| negated_words | Option&lt;Vec&lt;String&gt;&gt; | Words to be negated in the search |
| dataset_id | uuid::Uuid | ID of the dataset |
| pool | web::Data&lt;Pool&gt; | Database connection pool |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| filter | Result&lt;Filter, ServiceError&gt; | Assembled Qdrant filter |

### `retrieve_qdrant_points_query`
#### Description
Retrieves points from Qdrant based on the provided search queries.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| qdrant_searches | Vec&lt;QdrantSearchQuery&gt; | Vector of Qdrant search queries |
| page | u64 | Page number for pagination |
| get_total_pages | bool | Whether to get total pages |
| config | &DatasetConfiguration | Dataset configuration |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Result&lt;SearchChunkQueryResult, ServiceError&gt; | Search results |

### `search_chunks_query`
#### Description
Performs a search operation on chunks based on the provided parameters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | SearchChunksReqPayload | Search request payload |
| parsed_query | ParsedQueryTypes | Parsed query |
| pool | web::Data&lt;Pool&gt; | Database connection pool |
| dataset | Dataset | Dataset information |
| config | &DatasetConfiguration | Dataset configuration |
| timer | &mut Timer | Timer for performance tracking |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Result&lt;SearchChunkQueryResponseBody, actix_web::Error&gt; | Search response body |

## Dependencies
The file relies on several external crates and internal modules, including:
- `qdrant_client` for interacting with the Qdrant vector database
- `diesel` for database operations
- `serde` for serialization and deserialization
- Custom modules like `chunk_operator`, `group_operator`, and `model_operator` for specific operations

## Error Handling
The code uses a custom `ServiceError` type for error handling, which is propagated through the `Result` type in function returns.

## Performance Considerations
The code includes several optimizations and considerations for performance:
- Use of asynchronous operations for database and Qdrant queries
- Batching of operations where possible
- Reranking of search results for improved relevance
- Use of timers for performance tracking

This file is central to the search functionality of the Trieve server, handling the complex process of querying vector databases, processing results, and applying various search algorithms and filters.