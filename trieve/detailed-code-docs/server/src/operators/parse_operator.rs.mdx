---
title: "parse_operator.rs"
---

Here's a high-level description and documentation of the target file `server/src/operators/parse_operator.rs`:

## High-level description
This file contains utility functions for parsing and processing text data. It includes functions for converting HTML to plain text, chunking text, building regular expressions for splitting text, and averaging embeddings. These functions are used in various parts of the server application to handle text processing tasks.

## Code Structure
The file defines several public functions that operate on text data. These functions are independent of each other but may be used together in other parts of the application for text processing pipelines.

## Symbols

### `convert_html_to_text`
#### Description
Converts HTML content to plain text by parsing the HTML and extracting the text content.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| html | &str | The HTML content to convert |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| text | String | The extracted plain text |

### `coarse_remove_large_chunks`
#### Description
Splits large chunks of text into smaller pieces based on a maximum chunk length.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cur_chunks | Vec&lt;String&gt; | The current chunks of text |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| new_chunks | Vec&lt;String&gt; | The resulting smaller chunks |

### `build_chunking_regex`
#### Description
Builds a regular expression for splitting text based on provided delimiters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| delimiters | Vec&lt;String&gt; | The delimiters to use for splitting |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| re | Regex | The compiled regular expression |

### `coarse_doc_chunker`
#### Description
Splits a document into chunks based on a given pattern or default delimiters.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| document | String | The document to split |
| split_pattern | Option&lt;Regex&gt; | Optional custom split pattern |
| rebalance_chunks | bool | Whether to rebalance chunks |
| target_splits_per_chunk | usize | Target number of splits per chunk |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| groups | Vec&lt;String&gt; | The resulting chunks |

### `average_embeddings`
#### Description
Calculates the average of a list of embeddings.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| embeddings | Vec&lt;Vec&lt;f32&gt;&gt; | List of embeddings to average |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| average | Vec&lt;f32&gt; | The averaged embedding |

## Dependencies
The file uses several external crates:
- `ndarray` for numerical operations
- `regex` for regular expression handling
- `scraper` for HTML parsing
- `tracing` for instrumentation

## Error Handling
The functions return `Result` types to handle potential errors, such as invalid regular expressions or empty embeddings.

## Testing
The file includes a test module with a unit test for the `average_embeddings` function.

This file provides essential text processing utilities that are likely used throughout the server application for tasks such as preparing text for embedding, splitting documents into manageable chunks, and processing HTML content.