---
title: "email_operator.rs"
---

## High-level description
This code defines the main server application for the Trieve API. It sets up the server configuration, database connections, middleware, and routes for various API endpoints. The server uses Actix-web framework and integrates with several external services and libraries for authentication, database operations, and analytics.

## Code Structure
The main function sets up the server environment, including database connections, Redis store, OIDC client, and various configuration options. It then defines the Actix-web application with multiple services and routes for different API endpoints. The code also includes OpenAPI documentation using Utoipa.

## Symbols

### `main`
#### Description
The main function that sets up and runs the Actix-web server.

#### Internal Logic
1. Initializes environment variables and Sentry monitoring (if configured).
2. Sets up database connection pool and Redis store.
3. Creates OIDC client and configures various server options.
4. Sets up Actix-web application with middleware, routes, and services.
5. Starts the HTTP server.

### `ApiDoc`
#### Description
A struct that generates OpenAPI documentation for the Trieve API using Utoipa.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| actix-web | Web framework for building the server |
| diesel | ORM for database operations |
| sentry | Error monitoring and logging |
| utoipa | OpenAPI documentation generation |
| lettre | Email sending functionality |
| redis | Session storage |
| openssl | SSL/TLS support |
| clickhouse | Analytics database |

## Configuration
The server uses various environment variables for configuration:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| DATABASE_URL | String | Required | PostgreSQL database connection URL |
| REDIS_URL | String | Required | Redis connection URL |
| SENTRY_URL | String | Optional | Sentry monitoring URL |
| QUANTIZE_VECTORS | bool | false | Whether to quantize vectors |
| REPLICATION_FACTOR | u32 | 2 | Replication factor for Qdrant collections |
| VECTOR_SIZES | Vec&lt;u64&gt; | [384,512,768,1024,1536,3072] | Supported vector sizes |
| USE_ANALYTICS | bool | false | Whether to enable analytics |
| CLICKHOUSE_URL | String | "http://localhost:8123" | ClickHouse database URL |
| CLICKHOUSE_USER | String | "default" | ClickHouse username |
| CLICKHOUSE_PASSWORD | String | "password" | ClickHouse password |
| CLICKHOUSE_DB | String | "default" | ClickHouse database name |

## Error Handling
The server uses custom error handling middleware and the `ServiceError` enum for consistent error responses across the API.

## Logging
The server uses the `tracing` crate for logging and integrates with Sentry for error monitoring when configured.

## API/Interface Reference
The API endpoints are defined using Actix-web's routing system and are documented using Utoipa OpenAPI annotations. The main API routes include:

- Authentication (/api/auth)
- Chunks (/api/chunks)
- Datasets (/api/dataset)
- Topics (/api/topic)
- Messages (/api/message)
- Users (/api/user)
- Organizations (/api/organization)
- Files (/api/file)
- Events (/api/events)
- Analytics (/api/analytics)

Each endpoint has specific HTTP methods and request/response formats defined in the OpenAPI documentation.