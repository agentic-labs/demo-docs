---
title: "organization_handler.rs"
---

Here's a detailed documentation of the `organization_handler.rs` file:

## High-level description
This file contains handler functions for organization-related operations in the Trieve API. It includes functionality for creating, updating, deleting, and retrieving organizations, as well as managing users within organizations and handling organization-wide configurations.

## Code Structure
The file defines several handler functions that correspond to different API endpoints. These functions interact with the database through the `organization_operator` module and other related operators. They also use various models defined in `data::models`.

## Symbols

### `get_organization`
#### Description
Fetches the details of an organization by its ID. The authenticated user or API key must have an admin or owner role for the specified organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization_id | web::Path&lt;uuid::Uuid&gt; | The ID of the organization to fetch |
| pool | web::Data&lt;Pool&gt; | Database connection pool |
| user | AdminOnly | Authenticated user with admin privileges |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| HttpResponse | Result&lt;HttpResponse, actix_web::Error&gt; | JSON response containing the organization details |

#### Internal Logic
1. Verifies that the user has admin privileges for the organization.
2. Retrieves the organization details from the database.
3. Returns the organization details as a JSON response.

### `delete_organization`
#### Description
Deletes an organization by its ID. The authenticated user must be an owner of the organization to delete it.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| req | HttpRequest | The HTTP request |
| organization_id | web::Path&lt;uuid::Uuid&gt; | The ID of the organization to delete |
| pool | web::Data&lt;Pool&gt; | Database connection pool |
| redis_pool | web::Data&lt;RedisPool&gt; | Redis connection pool |
| user | OwnerOnly | Authenticated user with owner privileges |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| HttpResponse | Result&lt;HttpResponse, actix_web::Error&gt; | No content response on successful deletion |

#### Internal Logic
1. Verifies that the user has owner privileges for the organization.
2. Calls the `delete_organization_query` function to perform the deletion.
3. Returns a no content response on success.

### `update_organization`
#### Description
Updates an organization's details. Only the owner of the organization can update it.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | web::Json&lt;UpdateOrganizationReqPayload&gt; | The update payload |
| pool | web::Data&lt;Pool&gt; | Database connection pool |
| redis_pool | web::Data&lt;RedisPool&gt; | Redis connection pool |
| user | OwnerOnly | Authenticated user with owner privileges |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| HttpResponse | Result&lt;HttpResponse, actix_web::Error&gt; | JSON response containing the updated organization details |

#### Internal Logic
1. Verifies that the user has owner privileges for the organization.
2. Retrieves the current organization details.
3. Updates the organization with the new name if provided.
4. Returns the updated organization details as a JSON response.

### `create_organization`
#### Description
Creates a new organization. The authenticated user who creates the organization will be the default owner.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| req | HttpRequest | The HTTP request |
| organization | web::Json&lt;CreateOrganizationReqPayload&gt; | The creation payload |
| pool | web::Data&lt;Pool&gt; | Database connection pool |
| user | LoggedUser | Authenticated user |
| redis_pool | web::Data&lt;RedisPool&gt; | Redis connection pool |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| HttpResponse | Result&lt;HttpResponse, actix_web::Error&gt; | JSON response containing the created organization details |

#### Internal Logic
1. Creates a new organization with the provided name.
2. Adds the authenticated user as the owner of the new organization.
3. Returns the created organization details as a JSON response.

### `get_organization_usage`
#### Description
Fetches the current usage specification of an organization by its ID.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | web::Path&lt;uuid::Uuid&gt; | The ID of the organization |
| pool | web::Data&lt;Pool&gt; | Database connection pool |
| user | AdminOnly | Authenticated user with admin privileges |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| HttpResponse | Result&lt;HttpResponse, actix_web::Error&gt; | JSON response containing the organization's usage details |

#### Internal Logic
1. Verifies that the user has admin privileges for the organization.
2. Retrieves the organization's usage details from the database.
3. Returns the usage details as a JSON response.

### `get_organization_users`
#### Description
Fetches the users of an organization by its ID.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization_id | web::Path&lt;uuid::Uuid&gt; | The ID of the organization |
| pool | web::Data&lt;Pool&gt; | Database connection pool |
| user | AdminOnly | Authenticated user with admin privileges |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| HttpResponse | Result&lt;HttpResponse, actix_web::Error&gt; | JSON response containing an array of users belonging to the organization |

#### Internal Logic
1. Verifies that the user has admin privileges for the organization.
2. Retrieves the list of users belonging to the organization from the database.
3. Returns the list of users as a JSON response.

### `remove_user_from_org`
#### Description
Removes a user from an organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | web::Path&lt;RemoveUserFromOrgPathParams&gt; | Path parameters containing organization and user IDs |
| pool | web::Data&lt;Pool&gt; | Database connection pool |
| redis_pool | web::Data&lt;RedisPool&gt; | Redis connection pool |
| user | AdminOnly | Authenticated user with admin privileges |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| HttpResponse | Result&lt;HttpResponse, actix_web::Error&gt; | No content response on successful removal |

#### Internal Logic
1. Verifies that the user has admin privileges for the organization.
2. Retrieves the role of the authenticated user in the organization.
3. Removes the specified user from the organization.
4. Returns a no content response on success.

### `update_all_org_dataset_configs`
#### Description
Updates the configurations for all datasets in an organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| req_payload | web::Json&lt;UpdateAllOrgDatasetConfigsReqPayload&gt; | The update payload |
| pool | web::Data&lt;Pool&gt; | Database connection pool |
| user | OwnerOnly | Authenticated user with owner privileges |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| HttpResponse | Result&lt;HttpResponse, actix_web::Error&gt; | No content response on successful update |

#### Internal Logic
1. Verifies that the user has owner privileges for the organization.
2. Updates the configurations for all datasets in the organization.
3. Returns a no content response on success.

## Dependencies
- `actix_web`: Web framework for handling HTTP requests and responses.
- `serde`: For serialization and deserialization of JSON data.
- `utoipa`: For API documentation generation.
- Custom modules: `auth_handler`, `models`, `errors`, `middleware`, `operators`.

## Error Handling
The handlers use the `ServiceError` enum for error handling, which is then converted to appropriate HTTP responses.

## API/Interface Reference
Each handler function is annotated with `#[utoipa::path]`, which generates OpenAPI documentation for the endpoints. These annotations describe the HTTP method, path, request body, responses, and security requirements for each endpoint.