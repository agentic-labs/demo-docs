---
title: "Overview"
---

## High-level description
This directory contains middleware components for a Rust-based web server application. It includes modules for API versioning, authentication, and JSON processing. These middleware components are designed to handle cross-cutting concerns in the application, such as request preprocessing, authentication, and version control.

## What does it do?
The middleware in this directory performs several important functions:

1. API Versioning: It manages different versions of the API, allowing the server to maintain backward compatibility while introducing new features. The system determines the API version based on the dataset's creation date or an explicit version header.

2. Authentication: It handles user authentication using both session-based and API key-based methods. The middleware integrates with OpenID Connect for user authentication and implements role-based access control for different endpoints.

3. JSON Processing: While not explicitly detailed, this middleware likely handles JSON request and response processing, potentially including validation, transformation, or error handling for JSON data.

These middleware components work together to ensure that incoming requests are properly versioned, authenticated, and processed before reaching the main application logic.

## Entry points
The main entry point for the middleware is the `mod.rs` file, which declares and exports the three submodules:

1. `api_version`: Handles API versioning logic
2. `auth_middleware`: Manages authentication and authorization
3. `json_middleware`: Processes JSON-related tasks

Developers working with this codebase should start by examining these modules to understand how requests are preprocessed and how to integrate new middleware functionality.

## Key Files
1. `api_version.rs`: 
   - Defines the `APIVersion` enum and implements the versioning middleware.
   - Uses the `ApiVersionCheckFactory` and `ApiVersionMiddleware` to process requests.

2. `auth_middleware.rs`:
   - Implements the `AuthenticationMiddleware` for user authentication and authorization.
   - Handles both session-based and API key-based authentication.
   - Integrates with OpenID Connect for user authentication.

3. `json_middleware.rs`:
   - While not detailed in the provided summaries, this file likely handles JSON processing for requests and responses.

## Dependencies
The middleware components rely on several external libraries:

1. `actix-web`: Web framework for handling HTTP requests and responses
2. `actix-identity`: For managing user identity and sessions
3. `oauth2` and `openidconnect`: For implementing OpenID Connect authentication
4. `diesel`: ORM for database operations
5. `redis`: For caching user data
6. `sentry`: For error tracking and monitoring
7. `chrono`: For date and time handling
8. `utoipa`: For OpenAPI documentation generation

## Configuration
The middleware components use environment variables for configuration:

1. API Versioning:
   - `V2_VERSIONING_DATE`: Cutoff date for V2 API version (default: "2024-07-14")

2. Authentication:
   - Various environment variables for OpenID Connect configuration (client ID, secret, etc.)
   - Database connection details
   - Redis configuration for caching

Developers should ensure these environment variables are properly set for the middleware to function correctly.

In summary, this middleware directory provides crucial functionality for managing API versions, authenticating users, and processing JSON data in the web application. It serves as a central point for request preprocessing and cross-cutting concerns, ensuring that the main application logic receives properly validated and authenticated requests.