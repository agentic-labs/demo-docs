---
title: "create-new-qdrant.rs"
---

## High-level description
This Rust code defines a command-line interface (CLI) application that creates new Qdrant collections and their corresponding indexes. It retrieves configuration parameters from environment variables or uses default values if not provided.

## References
- `create_new_qdrant_collection_query`: This function is defined in the `qdrant_operator` module and is responsible for the actual creation of the Qdrant collections and indexes.
- `ServiceError`: This enum, defined in the `errors` module, represents errors that can occur during the execution of the application.

## Symbols
### `main`
#### Description
This is the main function of the CLI application. It loads environment variables, parses configuration parameters, and calls the `create_new_qdrant_collection_query` function to create the Qdrant collections and indexes.

#### Inputs
This function does not take any explicit inputs.

#### Outputs
- `Result&lt;(), ServiceError&gt;`: Returns `Ok(())` on success, or a `ServiceError` on failure.

#### Internal Logic
1. **Load environment variables:**
    - Loads environment variables from a `.env` file if it exists.
    - Retrieves the values for `QDRANT_URL`, `QDRANT_API_KEY`, `REPLICATION_FACTOR`, `QUANTIZE_VECTORS`, and `VECTOR_SIZES` from the environment.
    - Uses default values if any of these variables are not set.
2. **Parse configuration parameters:**
    - Parses the `REPLICATION_FACTOR`, `QUANTIZE_VECTORS`, and `VECTOR_SIZES` values from strings to their respective data types.
3. **Create Qdrant collections and indexes:**
    - Calls the `create_new_qdrant_collection_query` function with the parsed configuration parameters.
4. **Handle result:**
    - Returns `Ok(())` if the `create_new_qdrant_collection_query` function executes successfully.
    - Returns a `ServiceError` if an error occurs during the execution.

## Dependencies
- `dotenv`: Used to load environment variables from a `.env` file.
- `tokio`: Used for asynchronous programming.
- `trieve_server`: This is the main crate of the application, containing the `errors` and `operators` modules.

## Configuration
The following environment variables are used to configure the application:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `QDRANT_URL` | `String` | `"http://localhost:6333"` | The URL of the Qdrant server. |
| `QDRANT_API_KEY` | `String` | `"qdrant_api_key"` | The API key for the Qdrant server. |
| `REPLICATION_FACTOR` | `u32` | `2` | The replication factor for the Qdrant collections. |
| `QUANTIZE_VECTORS` | `bool` | `false` | Whether to quantize vectors in the Qdrant collections. |
| `VECTOR_SIZES` | `Vec&lt;u64&gt;` | `vec![384, 512, 768, 1024, 1536, 3072]` | A comma-separated list of vector sizes to create Qdrant collections for. |

## Error Handling
The application uses the `ServiceError` enum to represent errors. The `main` function returns a `Result&lt;(), ServiceError&gt;` to propagate errors to the caller.

## Logging
The application logs information about the creation of Qdrant collections using the `log` crate.
