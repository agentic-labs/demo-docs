---
title: "up.sql"
---

## High-level description
This SQL migration script modifies the `users` table by adding new columns for username, website, and email visibility. It also sets a default value for the email visibility for existing users.

## Symbols

### ALTER TABLE users
#### Description
This SQL command alters the structure of the `users` table by adding three new columns.

#### Internal Logic
1. Adds a `username` column of type TEXT, which can be NULL and must be unique.
2. Adds a `website` column of type TEXT, which can be NULL.
3. Adds a `visible_email` column of type BOOLEAN, which cannot be NULL and has a default value of false.

### UPDATE users
#### Description
This SQL command updates all existing rows in the `users` table, setting the `visible_email` column to true.

#### Internal Logic
Sets the `visible_email` column to true for all existing rows in the `users` table.

## Side Effects
- Modifies the structure of the `users` table by adding new columns.
- Updates existing user records to set `visible_email` to true.

## Performance Considerations
- The ALTER TABLE operation may lock the table during the modification, which could impact database performance temporarily, especially if the `users` table is large.
- The UPDATE operation affects all existing rows in the `users` table, which could be resource-intensive for tables with a large number of records.

## TODOs
There appears to be a discrepancy in the migration script:
1. The `visible_email` column is added with a DEFAULT value of false.
2. However, the subsequent UPDATE statement sets `visible_email` to true for all existing rows.

This inconsistency should be reviewed and clarified to ensure the intended behavior is implemented correctly.