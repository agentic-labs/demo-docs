---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for modifying indexes on the `chunk_metadata` table in a database. The migration adds a new JSON index and removes several existing indexes. The directory includes both "up" and "down" migration scripts, allowing for the changes to be applied or reverted as needed.

## What does it do?
These migration scripts modify the database structure to optimize query performance for JSON data in the `chunk_metadata` table. The "up" migration removes three existing indexes on specific columns (`link`, `created_at`, and `time_stamp`) and replaces them with a single, more versatile GIN (Generalized Inverted Index) index on the `metadata` column, which is assumed to contain JSON data. This change likely aims to improve query performance for operations involving JSON data within the `metadata` column.

The "down" migration does the opposite: it removes the newly created JSON index and recreates the three original indexes on the specific columns. This allows the database to be reverted to its previous state if needed.

## Key Files

1. `up.sql`: This file contains the SQL commands to apply the new changes. It drops three existing indexes and creates a new GIN index for JSON data.

   ```sql
   DROP INDEX idx_card_metadata_link;
   DROP INDEX idx_chunk_metadata_created_at;
   DROP INDEX idx_chunk_metadata_time_stamp;
   CREATE INDEX idx_chunk_metadata_json ON chunk_metadata USING gin (metadata jsonb_path_ops);
   ```

2. `down.sql`: This file contains the SQL commands to revert the changes made by the `up.sql` script. It drops the newly created JSON index and recreates the three original indexes.

   ```sql
   DROP INDEX idx_chunk_metadata_json;
   CREATE INDEX idx_card_metadata_link ON chunk_metadata (link);
   CREATE INDEX idx_chunk_metadata_created_at ON chunk_metadata (created_at);
   CREATE INDEX idx_chunk_metadata_time_stamp ON chunk_metadata (time_stamp);
   ```

These scripts are designed to be run by a database migration tool, which would typically apply the `up.sql` script when upgrading the database and the `down.sql` script when downgrading.

## Configuration
The migration scripts don't require any external configuration. However, they assume the existence of a `chunk_metadata` table with specific columns:

- `metadata`: A JSONB column that will be indexed using GIN in the new structure.
- `link`: A column that was previously indexed.
- `created_at`: A column that was previously indexed, likely containing timestamp data for record creation.
- `time_stamp`: A column that was previously indexed, likely containing general timestamp data.

The database migration tool used with these scripts would typically require configuration to specify the database connection details and migration directory.