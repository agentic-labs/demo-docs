---
title: "down.sql"
---

## High-level description
This SQL script defines the "down" migration for reverting a database change related to a table named `stripe_customers`. It aims to recreate the `stripe_customers` table and its associated columns, constraints, and foreign key relationship. This suggests that the corresponding "up" migration likely involved dropping this table.

## Symbols

### `CREATE TABLE stripe_customers`
#### Description
This SQL statement defines the structure for the `stripe_customers` table, specifying its columns, data types, constraints, and foreign key relationship.

#### Inputs
N/A - This is a SQL statement, not a function with explicit inputs.

#### Outputs
N/A - This statement, when executed, creates a table in the database. It doesn't return a value.

#### Internal Logic
The statement creates a table named `stripe_customers` with the following columns:

- `id`: A universally unique identifier (UUID) serving as the primary key, ensuring each row has a unique identifier. The `NOT NULL` constraint makes it mandatory for each row to have a value for this column.
- `stripe_id`: A text field intended to store a unique identifier from Stripe, likely representing a customer in the Stripe system. The `NOT NULL` and `UNIQUE` constraints enforce that each row must have a value for this column and that it must be unique across all rows.
- `email`: An optional text field to store the email address of the Stripe customer. The `UNIQUE` constraint ensures that if an email is provided, it must be unique within this table.
- `created_at`: A timestamp field recording when a row was created in the table. The `NOT NULL` constraint makes it mandatory for each row to have a value for this column.
- `updated_at`: A timestamp field recording when a row was last updated in the table. The `NOT NULL` constraint makes it mandatory for each row to have a value for this column.

The statement also establishes a foreign key constraint:

- `FOREIGN KEY (email) REFERENCES users(email)`: This constraint establishes a link between the `email` column in the `stripe_customers` table and the `email` column in the `users` table. This implies a relationship where each stripe customer might be associated with a user in the `users` table, using the email address as a common identifier.

## Side Effects
- **Database Modification**: Executes a database migration that creates the `stripe_customers` table. This action modifies the database schema. 

## Error Handling
N/A - This SQL script does not include explicit error handling mechanisms. Standard database error handling would apply during execution.
