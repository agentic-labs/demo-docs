---
title: "down.sql"
---

## High-level description
This SQL script performs a database migration rollback, specifically reverting changes related to file size tracking. It drops a trigger and a function that were likely introduced in a previous migration to manage file storage counts.

## Symbols

### `DROP TRIGGER IF EXISTS update_files_storage_with_update_trigger ON files`
#### Description
This statement attempts to drop a trigger named `update_files_storage_with_update_trigger` associated with the `files` table. The `IF EXISTS` clause ensures that the operation doesn't fail if the trigger doesn't exist. This trigger was likely responsible for updating file storage counts in response to `INSERT`, `UPDATE`, and `DELETE` operations on the `files` table.

#### Internal Logic
1. **Check for Trigger Existence:** The database checks if the trigger `update_files_storage_with_update_trigger` exists on the `files` table.
2. **Conditional Drop:** If the trigger exists, it is dropped. If it doesn't exist, the statement has no effect.

### `DROP FUNCTION IF EXISTS update_files_storage_counts_with_update()`
#### Description
This statement attempts to drop a function named `update_files_storage_counts_with_update()`. The `IF EXISTS` clause ensures that the operation doesn't fail if the function doesn't exist. This function likely contained the logic for calculating and updating file storage counts, particularly handling the `UPDATE` operation.

#### Internal Logic
1. **Check for Function Existence:** The database checks if the function `update_files_storage_counts_with_update()` exists.
2. **Conditional Drop:** If the function exists, it is dropped. If it doesn't exist, the statement has no effect.
