---
title: "up.sql"
---

## High-level description
This SQL script defines a function `set_default_dataset_usage_data` and a trigger `set_default_dataset_usage_data_trigger`. The trigger automatically inserts a new record into the `dataset_usage_counts` table whenever a new dataset is added to the `datasets` table.

## Symbols

### `set_default_dataset_usage_data`
#### Description
This function inserts a new row into the `dataset_usage_counts` table with the `dataset_id` of the newly inserted dataset. If a record with the same `dataset_id` already exists, it does nothing.

#### Inputs
This function does not take any explicit inputs. It implicitly uses the `NEW` record from the triggering `INSERT` statement on the `datasets` table.

#### Outputs
This function returns a trigger signal (`NEW`) indicating that the operation was successful.

#### Internal Logic
1. **Insert Statement:** Attempts to insert a new row into the `dataset_usage_counts` table.
    - The `dataset_id` for the new row is taken from the `NEW.id` value, which represents the `id` of the newly inserted dataset.
2. **Conflict Handling:** Uses `ON CONFLICT (dataset_id) DO NOTHING` to handle cases where a record with the same `dataset_id` already exists. In such cases, the insert is skipped.

### `set_default_dataset_usage_data_trigger`
#### Description
This trigger automatically executes the `set_default_dataset_usage_data` function after a new row is inserted into the `datasets` table.

#### Inputs
This trigger implicitly uses the `NEW` record from the `INSERT` statement on the `datasets` table.

#### Outputs
This trigger does not have any explicit outputs. It ensures that a corresponding record is created in the `dataset_usage_counts` table whenever a new dataset is added.

#### Internal Logic
1. **Trigger Activation:** The trigger is activated `AFTER INSERT` on the `datasets` table.
2. **Trigger Execution:** For each row inserted into the `datasets` table, the trigger executes the `set_default_dataset_usage_data` function.
