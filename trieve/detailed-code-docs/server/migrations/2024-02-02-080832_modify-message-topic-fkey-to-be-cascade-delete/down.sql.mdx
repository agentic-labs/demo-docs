---
title: "down.sql"
---

## High-level description
This SQL script defines a database migration that reverts a change made to the foreign key constraint between the `messages` and `topics` tables. Specifically, it removes the cascade delete behavior from the foreign key constraint.

## Symbols

### `down.sql`
#### Description
This script is executed when rolling back a database migration. It removes the `ON DELETE CASCADE` behavior from the foreign key constraint `messages_topic_id_fkey` between the `messages` and `topics` tables. This means deleting a row in the `topics` table will no longer automatically delete related rows in the `messages` table.

#### Internal Logic
1. **Drop Existing Constraint:** `ALTER TABLE messages DROP CONSTRAINT IF EXISTS messages_topic_id_fkey;` drops the existing foreign key constraint if it exists. This is done to avoid conflicts when recreating the constraint without the cascade delete behavior.
2. **Recreate Constraint:** `ALTER TABLE messages ADD CONSTRAINT messages_topic_id_fkey FOREIGN KEY (topic_id) REFERENCES topics(id);` recreates the foreign key constraint `messages_topic_id_fkey` between the `topic_id` column in the `messages` table and the `id` column in the `topics` table. This time, the constraint is created without the `ON DELETE CASCADE` option, effectively disabling the automatic deletion of related messages when a topic is deleted. 
