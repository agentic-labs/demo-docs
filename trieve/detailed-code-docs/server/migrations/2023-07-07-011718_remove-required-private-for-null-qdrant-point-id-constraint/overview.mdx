---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for modifying the `card_metadata` table in a database. The migration is focused on removing and re-adding a constraint related to the `private` and `qdrant_point_id` columns.

## What does it do?
The migration scripts in this directory perform the following actions:

1. The "up" migration removes a constraint from the `card_metadata` table. This constraint previously enforced a rule that if a card was not private (i.e., `private` column is false), it must have a `qdrant_point_id`. By removing this constraint, the database now allows `qdrant_point_id` to be NULL regardless of the `private` column's value.

2. The "down" migration reverses this change by re-adding the constraint. This ensures that if the migration needs to be rolled back, the original data integrity rules are restored.

These changes likely reflect a modification in the application's business logic or data model, possibly allowing for more flexibility in how card metadata is stored or processed.

## Key Files

1. `up.sql`:
   This file contains the SQL command to remove the constraint from the `card_metadata` table. Here's the content:

   ```sql
   ALTER TABLE card_metadata
   DROP CONSTRAINT qdrant_point_nullable_constraint;
   ```

   This command removes the `qdrant_point_nullable_constraint` from the `card_metadata` table, allowing `qdrant_point_id` to be NULL regardless of the `private` column's value.

2. `down.sql`:
   This file contains the SQL command to re-add the constraint to the `card_metadata` table in case the migration needs to be reversed. Here's the content:

   ```sql
   ALTER TABLE card_metadata
   ADD CONSTRAINT qdrant_point_nullable_constraint
   CHECK (private = true OR qdrant_point_id IS NOT NULL);
   ```

   This command adds back the `qdrant_point_nullable_constraint` to the `card_metadata` table, enforcing that if `private` is false, `qdrant_point_id` must not be NULL.

## Configuration
The migration is identified by its timestamp: `2023-07-07-011718`. This timestamp is likely used by the migration system to track which migrations have been applied and in what order.

## Dependencies
While not explicitly stated, this migration likely depends on:

1. A database system that supports ALTER TABLE and CHECK constraints (such as PostgreSQL).
2. A migration framework or tool that can execute these SQL scripts and track their application.

## Additional Notes

1. The constraint name `qdrant_point_nullable_constraint` suggests that `qdrant_point_id` might be related to an external system or service called Qdrant, possibly a vector database or search engine.

2. The removal of this constraint indicates a change in the application's data model or business logic. It might be part of a larger change to how card metadata is handled, possibly allowing for more flexible data storage or processing.

3. Developers working with this codebase should be aware that after applying this migration, the `qdrant_point_id` can be NULL even for non-private cards. This might require changes in application code that interacts with this data to handle potential NULL values.

4. When rolling back this migration, developers should ensure that no data violates the re-added constraint. If any non-private cards have NULL `qdrant_point_id` values, they would need to be updated before applying the "down" migration.

5. The migration scripts are simple and focused, following good practices for database migrations by making a single, atomic change that can be easily reversed if needed.