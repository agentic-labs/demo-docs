---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for modifying the `card_metadata` table in a database. The migration focuses on removing and re-adding a constraint related to the `private` and `qdrant_point_id` columns. The purpose of these scripts is to manage database schema changes in a version-controlled manner.

## What does it do?
The migration scripts in this directory perform the following actions:

1. The "up" migration removes a constraint from the `card_metadata` table. This constraint previously enforced that if a card was not private (i.e., `private` column is false), it must have a `qdrant_point_id`. By removing this constraint, the database now allows null values for `qdrant_point_id` regardless of the `private` column's value.

2. The "down" migration reverses this change by re-adding the constraint. This ensures that if a card is not private, it must have a non-null `qdrant_point_id`.

These changes allow for more flexibility in how card metadata is stored and managed, particularly in relation to the `qdrant_point_id` field.

## Key Files

1. `up.sql`: This file contains the SQL script to remove the constraint from the `card_metadata` table. It uses the `ALTER TABLE` statement to drop the `qdrant_point_nullable_constraint`.

   ```sql
   ALTER TABLE card_metadata
   DROP CONSTRAINT qdrant_point_nullable_constraint;
   ```

2. `down.sql`: This file contains the SQL script to revert the changes made by `up.sql`. It re-adds the constraint to the `card_metadata` table.

   ```sql
   ALTER TABLE card_metadata
   ADD CONSTRAINT qdrant_point_nullable_constraint
   CHECK (private = true OR qdrant_point_id IS NOT NULL);
   ```

These files work together to provide a reversible database migration, allowing developers to apply or roll back changes to the database schema as needed.

## Configuration
The migration scripts don't require any external configuration. However, they are likely part of a larger migration system, possibly managed by an ORM or database migration tool. The filename `2023-07-07-011718_remove-required-private-for-null-qdrant-point-id-constraint` suggests that this migration was created on July 7, 2023, at 01:17:18, and provides a description of its purpose.

When running these migrations, it's important to consider:

1. The database system being used (likely PostgreSQL, given the SQL syntax).
2. The current state of the database schema.
3. Any data that might be affected by the constraint changes.

Developers should ensure that removing the constraint doesn't introduce data integrity issues and that any application code relying on this constraint is updated accordingly.