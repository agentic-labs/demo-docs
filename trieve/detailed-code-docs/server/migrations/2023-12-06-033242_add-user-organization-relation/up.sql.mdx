---
title: "up.sql"
---

## High-level description
This SQL migration script adds a new column `organization_id` to the `users` table and establishes a foreign key relationship between the `users` and `organizations` tables. This change associates each user with a specific organization in the database schema.

## Symbols

### ALTER TABLE users ADD COLUMN organization_id UUID NOT NULL
#### Description
This SQL statement adds a new column named `organization_id` to the `users` table. The column is of type UUID (Universally Unique Identifier) and is set as NOT NULL, meaning it must have a value for every row in the table.

#### Internal Logic
1. Identifies the `users` table for modification.
2. Adds a new column named `organization_id`.
3. Sets the data type of the new column to UUID.
4. Specifies that the column cannot contain NULL values.

### ALTER TABLE users ADD CONSTRAINT users_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES organizations(id)
#### Description
This SQL statement creates a foreign key constraint on the `organization_id` column in the `users` table. It establishes a relationship between the `users` and `organizations` tables, ensuring referential integrity.

#### Internal Logic
1. Identifies the `users` table for modification.
2. Adds a new constraint named `users_organization_id_fkey`.
3. Defines the constraint as a foreign key on the `organization_id` column.
4. Specifies that the foreign key references the `id` column in the `organizations` table.

## Side Effects
- Existing rows in the `users` table will need to have a valid `organization_id` assigned, as the new column is set to NOT NULL.
- Attempts to insert or update users with non-existent organization IDs will be prevented by the foreign key constraint.
- Deleting an organization from the `organizations` table may be restricted if there are users associated with it, depending on the delete rule of the foreign key (not specified in this script).

## Performance Considerations
- Adding a new column and constraint to an existing table may temporarily lock the table, potentially affecting database operations during the migration.
- The foreign key constraint may slightly impact the performance of insert and update operations on the `users` table, as the database will need to check the `organizations` table for each operation.

## Dependencies
This migration script assumes the existence of:
| Dependency | Purpose |
|:-----------|:--------|
| `users` table | The table being modified to include the new column and constraint |
| `organizations` table | The referenced table in the foreign key relationship |

Note: The script does not create these tables; it assumes they already exist in the database schema.