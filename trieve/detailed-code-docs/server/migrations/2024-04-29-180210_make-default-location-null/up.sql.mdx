---
title: "up.sql"
---

## High-level description
This SQL migration script modifies the `chunk_metadata` table by removing the existing `location` column (if it exists) and then adding a new `location` column of type JSONB with a default value of NULL.

## Symbols

### ALTER TABLE chunk_metadata DROP COLUMN IF EXISTS location;
#### Description
This SQL statement removes the `location` column from the `chunk_metadata` table if it exists.

#### Internal Logic
1. Checks if the `location` column exists in the `chunk_metadata` table.
2. If the column exists, it is dropped from the table.
3. If the column doesn't exist, the statement has no effect.

### ALTER TABLE chunk_metadata ADD COLUMN location JSONB DEFAULT NULL;
#### Description
This SQL statement adds a new `location` column to the `chunk_metadata` table with the JSONB data type and a default value of NULL.

#### Internal Logic
1. Adds a new column named `location` to the `chunk_metadata` table.
2. Sets the data type of the new column to JSONB (JSON Binary), which allows for efficient storage and querying of JSON data.
3. Sets the default value of the new column to NULL, meaning if no value is specified when inserting a new row, it will be NULL.

## Side Effects
- The structure of the `chunk_metadata` table is modified.
- Any existing data in the old `location` column (if it existed) will be lost.
- Applications or queries that relied on the previous `location` column may need to be updated to work with the new JSONB column.

## Performance Considerations
- The JSONB data type allows for efficient storage and querying of JSON data, which can improve performance for JSON-related operations compared to using a plain text column.
- However, if the table contains a large number of rows, this migration might take some time to complete, especially if there's existing data in the `location` column.

## TODOs
There are no explicit TODOs in this migration script. However, it's important to note that after applying this migration, any code that interacts with the `chunk_metadata` table's `location` column should be updated to handle the new JSONB data type and the possibility of NULL values.