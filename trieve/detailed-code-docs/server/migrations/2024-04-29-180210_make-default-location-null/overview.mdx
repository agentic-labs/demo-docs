---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for altering the `chunk_metadata` table in a database. The migration is specifically focused on modifying the `location` column, changing its default value and nullability. The migration is identified by the timestamp 2024-04-29-180210 and is named "make-default-location-null".

## What does it do?
This migration changes how the `location` column in the `chunk_metadata` table is handled. The main changes are:

1. It removes any existing default value for the `location` column.
2. It allows the `location` column to contain NULL values.

These changes give more flexibility in how location data is stored and handled in the chunk metadata. Instead of always having a default empty JSON object, the column can now be explicitly set to NULL when no location data is available.

## Key Files
The directory contains two important SQL files:

1. `up.sql`: This file contains the SQL commands to apply the migration. It drops the existing `location` column and adds it back as a JSONB column with a default value of NULL.

2. `down.sql`: This file contains the SQL commands to revert the migration. It drops the modified `location` column and adds it back with its previous configuration (default value of an empty JSON object and allowing NULL values).

## Configuration
The migration is configured through the SQL commands in the `up.sql` and `down.sql` files. There are no external configuration files or environment variables used directly by these migration scripts.

Key configuration details:

- Table name: `chunk_metadata`
- Column name: `location`
- Data type: JSONB
- Default value (after migration): NULL
- Nullability (after migration): Allows NULL values

Here's a breakdown of the changes made by the migration:

```sql
-- up.sql
ALTER TABLE chunk_metadata DROP COLUMN IF EXISTS location;
ALTER TABLE chunk_metadata ADD COLUMN location JSONB DEFAULT NULL;

-- down.sql
ALTER TABLE chunk_metadata DROP COLUMN location;
ALTER TABLE chunk_metadata ADD COLUMN location JSONB DEFAULT '{}' NULL;
```

The `up.sql` script first drops the existing `location` column (if it exists) and then adds it back with a default value of NULL. This allows new rows to be inserted without requiring a location value.

The `down.sql` script reverts these changes by dropping the modified `location` column and adding it back with its previous configuration, which had a default value of an empty JSON object (`'{}'`) and explicitly allowed NULL values.

This migration provides more flexibility in handling location data within the `chunk_metadata` table, allowing for explicit NULL values when no location information is available, rather than defaulting to an empty JSON object.