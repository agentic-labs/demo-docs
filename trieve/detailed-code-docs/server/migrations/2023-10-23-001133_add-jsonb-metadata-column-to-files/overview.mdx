---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for modifying the `files` table in a database. The migration adds a new `metadata` column of type JSONB and removes the existing `mime_type` column. This change allows for more flexible and structured metadata storage for files. The directory includes both "up" and "down" migration scripts to apply and revert the changes, respectively.

## What does it do?
The migration scripts in this directory perform the following actions:

1. In the "up" migration:
   - Add a new column called `metadata` to the `files` table. This column is of type JSONB, which allows storing structured JSON data with advanced querying capabilities.
   - Remove the existing `mime_type` column from the `files` table.

2. In the "down" migration:
   - Remove the `metadata` column from the `files` table.
   - Add back the `mime_type` column to the `files` table.

These changes enable the application to store more flexible and detailed metadata for files, moving from a simple text-based `mime_type` to a structured JSON object that can contain various properties related to the file.

## Key Files

1. `up.sql`: This file contains the SQL commands to apply the migration, adding the `metadata` column and removing the `mime_type` column.

2. `down.sql`: This file contains the SQL commands to revert the migration, removing the `metadata` column and adding back the `mime_type` column.

Both files are crucial for managing the database schema changes and ensuring that the changes can be applied and rolled back as needed.

## Configuration
The migration scripts use standard SQL syntax and do not require additional configuration. However, the following details are important to note:

- The `metadata` column in `up.sql` is configured as follows:
  - Type: JSONB
  - Nullable: Yes
  - Default value: An empty JSON object (`'{}'::JSONB`)

- The `mime_type` column in `down.sql` is configured as follows:
  - Type: TEXT
  - Nullable: Yes
  - Default value: NULL

These configurations ensure that the new `metadata` column can store structured data with a default empty object, while the `mime_type` column (when restored) maintains its original properties.

Here's a sample of how the `up.sql` script modifies the `files` table:

```sql
ALTER TABLE files ADD COLUMN metadata JSONB NULL DEFAULT '{}'::JSONB;
ALTER TABLE files DROP COLUMN mime_type;
```

And here's how the `down.sql` script reverts these changes:

```sql
ALTER TABLE files DROP COLUMN metadata;
ALTER TABLE files ADD COLUMN mime_type TEXT NULL DEFAULT NULL;
```

It's important to note that running these migrations will permanently alter the database schema and may affect existing data and application functionality. Proper testing and data migration strategies should be implemented when applying these changes in a production environment.