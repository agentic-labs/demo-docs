---
title: "up.sql"
---

## High-level description
This SQL migration script creates a new table `card_collisions` and adds a unique constraint to the `card_metadata` table. It establishes a structure to track collisions between cards based on their Qdrant point IDs and ensures uniqueness of Qdrant point IDs in the card metadata.

## Symbols

### ALTER TABLE card_metadata
#### Description
This statement adds a unique constraint to the `qdrant_point_id` column in the `card_metadata` table.

#### Internal Logic
- Adds a unique constraint named `uq_qdrant_point_id` to the `qdrant_point_id` column.
- This ensures that each Qdrant point ID is unique across all card metadata entries.

### CREATE TABLE card_collisions
#### Description
This statement creates a new table named `card_collisions` to store information about card collisions.

#### Internal Logic
- Creates a table with the following columns:
  - `id`: UUID, serves as the primary key
  - `card_id`: UUID, references the `id` column in the `card_metadata` table
  - `collision_qdrant_id`: UUID, references the `qdrant_point_id` column in the `card_metadata` table
- Establishes foreign key relationships to ensure data integrity

### CREATE INDEX idx_card_collisions_card_id
#### Description
This statement creates an index on the `card_id` column of the `card_collisions` table.

#### Internal Logic
- Creates an index named `idx_card_collisions_card_id` on the `card_id` column
- This index will improve query performance when searching for collisions by card ID

## Performance Considerations
- The unique constraint on `qdrant_point_id` in the `card_metadata` table will enforce uniqueness but may slightly impact insert performance.
- The index on `card_id` in the `card_collisions` table will improve query performance for lookups by card ID but may slightly impact insert and update operations on this table.

## Dependencies
This migration script assumes the existence of a `card_metadata` table with `id` and `qdrant_point_id` columns.