---
title: "down.sql"
---

## High-level description
This SQL script reverts the database migration defined in the corresponding `up.sql` file, specifically targeting the `dataset_tags` table. It removes a unique constraint on the combination of `dataset_id` and `tag_key` and adds unique constraints on the `id`, `dataset_id` combination and the `tag` column.

## Symbols

### `down.sql`
#### Description
This SQL script undoes the changes made by the `up.sql` migration script, reverting the `dataset_tags` table to its previous state.

#### Internal Logic
1. **Drop Existing Constraint (if exists):**
   - `ALTER TABLE dataset_tags DROP CONSTRAINT IF EXISTS dataset_tags_dataset_id_tag_key;` 
   - This statement attempts to drop the `dataset_tags_dataset_id_tag_key` constraint from the `dataset_tags` table. The `IF EXISTS` clause ensures that the operation doesn't fail if the constraint is already absent.

2. **Add Unique Constraint on `id` and `dataset_id`:**
   - `ALTER TABLE dataset_tags ADD CONSTRAINT dataset_tags_id_dataset_id UNIQUE(id, dataset_id);`
   - This statement adds a new unique constraint named `dataset_tags_id_dataset_id` to the `dataset_tags` table. This constraint ensures that the combination of `id` and `dataset_id` is unique across all rows in the table.

3. **Add Unique Constraint on `tag`:**
   - `ALTER TABLE dataset_tags ADD CONSTRAINT dataset_tags_tag UNIQUE(tag);`
   - This statement adds another unique constraint named `dataset_tags_tag` to the `dataset_tags` table. This constraint ensures that the `tag` column has unique values across all rows.
