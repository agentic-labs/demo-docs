---
title: "up.sql"
---

## High-level description
This SQL migration file adds a trigram index to the `card_metadata` table using the GIN (Generalized Inverted Index) method. It enables efficient text search operations on the `oc_file_path` column.

## Symbols

### CREATE EXTENSION pg_trgm
#### Description
This command creates the PostgreSQL trigram extension, which provides functions and operators for determining the similarity of alphanumeric text based on trigram matching.

#### Internal Logic
The `pg_trgm` extension is added to the database, enabling trigram-based text search functionality.

### CREATE INDEX idx_gist
#### Description
This command creates a GIN index named `idx_gist` on the `card_metadata` table, specifically for the `oc_file_path` column using trigram operations.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| card_metadata | table | The table on which the index is created |
| oc_file_path | column | The column being indexed |

#### Internal Logic
1. Creates an index named `idx_gist` on the `card_metadata` table.
2. Uses the GIN indexing method, which is efficient for full-text search.
3. Applies the index to the `oc_file_path` column.
4. Utilizes the `gin_trgm_ops` operator class, which is specific to trigram operations.

## Performance Considerations
The addition of this trigram index can significantly improve the performance of text search queries on the `oc_file_path` column, especially for pattern matching and similarity searches. However, it may slightly increase the time required for insert and update operations on the `card_metadata` table.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| pg_trgm | Provides trigram functionality for text similarity searches |

Note: This migration assumes that the `card_metadata` table already exists in the database.