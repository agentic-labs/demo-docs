---
title: "Overview"
---

## High-level description
This directory contains SQL migration files for adding a trigram index using the GiST (Generalized Search Tree) method to improve text search operations on the `card_metadata` table in a PostgreSQL database. The migration adds the PostgreSQL trigram extension and creates an index on the `oc_file_path` column.

## What does it do?
The migration performs two main tasks:

1. It adds the PostgreSQL trigram extension (`pg_trgm`) to the database. This extension provides functions and operators for determining the similarity of alphanumeric text based on trigram matching, which is useful for advanced text search capabilities.

2. It creates a GIN (Generalized Inverted Index) index named `idx_gist` on the `oc_file_path` column of the `card_metadata` table. This index uses trigram operations to enable efficient text search operations, such as pattern matching and similarity searches.

These changes can significantly improve the performance of text search queries on the `oc_file_path` column, especially for operations involving partial matches or similarity comparisons. However, it's worth noting that this may slightly increase the time required for insert and update operations on the `card_metadata` table due to the overhead of maintaining the index.

The migration also includes a corresponding "down" migration that can undo these changes, removing the index and the trigram extension if needed.

## Key Files

1. `up.sql`: This file contains the SQL commands to apply the migration. It creates the `pg_trgm` extension and adds the GIN index to the `card_metadata` table.

   ```sql
   CREATE EXTENSION pg_trgm;

   CREATE INDEX idx_gist ON card_metadata USING gin (oc_file_path gin_trgm_ops);
   ```

2. `down.sql`: This file contains the SQL commands to revert the migration. It removes the GIN index and drops the `pg_trgm` extension.

   ```sql
   DROP INDEX IF EXISTS idx_gist;
   DROP EXTENSION IF EXISTS pg_trgm;
   ```

Both files use `IF EXISTS` clauses to ensure idempotency, meaning they can be run multiple times without causing errors if the objects they're trying to create or remove don't exist.

## Dependencies
The migration relies on PostgreSQL and specifically requires support for the `pg_trgm` extension. This extension is typically available in standard PostgreSQL installations but may need to be enabled or installed separately in some environments.

## Configuration
This migration doesn't require any specific configuration. However, database administrators should be aware of the following:

1. The migration assumes the existence of a `card_metadata` table with an `oc_file_path` column.
2. The name of the created index is `idx_gist`. If this conflicts with existing indexes, it may need to be changed.
3. The migration uses the GIN indexing method, which is generally more efficient for full-text search operations than other index types like B-tree.

When applying this migration, database administrators should consider the following:

1. The impact on database size, as the new index will require additional storage.
2. Potential performance impacts on write operations (inserts, updates, deletes) on the `card_metadata` table.
3. The benefits for read operations, especially those involving text searches on the `oc_file_path` column.

Overall, this migration aims to optimize text search operations on the `card_metadata` table, which can be particularly useful for applications that frequently perform partial matches or similarity searches on file paths.