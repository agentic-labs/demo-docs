---
title: "up.sql"
---

## High-level description
This SQL script performs database migration by removing the `author_id` column from the `chunk_metadata` table and updates foreign key constraints on multiple tables to include `ON UPDATE CASCADE` and `ON DELETE CASCADE` clauses. 

## Symbols
### `up.sql`
#### Description
This SQL script defines the "up" migration for removing the `author_id` column from the `chunk_metadata` table and updating foreign key constraints on related tables. It ensures that changes to the `users` table, specifically updates and deletions, are cascaded to related tables.

#### Internal Logic
1. **Drop `author_id` column:**
   - `ALTER TABLE chunk_metadata DROP COLUMN author_id;` removes the `author_id` column from the `chunk_metadata` table.

2. **Update foreign key constraints:**
   - For tables `user_organizations`, `user_api_key`, `files`, and `topics`:
     - It first drops the existing foreign key constraint on the `user_id` column if it exists.
     - Then, it adds a new foreign key constraint on the `user_id` column referencing the `users` table.
     - The key change is the addition of `ON UPDATE CASCADE ON DELETE CASCADE`, which ensures that updates and deletions on the `users` table are cascaded to the corresponding rows in these tables.

#### Side Effects
- The `author_id` column is removed from the `chunk_metadata` table.
- Foreign key constraints on `user_organizations`, `user_api_key`, `files`, and `topics` tables are updated to include cascade behavior on update and delete operations on the `users` table. 
