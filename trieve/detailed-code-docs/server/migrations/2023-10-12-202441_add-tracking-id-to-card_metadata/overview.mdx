---
title: "Overview"
---

## High-level description
This directory contains SQL migration files for adding a new `tracking_id` column to the `card_metadata` table in the database. The migration is dated 2023-10-12 and includes both `up.sql` and `down.sql` scripts to apply and revert the changes respectively.

## What does it do?
The migration adds a new column called `tracking_id` to the `card_metadata` table. This column is designed to store a unique identifier for each card metadata entry. The `up.sql` script adds this new column, while the `down.sql` script provides a way to remove it if needed.

Here's a breakdown of the process:

1. When applying the migration (using `up.sql`):
   - A new column named `tracking_id` is added to the `card_metadata` table.
   - This column is of type TEXT, allowing for flexible string storage.
   - A UNIQUE constraint is applied to ensure each `tracking_id` value is distinct across all rows.

2. When reverting the migration (using `down.sql`):
   - The `tracking_id` column is removed from the `card_metadata` table.
   - Any data stored in this column will be permanently deleted.

This migration allows the application to associate a unique tracking identifier with each card metadata entry, which could be useful for various purposes such as auditing, tracking changes, or integrating with external systems.

## Key Files

1. `up.sql`:
   - Purpose: Applies the database changes to add the `tracking_id` column.
   - Content:
     ```sql
     ALTER TABLE card_metadata
     ADD COLUMN tracking_id TEXT UNIQUE;
     ```
   - This script modifies the `card_metadata` table by adding the new `tracking_id` column with a UNIQUE constraint.

2. `down.sql`:
   - Purpose: Reverts the changes made by `up.sql`, removing the `tracking_id` column.
   - Content:
     ```sql
     ALTER TABLE card_metadata
     DROP COLUMN tracking_id;
     ```
   - This script removes the `tracking_id` column from the `card_metadata` table, effectively undoing the changes made by the `up.sql` script.

## Configuration
While there are no explicit configuration files in this directory, the migration scripts themselves serve as a form of configuration for the database schema. The naming convention of the directory (2023-10-12-202441_add-tracking-id-to-card_metadata) likely follows a specific format used by the migration tool or framework employed in the project.

## Performance Considerations
1. Adding a new column with a UNIQUE constraint (`up.sql`):
   - This operation may have performance implications, especially for large tables.
   - The database will create an index to enforce the UNIQUE constraint, which could take time for tables with many rows.
   - The ALTER TABLE operation might briefly lock the table, potentially affecting concurrent operations.

2. Removing a column (`down.sql`):
   - Generally, dropping a column is a fast operation.
   - However, it may still briefly lock the table, which could impact concurrent operations.
   - The impact depends on the size of the table and the specific database system being used.

It's recommended to perform these migrations during low-traffic periods to minimize potential disruptions.

## Error Handling and Considerations
1. The `up.sql` script doesn't specify a NOT NULL constraint or a default value for the new `tracking_id` column. This means:
   - Existing rows will have NULL values in this column after the migration.
   - Future inserts into the `card_metadata` table won't require a `tracking_id` value unless enforced by application logic.

2. The `down.sql` script doesn't include explicit error handling. If run when the `tracking_id` column doesn't exist, it may raise an error. Care should be taken to ensure this script is only executed when reverting from a state where the column exists.

3. Data loss consideration: Running the `down.sql` script will permanently delete all data stored in the `tracking_id` column. Ensure that this data is no longer needed or has been backed up before executing this script.

4. Application impact: After applying the `up.sql` migration, any queries or application code that interacts with the `card_metadata` table may need to be updated to handle the new column. Similarly, after running `down.sql`, code that relies on the `tracking_id` column will need to be adjusted to avoid errors.

In conclusion, this migration provides a straightforward way to add and remove a `tracking_id` column in the `card_metadata` table, allowing for unique identification of card metadata entries. Proper care should be taken when applying or reverting these changes, considering the potential impacts on existing data and application functionality.