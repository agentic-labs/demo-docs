---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for modifying the `card_collisions` table in a database. Specifically, these scripts are designed to change the `collision_qdrant_id` column to allow NULL values, making it an optional field. The migration was created on July 2, 2023, as indicated by the directory name.

## What does it do?
These migration scripts perform a database schema change on the `card_collisions` table. The change allows the `collision_qdrant_id` column to accept NULL values, whereas previously it did not allow NULL values. This modification provides more flexibility in storing data related to card collisions, as it now accommodates scenarios where a collision_qdrant_id might not be available or applicable.

In simple terms, imagine you have a spreadsheet (the `card_collisions` table) where one column (the `collision_qdrant_id` column) previously required a value for every entry. These scripts change that column so that it's okay to leave some cells in that column empty.

## Key Files
The directory contains two important SQL files:

1. `up.sql`: This file contains the SQL command to alter the `card_collisions` table by modifying the `collision_qdrant_id` column to allow NULL values. The specific command is:

   ```sql
   ALTER TABLE card_collisions ALTER COLUMN collision_qdrant_id DROP NOT NULL
   ```

   This script is run when applying the migration, effectively making the change to the database schema.

2. `down.sql`: This file contains the SQL command to revert the changes made by the `up.sql` script. It modifies the `collision_qdrant_id` column to disallow NULL values again. The specific command is:

   ```sql
   ALTER TABLE card_collisions ALTER COLUMN collision_qdrant_id SET NOT NULL
   ```

   This script is run when rolling back the migration, undoing the change to the database schema.

## Dependencies
These migration scripts rely on the existence of:
1. The `card_collisions` table in the database.
2. The `collision_qdrant_id` column within the `card_collisions` table.

The SQL syntax used in these scripts is compatible with PostgreSQL and several other major database systems.

## Configuration
There are no specific configuration files or environment variables associated with these migration scripts. However, the database connection details and migration framework configuration would typically be managed at a higher level in the application structure.

## Notes
1. This migration allows for more flexible data storage in the `card_collisions` table by making the `collision_qdrant_id` column optional.
2. After applying this migration, application logic and database queries should be reviewed and potentially updated to handle NULL values in the `collision_qdrant_id` column.
3. While the schema change itself is typically quick to execute, it may briefly lock the table during the operation, which could impact performance on large tables or busy systems.
4. Care should be taken when applying or rolling back this migration, as it may affect data integrity if the application relies on specific behavior regarding NULL values in this column.