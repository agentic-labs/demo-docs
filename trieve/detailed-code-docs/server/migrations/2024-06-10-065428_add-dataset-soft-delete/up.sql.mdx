---
title: "up.sql"
---

## High-level description
This SQL migration script adds a soft delete functionality to the `datasets` table by introducing a new column called `deleted` and creating an index on this column for improved query performance.

## Symbols

### ALTER TABLE datasets ADD COLUMN deleted INT DEFAULT 0 NOT NULL
#### Description
This SQL statement adds a new column named `deleted` to the `datasets` table.

#### Internal Logic
- Adds a new column called `deleted` to the `datasets` table
- Sets the data type of the column to `INT` (integer)
- Sets a default value of 0 for the column
- Makes the column `NOT NULL`, ensuring it always has a value

### CREATE INDEX IF NOT EXISTS idx_dataset_deleted ON datasets (deleted)
#### Description
This SQL statement creates an index on the newly added `deleted` column of the `datasets` table.

#### Internal Logic
- Creates an index named `idx_dataset_deleted` on the `datasets` table
- The index is created only on the `deleted` column
- Uses `IF NOT EXISTS` to prevent errors if the index already exists

## Performance Considerations
The addition of the index on the `deleted` column will improve query performance for operations that filter or sort based on the `deleted` status of datasets. This is particularly useful for soft delete functionality, where queries often need to exclude or specifically target deleted items.

## Dependencies
This migration script assumes the existence of a `datasets` table in the database schema.

## Side Effects
- Existing rows in the `datasets` table will have their `deleted` column set to the default value of 0.
- Queries on the `datasets` table may need to be updated to consider the `deleted` status when retrieving or modifying data.
- The database schema version will be updated to reflect this migration.