---
title: "up.sql"
---

## High-level description
This SQL script migrates the database schema by adding a new column named `dataset_id` to the `card_metadata` and `card_collection` tables. It also establishes foreign key constraints to link these tables to the `datasets` table. Additionally, it drops the `dataset_id` column from the `card_collection_bookmarks` table if it exists.

## Symbols

### `ALTER TABLE card_collection_bookmarks`
#### Description
This statement attempts to drop the `dataset_id` column from the `card_collection_bookmarks` table if it exists. This is done to avoid potential conflicts before adding the column to other tables.

#### Inputs
N/A

#### Outputs
N/A

#### Internal Logic
- `DROP COLUMN IF EXISTS dataset_id`: This clause checks if a column named `dataset_id` exists in the `card_collection_bookmarks` table. If it does, the column is dropped. The `IF EXISTS` clause ensures that the statement doesn't fail if the column doesn't exist.

### `ALTER TABLE card_metadata`
#### Description
This statement adds a new column named `dataset_id` to the `card_metadata` table and adds a foreign key constraint.

#### Inputs
N/A

#### Outputs
N/A

#### Internal Logic
- `ADD COLUMN dataset_id UUID NOT NULL`: This clause adds a new column named `dataset_id` to the `card_metadata` table. The data type of the column is `UUID` and it's set as `NOT NULL`, meaning it cannot be empty.
- `ADD CONSTRAINT card_metadata_dataset_id_fkey FOREIGN KEY (dataset_id) REFERENCES datasets(id)`: This clause adds a foreign key constraint named `card_metadata_dataset_id_fkey` to the `dataset_id` column. This constraint ensures that every value in the `dataset_id` column of the `card_metadata` table corresponds to a valid `id` in the `datasets` table.

### `ALTER TABLE card_collection`
#### Description
This statement adds a new column named `dataset_id` to the `card_collection` table and adds a foreign key constraint.

#### Inputs
N/A

#### Outputs
N/A

#### Internal Logic
- `ADD COLUMN dataset_id UUID NOT NULL`: This clause adds a new column named `dataset_id` to the `card_collection` table. The data type of the column is `UUID` and it's set as `NOT NULL`, meaning it cannot be empty.
- `ADD CONSTRAINT card_collection_dataset_id_fkey FOREIGN KEY (dataset_id) REFERENCES datasets(id)`: This clause adds a foreign key constraint named `card_collection_dataset_id_fkey` to the `dataset_id` column. This constraint ensures that every value in the `dataset_id` column of the `card_collection` table corresponds to a valid `id` in the `datasets` table.
