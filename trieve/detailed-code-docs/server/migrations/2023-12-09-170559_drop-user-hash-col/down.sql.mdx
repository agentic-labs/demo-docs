---
title: "down.sql"
---

## High-level description
This SQL migration script is designed to revert changes made to the "users" table. It adds back a "hash" column and removes a "name" column, effectively undoing the changes implemented in the corresponding `up.sql` migration.

## Symbols

### ALTER TABLE "users" ADD COLUMN "hash" VARCHAR(255) NULL;
#### Description
This SQL statement adds a new column named "hash" to the "users" table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| "users" | Table | The target table for the alteration |
| "hash" | Column name | The name of the new column being added |
| VARCHAR(255) | Data type | The data type of the new column, allowing for variable-length character strings up to 255 characters |
| NULL | Constraint | Specifies that the column can contain NULL values |

#### Internal Logic
1. Identifies the "users" table
2. Adds a new column named "hash"
3. Sets the data type of the new column to VARCHAR(255)
4. Allows NULL values in the new column

### ALTER TABLE "users" DROP COLUMN IF EXISTS "name" ;
#### Description
This SQL statement removes the "name" column from the "users" table if it exists.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| "users" | Table | The target table for the alteration |
| "name" | Column name | The name of the column to be dropped |

#### Internal Logic
1. Identifies the "users" table
2. Checks if a column named "name" exists in the table
3. If the column exists, it is removed from the table
4. If the column doesn't exist, the statement has no effect (preventing errors)

## Side Effects
- The structure of the "users" table is modified:
  1. A new "hash" column is added, potentially affecting existing queries or application logic that interacts with the table.
  2. The "name" column is removed (if it exists), which could impact any part of the application that relies on this column for user information.

## Error Handling
The script includes basic error handling:
- The "IF EXISTS" clause in the DROP COLUMN statement prevents errors if the "name" column doesn't exist.

## Notes
1. This is a database migration "down" script, typically used to revert changes made by a corresponding "up" migration.
2. The script assumes that the "users" table exists in the database.
3. The addition of the "hash" column as nullable suggests it may have been used for storing password hashes or similar sensitive information.
4. The removal of the "name" column implies that user identification might have been restructured in the corresponding "up" migration.
5. Care should be taken when applying this migration, as it could potentially lead to data loss if the "name" column contains important information that hasn't been backed up or migrated elsewhere.