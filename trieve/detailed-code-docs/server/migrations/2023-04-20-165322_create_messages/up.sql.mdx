---
title: "up.sql"
---

## High-level description
This SQL script creates a table named `messages` in a relational database. The table is designed to store messages associated with a topic, including their content, role (system, user, assistant), token usage, and timestamps. 

## Symbols

### `CREATE TABLE messages`
#### Description
This SQL statement defines a new table named `messages` with its columns and constraints.

#### Inputs
N/A - This is a SQL statement, not a function.

#### Outputs
N/A - This statement creates a table in the database as a side effect.

#### Internal Logic
The statement defines the following columns for the `messages` table:

- `id`: A universally unique identifier (UUID) serving as the primary key, ensuring each message has a unique identifier.
- `topic_id`: A foreign key (UUID) referencing the `topics` table, indicating the topic to which the message belongs.
- `sort_order`: An integer defining the order of messages within a topic.
- `content`: A text field storing the actual message content.
- `role`: A string indicating the sender's role (system, user, assistant) with a default value of 'assistant'.
- `deleted`: A boolean flag indicating whether the message has been deleted (default is false).
- `prompt_tokens`: An integer storing the number of tokens used in the prompt for this message (default is 0).
- `completion_tokens`: An integer storing the number of tokens used in the completion for this message (default is 0).
- `created_at`: A timestamp recording the message creation time.
- `updated_at`: A timestamp recording the last update time of the message.

#### Side Effects
- Creates a new table named `messages` in the database.
- Establishes a foreign key relationship with the `topics` table.

## Dependencies
- This script depends on the existence of a `topics` table with an `id` column defined as a UUID.

## Error Handling
- The script uses `NOT NULL` constraints to ensure data integrity for several columns.
- A `CHECK` constraint enforces the `role` column to only accept specific values ('system', 'user', 'assistant').
- Any violation of these constraints will result in an error during the table creation process. 
