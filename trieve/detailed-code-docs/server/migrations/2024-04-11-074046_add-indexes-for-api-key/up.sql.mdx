---
title: "up.sql"
---

## High-level description
This SQL migration file adds two indexes to the `user_api_key` table to improve query performance for API key-related operations. The indexes are created on the `api_key_hash` and `blake3_hash` columns.

## Symbols

### CREATE INDEX IF NOT EXISTS user_api_key_api_key_hash_index
#### Description
This SQL command creates an index named `user_api_key_api_key_hash_index` on the `api_key_hash` column of the `user_api_key` table if it doesn't already exist.

#### Internal Logic
- The `IF NOT EXISTS` clause ensures that the index is only created if it doesn't already exist, preventing errors on subsequent migrations.
- The index is created on the `api_key_hash` column, which likely contains a hashed version of the API key.
- This index will improve the performance of queries that search or filter based on the `api_key_hash` column.

### CREATE INDEX IF NOT EXISTS user_api_key_blake3_hash_index
#### Description
This SQL command creates an index named `user_api_key_blake3_hash_index` on the `blake3_hash` column of the `user_api_key` table if it doesn't already exist.

#### Internal Logic
- The `IF NOT EXISTS` clause ensures that the index is only created if it doesn't already exist, preventing errors on subsequent migrations.
- The index is created on the `blake3_hash` column, which likely contains a BLAKE3 hash of the API key.
- This index will improve the performance of queries that search or filter based on the `blake3_hash` column.

## Performance Considerations
- Adding these indexes will improve the read performance of queries that filter or search on the `api_key_hash` and `blake3_hash` columns.
- However, it's important to note that indexes can slightly slow down write operations (inserts, updates, and deletes) on the `user_api_key` table, as the indexes need to be updated along with the table data.
- The trade-off between improved read performance and slightly decreased write performance should be considered based on the application's usage patterns.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| PostgreSQL | This SQL script is written for PostgreSQL databases and uses PostgreSQL-specific syntax for creating indexes. |

Note: The exact version of PostgreSQL being used is not specified in the migration file, but it's compatible with recent versions of PostgreSQL that support the `CREATE INDEX IF NOT EXISTS` syntax.