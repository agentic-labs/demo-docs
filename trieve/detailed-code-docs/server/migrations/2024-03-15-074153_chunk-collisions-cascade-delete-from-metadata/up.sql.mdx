---
title: "up.sql"
---

## High-level description
This SQL migration script modifies the `chunk_collisions` table by updating its foreign key constraints. It changes the behavior of the foreign keys to implement cascading deletes and updates, ensuring referential integrity with the `chunk_metadata` table.

## Symbols

### ALTER TABLE chunk_collisions
#### Description
This SQL command is used multiple times in the script to modify the `chunk_collisions` table structure, specifically its foreign key constraints.

#### Internal Logic
1. Drops existing foreign key constraints.
2. Adds new foreign key constraints with CASCADE options for both DELETE and UPDATE operations.

### DROP CONSTRAINT
#### Description
This clause removes existing foreign key constraints from the `chunk_collisions` table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| constraint_name | string | Name of the constraint to be dropped |

### ADD CONSTRAINT
#### Description
This clause adds new foreign key constraints to the `chunk_collisions` table with CASCADE options.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| constraint_name | string | Name of the new constraint |
| column_name | string | Column in the `chunk_collisions` table |
| referenced_table | string | Table being referenced (chunk_metadata) |
| referenced_column | string | Column in the referenced table |

## Side Effects
- Existing foreign key constraints on the `chunk_collisions` table are removed.
- New foreign key constraints are added with CASCADE options for DELETE and UPDATE.
- This change affects the behavior of delete and update operations on the `chunk_metadata` table, which will now propagate to the `chunk_collisions` table.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| chunk_collisions table | The table being modified |
| chunk_metadata table | The referenced table in the foreign key constraints |

## Error Handling
This script does not include explicit error handling. If an error occurs during execution, it will be handled by the database management system running the migration.

## Notes
1. The script renames constraints from "card_collisions" to "chunk_collisions", suggesting a possible renaming of the table or a correction of a previous naming inconsistency.
2. The script ensures that when a record is deleted or updated in the `chunk_metadata` table, corresponding records in the `chunk_collisions` table will be automatically deleted or updated, maintaining referential integrity.
3. Two foreign key relationships are established:
   - Between `chunk_collisions.chunk_id` and `chunk_metadata.id`
   - Between `chunk_collisions.collision_qdrant_id` and `chunk_metadata.qdrant_point_id`