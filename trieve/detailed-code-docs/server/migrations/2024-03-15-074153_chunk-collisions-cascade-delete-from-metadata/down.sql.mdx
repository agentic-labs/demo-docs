---
title: "down.sql"
---

## High-level description
This SQL script is designed to revert the changes made in the corresponding `up.sql` file. It modifies the `chunk_collisions` table by removing and re-adding foreign key constraints, effectively undoing a cascade delete operation and reverting the table structure to its previous state.

## Symbols

### SQL Commands

#### Description
The script consists of four main SQL commands that alter the `chunk_collisions` table:

1. Drop the foreign key constraint `chunk_collisions_card_id_fkey`.
2. Add a new foreign key constraint `card_collisions_card_id_fkey`.
3. Drop the foreign key constraint `chunk_collisions_collision_qdrant_id_fkey`.
4. Add a new foreign key constraint `card_collisions_collision_qdrant_id_fkey`.

#### Internal Logic
1. The first two commands deal with the `chunk_id` column:
   - Remove the existing foreign key constraint.
   - Add a new foreign key constraint referencing the `id` column in the `chunk_metadata` table.

2. The last two commands deal with the `collision_qdrant_id` column:
   - Remove the existing foreign key constraint.
   - Add a new foreign key constraint referencing the `qdrant_point_id` column in the `chunk_metadata` table.

## Side Effects
- The `chunk_collisions` table's foreign key constraints are modified, potentially affecting data integrity and deletion behavior.
- The naming convention of the constraints is changed from "chunk_collisions" to "card_collisions".
- The cascade delete functionality (if it was added in the `up.sql` file) is removed.

## Error Handling
This script does not include explicit error handling. If any of the ALTER TABLE commands fail, the database system will likely roll back the transaction, leaving the table in its original state.

## TODOs
- The comment "Your SQL goes here" suggests that this might be a template or placeholder. Ensure that the SQL commands are correct and complete for the specific use case.
- Consider adding error handling or validation steps if necessary for the production environment.
- Verify that the constraint names and referenced columns are correct, especially given the change from "chunk_collisions" to "card_collisions" in the constraint names.