---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for dropping the 'configuration' column from the 'organizations' table in a database. It includes both 'up' and 'down' migration files, allowing for the change to be applied and reversed if necessary.

## What does it do?
The migration scripts in this directory perform the following actions:

1. The 'up' migration removes the 'configuration' column from the 'organizations' table. This column likely stored JSON-formatted configuration data for each organization.

2. The 'down' migration adds the 'configuration' column back to the 'organizations' table, allowing the change to be reversed if needed. The column is defined as a JSONB (JSON Binary) type, which is efficient for storing and querying JSON data.

These migrations are part of a database schema update, possibly to change how organization configurations are stored or managed in the application.

## Key Files

1. `up.sql`:
   - Contains the SQL command to drop the 'configuration' column from the 'organizations' table.
   - SQL command: `ALTER TABLE organizations DROP COLUMN configuration;`

2. `down.sql`:
   - Contains the SQL command to add back the 'configuration' column to the 'organizations' table.
   - SQL command: `ALTER TABLE organizations ADD COLUMN configuration jsonb NOT NULL DEFAULT`

## Configuration
The migration files don't contain any configurable fields. However, there's an issue in the `down.sql` file that needs attention:

- The `DEFAULT` keyword is used without specifying a default value. This is likely an error in the migration script and should be fixed by either removing the `DEFAULT` keyword or providing a valid default JSON value.

## TODOs and Considerations

1. Fix the `DEFAULT` clause in `down.sql`:
   - Either remove the `DEFAULT` keyword if no default value is needed, or
   - Provide a valid default JSON value, e.g., `DEFAULT '{}'::jsonb`

2. Update application code:
   - Remove any references to the 'configuration' column in queries
   - Update ORM models or schemas
   - Modify business logic that depended on the 'configuration' data
   - Update API endpoints that returned or accepted 'configuration' data

3. Consider adding comments to the migration files explaining the purpose of the change and any important details about the 'configuration' column's previous usage.

4. Ensure that any data in the 'configuration' column is properly migrated or archived before applying the 'up' migration, as the column and its data will be permanently removed.

5. Test the migrations thoroughly in a non-production environment to ensure they work as expected and don't cause any unintended side effects.

6. Update any documentation related to the database schema or the 'organizations' table to reflect this change.

By implementing these migrations, the application is removing the 'configuration' column from the 'organizations' table, which may indicate a shift in how organization-specific configurations are managed. It's crucial to ensure that all related parts of the application are updated accordingly to maintain consistency and prevent errors related to this schema change.