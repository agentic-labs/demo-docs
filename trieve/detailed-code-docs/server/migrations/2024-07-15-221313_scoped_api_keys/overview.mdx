---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for adding and removing a 'scopes' column to the 'user_api_key' table in a database. The migration is dated 2024-07-15 and is specifically for implementing scoped API keys functionality.

## What does it do?
These migration scripts modify the structure of the 'user_api_key' table in the database. The 'up' migration adds a new column called 'scopes' to store an array of text values, which likely represent the permissions or access levels associated with each API key. The 'down' migration removes this column, allowing for the change to be reverted if necessary.

This functionality allows for more granular control over API key permissions. Instead of having a single, all-or-nothing access level, each API key can now have specific scopes or permissions associated with it. This is a common practice in API design to enhance security and allow for more fine-grained access control.

## Key Files

1. `up.sql`:
   This file contains the SQL command to add the 'scopes' column to the 'user_api_key' table. The command is:

   ```sql
   ALTER TABLE user_api_key ADD COLUMN IF NOT EXISTS scopes text[];
   ```

   This adds a new column named 'scopes' of type 'text[]', which is an array of text values. The 'IF NOT EXISTS' clause makes this operation idempotent, meaning it can be run multiple times without causing errors.

2. `down.sql`:
   This file contains the SQL command to remove the 'scopes' column from the 'user_api_key' table. The command is:

   ```sql
   ALTER TABLE user_api_key DROP COLUMN IF EXISTS scopes;
   ```

   This removes the 'scopes' column if it exists. Again, the 'IF EXISTS' clause ensures idempotency.

## Configuration
These migration scripts don't require any additional configuration. They are designed to be run by a database migration tool (likely Diesel, given the project context) which will execute these scripts in the appropriate order based on their timestamp.

The naming convention of the directory (2024-07-15-221313_scoped_api_keys) suggests that this migration was created on July 15, 2024, at 22:13:13. This timestamp is typically used by migration tools to determine the order in which to apply migrations.

It's important to note that running these migrations will modify the database schema, and the 'down' migration will result in data loss if there's any data in the 'scopes' column when it's run. Therefore, it should be used with caution in production environments.