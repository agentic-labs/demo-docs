---
title: "up.sql"
---

## High-level description
This SQL migration script adds a new column `dataset_id` to the `files` table and establishes a foreign key relationship between the `files` table and the `datasets` table. This modification allows each file to be associated with a specific dataset.

## Symbols

### ALTER TABLE files ADD COLUMN dataset_id UUID NOT NULL
#### Description
This SQL statement adds a new column named `dataset_id` to the `files` table. The column is of type UUID (Universally Unique Identifier) and is set as NOT NULL, meaning it must have a value for every row in the table.

#### Internal Logic
1. Identifies the `files` table for modification.
2. Adds a new column named `dataset_id`.
3. Sets the data type of the new column to UUID.
4. Specifies that the column cannot contain NULL values.

### ALTER TABLE files ADD CONSTRAINT files_dataset_id_fkey FOREIGN KEY (dataset_id) REFERENCES datasets(id)
#### Description
This SQL statement creates a foreign key constraint on the `dataset_id` column in the `files` table, establishing a relationship with the `id` column in the `datasets` table.

#### Internal Logic
1. Identifies the `files` table for modification.
2. Adds a new constraint named `files_dataset_id_fkey`.
3. Defines the constraint as a foreign key on the `dataset_id` column.
4. Specifies that the foreign key references the `id` column in the `datasets` table.

## Side Effects
- The `files` table structure is modified, adding a new column.
- A new relationship is established between the `files` and `datasets` tables.
- Existing rows in the `files` table (if any) will need to have a valid `dataset_id` assigned, as the new column is set to NOT NULL.

## Dependencies
This migration script assumes the existence of:
| Dependency | Purpose |
|:-----------|:--------|
| `files` table | The table being modified |
| `datasets` table | The table referenced by the new foreign key |

## Error Handling
This script does not include explicit error handling. If there are any issues (e.g., the `files` or `datasets` tables don't exist, or there are existing rows in `files` that can't satisfy the NOT NULL constraint), the database system will raise an error and roll back the transaction.

___