---
title: "down.sql"
---

## High-level description
This SQL script reverts the database migration applied by the corresponding `up.sql` script, specifically by removing a unique constraint that combines `tracking_id` and `dataset_id` and restoring a unique constraint on `tracking_id` alone for the `chunk_metadata` table. 

## Symbols

### `down.sql`
#### Description
This SQL script undoes the changes introduced in the corresponding `up.sql` migration file. It specifically targets the `chunk_metadata` table and reverts the changes related to unique constraints on the `tracking_id` column.

#### Internal Logic
1. **Drop the combined unique constraint:**
   - `ALTER TABLE chunk_metadata DROP CONSTRAINT chunk_metadata_tracking_id_dataset_id_key;` 
   - This statement removes the unique constraint named `chunk_metadata_tracking_id_dataset_id_key` from the `chunk_metadata` table. This constraint likely enforced uniqueness for the combination of `tracking_id` and `dataset_id`.

2. **Recreate the unique constraint on `tracking_id`:**
   - `ALTER TABLE chunk_metadata ADD CONSTRAINT card_metadata_tracking_id_key UNIQUE (tracking_id);`
   - This statement adds a new unique constraint named `card_metadata_tracking_id_key` to the `chunk_metadata` table. This constraint enforces that the `tracking_id` column must be unique across all rows in the table.

#### Side Effects
- **Modified database schema:** The script alters the structure of the `chunk_metadata` table by removing and adding unique constraints.
- **Data integrity:** Reverting the migration might lead to data integrity issues if the `up.sql` script allowed duplicate `tracking_id` values within the same dataset. 
