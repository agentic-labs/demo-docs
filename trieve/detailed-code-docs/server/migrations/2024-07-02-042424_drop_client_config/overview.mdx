---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for modifying the structure of the `datasets` table in a database. Specifically, these scripts are designed to remove the `client_configuration` column from the table and provide a way to revert this change if needed.

## What does it do?
The migration scripts in this directory perform the following actions:

1. Remove a column: The "up" migration removes the `client_configuration` column from the `datasets` table. This column likely stored JSON data related to client-specific configurations.

2. Add a column (for reverting): The "down" migration adds the `client_configuration` column back to the `datasets` table. This column is defined as `jsonb` type, which is used for storing JSON data in a binary format for efficient processing and querying.

These migrations allow database administrators or developers to update the database schema by removing potentially unused or deprecated data, while also providing a way to undo this change if necessary.

## Key Files

1. `up.sql`:
   - Purpose: Removes the `client_configuration` column from the `datasets` table.
   - Content: 
     ```sql
     ALTER TABLE datasets DROP COLUMN client_configuration
     ```
   - This file is executed when applying the migration to update the database schema.

2. `down.sql`:
   - Purpose: Adds the `client_configuration` column back to the `datasets` table.
   - Content:
     ```sql
     ALTER TABLE datasets ADD COLUMN client_configuration jsonb;
     ```
   - This file is executed when rolling back the migration to revert the database schema to its previous state.

## Configuration
The migration is identified by its timestamp: `2024-07-02-042424`. This timestamp is likely used by a migration management system to track which migrations have been applied and in what order.

## Side Effects
Executing these migrations will have the following effects:

1. When applying the "up" migration:
   - The `client_configuration` column and all its data will be permanently removed from the `datasets` table.
   - Queries or application code relying on this column will need to be updated.
   - Storage space used by the column will be freed up.

2. When applying the "down" migration:
   - A new `client_configuration` column of type `jsonb` will be added to the `datasets` table.
   - Existing rows will have NULL values in this new column unless otherwise specified.
   - Applications will regain access to this column, but without the original data.

## Performance Considerations
1. The impact of these migrations depends on the size of the `datasets` table:
   - For small to medium-sized tables, the operations should be relatively quick.
   - For very large tables, the migrations might take considerable time and could potentially lock the table during execution.

2. It's recommended to perform these schema changes during low-traffic periods to minimize disruption to applications using the database.

3. The use of `jsonb` type in the "down" migration allows for efficient storage and querying of JSON data, which can be beneficial for performance if the column is heavily used.

## TODOs
1. Ensure that the SQL commands in both files are correct and final before executing in a production environment.
2. Update any application code, queries, or data access layers that might be affected by the removal of the `client_configuration` column.
3. If rolling back the migration, consider how to handle the loss of data that was in the original `client_configuration` column before it was dropped.
4. Review and update any database indexes, constraints, or triggers that might have referenced the `client_configuration` column.

By following these migration scripts, database administrators can effectively manage the evolution of the database schema, ensuring that it aligns with the current needs of the application while maintaining the ability to revert changes if necessary.