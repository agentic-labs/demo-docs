---
title: "up.sql"
---

## High-level description
This SQL script alters the `user_api_key` table to improve the performance of API key lookups. It adds a new column `blake3_hash` and makes the existing `api_key_hash` column non-nullable.

## Symbols
### `ALTER TABLE user_api_key ADD COLUMN blake3_hash TEXT;`
#### Description
This statement adds a new column named `blake3_hash` to the `user_api_key` table. The column is of type `TEXT`, which can store a variable-length string, likely intended for storing a hash value.

#### Internal Logic
- `ALTER TABLE user_api_key`: This part specifies that the table named `user_api_key` is being modified.
- `ADD COLUMN blake3_hash`: This part instructs to add a new column with the name `blake3_hash`.
- `TEXT`: This defines the data type of the new column as `TEXT`, allowing it to store text strings.

### `ALTER TABLE user_api_key ALTER COLUMN api_key_hash DROP NOT NULL;`
#### Description
This statement modifies the existing `api_key_hash` column in the `user_api_key` table to remove the `NOT NULL` constraint. This means the column can now contain null values.

#### Internal Logic
- `ALTER TABLE user_api_key`: This part specifies that the table named `user_api_key` is being modified.
- `ALTER COLUMN api_key_hash`: This part indicates that the existing column `api_key_hash` is being altered.
- `DROP NOT NULL`: This part removes the `NOT NULL` constraint from the `api_key_hash` column, allowing it to accept null values.
