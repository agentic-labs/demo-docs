---
title: "up.sql"
---

## High-level description
This SQL migration file creates two new tables in the database: `stripe_plans` and `stripe_subscriptions`. These tables are designed to store information about Stripe plans and subscriptions, respectively, which are likely used for managing payment plans and subscriptions within the application.

## Code Structure
The code consists of two `CREATE TABLE` statements, each defining the structure for a new table in the database.

## Symbols

### `stripe_plans` table
#### Description
This table stores information about different Stripe plans available in the system.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| id | UUID | Primary key, unique identifier for the plan |
| stripe_id | TEXT | Unique identifier from Stripe |
| card_count | INTEGER | Number of cards allowed in the plan (default: 0) |
| file_storage | INTEGER | Amount of file storage allowed (default: 0) |
| user_count | INTEGER | Number of users allowed (default: 0) |
| dataset_count | INTEGER | Number of datasets allowed (default: 0) |
| message_count | INTEGER | Number of messages allowed (default: 0) |
| amount | BIGINT | Cost of the plan |
| created_at | TIMESTAMP | When the plan was created |
| updated_at | TIMESTAMP | When the plan was last updated |

### `stripe_subscriptions` table
#### Description
This table stores information about subscriptions to Stripe plans for different organizations.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| id | UUID | Primary key, unique identifier for the subscription |
| stripe_id | TEXT | Unique identifier from Stripe |
| plan_id | UUID | Foreign key referencing the `stripe_plans` table |
| organization_id | UUID | Foreign key referencing the `organizations` table |
| created_at | TIMESTAMP | When the subscription was created |
| updated_at | TIMESTAMP | When the subscription was last updated |

## References
- The `stripe_subscriptions` table references the `stripe_plans` table through the `plan_id` foreign key.
- The `stripe_subscriptions` table references an `organizations` table through the `organization_id` foreign key.

## Dependencies
This migration depends on the existence of an `organizations` table, which is referenced by the `stripe_subscriptions` table.

## Performance Considerations
- Both tables use UUIDs as primary keys, which can have performance implications for very large datasets compared to auto-incrementing integers.
- The `stripe_id` column in both tables is marked as `UNIQUE`, which will create an index to ensure uniqueness and potentially speed up lookups by this field.