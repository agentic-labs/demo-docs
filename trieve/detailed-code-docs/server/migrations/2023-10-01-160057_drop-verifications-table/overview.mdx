---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for dropping the `verification_notifications` and `card_verification` tables from the database schema. The migration is dated 2023-10-01 and is identified by the timestamp 160057. The directory includes both 'up' and 'down' migration scripts, allowing for the changes to be applied or reverted as needed.

## What does it do?
This migration removes two tables related to card verification from the database:

1. `verification_notifications`: This table likely stored notifications sent to users about card verifications.
2. `card_verification`: This table probably contained records of card verification events.

The 'up' migration script removes these tables, while the 'down' migration script recreates them, allowing the database schema to be rolled back to its previous state if necessary.

## Key Files

### up.sql
This file contains the SQL commands to drop the `verification_notifications` and `card_verification` tables. It uses `DROP TABLE IF EXISTS` statements to ensure the operation is idempotent (can be run multiple times without error).

```sql
DROP TABLE IF EXISTS verification_notifications;
DROP TABLE IF EXISTS card_verification;
```

### down.sql
This file contains the SQL commands to recreate the dropped tables and their associated constraints. It includes:

1. Recreation of the `verification_notifications` table with its original structure:

```sql
CREATE TABLE verification_notifications (
    id UUID PRIMARY KEY,
    user_uuid UUID NOT NULL REFERENCES users(id),
    card_uuid UUID NOT NULL REFERENCES card_metadata(id),
    verification_uuid UUID NOT NULL REFERENCES card_verification(id),
    similarity_score BIGINT NOT NULL,
    user_read BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL
);
```

2. Addition of a unique constraint on the `card_verification` table:

```sql
ALTER TABLE card_verification ADD CONSTRAINT uq_card_id UNIQUE (card_id);
```

3. Recreation of the `card_verification` table:

```sql
CREATE TABLE public.card_verification (
    id UUID NOT NULL,
    card_id UUID NOT NULL,
    similarity_score BIGINT NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL,
    CONSTRAINT card_verification_pkey PRIMARY KEY (id)
);
```

## Configuration
This migration does not require any specific configuration. It is designed to be run as part of a database migration process, typically managed by an ORM or migration tool in the application's backend.

The migration is identified by its timestamp (2023-10-01-160057), which should be used by the migration tool to determine the order of execution relative to other migrations.

## Dependencies
This migration has implicit dependencies on the existence of the following database objects:

1. `users` table (referenced by `verification_notifications.user_uuid`)
2. `card_metadata` table (referenced by `verification_notifications.card_uuid`)

These dependencies are not created or modified by this migration but are assumed to exist in the database schema.

## Entry points
There are two main entry points for this migration:

1. `up.sql`: This is the script that will be run when applying the migration, dropping the specified tables.
2. `down.sql`: This is the script that will be run when reverting the migration, recreating the dropped tables.

The choice of which script to run depends on whether the migration is being applied (moving forward) or reverted (rolling back).

In a typical database migration workflow:
1. When updating the database schema, the migration tool would execute `up.sql`.
2. If there's a need to revert this change, the migration tool would execute `down.sql`.

This bidirectional approach allows for flexible management of database schema changes, enabling easy updates and rollbacks as needed during development or deployment processes.