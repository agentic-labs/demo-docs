---
title: "up.sql"
---

## High-level description
This SQL script adds a new column `card_metadata_tsvector` to the `card_metadata` table for storing full-text search vectors generated from the `content` column. It then populates this new column with tsvector values for existing rows and creates a GIN index on the `card_metadata_tsvector` column to speed up full-text searches. 

## Symbols

### `ALTER TABLE card_metadata ADD COLUMN card_metadata_tsvector TSVECTOR;`
#### Description
This statement adds a new column named `card_metadata_tsvector` to the `card_metadata` table. The data type of the new column is `TSVECTOR`, which is used to store text search vectors.

#### Internal Logic
This statement modifies the structure of the `card_metadata` table by adding a new column specifically designed for storing tsvector data.

### `UPDATE card_metadata SET card_metadata_tsvector = to_tsvector('english', content);`
#### Description
This statement populates the newly added `card_metadata_tsvector` column with tsvector values generated from the existing `content` column.

#### Internal Logic
This statement iterates through each row in the `card_metadata` table and updates the `card_metadata_tsvector` column. For each row, it uses the `to_tsvector` function to generate a tsvector value from the `content` column, specifying 'english' as the language for text search parsing.

### `CREATE INDEX idx_card_metadata_tsvector ON card_metadata USING GIN(card_metadata_tsvector);`
#### Description
This statement creates a Generalized Inverted Index (GIN) named `idx_card_metadata_tsvector` on the `card_metadata_tsvector` column.

#### Internal Logic
This statement creates an index specifically designed for optimizing full-text search queries using the tsvector data stored in the `card_metadata_tsvector` column. The GIN index is chosen because it is well-suited for indexing tsvector values and provides efficient performance for full-text searches.
