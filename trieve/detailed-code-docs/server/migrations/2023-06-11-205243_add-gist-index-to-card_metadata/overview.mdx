---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for adding and removing a GIN index and a tsvector column to the `card_metadata` table. These changes are designed to enhance full-text search capabilities on the content of card metadata.

## What does it do?
The migration scripts in this directory perform the following actions:

1. Add a new column called `card_metadata_tsvector` to the `card_metadata` table. This column is designed to store text search vectors, which are optimized representations of text for full-text search operations.

2. Populate the new `card_metadata_tsvector` column with data derived from the existing `content` column. This is done by converting the content to a tsvector format, which breaks down the text into searchable tokens.

3. Create a GIN (Generalized Inverted Index) index on the `card_metadata_tsvector` column. This index significantly speeds up full-text search queries on the card metadata.

4. Provide a way to revert these changes by dropping the newly created index and column.

These changes allow for more efficient and powerful text search capabilities within the card metadata, which can improve the overall performance and functionality of the application, especially for features that involve searching or filtering cards based on their content.

## Key Files

### up.sql
This file contains the SQL commands to implement the new full-text search capabilities:

```sql
ALTER TABLE card_metadata ADD COLUMN card_metadata_tsvector TSVECTOR;
UPDATE card_metadata SET card_metadata_tsvector = to_tsvector('english', content);
CREATE INDEX idx_card_metadata_tsvector ON card_metadata USING GIN(card_metadata_tsvector);
```

These commands add the new tsvector column, populate it with data, and create the GIN index.

### down.sql
This file contains the SQL commands to revert the changes made by up.sql:

```sql
DROP INDEX IF EXISTS idx_card_metadata_tsvector;
ALTER TABLE card_metadata DROP COLUMN IF EXISTS card_metadata_tsvector;
```

These commands remove the GIN index and the tsvector column, effectively undoing the migration.

## Configuration
This migration does not require any specific configuration. However, it's important to note that it assumes:

1. The existence of a `card_metadata` table with a `content` column.
2. The use of English language for text search parsing (as specified in the `to_tsvector('english', content)` function call).

If the application needs to support multiple languages or use a different language for text search, the `'english'` parameter in the `to_tsvector` function would need to be adjusted accordingly.

## Dependencies
This migration relies on PostgreSQL's built-in full-text search capabilities, including:

1. The `tsvector` data type
2. The `to_tsvector` function
3. GIN indexing

These features are standard in PostgreSQL 9.6 and later versions. The exact version of PostgreSQL being used is not specified in these migration files, but it should be at least 9.6 to support these operations efficiently.

In conclusion, this migration enhances the database's ability to perform fast and efficient full-text searches on card metadata, which can significantly improve the performance of search-related features in the application.