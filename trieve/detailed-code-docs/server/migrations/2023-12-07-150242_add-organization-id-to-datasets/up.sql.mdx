---
title: "up.sql"
---

## High-level description
This SQL script migrates the `datasets` table by adding a new column `organization_id` referencing the `organizations` table. It then updates existing datasets to belong to the 'DEFAULT' organization and finally makes the `organization_id` column non-nullable.

## Code Structure
The script executes a sequence of SQL statements to alter the `datasets` table and establish a relationship with the `organizations` table.

## Symbols

### `ALTER TABLE datasets ADD COLUMN organization_id UUID DEFAULT NULL;`
#### Description
This statement adds a new column named `organization_id` to the `datasets` table. The column's data type is UUID and it allows null values by default.

#### Internal Logic
- `ALTER TABLE datasets`: This clause initiates the modification of the existing `datasets` table.
- `ADD COLUMN organization_id`: This clause specifies the addition of a new column named `organization_id`.
- `UUID`: This defines the data type of the new column as UUID (Universally Unique Identifier).
- `DEFAULT NULL`: This sets the default value of the `organization_id` column to NULL, meaning new datasets will not have an organization assigned by default.

### `UPDATE datasets SET organization_id = organizations.id FROM organizations WHERE organizations.name = 'DEFAULT';`
#### Description
This statement updates the newly added `organization_id` column in the `datasets` table. It sets the `organization_id` to the `id` of the organization from the `organizations` table where the organization's name is 'DEFAULT'.

#### Internal Logic
- `UPDATE datasets`: This clause initiates the update operation on the `datasets` table.
- `SET organization_id = organizations.id`: This clause sets the value of the `organization_id` column in the `datasets` table.
- `FROM organizations`: This clause specifies that the data for the update operation will be retrieved from the `organizations` table.
- `WHERE organizations.name = 'DEFAULT'`: This clause filters the rows from the `organizations` table, selecting only the row where the `name` column is equal to 'DEFAULT'.

### `ALTER TABLE datasets ALTER COLUMN organization_id SET NOT NULL;`
#### Description
This statement modifies the `organization_id` column in the `datasets` table to disallow null values.

#### Internal Logic
- `ALTER TABLE datasets`: This clause initiates the modification of the existing `datasets` table.
- `ALTER COLUMN organization_id`: This clause specifies that the `organization_id` column will be modified.
- `SET NOT NULL`: This clause sets the `organization_id` column to be non-nullable, meaning it cannot contain NULL values.

### `ALTER TABLE datasets ADD CONSTRAINT datasets_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES organizations(id);`
#### Description
This statement adds a foreign key constraint to the `datasets` table, establishing a relationship with the `organizations` table through the `organization_id` column.

#### Internal Logic
- `ALTER TABLE datasets`: This clause initiates the modification of the existing `datasets` table.
- `ADD CONSTRAINT datasets_organization_id_fkey`: This clause adds a new constraint named `datasets_organization_id_fkey` to the `datasets` table.
- `FOREIGN KEY (organization_id)`: This clause defines the `organization_id` column as the foreign key.
- `REFERENCES organizations(id)`: This clause specifies that the foreign key `organization_id` references the `id` column in the `organizations` table. This ensures that any value in the `organization_id` column of the `datasets` table must correspond to a valid `id` in the `organizations` table, enforcing referential integrity.
