---
title: "Overview"
---

## High-level description
This directory contains SQL migration files for adding and removing a `normal_chat` column to the `topics` table in the database. The migration is dated 2023-05-15 and is identified by the timestamp 061509. The directory includes two SQL files: `up.sql` for applying the change and `down.sql` for reverting it.

## What does it do?
This migration adds a new feature to the database schema related to chat functionality. It introduces a boolean flag called `normal_chat` to the `topics` table. This flag likely indicates whether a topic is associated with a normal chat or possibly some other type of chat (e.g., a special or advanced chat mode).

When applied, the migration adds the `normal_chat` column to the `topics` table, setting it as a non-nullable boolean with a default value of false. This means that all existing topics will be marked as not being "normal chats" by default, and any new topics created will require this field to be specified or will default to false.

If the migration needs to be rolled back, the `down.sql` script will remove the `normal_chat` column from the `topics` table, effectively undoing the change and returning the database schema to its previous state.

## Key Files

1. `up.sql`: This file contains the SQL command to add the `normal_chat` column to the `topics` table.

   ```sql
   ALTER TABLE topics
   ADD COLUMN normal_chat boolean NOT NULL DEFAULT false;
   ```

   This command modifies the `topics` table by adding a new boolean column named `normal_chat`. The column is set to not allow NULL values and has a default value of false.

2. `down.sql`: This file contains the SQL command to remove the `normal_chat` column from the `topics` table.

   ```sql
   ALTER TABLE topics DROP COLUMN normal_chat;
   ```

   This command alters the `topics` table by removing the `normal_chat` column, effectively undoing the change made by the `up.sql` script.

## Configuration
The migration files themselves do not contain any configurable parameters. However, the naming convention of the directory (2023-05-15-061509_normal_chat) suggests that this migration system likely uses timestamps for ordering and identifying migrations. This naming scheme is important for the migration tool to determine the order in which to apply or revert migrations.

## Performance Considerations
When applying or reverting this migration, there are a few performance considerations to keep in mind:

1. Table Locking: Altering table structure may cause temporary locks on the `topics` table. The duration of this lock depends on the size of the table and the database system being used.

2. Data Volume: If the `topics` table contains a large amount of data, adding or removing a column could take longer and potentially impact database performance during the migration.

3. Application Impact: During the migration, any queries or application code that interacts with the `topics` table may be briefly affected. It's recommended to perform this migration during a maintenance window or low-traffic period.

4. Rollback Considerations: When rolling back this migration (using `down.sql`), all data in the `normal_chat` column will be permanently lost. Ensure that any important data is backed up before reverting the migration if necessary.

In conclusion, this migration introduces a new boolean flag to the `topics` table, likely to support a feature related to differentiating between normal chats and other types of chats. The migration is designed to be reversible, allowing for easy application and rollback of the schema change.