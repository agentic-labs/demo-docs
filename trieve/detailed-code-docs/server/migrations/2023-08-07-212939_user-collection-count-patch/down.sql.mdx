---
title: "down.sql"
---

## High-level description
This SQL script performs database migration rollback operations, specifically reverting changes introduced by the `up.sql` script related to user card collection counts. It drops a trigger, a function, and a table associated with maintaining and updating these counts.

## Symbols
### `DROP TRIGGER IF EXISTS update_collection_counts_trigger ON card_collection`
#### Description
This statement attempts to drop a trigger named `update_collection_counts_trigger` associated with the `card_collection` table. The `IF EXISTS` clause ensures that the operation proceeds without errors even if the trigger doesn't exist. This suggests the trigger was likely created in the `up.sql` migration and is being reverted here.

#### Internal Logic
1. **Check for Trigger Existence:** The database checks if a trigger named `update_collection_counts_trigger` exists on the `card_collection` table.
2. **Drop Trigger (If Exists):** If the trigger exists, it is dropped, removing any associated actions that were set to occur on events related to the `card_collection` table. If the trigger doesn't exist, the statement completes without taking any action.

### `DROP FUNCTION IF EXISTS update_collection_counts()`
#### Description
This statement attempts to drop a function named `update_collection_counts`. The `IF EXISTS` clause ensures that the operation proceeds without errors even if the function doesn't exist. This suggests the function was likely created in the `up.sql` migration and is being reverted here.

#### Internal Logic
1. **Check for Function Existence:** The database checks if a function named `update_collection_counts` exists.
2. **Drop Function (If Exists):** If the function exists, it is dropped from the database. If the function doesn't exist, the statement completes without taking any action.

### `DROP TABLE IF EXISTS user_collection_counts`
#### Description
This statement attempts to drop a table named `user_collection_counts`. The `IF EXISTS` clause ensures that the operation proceeds without errors even if the table doesn't exist. This suggests the table was likely created in the `up.sql` migration and is being reverted here.

#### Internal Logic
1. **Check for Table Existence:** The database checks if a table named `user_collection_counts` exists.
2. **Drop Table (If Exists):** If the table exists, it is dropped from the database, along with all of its data and associated constraints. If the table doesn't exist, the statement completes without taking any action.
