---
title: "down.sql"
---

## High-level description
This SQL script defines a database migration that reverts a change made in a previous migration, specifically the removal of the `stripe_customers` table. It recreates the table with its original columns and constraints.

## Symbols

### `CREATE TABLE stripe_customers`
#### Description
This SQL statement recreates the `stripe_customers` table, which stores information about Stripe customers. Each row represents a unique customer and includes their Stripe ID, email address, creation timestamp, update timestamp, and a foreign key reference to the `users` table.

#### Inputs
N/A - This is a DDL statement, not a function.

#### Outputs
N/A - This is a DDL statement, not a function.

#### Internal Logic
1. **`CREATE TABLE stripe_customers`**: This clause initiates the creation of a new table named `stripe_customers`.
2. **`(id UUID NOT NULL UNIQUE PRIMARY KEY)`**: Defines the `id` column as a UUID (Universally Unique Identifier), ensuring each customer has a unique identifier. It's marked as `NOT NULL` (mandatory) and `PRIMARY KEY` (main identifier for the table).
3. **`stripe_id TEXT NOT NULL UNIQUE`**: Defines the `stripe_id` column to store Stripe-specific customer IDs as text. It's also mandatory (`NOT NULL`) and must be unique (`UNIQUE`).
4. **`email VARCHAR(100) UNIQUE DEFAULT NULL`**: Defines the `email` column to store customer email addresses with a maximum length of 100 characters. It allows `NULL` values (no email provided) by default and enforces uniqueness (`UNIQUE`).
5. **`created_at TIMESTAMP NOT NULL`**: Defines the `created_at` column to store the timestamp of when the customer record was created. It cannot be `NULL`.
6. **`updated_at TIMESTAMP NOT NULL`**: Defines the `updated_at` column to store the timestamp of the last update to the customer record. It also cannot be `NULL`.
7. **`FOREIGN KEY (email) REFERENCES users(email)`**: Establishes a foreign key constraint on the `email` column, linking it to the `users` table. This ensures that any email address in `stripe_customers` must also exist in the `users` table, maintaining data integrity.

## Side Effects
This script modifies the database schema by recreating the `stripe_customers` table. 
