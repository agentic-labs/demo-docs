---
title: "Overview"
---

## High-level description
This directory contains SQL migration files for adding a new `weight` column to the `card_metadata` table in the database. The migration is dated 2023-12-19 and includes both an "up" migration to apply the change and a "down" migration to revert it.

## What does it do?
These migration files modify the structure of the `card_metadata` table in the database. The "up" migration adds a new column called `weight` to store a numerical value associated with each card. This weight is set to default to 1 if not specified. The "down" migration provides a way to undo this change by removing the `weight` column if needed.

## Key Files

1. `up.sql`: This file contains the SQL command to add the `weight` column to the `card_metadata` table.

   ```sql
   ALTER TABLE card_metadata
   ADD COLUMN weight double precision NOT NULL DEFAULT 1;
   ```

   This command adds a new column named `weight` with the following characteristics:
   - Data type: `double precision` (allows for high-precision floating-point numbers)
   - Constraint: `NOT NULL` (ensures the column always has a value)
   - Default value: 1 (if no value is specified when inserting a new row)

2. `down.sql`: This file contains the SQL command to remove the `weight` column from the `card_metadata` table.

   ```sql
   ALTER TABLE card_metadata
   DROP COLUMN IF EXISTS weight;
   ```

   This command removes the `weight` column if it exists, providing a way to revert the changes made by the up migration.

## Side Effects
- Applying the up migration will modify the structure of the `card_metadata` table, adding the `weight` column to all existing rows with a default value of 1.
- Applying the down migration will remove the `weight` column and all its data from the `card_metadata` table.
- These changes may affect any queries or operations that interact with the `card_metadata` table, potentially requiring updates to application code that uses this table.

## Performance Considerations
- The up migration may take some time to complete if the `card_metadata` table contains a large number of rows, as it needs to add the new column to all existing records.
- If there are any indexes on the `card_metadata` table, they might need to be rebuilt after applying the up migration.
- The down migration (dropping a column) is generally a faster operation but may still impact performance temporarily on large tables.

## Error Handling
- The down migration uses the `IF EXISTS` clause when dropping the column, which prevents errors if the column doesn't exist. This makes the migration more robust and allows it to be run multiple times without causing issues.

## TODOs
- The comment "-- Your SQL goes here" in the `up.sql` file could be removed as it's no longer needed.
- Ensure that any application code or queries that interact with the `card_metadata` table are updated to handle the new `weight` column appropriately.
- Consider adding appropriate indexes on the `weight` column if it will be frequently used in queries, especially for sorting or filtering operations.

This migration set provides a clear and reversible way to add a new feature (card weight) to the database schema, allowing for easy application and rollback of the change as needed.