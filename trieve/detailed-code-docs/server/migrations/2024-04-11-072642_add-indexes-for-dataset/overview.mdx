---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for adding and removing indexes on specific columns in the `datasets` and `stripe_subscriptions` tables. The migration is dated 2024-04-11 and is designed to improve query performance for these tables.

## What does it do?
The migration scripts in this directory perform two main actions:

1. In the "up" migration:
   - Creates an index on the `organization_id` column of the `datasets` table.
   - Creates an index on the `plan_id` column of the `stripe_subscriptions` table.

2. In the "down" migration:
   - Removes the index on the `organization_id` column of the `datasets` table.
   - Removes the index on the `plan_id` column of the `stripe_subscriptions` table.

These actions are designed to optimize database performance for queries that frequently use these columns for filtering or joining operations. The "up" migration improves query speed, while the "down" migration allows for reverting these changes if needed.

## Key Files

### up.sql
This file contains the SQL commands to create the new indexes:

```sql
CREATE INDEX IF NOT EXISTS datasets_organization_id_index ON datasets (organization_id);
CREATE INDEX IF NOT EXISTS stripe_subscriptions_plan_id_index ON stripe_subscriptions (plan_id);
```

These commands create indexes only if they don't already exist, ensuring idempotency of the migration.

### down.sql
This file contains the SQL commands to remove the indexes created by the up migration:

```sql
ALTER TABLE datasets DROP INDEX datasets_organization_id_index;
ALTER TABLE stripe_subscriptions DROP INDEX stripe_subscriptions_plan_id_index;
```

These commands remove the specific indexes, allowing the database schema to be reverted to its previous state.

## Configuration
This migration doesn't require any specific configuration. It's designed to be run as part of a database migration process, typically managed by an ORM or migration tool in the application's backend.

The migration is identified by its timestamp (2024-04-11-072642), which ensures it's applied in the correct order relative to other migrations.

## Dependencies
This migration doesn't explicitly depend on any external libraries or frameworks. However, it assumes the existence of:

1. A `datasets` table with an `organization_id` column
2. A `stripe_subscriptions` table with a `plan_id` column

These tables should be created by earlier migrations or as part of the initial database setup.

## Additional Notes

1. Performance Impact: 
   - The addition of these indexes will likely improve query performance for operations that filter or join on the `organization_id` and `plan_id` columns.
   - However, index creation and maintenance can slightly slow down write operations (INSERT, UPDATE, DELETE) on these tables.

2. Storage Considerations:
   - Creating indexes will increase the database size, as indexes require additional storage.

3. Migration Reversibility:
   - The provided "down" migration ensures that these changes can be fully reversed if needed.

4. Idempotency:
   - The use of `IF NOT EXISTS` in the "up" migration ensures that the migration can be run multiple times without error, even if the indexes already exist.

5. Naming Convention:
   - The index names (`datasets_organization_id_index` and `stripe_subscriptions_plan_id_index`) follow a clear naming convention, which is good for maintainability.

By implementing these indexes, the database queries related to organization IDs in datasets and plan IDs in stripe subscriptions should see improved performance, potentially leading to faster application response times for operations involving these tables.