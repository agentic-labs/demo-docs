---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for creating and dropping tables related to tag sets in a database. The migration is dated 2024-06-06-031312 and specifically focuses on creating tables for dataset tags and chunk metadata tags.

## What does it do?
The migration scripts in this directory perform the following actions:

1. Create two new tables:
   - `dataset_tags`: Stores unique tags associated with datasets.
   - `chunk_metadata_tags`: Links chunk metadata to tags defined in the `dataset_tags` table.

2. Establish relationships between these new tables and existing tables (`datasets` and `chunk_metadata`).

3. Provide a way to revert these changes by dropping the newly created tables.

These scripts allow the database to support tagging functionality for datasets and chunk metadata, enabling better organization and searchability of data within the system.

## Key Files

### up.sql
This file contains the SQL commands to create the new tables and establish their relationships. Key features include:

- Creation of the `dataset_tags` table with columns:
  - `id`: UUID primary key
  - `dataset_id`: UUID foreign key referencing the `datasets` table
  - `tag`: TEXT field for the tag value
- Creation of the `chunk_metadata_tags` table with columns:
  - `id`: UUID primary key
  - `chunk_metadata_id`: UUID foreign key referencing the `chunk_metadata` table
  - `tag_id`: UUID foreign key referencing the `dataset_tags` table
- Establishment of unique constraints to ensure data integrity

Example of table creation:

```sql
CREATE TABLE dataset_tags (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    dataset_id UUID NOT NULL REFERENCES datasets(id) ON DELETE CASCADE,
    tag TEXT NOT NULL,
    CONSTRAINT dataset_tags_dataset_id_tag UNIQUE(dataset_id, tag)
);
```

### down.sql
This file contains the SQL commands to revert the changes made by the up.sql script. It simply drops the newly created tables:

```sql
DROP TABLE IF EXISTS chunk_metadata_tags;
DROP TABLE IF EXISTS dataset_tags;
```

The `IF EXISTS` clause is used to prevent errors if the tables don't exist when the down migration is run.

## Configuration
This migration doesn't require any specific configuration. It assumes the existence of the following tables in the database:

- `datasets`
- `chunk_metadata`

The migration also assumes that the UUID extension is available in the database for generating UUID values.

By implementing these tables, the system gains the ability to associate tags with datasets and chunk metadata, enabling more sophisticated data organization and retrieval capabilities. The use of foreign keys and unique constraints ensures data integrity and prevents duplicate entries.