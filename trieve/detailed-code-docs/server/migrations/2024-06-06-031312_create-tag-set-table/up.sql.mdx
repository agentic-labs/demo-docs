---
title: "up.sql"
---

## High-level description
This SQL script defines two tables, `dataset_tags` and `chunk_metadata_tags`, to implement a tagging system for datasets and chunk metadata within a database. It establishes relationships between these tables and enforces data integrity through constraints and foreign keys.

## Code Structure
The code defines two tables: `dataset_tags` and `chunk_metadata_tags`. The `dataset_tags` table stores unique tags associated with datasets. The `chunk_metadata_tags` table links tags from `dataset_tags` to specific chunk metadata entries in a `chunk_metadata` table. Foreign key constraints ensure referential integrity between these tables.

## References
- `datasets` table (referenced by `dataset_tags`)
- `chunk_metadata` table (referenced by `chunk_metadata_tags`)

## Symbols
### `dataset_tags` table
#### Description
This table stores unique tags associated with specific datasets.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| id | UUID | Primary key, automatically generated UUID |
| dataset_id | UUID | Foreign key referencing the `datasets` table, ensuring a valid dataset is linked |
| tag | TEXT | The actual tag value, enforced to be unique within the context of a dataset |

#### Constraints
- `dataset_tags_pkey`: Primary key constraint on the `id` column.
- `dataset_tags_id_dataset_id`: Unique constraint ensuring a unique combination of `id` and `dataset_id`.
- `dataset_tags_dataset_id_fkey`: Foreign key constraint referencing the `datasets` table's `id` column. It enforces cascading updates and deletions to maintain referential integrity.

### `chunk_metadata_tags` table
#### Description
This table connects tags from the `dataset_tags` table to specific chunk metadata entries.

#### Columns
| Name | Type | Description |
|:-----|:-----|:------------|
| id | UUID | Primary key, automatically generated UUID |
| chunk_metadata_id | UUID | Foreign key referencing the `chunk_metadata` table, ensuring a link to valid chunk metadata |
| tag_id | UUID | Foreign key referencing the `dataset_tags` table, linking to a specific tag |

#### Constraints
- `chunk_metadata_tags_pkey`: Primary key constraint on the `id` column.
- `chunk_metadata_tags_metadata_id_tag_id`: Unique constraint ensuring a unique combination of `chunk_metadata_id` and `tag_id`, preventing duplicate tag assignments to the same chunk metadata.
- `chunk_metadata_tags_chunk_metadata_id_fkey`: Foreign key constraint referencing the `chunk_metadata` table's `id` column. It enforces cascading updates and deletions.
- `chunk_metadata_tags_tag_id_fkey`: Foreign key constraint referencing the `dataset_tags` table's `id` column. It enforces cascading updates and deletions.
