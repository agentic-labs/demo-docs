---
title: "down.sql"
---

## High-level description
This SQL script defines the "down" migration for reverting a database schema change. It specifically recreates the `user_plans` table and its associated index `idx_user_plans_stripe_customer_id` that were likely dropped in the corresponding `up.sql` migration file. 

This suggests that the `user_plans` table was deemed unnecessary or redundant in a later version of the application, and thus removed. This migration script allows for reverting to a previous state of the database schema where this table existed.

## Symbols

### `CREATE TABLE user_plans`
#### Description
This statement recreates the `user_plans` table with its original columns and constraints.

#### Internal Logic
- The table is created with the name `user_plans`.
- It defines several columns:
    - `id`: A UUID acting as the primary key, ensuring each row has a unique identifier.
    - `stripe_customer_id`: A text field storing a unique Stripe customer ID, likely for integrating with the Stripe payment platform.
    - `stripe_subscription_id`: A text field storing a unique Stripe subscription ID, also likely for Stripe integration.
    - `plan`: A text field indicating the user's chosen subscription plan.
    - `status`: A text field representing the current status of the user's subscription.
    - `created_at`: A timestamp recording when the record was created.
    - `updated_at`: A timestamp recording when the record was last updated.

- Constraints:
    - `NOT NULL` is applied to all columns, ensuring no field can be empty.
    - `UNIQUE` is applied to `id`, `stripe_customer_id`, and `stripe_subscription_id`, enforcing their uniqueness within the table.
    - `PRIMARY KEY` is assigned to `id`, making it the primary identifier for rows in the table.

### `CREATE INDEX idx_user_plans_stripe_customer_id`
#### Description
This statement recreates an index on the `stripe_customer_id` column of the `user_plans` table.

#### Internal Logic
- It creates an index named `idx_user_plans_stripe_customer_id`.
- The index is built on the `stripe_customer_id` column of the `user_plans` table.
- This index is likely intended to speed up queries that filter or search based on the `stripe_customer_id`.
