---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for modifying the `card_metadata` table in a database. The migration adds a new `private` boolean field to the table and makes changes to the `qdrant_point_id` column, including adding a constraint. The directory includes both "up" and "down" migration scripts to allow for applying and reverting the changes.

## What does it do?
These migration scripts modify the structure of the `card_metadata` table in the database. The main changes are:

1. Adding a new `private` boolean column to indicate whether a card is private or not.
2. Making the `qdrant_point_id` column nullable.
3. Adding a constraint to ensure that if a card is not private, it must have a `qdrant_point_id`.

These changes allow the system to differentiate between private and public cards, and to manage the relationship between a card's privacy status and its associated `qdrant_point_id`.

The "up" migration applies these changes, while the "down" migration reverts them, allowing for easy application and rollback of the database modifications.

## Key Files

### up.sql
This file contains the SQL statements to apply the migration:

```sql
ALTER TABLE card_metadata ADD COLUMN private BOOLEAN NOT NULL DEFAULT false;
ALTER TABLE card_metadata ALTER COLUMN qdrant_point_id DROP NOT NULL;
ALTER TABLE card_metadata ADD CONSTRAINT qdrant_point_nullable_constraint CHECK (private = true OR qdrant_point_id IS NOT NULL);
```

These statements add the `private` column, make `qdrant_point_id` nullable, and add a constraint to ensure that non-private cards have a `qdrant_point_id`.

### down.sql
This file contains the SQL statements to revert the migration:

```sql
ALTER TABLE card_metadata DROP CONSTRAINT qdrant_point_nullable_constraint;
ALTER TABLE card_metadata ALTER COLUMN qdrant_point_id SET NOT NULL;
ALTER TABLE card_metadata DROP COLUMN private;
```

These statements remove the added constraint, make `qdrant_point_id` non-nullable again, and remove the `private` column.

## Configuration
The migration is identified by its timestamp: `2023-06-15-183634`. This timestamp is likely used by the migration system to track which migrations have been applied and in what order.

No additional configuration files or environment variables are required for these migration scripts.