---
title: "down.sql"
---

## High-level description
This SQL migration script is designed to revert changes made to the `card_metadata` table. It removes a CHECK constraint, modifies a column to disallow NULL values, and drops a column named 'private'.

## Symbols

### SQL Commands

#### Description
This migration script contains three main SQL commands, each performing a specific operation on the `card_metadata` table.

#### Internal Logic

1. **Remove CHECK constraint:**
   ```sql
   ALTER TABLE card_metadata
   DROP CONSTRAINT qdrant_point_nullable_constraint;
   ```
   This command removes a CHECK constraint named `qdrant_point_nullable_constraint` from the `card_metadata` table. The constraint likely enforced some condition on the `qdrant_point_id` column.

2. **Modify column to disallow NULL:**
   ```sql
   ALTER TABLE card_metadata
   ALTER COLUMN qdrant_point_id SET NOT NULL;
   ```
   This command modifies the `qdrant_point_id` column in the `card_metadata` table to disallow NULL values. This suggests that the column was previously allowed to contain NULL values.

3. **Drop column:**
   ```sql
   ALTER TABLE card_metadata
   DROP COLUMN private;
   ```
   This command removes the `private` column from the `card_metadata` table entirely.

## Side Effects
- The `card_metadata` table structure is modified:
  - A CHECK constraint is removed, potentially allowing previously invalid data.
  - The `qdrant_point_id` column no longer accepts NULL values, which may cause issues if there are existing NULL values in this column.
  - The `private` column is completely removed, resulting in loss of any data stored in this column.

## Notes
This appears to be a 'down' migration script, meant to revert changes made in a corresponding 'up' migration. The operations performed suggest that the original 'up' migration likely:
1. Added a CHECK constraint named `qdrant_point_nullable_constraint`.
2. Modified the `qdrant_point_id` column to allow NULL values.
3. Added a new column named `private`.

When applying this 'down' migration, it's important to ensure that:
1. There are no NULL values in the `qdrant_point_id` column before making it NOT NULL.
2. Any processes or applications relying on the `private` column are updated to handle its absence.
3. The removal of the CHECK constraint doesn't introduce data integrity issues.