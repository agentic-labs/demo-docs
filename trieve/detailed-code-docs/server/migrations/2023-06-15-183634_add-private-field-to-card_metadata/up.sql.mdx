---
title: "up.sql"
---

## High-level description
This SQL script modifies the `card_metadata` table by adding a new boolean column named `private` and adjusting the existing `qdrant_point_id` column to be nullable. It also adds a constraint to ensure that if a card is not private, it must have a `qdrant_point_id`.

## Symbols

### `ALTER TABLE card_metadata ADD COLUMN private BOOLEAN NOT NULL DEFAULT false;`
#### Description
This statement adds a new column named `private` to the `card_metadata` table. 

#### Internal Logic
* **`ALTER TABLE card_metadata`**: Specifies that the `card_metadata` table is being modified.
* **`ADD COLUMN private`**:  Adds a new column named `private`.
* **`BOOLEAN`**: Defines the data type of the new column as boolean (true/false).
* **`NOT NULL`**: Specifies that the `private` column cannot contain null values.
* **`DEFAULT false`**: Sets the default value for the `private` column to `false` for newly inserted rows.

### `ALTER TABLE card_metadata ALTER COLUMN qdrant_point_id DROP NOT NULL;`
#### Description
This statement modifies the existing `qdrant_point_id` column in the `card_metadata` table to allow null values.

#### Internal Logic
* **`ALTER TABLE card_metadata`**: Specifies that the `card_metadata` table is being modified.
* **`ALTER COLUMN qdrant_point_id`**: Specifies that the `qdrant_point_id` column is being modified.
* **`DROP NOT NULL`**: Removes the `NOT NULL` constraint from the column, allowing it to accept null values.

### `ALTER TABLE card_metadata ADD CONSTRAINT qdrant_point_nullable_constraint CHECK (private = true OR qdrant_point_id IS NOT NULL);`
#### Description
This statement adds a new constraint to the `card_metadata` table named `qdrant_point_nullable_constraint`.

#### Internal Logic
* **`ALTER TABLE card_metadata`**: Specifies that the `card_metadata` table is being modified.
* **`ADD CONSTRAINT qdrant_point_nullable_constraint`**: Adds a new constraint named `qdrant_point_nullable_constraint`.
* **`CHECK (private = true OR qdrant_point_id IS NOT NULL)`**: Defines the rule for the constraint. This rule ensures that for each row in the table, either the `private` column is true or the `qdrant_point_id` column is not null. This effectively means that if a card is not private (`private` is false), it must have a `qdrant_point_id`. 
