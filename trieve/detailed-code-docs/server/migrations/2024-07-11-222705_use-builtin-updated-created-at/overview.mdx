---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for implementing built-in `updated_at` and `created_at` timestamps in a database. The migration is dated 2024-07-11-222705 and is titled "use-builtin-updated-created-at". It consists of two files: `up.sql` for applying the changes and `down.sql` for reverting them.

## What does it do?
The migration modifies the database to use a more efficient and standardized method for managing `updated_at` timestamps on various tables. 

In the `up.sql` script:
1. It removes existing custom triggers and functions related to updating `updated_at` timestamps.
2. It introduces new, more efficient functions (`diesel_manage_updated_at` and `diesel_set_updated_at`) to handle the automatic updating of `updated_at` columns.
3. It applies these new functions to multiple tables in the database.

The `down.sql` script reverses these changes:
1. It drops the newly created triggers and functions.
2. It reintroduces custom functions (`update_updated_at` and `update_main_table_updated_at`) to manage `updated_at` timestamps.
3. It creates triggers on various tables to use these custom functions.

This migration aims to improve the efficiency and consistency of timestamp management in the database, likely as part of an optimization or standardization effort.

## Key Files

1. `up.sql`:
   - Implements the new timestamp management system.
   - Drops existing triggers and functions.
   - Creates new functions `diesel_manage_updated_at` and `diesel_set_updated_at`.
   - Applies these functions to multiple tables.

2. `down.sql`:
   - Reverts the changes made by `up.sql`.
   - Drops the new triggers and functions.
   - Recreates custom functions for timestamp management.
   - Sets up triggers on various tables to use these custom functions.

Both files are crucial for the migration process, allowing for both the application and potential rollback of the changes.

## Configuration
The migration scripts use SQL statements and do not rely on external configuration files. However, they do reference specific table names, which implies a certain database schema:

- main
- collection_items
- collection_item_versions
- collection_item_comments
- collection_item_reactions
- collection_item_tags
- collection_item_links
- collection_item_attachments

These table names are hardcoded in the migration scripts, indicating that the migration is designed for a specific database structure.