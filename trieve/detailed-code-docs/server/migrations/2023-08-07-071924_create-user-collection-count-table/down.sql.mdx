---
title: "down.sql"
---

## High-level description
This SQL script defines the "down" migration for reverting changes introduced by the "up" migration related to tracking user card collection counts. It ensures that the database schema returns to its previous state by dropping the `user_collection_counts` table, the associated trigger `update_collection_counts_trigger`, and the helper function `update_collection_counts`.

## Code Structure
The script executes three SQL statements in sequence:
1. Drops the `update_collection_counts_trigger` trigger on the `card_collection` table if it exists.
2. Drops the `update_collection_counts` function if it exists.
3. Drops the `user_collection_counts` table if it exists.

## Symbols

### `DROP TRIGGER`
#### Description
This SQL statement attempts to drop a trigger named `update_collection_counts_trigger` on the `card_collection` table. The `IF EXISTS` clause ensures that the statement executes successfully even if the trigger doesn't exist. This is crucial for a "down" migration to revert changes gracefully.

#### Inputs
N/A - This is a SQL statement, not a function.

#### Outputs
N/A - This statement doesn't return any values. It performs an action on the database schema.

### `DROP FUNCTION`
#### Description
This SQL statement attempts to drop a function named `update_collection_counts`. Similar to the trigger drop, the `IF EXISTS` clause ensures graceful execution even if the function is already absent.

#### Inputs
N/A - This is a SQL statement, not a function.

#### Outputs
N/A - This statement doesn't return any values. It modifies the database schema.

### `DROP TABLE`
#### Description
This SQL statement attempts to drop a table named `user_collection_counts`. The `IF EXISTS` clause ensures that the statement executes successfully even if the table doesn't exist, which is essential for a "down" migration to handle potential discrepancies.

#### Inputs
N/A - This is a SQL statement, not a function.

#### Outputs
N/A - This statement doesn't return any values. It modifies the database schema.
