---
title: "up.sql"
---

## High-level description
This SQL migration script modifies the `chunk_group_bookmarks` table by dropping an existing foreign key constraint and adding a new one. The changes are designed to update the relationship between the `chunk_group_bookmarks` table and the `chunk_metadata` table, ensuring referential integrity with cascading delete and update actions.

## Symbols

### SQL Commands

#### Description
The script consists of two main SQL commands: one to drop an existing constraint and another to add a new foreign key constraint.

#### Internal Logic

1. Drop existing constraint:
   ```sql
   ALTER TABLE chunk_group_bookmarks
     DROP CONSTRAINT card_collection_bookmarks_card_metadata_id_fkey;
   ```
   This command removes the existing foreign key constraint named `card_collection_bookmarks_card_metadata_id_fkey` from the `chunk_group_bookmarks` table.

2. Add new foreign key constraint:
   ```sql
   ALTER TABLE chunk_group_bookmarks
     ADD CONSTRAINT chunk_group_bookmarks_chunk_metadata_id_fkey
     FOREIGN KEY (chunk_metadata_id) REFERENCES chunk_metadata(id) ON DELETE CASCADE ON UPDATE CASCADE;
   ```
   This command adds a new foreign key constraint named `chunk_group_bookmarks_chunk_metadata_id_fkey` to the `chunk_group_bookmarks` table. The constraint links the `chunk_metadata_id` column in `chunk_group_bookmarks` to the `id` column in the `chunk_metadata` table. It includes `ON DELETE CASCADE` and `ON UPDATE CASCADE` clauses, which ensure that when a record in the `chunk_metadata` table is deleted or updated, the corresponding records in the `chunk_group_bookmarks` table are automatically deleted or updated accordingly.

## Side Effects
- The existing foreign key constraint is removed, potentially affecting data integrity if not immediately replaced.
- The new foreign key constraint is added, enforcing referential integrity between `chunk_group_bookmarks` and `chunk_metadata` tables.
- Cascading delete and update actions are now in place, which means that changes to the `chunk_metadata` table will automatically propagate to the `chunk_group_bookmarks` table.

## Dependencies
This migration script assumes the existence of the following database objects:
- `chunk_group_bookmarks` table
- `chunk_metadata` table
- `id` column in the `chunk_metadata` table
- `chunk_metadata_id` column in the `chunk_group_bookmarks` table

## Error Handling
The SQL commands do not include explicit error handling. If any of the tables or columns do not exist, or if there are any issues with the constraint names, the database system will likely raise an error, and the migration may fail.