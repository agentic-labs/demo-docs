---
title: "up.sql"
---

## High-level description
This SQL script defines two new tables, `card_metadata` and `card_votes`, in the database as part of a migration. It also creates indexes on these tables to improve query performance.

## Code Structure
The code consists of two SQL `CREATE TABLE` statements, one for `card_metadata` and one for `card_votes`. Each table definition includes column definitions, primary key constraints, and foreign key constraints referencing the `users` table. Additionally, the code includes `CREATE INDEX` statements to create indexes on specific columns for both tables.

## Symbols
### `card_metadata` table
#### Description
This table stores metadata information about cards, such as content, link, author, and association with a Qdrant point.

#### Inputs
N/A - This is a table definition, not a function.

#### Outputs
N/A - This is a table definition, not a function.

#### Internal Logic
The table has the following columns:
- `id`: UUID primary key for the card metadata.
- `content`: Text content of the card, cannot be NULL.
- `link`: Optional text field for storing a link related to the card.
- `author_id`: UUID referencing the `users` table, representing the author of the card.
- `qdrant_point_id`: UUID referencing a point in a Qdrant index, likely related to the card's content.
- `created_at`: Timestamp indicating the creation time of the record, defaults to the current time.
- `updated_at`: Timestamp indicating the last update time of the record, defaults to the current time.

### `idx_card_metadata_author_id` index
#### Description
This index is created on the `author_id` column of the `card_metadata` table to speed up queries filtering or ordering by author.

### `idx_card_metadata_qdrant_point_id` index
#### Description
This index is created on the `qdrant_point_id` column of the `card_metadata` table to speed up queries searching for cards associated with specific Qdrant points.

### `card_votes` table
#### Description
This table stores information about votes cast on cards by users.

#### Inputs
N/A - This is a table definition, not a function.

#### Outputs
N/A - This is a table definition, not a function.

#### Internal Logic
The table has the following columns:
- `id`: UUID primary key for the vote record.
- `voted_user_id`: UUID referencing the `users` table, representing the user who cast the vote.
- `card_metadata_id`: UUID referencing the `card_metadata` table, indicating the card being voted on.
- `vote`: Boolean value representing the vote (true for upvote, false for downvote).
- `created_at`: Timestamp indicating the creation time of the vote record, defaults to the current time.
- `updated_at`: Timestamp indicating the last update time of the vote record, defaults to the current time.

### `idx_card_votes_voted_user_id` index
#### Description
This index is created on the `voted_user_id` column of the `card_votes` table to speed up queries filtering or ordering by voting user.

### `idx_card_votes_card_metadata_id` index
#### Description
This index is created on the `card_metadata_id` column of the `card_votes` table to speed up queries retrieving votes for a specific card.

## References
- `users` table: The `card_metadata` and `card_votes` tables have foreign key constraints referencing the `id` column of the `users` table. This indicates a relationship where cards and votes are associated with specific users.
