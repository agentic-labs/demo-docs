---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for creating and managing two new tables: `card_metadata` and `card_votes`. These tables are designed to store information about cards and their associated votes in a database system. The migration scripts provide the ability to create these tables with their respective structures and indexes, as well as the ability to revert these changes if needed.

## What does it do?
The migration scripts in this directory perform the following tasks:

1. Create a `card_metadata` table to store information about cards, including their content, associated links, authors, and relationships to Qdrant points (likely for search or recommendation purposes).

2. Create a `card_votes` table to record votes cast by users on specific cards, including whether the vote was positive or negative.

3. Establish relationships between these new tables and an existing `users` table, linking cards and votes to specific users.

4. Create indexes on key columns to optimize query performance for common operations like filtering by author or retrieving votes for a specific card.

5. Provide a mechanism to revert these changes by dropping the newly created tables if needed.

These scripts enable the application to manage card-related data and user interactions with cards, likely as part of a content management or social media-like system.

## Key Files

1. `up.sql`: This file contains the SQL statements to create the `card_metadata` and `card_votes` tables, along with their associated indexes. It's responsible for setting up the new database structure.

   Key aspects of `up.sql`:
   - Creates the `card_metadata` table with columns for id, content, link, author_id, qdrant_point_id, created_at, and updated_at.
   - Creates the `card_votes` table with columns for id, voted_user_id, card_metadata_id, vote, created_at, and updated_at.
   - Establishes foreign key relationships with the `users` table.
   - Creates indexes on `author_id` and `qdrant_point_id` for `card_metadata`, and on `voted_user_id` and `card_metadata_id` for `card_votes`.

2. `down.sql`: This file contains the SQL statements to revert the changes made by `up.sql`. It's used to roll back the migration if necessary.

   Key aspects of `down.sql`:
   - Drops the `card_votes` table if it exists.
   - Drops the `card_metadata` table if it exists.

These files work together to provide a reversible database migration, allowing for easy updates and rollbacks of the database schema.

## Configuration
The migration scripts use SQL statements that are likely compatible with PostgreSQL, given the use of UUID data types and the `USING btree` clause in index creation. The specific database configuration (such as connection details) is not included in these files and would typically be managed by the application's database connection settings.

Key configurable elements in the migration:

1. Table names: `card_metadata` and `card_votes`
2. Column names and data types (e.g., `id UUID`, `content TEXT`, `vote BOOLEAN`)
3. Index names (e.g., `idx_card_metadata_author_id`, `idx_card_votes_card_metadata_id`)
4. Foreign key relationships (referencing the `users` table)

These elements could be adjusted if needed to fit specific application requirements or naming conventions.