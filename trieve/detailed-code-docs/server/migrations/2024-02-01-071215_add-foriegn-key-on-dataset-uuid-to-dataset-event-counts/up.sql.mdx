---
title: "up.sql"
---

## High-level description
This SQL script adds a foreign key constraint and a unique constraint on the `dataset_uuid` column in the `dataset_event_counts` table. It also makes the `dataset_uuid` column non-nullable. 

This ensures that each row in the `dataset_event_counts` table has a corresponding row in the `datasets` table, and that each `dataset_uuid` is unique. The `ON UPDATE CASCADE` and `ON DELETE CASCADE` clauses ensure that any updates or deletions to the `datasets` table are automatically reflected in the `dataset_event_counts` table.

## Symbols
### `ALTER TABLE dataset_event_counts`
#### Description
This SQL statement modifies the existing `dataset_event_counts` table by adding constraints and altering column properties.

#### Internal Logic
1. **Add Foreign Key Constraint:**
   - Adds a foreign key constraint named `dataset_event_counts_dataset_uuid_fkey` to the `dataset_uuid` column.
   - This constraint references the `id` column in the `datasets` table.
   - `ON UPDATE CASCADE`: If the `id` of a dataset in the `datasets` table is updated, the corresponding `dataset_uuid` in the `dataset_event_counts` table will be automatically updated.
   - `ON DELETE CASCADE`: If a dataset is deleted from the `datasets` table, the corresponding rows in the `dataset_event_counts` table will also be deleted.

2. **Add Unique Constraint:**
   - Adds a unique constraint named `dataset_event_counts_dataset_uuid_unique` to the `dataset_uuid` column.
   - This ensures that each `dataset_uuid` in the `dataset_event_counts` table is unique.

3. **Alter Column**:
   - Modifies the `dataset_uuid` column to be `NOT NULL`.
   - This ensures that all future entries in the `dataset_event_counts` table must have a value for `dataset_uuid`. 
