---
title: "up.sql"
---

## High-level description
This SQL script creates a new table named `stripe_invoices` in the database. The table is designed to store information about Stripe invoices associated with organizations, including details such as the total amount, creation date, status, and a URL to view the invoice.

## Symbols

### `stripe_invoices` table
#### Description
The `stripe_invoices` table is created to store information about Stripe invoices. It establishes a relationship with the `organizations` table through a foreign key constraint.

#### Internal Logic
The table is created with the following columns:

1. `id`: A UUID primary key with a default value generated using `gen_random_uuid()`.
2. `org_id`: A UUID column to store the associated organization's ID.
3. `total`: An integer column to store the total amount of the invoice.
4. `created_at`: A timestamp column to store the creation date and time of the invoice.
5. `status`: A text column to store the status of the invoice.
6. `hosted_invoice_url`: A text column to store the URL where the invoice can be viewed.

A foreign key constraint is added to the `org_id` column, referencing the `id` column in the `organizations` table. This ensures referential integrity and establishes a one-to-many relationship between organizations and their invoices.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| `organizations` table | The `stripe_invoices` table references the `organizations` table through a foreign key constraint. |

## Notes
1. The `ON DELETE CASCADE` option in the foreign key constraint ensures that when an organization is deleted, all associated invoices are automatically deleted as well.
2. The use of `gen_random_uuid()` for the `id` column suggests that the database system supports this function for generating UUIDs.
3. The `total` column is defined as an integer, which implies that the invoice amount is stored in the smallest currency unit (e.g., cents for USD).
4. The `status` column allows for storing different invoice statuses, which can be useful for tracking the lifecycle of an invoice.
5. The `hosted_invoice_url` column suggests that these invoices are accessible online, likely through Stripe's invoice hosting service.

This migration script is part of a larger application that integrates with Stripe for invoice management and ties these invoices to specific organizations within the system.