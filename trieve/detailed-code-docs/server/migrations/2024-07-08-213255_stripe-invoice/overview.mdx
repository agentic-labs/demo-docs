---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for creating and dropping a `stripe_invoices` table in the database. The migration is dated 2024-07-08 and is specifically related to Stripe invoice functionality.

## What does it do?
The migration scripts in this directory perform the following actions:

1. Create a new table: The "up" migration creates a `stripe_invoices` table to store information about invoices generated by Stripe. This table includes details such as the invoice ID, associated organization ID, total amount, creation timestamp, status, and a URL to the hosted invoice.

2. Enable rollback: The "down" migration provides the ability to undo the changes by dropping the `stripe_invoices` table if needed.

These scripts allow the application to track and manage Stripe invoices associated with organizations, providing a structured way to store and retrieve invoice data within the database.

## Key Files

1. `up.sql`: This file contains the SQL script to create the `stripe_invoices` table.

   ```sql
   CREATE TABLE stripe_invoices (
     id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
     org_id UUID NOT NULL,
     total INT NOT NULL,
     created_at TIMESTAMP NOT NULL,
     status TEXT NOT NULL,
     hosted_invoice_url TEXT NOT NULL,
     FOREIGN KEY (org_id) REFERENCES organizations(id) ON DELETE CASCADE
   );
   ```

   The script defines the table structure with the following columns:
   - `id`: A UUID primary key with a default value generated by `gen_random_uuid()`.
   - `org_id`: A UUID representing the associated organization, with a foreign key constraint.
   - `total`: An integer representing the total amount of the invoice.
   - `created_at`: A timestamp indicating when the invoice was created.
   - `status`: A text field for the invoice status.
   - `hosted_invoice_url`: A text field for the URL of the hosted invoice.

   The foreign key constraint ensures referential integrity with the `organizations` table and includes a cascade delete option.

2. `down.sql`: This file contains the SQL script to drop the `stripe_invoices` table.

   ```sql
   DROP TABLE stripe_invoices;
   ```

   This simple script removes the `stripe_invoices` table from the database, effectively undoing the changes made by the "up" migration.

## Dependencies
The migration scripts rely on the existence of an `organizations` table in the database, as evidenced by the foreign key constraint in the `up.sql` script.

## Configuration
These migration scripts do not require any specific configuration. However, they assume that:

1. The database system supports UUID data types and the `gen_random_uuid()` function.
2. The `organizations` table exists in the database with an `id` column of UUID type.

When running these migrations, ensure that the database user has the necessary permissions to create and drop tables, as well as to add foreign key constraints.