---
title: "up.sql"
---

## High-level description
This SQL script migrates the `topics` table by replacing the `user_id` column with an `owner_id` column. It also creates an index on the `dataset_id` and `owner_id` columns.

## Symbols
### `ALTER TABLE topics ADD COLUMN owner_id TEXT NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000'`
#### Description
This statement adds a new column named `owner_id` to the `topics` table. 

#### Internal Logic
*  `ALTER TABLE topics`: This part specifies that we are modifying the `topics` table.
*  `ADD COLUMN owner_id`: This adds a new column named `owner_id`.
*  `TEXT NOT NULL`: This defines the data type of the column as TEXT and makes it mandatory (cannot be NULL).
*  `DEFAULT '00000000-0000-0000-0000-000000000000'`: This sets a default value for the column if no value is provided during insertion.

### `UPDATE topics SET owner_id = user_id WHERE user_id IS NOT NULL`
#### Description
This statement updates the newly added `owner_id` column with the values from the existing `user_id` column.

#### Internal Logic
*  `UPDATE topics`: This specifies that we are updating data in the `topics` table.
*  `SET owner_id = user_id`: This sets the value of the `owner_id` column to the value of the `user_id` column for each row.
*  `WHERE user_id IS NOT NULL`: This condition ensures that only rows where `user_id` is not NULL are updated.

### `ALTER TABLE topics DROP COLUMN user_id`
#### Description
This statement removes the `user_id` column from the `topics` table.

#### Internal Logic
*  `ALTER TABLE topics`: This specifies that we are modifying the `topics` table.
*  `DROP COLUMN user_id`: This removes the column named `user_id`.

### `CREATE INDEX topics_dataset_id_owner_id_idx ON topics (dataset_id, owner_id)`
#### Description
This statement creates an index named `topics_dataset_id_owner_id_idx` on the `dataset_id` and `owner_id` columns of the `topics` table.

#### Internal Logic
*  `CREATE INDEX topics_dataset_id_owner_id_idx`: This creates an index with the specified name.
*  `ON topics`: This specifies that the index is being created on the `topics` table.
*  `(dataset_id, owner_id)`: This defines the columns included in the index. 
