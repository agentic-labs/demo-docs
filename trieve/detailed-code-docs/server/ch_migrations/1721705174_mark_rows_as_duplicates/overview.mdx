---
title: "Overview"
---

## High-level description
This directory contains SQL migration scripts for altering the `search_queries` table in a PostgreSQL database. The migration is designed to add and remove a column named `is_duplicate` to flag duplicate entries in the table.

## What does it do?
The migration scripts in this directory perform the following actions:

1. Add a new column called `is_duplicate` to the `search_queries` table. This column is used to mark certain rows as duplicates.
2. Set up the new column with a default value of 0, indicating that by default, rows are not considered duplicates.
3. Provide a way to revert the changes by removing the `is_duplicate` column if needed.

These changes allow the system to flag and potentially handle duplicate search queries, which could be useful for data analysis, cleaning, or optimization purposes.

## Key Files

### up.sql
This file contains the SQL commands to apply the migration:

```sql
ALTER TABLE search_queries
ADD COLUMN IF NOT EXISTS is_duplicate UInt8 DEFAULT 0
```

This script adds the `is_duplicate` column to the `search_queries` table. The column is of type `UInt8` (8-bit unsigned integer) and has a default value of 0, meaning rows are not considered duplicates unless explicitly marked otherwise.

### down.sql
This file contains the SQL commands to revert the migration:

```sql
ALTER TABLE search_queries
DROP COLUMN IF EXISTS is_duplicate
```

This script removes the `is_duplicate` column from the `search_queries` table, effectively undoing the changes made by the up migration.

## Dependencies
The migration scripts are designed for PostgreSQL databases. They use standard SQL syntax compatible with PostgreSQL.

## Configuration
No specific configuration is required for these migration scripts. However, they should be executed within the context of a database migration system that manages the order and application of migrations.

## Performance Considerations
1. Adding a new column (`up.sql`):
   - This operation may temporarily lock the `search_queries` table.
   - For large tables, this could potentially impact database performance during execution.
   - The `IF NOT EXISTS` clause prevents errors if the column already exists, making the script idempotent and safe to re-run.

2. Removing a column (`down.sql`):
   - This operation may also temporarily lock the `search_queries` table.
   - It will result in the loss of any data stored in the `is_duplicate` column.
   - The `IF EXISTS` clause prevents errors if the column doesn't exist, making the script idempotent.

In both cases, it's recommended to execute these migrations during low-traffic periods to minimize potential disruptions to database operations.

## Error Handling
Both scripts use conditional clauses to prevent errors:
- `up.sql` uses `IF NOT EXISTS` when adding the column.
- `down.sql` uses `IF EXISTS` when dropping the column.

These conditions make the scripts more robust and allow them to be safely re-run without causing errors due to the column already existing or not existing.