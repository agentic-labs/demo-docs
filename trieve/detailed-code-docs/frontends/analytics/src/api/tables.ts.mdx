---
title: "tables.ts"
---

## High-level description
The `getSearchQueries` function fetches search query data from the analytics API endpoint. It takes search parameters and a dataset ID as input and returns an array of `SearchQueryEvent` objects representing the retrieved search queries.

## References
- `AnalyticsFilter`, `SearchQueryResponse`, `SearchSortBy`, `SortOrder` from "shared/types"
- `transformAnalyticsFilter` from "../utils/formatDate"
- `apiHost` from "../utils/apiHost"

## Symbols

### `getSearchQueries`
#### Description
This asynchronous function retrieves search queries from the analytics API based on provided parameters and dataset ID. It constructs the API request, handles the response, and returns the extracted query data.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| params | `SearchQueriesTablesParams` | An object containing filter, pagination, sorting parameters for the search queries. |
| datasetId | `string` | The ID of the dataset for which to retrieve search queries. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| queries | `SearchQueryEvent[]` | An array of `SearchQueryEvent` objects representing the retrieved search queries. |

#### Internal Logic
1. **Construct API Request:**
   - Builds the API endpoint URL using `apiHost` and the `/analytics/search` path.
   - Creates a request body object containing transformed filter parameters, pagination details, sorting options, and the query type ("search_queries").
   - Sets request headers including the dataset ID (`TR-Dataset`) and content type.

2. **Fetch Data:**
   - Sends a POST request to the constructed API endpoint with the prepared body and headers.
   - Includes credentials in the request.

3. **Handle Response:**
   - Checks if the response status is OK (2xx).
   - If not OK, throws an error with the response status text.
   - If OK, parses the response JSON as a `SearchQueryResponse` object.

4. **Return Queries:**
   - Extracts the `queries` array from the parsed response data and returns it.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| shared/types | Provides type definitions for `AnalyticsFilter`, `SearchQueryResponse`, `SearchSortBy`, `SortOrder`, and `SearchQueryEvent`. |
| ../utils/formatDate | Imports the `transformAnalyticsFilter` function for transforming date formats in filter parameters. |
| ../utils/apiHost | Imports the `apiHost` variable containing the base URL for API requests. |

## Error Handling
- Throws an error if the API request fails (non-OK response status). The error message includes the response status text.
