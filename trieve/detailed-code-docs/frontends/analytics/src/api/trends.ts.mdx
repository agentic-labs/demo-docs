---
title: "trends.ts"
---

## High-level description
The code defines two asynchronous functions, `getTrendsBubbles` and `getQueriesForTopic`, that fetch data from the analytics API to display trends in user searches. These functions are used to populate the Trend Explorer page in the application.

## References
- This code references the `apiHost` constant from `../utils/apiHost`, which provides the base URL for API requests.
- It also uses types `SearchClusterResponse`, `SearchClusterTopics`, `SearchQueryEvent`, and `SearchQueryResponse` from `shared/types` to define the structure of data received from the API.

## Symbols
### `getTrendsBubbles`
#### Description
This asynchronous function fetches a list of trending search topics (represented as clusters) for a given dataset.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| datasetId | string | The ID of the dataset to fetch trends for. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise&lt;SearchClusterTopics[]&gt; | Promise | A promise that resolves to an array of `SearchClusterTopics` objects, each representing a trending topic. |

#### Internal Logic
1. Constructs the API endpoint URL using the `apiHost` and the `/analytics/search/clusters` path.
2. Sends a POST request to the endpoint with the following:
    - `credentials: "include"` to include cookies for authentication.
    - `TR-Dataset` header set to the provided `datasetId`.
    - JSON body with `type` set to `"cluster_topics"`.
3. Parses the response JSON as a `SearchClusterResponse` object.
4. Returns the `clusters` property of the parsed response.
5. Throws an error if the API request fails.

### `getQueriesForTopic`
#### Description
This asynchronous function fetches a list of search queries associated with a specific trending topic (cluster) within a given dataset.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| datasetId | string | The ID of the dataset. |
| clusterId | string | The ID of the cluster representing the trending topic. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise&lt;SearchQueryEvent[]&gt; | Promise | A promise that resolves to an array of `SearchQueryEvent` objects, each representing a search query associated with the specified topic. |

#### Internal Logic
1. Constructs the API endpoint URL using the `apiHost` and the `/analytics/search/clusters` path.
2. Sends a POST request to the endpoint with the following:
    - `credentials: "include"` to include cookies for authentication.
    - `TR-Dataset` header set to the provided `datasetId`.
    - JSON body with `type` set to `"cluster_queries"` and `cluster_id` set to the provided `clusterId`.
3. Parses the response JSON as a `SearchQueryResponse` object.
4. Returns the `queries` property of the parsed response.
5. Throws an error if the API request fails.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| shared/types | Provides type definitions for data structures used in the API responses. |
| ../utils/apiHost | Provides the base URL for API requests. |

## Error Handling
Both functions include basic error handling by checking the `ok` status of the fetch response. If the response is not ok, an error is thrown with the response status text.
