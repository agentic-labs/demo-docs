---
title: "ctr.ts"
---

## High-level description
The `getSearchCTRSummary` function fetches search click-through rate (CTR) summary data for a given dataset from the `/analytics/ctr` API endpoint. It sends a POST request with optional filters and returns an object containing the number of searches with clicks, the percentage of searches with clicks, and the average click position.

## References
- `AnalyticsFilter` type from "shared/types"
- `apiHost` from "../utils/apiHost"
- `transformAnalyticsFilter` from "../utils/formatDate"

## Symbols

### `getSearchCTRSummary`
#### Description
This asynchronous function retrieves a summary of search CTR metrics for a specific dataset, optionally filtered by provided criteria. It constructs and sends a POST request to the `/analytics/ctr` endpoint, handles the response, and returns the parsed data.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| datasetId | string | The ID of the dataset for which to fetch CTR data. |
| filters | AnalyticsFilter (optional) | An object containing filter parameters for the CTR data. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | object | An object containing the following CTR metrics: `searches_with_clicks`, `percent_searches_with_clicks`, and `avg_position_of_click`. |

#### Internal Logic
1. **Construct API Endpoint:** The function builds the API endpoint URL using the `apiHost` and the `/analytics/ctr` path.
2. **Prepare Request Body:** It creates a JSON payload for the request body, including the transformed `filters` (if provided) and the request `type` as "search_ctr_metrics".
3. **Send Request:** The function sends a POST request to the constructed endpoint with the prepared body, including credentials and dataset ID in the headers.
4. **Handle Response:**
   - **Success:** If the response is successful (status code 200-299), it parses the JSON response into an object containing CTR metrics.
   - **Error:** If the response is not successful, it throws an error with the response status text.
5. **Return Data:** The function returns the parsed CTR data object.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| fetch | Used to make the API request. |

## Error Handling
The function throws an error if the API request fails, providing the response status text as the error message.
