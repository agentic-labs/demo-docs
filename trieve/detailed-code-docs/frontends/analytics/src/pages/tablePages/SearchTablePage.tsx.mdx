---
title: "SearchTablePage.tsx"
---

## High-level description
The `SearchTablePage` component displays a table of search queries executed against a specific dataset. It allows users to filter, sort, and paginate through the search query data, providing insights into search behavior and performance. The component fetches data from an API and utilizes various UI components for filtering, sorting, and pagination.

## Code Structure
The `SearchTablePage` component uses several other components and hooks:
- `FilterBar`: Provides filtering options for the search query data.
- `Table`: Renders the table of search queries.
- `SearchRow`: Renders a single row in the search query table.
- `usePagination`: Manages pagination state and logic.
- `PaginationButtons`: Renders pagination buttons for navigating through pages.
- `useBetterNav`: Provides navigation functionality while preserving query parameters.

## Symbols

### `SearchTablePage`
#### Description
This component fetches and displays a table of search queries for a specific dataset. It allows users to filter, sort, and paginate through the data.

#### Inputs
This symbol is a component and does not take any explicit inputs.

#### Outputs
This symbol is a component and does not return any explicit outputs. It renders the search table page.

#### Internal Logic
1. **Initialization:**
   - Initializes a `queryClient` for data fetching.
   - Creates a store `filters` to manage filter parameters with an initial state of displaying queries from the last 7 days.
   - Creates signals `sortOrder` and `sortBy` to manage sorting state.
   - Initializes `pages` using the `usePagination` hook for pagination.
   - Retrieves the `dataset` context.

2. **Data Fetching:**
   - Uses `createEffect` to prefetch data for the next page when the current page changes.
   - Defines `searchTableQuery` using `createQuery` to fetch search query data based on filters, pagination, sorting, and dataset ID.

3. **Rendering:**
   - Renders a `FilterBar` component to allow users to filter the data.
   - Conditionally renders the search query table using `Show` based on the `searchTableQuery.data` state.
   - If data is available, renders a `Table` component with `SearchRow` components for each query.
   - Renders `PaginationButtons` to allow users to navigate through pages.

### `SortableHeader`
#### Description
This component renders a sortable table header. Clicking on the header toggles the sort order for the corresponding column.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| children | JSX.Element | The content of the header. |
| sortBy | "created_at" | "latency" | "top_score" | The column to sort by. |

#### Outputs
This symbol is a component and does not return any explicit outputs. It renders a sortable table header.

#### Internal Logic
1. **Click Handling:**
   - When clicked, checks if the current sort column is the same as the clicked header.
     - If yes, toggles the sort order (`asc` or `desc`).
     - If no, sets the clicked header as the new sort column.

2. **Rendering:**
   - Renders a button element with the provided content and a sort indicator icon.
   - Uses `Switch` and `Match` to conditionally render the sort indicator icon based on the current sort order.

### `SearchRow`
#### Description
This component renders a single row in the search query table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| event | SearchQueryEvent | The search query event data for the row. |
| filter | AnalyticsParams["filter"] | The current filter parameters. |

#### Outputs
This symbol is a component and does not return any explicit outputs. It renders a table row representing a single search query.

#### Internal Logic
1. **Search Method Formatting:**
   - Uses `createMemo` to format the search method based on the `event.request_params["search_type"]` value.

2. **Navigation:**
   - Uses `useBetterNav` to handle navigation when the row is clicked.
   - Navigates to the `/query/${props.event.id}` route, preserving query parameters.

3. **Rendering:**
   - Renders a `Tr` (table row) element.
   - Displays the query text, searched at timestamp, search method (conditionally), latency, and top score.

### `formatSearchMethod`
#### Description
This function formats a search method string for display.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| searchMethod | string | The search method string to format. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| formattedSearchMethod | string | The formatted search method string. |

#### Internal Logic
- Uses a `switch` statement to map the input `searchMethod` to a formatted string.
- Returns "All" if the input method is not recognized.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| solid-js | Provides core SolidJS functionality for creating components, managing state, and rendering. |
| @tanstack/solid-query | Provides data fetching and caching capabilities. |
| date-fns | Provides date and time utilities. |
| shared/ui | Provides shared UI components like `Table`, `Td`, `Th`, `DateRangePicker`, and `Select`. |
| shared/types | Provides shared type definitions. |
| solid-icons/ai | Provides SolidJS icons from the Ant Design library. |
| @solidjs/router | Provides routing functionality. |

## Error Handling
The `searchTableQuery` uses the `fallback` prop of the `Show` component to display a "Loading..." message while data is being fetched and a "No Data" message if no data is returned. The `getSearchQueries` function throws an error if the API request fails.

## Logging
The code does not implement any specific logging mechanisms.
