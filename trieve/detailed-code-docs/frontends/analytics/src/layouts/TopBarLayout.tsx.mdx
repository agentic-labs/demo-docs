---
title: "TopBarLayout.tsx"
---

## High-level description
The `TopBarLayout` component provides the main layout structure for the analytics dashboard. It fetches the available datasets for the selected organization and manages the selection of a dataset. It also handles redirection for unauthorized users and displays a "No Datasets" error page if no datasets are found.

## Code Structure
The `TopBarLayout` component uses the `OrgContext` to access the selected organization and the `DatasetContext` to provide the selected dataset to its children. It fetches the datasets using the `createQuery` hook from `@tanstack/solid-query` and manages the selected dataset with the `createSignal` hook. The component also uses the `Show` component from `solid-js` to conditionally render content based on the status of the datasets query and the selected dataset.

## References
- `OrgContext`
- `DatasetContext`
- `Sidebar`
- `NoDatasetsErrorPage`

## Symbols
### `TopBarLayout`
#### Description
This component defines the top bar layout of the analytics dashboard, including the sidebar and the main content area. It fetches the datasets for the selected organization, manages the selected dataset, and provides it to its children via the `DatasetContext`.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props | `ParentComponent` | The children components to be rendered within the layout. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| JSX.Element | `JSX.Element` | The rendered layout of the top bar. |

#### Internal Logic
1. **Fetches Datasets:** Uses `createQuery` to fetch datasets for the selected organization.
2. **Handles Redirection:** Redirects to the login page if the user is unauthorized (401 status code).
3. **Sets Selected Dataset:** Sets the initially selected dataset based on the URL parameters or the first dataset in the list.
4. **Updates Selected Dataset:** Updates the selected dataset when the URL parameters or the datasets query data changes.
5. **Renders Layout:**
   - Renders the `Sidebar` component with the fetched datasets, selected dataset, and a function to update the selected dataset.
   - Conditionally renders the `NoDatasetsErrorPage` if no datasets are found.
   - Conditionally renders the children components within a `DatasetContext.Provider` if a dataset is selected.

## Side Effects
- Modifies the URL parameters when the selected dataset changes.
- Redirects the user to the login page if unauthorized.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| solid-js | Provides core reactivity primitives and components. |
| @tanstack/solid-query | Provides data fetching and caching functionalities. |
| @solidjs/router | Provides routing functionalities. |
| shared/types | Provides shared types. |

### `DatasetContext`
#### Description
A SolidJS context that provides the selected dataset to its children components.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| value | `Accessor&lt;DatasetAndUsage&gt;` | The selected dataset. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| DatasetContext.Provider | `JSX.Element` | A provider component that makes the selected dataset available to its children. |

## Error Handling
- Redirects to the login page if the user is unauthorized (401 status code).
- Displays a "No Datasets" error page if no datasets are found for the selected organization.
