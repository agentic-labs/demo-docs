---
title: "HeadQueries.tsx"
---

## High-level description
The `HeadQueries` component displays a table of the most frequent search queries and their counts, fetched from the backend API. It allows pagination to navigate through the results and preloads the next page for smoother user experience.

## Code Structure
The `HeadQueries` component uses the `createQuery` hook from `@tanstack/solid-query` to fetch and manage the head queries data. It also utilizes the `usePagination` hook for pagination functionality and the `DatasetContext` to access the selected dataset ID. The `PaginationButtons` component is used to render the pagination controls.

## References
- `getHeadQueries`: A function imported from `../../api/analytics` that fetches the head queries data from the backend.
- `DatasetContext`: A context imported from `../../layouts/TopBarLayout` that provides access to the selected dataset.
- `usePagination`: A custom hook imported from `../../hooks/usePagination` that manages pagination state and logic.
- `PaginationButtons`: A component imported from `../PaginationButtons` that renders the pagination buttons.

## Symbols
### `HeadQueries`
#### Description
A SolidJS component that fetches and displays a table of the most frequent search queries and their counts.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props | `HeadQueriesProps` | An object containing the following properties: |
| props.params | `{ filter: AnalyticsFilter }` | An object containing the filter parameters for the head queries request. |

#### Outputs
JSX Element representing a table of head queries with pagination.

#### Internal Logic
1. **Retrieves Context and State:**
   - Accesses the selected dataset from the `DatasetContext`.
   - Initializes the `usePagination` hook to manage pagination.
   - Gets the `queryClient` instance from `useQueryClient`.

2. **Data Fetching and Caching:**
   - Uses `createQuery` to define a query function `headQueriesQuery` that fetches head queries data based on the provided filters and current page.
   - The `queryKey` is set to uniquely identify the query based on filters and page number.
   - The `queryFn` calls the `getHeadQueries` API function with the filter, dataset ID, and current page.

3. **Pagination and Prefetching:**
   - Employs the `usePagination` hook to handle page changes and determine if there are more pages to load.
   - Implements prefetching by using `queryClient.prefetchQuery` to load the next page's data in the background when the component mounts and whenever the current page changes.

4. **Rendering:**
   - Uses the `Show` component to conditionally render the table when data is available.
   - Displays a loading message while data is being fetched.
   - If no data is found, a "No Data" message is shown.
   - Renders the `Table` component with the fetched head queries data.
   - Utilizes the `PaginationButtons` component to allow users to navigate through the paginated results.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @tanstack/solid-query | Provides data fetching and caching functionalities. |
| solid-js | The core SolidJS library. |
| shared/types | Contains type definitions, including `AnalyticsFilter`. |
| ../../api/analytics | Provides the `getHeadQueries` function for fetching data. |
| ../../layouts/TopBarLayout | Provides the `DatasetContext`. |
| ../../hooks/usePagination | Provides the `usePagination` hook. |
| ../PaginationButtons | Provides the `PaginationButtons` component. |
| shared/ui | Provides UI components like `Table`, `Td`, `Th`, and `Tr`. |
