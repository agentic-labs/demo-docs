---
title: "RAGUsageGraph.tsx"
---

## High-level description
The `RAGUsageGraph` component displays a bar chart that visualizes the usage of RAG (Retrieval Augmented Generation) over time. It fetches usage data from an API, renders a chart using Chart.js, and updates the chart when data or filter parameters change.

## Code Structure
The `RAGUsageGraph` component uses two Solid queries (`usageQuery` and `ragTotalQuery`) to fetch data from the backend. The `createEffect` hook is used to create a Chart.js instance and update its data and configuration based on the fetched data and component props. The `onCleanup` hook ensures proper cleanup of the chart instance when the component unmounts.

## References
- `DatasetContext`: Provides access to the selected dataset's information.
- `getRagUsageGraph`: API function to fetch RAG usage data.
- `getRAGUsage`: API function to fetch total RAG usage count.
- `ChartCard`: A wrapper component for displaying charts.
- `parseCustomDateString`: Utility function to parse date strings.

## Symbols

### `RAGUsageGraph`
#### Description
A Solid component that renders a bar chart visualizing RAG usage over time.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props | `RAGUsageProps` | An object containing filter and granularity parameters for the chart. |

#### Outputs
JSX Element representing the RAG usage graph.

#### Internal Logic
1. **Data Fetching:** Uses `createQuery` to fetch RAG usage data (`usageQuery`) and total RAG usage count (`ragTotalQuery`) based on the provided filter and dataset ID.
2. **Chart Initialization:** When the component mounts and data is available, it initializes a Chart.js instance with a bar chart configuration.
3. **Chart Updates:**  The `createEffect` hook observes changes in `usageQuery` data and component props. When changes occur, it updates the chart's data, labels, and configuration (e.g., bar thickness, time unit) accordingly.
4. **Chart Cleanup:** The `onCleanup` hook ensures that the Chart.js instance is destroyed when the component unmounts to prevent memory leaks.
5. **Rendering:** Renders a `ChartCard` component, which displays the chart title, total query count (fetched by `ragTotalQuery`), and the canvas element for the Chart.js instance.

## Side Effects
- Fetches data from the backend using `getRagUsageGraph` and `getRAGUsage`.
- Modifies the DOM by rendering and updating the Chart.js canvas.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @tanstack/solid-query | Used for data fetching and caching. |
| date-fns | Provides date and time utilities. |
| chart.js | Used for rendering the bar chart. |
| chartjs-adapter-date-fns | Adapter for using date-fns with Chart.js. |

## Error Handling
The code includes basic error handling for API requests. If an API request fails, an error is thrown. However, there is no specific error handling or display implemented within the component.

## TODOs
- Implement more robust error handling and display for API requests.
- Consider adding loading states while data is being fetched.
- Improve type safety by updating library types or using type assertions sparingly. 
