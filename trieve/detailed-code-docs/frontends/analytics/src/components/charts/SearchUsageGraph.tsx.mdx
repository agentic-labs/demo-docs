---
title: "SearchUsageGraph.tsx"
---

## High-level description
The `SearchUsageGraph` component displays a bar chart visualizing the number of search requests over time. It fetches usage data based on provided filters and granularity, then renders a dynamic chart using Chart.js.

## Code Structure
The `SearchUsageGraph` component uses the `createQuery` hook from `@tanstack/solid-query` to fetch and manage search usage data. It also utilizes the `Chart` object from `chart.js` to render the bar chart. The component leverages SolidJS's reactive primitives like `createEffect` and `createSignal` to update the chart when data or props change.

## References
- `getRpsUsageGraph`: Fetches search usage data from the API.
- `DatasetContext`: Provides access to the selected dataset's ID.
- `AnalyticsFilter`, `AnalyticsParams`: Defines the types for filter and granularity parameters.

## Symbols

### `SearchUsageGraph`
#### Description
A SolidJS component that renders a bar chart of search usage over time. It fetches data based on provided filters and granularity, dynamically updates the chart when data changes, and handles chart cleanup.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props | `SearchUsageProps` | An object containing filter and granularity parameters for the search usage data. |

#### Outputs
This component renders a `&lt;canvas&gt;` element containing the search usage bar chart.

#### Internal Logic
1. **Data Fetching:**
   - Uses `createQuery` to fetch search usage data from the `getRpsUsageGraph` API function.
   - The query key depends on the provided `params` and the selected dataset's ID from `DatasetContext`.
2. **Chart Initialization:**
   - When the component mounts and data is available, it initializes a new `Chart` instance on the `&lt;canvas&gt;` element.
   - The chart is configured as a bar chart with basic styling and axes labels.
3. **Chart Updating:**
   - A `createEffect` hook observes changes to the `usageQuery.data` and `props`.
   - When data or props change, the chart's labels, data points, and granularity settings are updated.
   - The `chartInstance.update()` method redraws the chart with the new data.
4. **Cleanup:**
   - An `onCleanup` hook ensures that the `chartInstance` is destroyed when the component unmounts to prevent memory leaks.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| `@tanstack/solid-query` | Used for data fetching and caching. |
| `chart.js` | Used for rendering the bar chart. |
| `chartjs-adapter-date-fns` | Used for date formatting on the chart's x-axis. |
| `date-fns` | Used for date manipulation and formatting. |

## Error Handling
The code includes basic error handling by checking the response status of the API call in the `usageQuery`. If the API call fails, an error is thrown. However, there is no specific error handling or display implemented within the component.

## Logging
The code does not implement any specific logging mechanisms.
