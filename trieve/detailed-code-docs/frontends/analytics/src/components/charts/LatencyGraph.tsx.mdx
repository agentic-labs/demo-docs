---
title: "LatencyGraph.tsx"
---

## High-level description
The `LatencyGraph` component renders a line chart that displays the average latency of searches over time. It fetches latency data from the backend API based on provided filters and granularity, and dynamically updates the chart using Chart.js.

## Code Structure
The `LatencyGraph` component uses the `createQuery` function from `@tanstack/solid-query` to fetch and manage latency data. It leverages SolidJS's reactive primitives like `createEffect` and `createSignal` to update the chart when data or props change. The `Chart` object from Chart.js is used to render and update the line chart.

## References
- `AnalyticsFilter`, `AnalyticsParams` from "shared/types"
- `DatasetContext` from "../../layouts/TopBarLayout"
- `getLatency` from "../../api/analytics"
- `parseCustomDateString` from "../../utils/formatDate"

## Symbols

### `LatencyGraph`
#### Description
A SolidJS component that renders a line chart displaying average search latency over time. It fetches data based on provided filters and granularity, and dynamically updates the chart.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props | `LatencyGraphProps` | An object containing filter and granularity settings for the latency data. |

#### Outputs
Renders a canvas element containing the latency graph.

#### Internal Logic
1. **Data Fetching:** Uses `createQuery` to fetch latency data from the backend API based on `props.params.filter`, `props.params.granularity`, and the selected dataset ID from `DatasetContext`.
2. **Chart Initialization:** When the component mounts and data is available, it initializes a new `Chart` instance on the canvas element.
3. **Chart Configuration:** Configures the chart type, data structure, axes labels, styling, and animation settings.
4. **Dynamic Updates:** Uses `createEffect` to reactively update the chart data and options whenever `props.params` or `latencyQuery.data` change.
5. **Cleanup:** Uses `onCleanup` to destroy the `Chart` instance when the component unmounts to prevent memory leaks.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @tanstack/solid-query | Used for fetching and managing asynchronous data. |
| chart.js | Used for rendering the line chart. |
| chartjs-adapter-date-fns | Used for handling date formatting on the chart's x-axis. |
| date-fns | Used for date manipulation and formatting. |

## Error Handling
The `getLatency` function, responsible for fetching data, throws an error if the API request fails. This error is not explicitly handled within the component and would likely be caught by a higher-level error boundary in the application. 
