---
title: "CTRSummary.tsx"
---

## High-level description
The `CTRSummary` component displays a summary of click-through rate (CTR) statistics for searches within a specific dataset. It shows the number of searches with clicks, the percentage of searches with clicks, and the average click position.

## Code Structure
The `CTRSummary` component uses the `createQuery` function from the `@tanstack/solid-query` library to fetch CTR summary data from the backend API. It also uses the `Show` component from `solid-js` to conditionally render content based on the availability of data and whether CTR tracking is set up.

## References
- `AnalyticsFilter` type from "shared/types"
- `createQuery` function from "@tanstack/solid-query"
- `getSearchCTRSummary` function from "../../api/ctr"
- `Show` and `useContext` from "solid-js"
- `DatasetContext` from "../../layouts/TopBarLayout"
- `useCTRNeedsSetup` from "../../hooks/useCTRNeedsSetup"

## Symbols

### `CTRSummary`
#### Description
This component fetches and displays a summary of click-through rate (CTR) statistics for a given dataset and filter. It shows the number of searches with clicks, the percentage of searches with clicks, and the average click position. If CTR tracking is not set up, it will not display the summary table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props | `SearchCTRStatsProps` | An object containing the filter to apply to the CTR summary data. |

#### Outputs
JSX element representing the CTR summary table.

#### Internal Logic
1. **Retrieves dataset ID:** Uses the `DatasetContext` to access the currently selected dataset's ID.
2. **Fetches CTR summary data:** Utilizes the `createQuery` hook to fetch CTR summary data from the backend API using the `getSearchCTRSummary` function. The query depends on the `datasetId` and the provided `filter`.
3. **Checks CTR setup:** Employs the `useCTRNeedsSetup` hook to determine if CTR tracking is properly configured.
4. **Renders content:**
   - Displays a "Loading..." message while the query is in progress.
   - If the query is successful and CTR tracking is set up, renders a table with the following CTR statistics:
     - Searches With Clicks
     - Percent Searches With Clicks
     - Average Click Position
   - If CTR tracking is not set up, the table is not displayed.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @tanstack/solid-query | Used for data fetching and caching. |
| solid-js | Used for building the user interface. |

## Error Handling
The component handles loading and error states of the `searchSummaryQuery` using the `Show` component. If the query is in progress, it displays a "Loading..." message. If the query fails, it will not display the summary table. 
