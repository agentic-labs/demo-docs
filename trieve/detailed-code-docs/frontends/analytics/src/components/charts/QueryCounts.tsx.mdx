---
title: "QueryCounts.tsx"
---

## High-level description
The `QueryCounts` component displays a summary of total searches performed, categorized by search type and optionally by search method. It allows users to filter the displayed data by a predefined set of date ranges.

## Code Structure
The `QueryCounts` component uses the `createQuery` hook from the `@tanstack/solid-query` library to fetch and manage the query count data. It also utilizes the `DatasetContext` to access the currently selected dataset's ID. The `Select` component from `shared/ui` is used to provide a dropdown for selecting the date range filter.

## References
- `SearchTypeCount` type from "shared/types"
- `DatasetContext` from "../../layouts/TopBarLayout"
- `createQuery` from "@tanstack/solid-query"
- `getQueryCounts` from "../../api/analytics"
- `toTitleCase` from "../../utils/titleCase"
- `Select` from "shared/ui"
- `DateRangeOption`, `dateRanges` from "../FilterBar"
- `CTRSummary` from "./CTRSummary"

## Symbols

### `QueryCounts`
#### Description
This component fetches and displays the total count of queries for different search types within a selected date range. It visualizes the data using a grid layout.

#### Inputs
This is a React Functional Component and doesn't explicitly define inputs.

#### Outputs
JSX Element representing the query counts section.

#### Internal Logic
1. **Retrieves Context:** Fetches the currently selected dataset from the `DatasetContext`.
2. **Manages Date Selection:** Uses the `createSignal` hook to manage the selected date range for filtering the data. The default range is set to "Past Week".
3. **Fetches Query Counts:** Utilizes the `createQuery` hook to fetch query counts data based on the selected date range and dataset ID. The `getQueryCounts` function is called to retrieve the data.
4. **Renders UI:**
    - Displays a heading "Total Searches" with a subtitle.
    - Renders a `Select` component for choosing the date range filter.
    - Shows a loading indicator while data is being fetched.
    - If data is available:
        - Iterates through the `queryCountsQuery.data` array using the `For` component.
        - For each search type, displays the type, optional search method (if available), and the corresponding search count.
        - If no data is found for the selected period, a "No searches found" message is displayed.
    - Renders the `CTRSummary` component, passing the selected date range as a filter.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| solid-js | Core library for building the component's UI and logic. |
| @tanstack/solid-query | Used for fetching, caching, and managing the asynchronous query count data. |
| shared/types | Provides the `SearchTypeCount` type definition. |
| ../../layouts/TopBarLayout | Provides the `DatasetContext` for accessing the selected dataset. |
| ../../api/analytics | Provides the `getQueryCounts` function for fetching data from the API. |
| ../../utils/titleCase | Provides the `toTitleCase` utility function for formatting text. |
| shared/ui | Provides the `Select` component for the date range dropdown. |
| ../FilterBar | Provides the `DateRangeOption` type and `dateRanges` array for the date filter options. |
| ./CTRSummary | Renders the CTR summary component. |

## Side Effects
- Fetches data from the API when the component mounts and whenever the selected date range changes.
- Updates the URL search parameters with the selected dataset ID.

## Error Handling
The component relies on the error handling mechanisms provided by `@tanstack/solid-query`. If the API request fails, the `queryCountsQuery.error` object will contain the error details.

## Logging
The code doesn't implement any specific logging mechanisms.
