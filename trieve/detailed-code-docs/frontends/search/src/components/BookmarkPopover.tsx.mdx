---
title: "BookmarkPopover.tsx"
---

## High-level description
This code defines a `BookmarkPopover` component in React, which allows users to manage groups for a specific chunk of data. It provides functionality to view, add, and remove chunks from groups, as well as create new groups. The component uses a popover interface and integrates with an API to perform these operations.

## Code Structure
The main component `BookmarkPopover` uses several hooks and sub-components to manage its state and render the UI. It interacts with the `DatasetAndUserContext` to access user and dataset information. The component makes API calls to fetch and update chunk groups and bookmarks.

## Symbols

### BookmarkPopover
#### Description
The main component that renders a popover for managing chunk groups and bookmarks.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| chunkMetadata | ChunkMetadata | Metadata of the chunk being managed |
| chunkGroups | ChunkGroupDTO[] | List of available chunk groups |
| totalGroupPages | number | Total number of pages for chunk groups |
| setLoginModal | Setter&lt;boolean&gt; | Function to set login modal visibility |
| bookmarks | ChunkBookmarksDTO[] | List of bookmarks for the chunk |
| setChunkGroups | Setter&lt;ChunkGroupDTO[]&gt; | Function to update chunk groups |

#### Internal Logic
1. Initializes state variables for managing groups, bookmarks, and UI elements.
2. Uses `createEffect` to handle data fetching and updates based on state changes.
3. Implements functions to refetch groups and bookmarks from the API.
4. Renders a popover with group management options, including adding/removing chunks from groups and creating new groups.

### refetchGroups
#### Description
Fetches updated chunk groups from the API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| curPage | number | Current page number for pagination |
| chunkBookmarks | ChunkBookmarksDTO[] | Current bookmarks for the chunk |
| setChunkGroups | Setter&lt;ChunkGroupDTO[]&gt; | Function to update chunk groups |

#### Internal Logic
1. Makes an API call to fetch chunk groups for the current dataset and page.
2. Updates the local state with the fetched groups, merging with existing bookmarks.
3. Handles authentication errors by setting `notLoggedIn` state.

### refetchBookmarks
#### Description
Fetches updated bookmarks for the current chunk from the API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| curPage | number | Current page number for pagination |

#### Internal Logic
1. Makes an API call to fetch bookmarks for the current chunk.
2. Updates the local state with the fetched bookmarks.
3. Merges the fetched bookmarks with existing chunk groups.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| solid-js | Core library for reactive UI components |
| solid-headless | UI component library for Solid.js |
| solid-icons | Icon library for Solid.js |
| shared/ui | Custom UI components (e.g., Tooltip) |

## Error Handling
The component handles API errors by setting the `notLoggedIn` state when receiving a 401 status code. It also uses try-catch blocks to prevent unhandled exceptions during API calls.

## Performance Considerations
The component uses `createEffect` hooks to efficiently manage side effects and update the UI based on state changes. It also implements pagination for chunk groups to handle large datasets more efficiently.