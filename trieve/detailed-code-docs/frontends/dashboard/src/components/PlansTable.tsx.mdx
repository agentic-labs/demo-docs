---
title: "PlansTable.tsx"
---

## High-level description
This code defines a `PlansTable` component in React that displays subscription plans for an organization. It allows users to view, upgrade, downgrade, or cancel their subscription plans. The component fetches available plans from an API, displays them in a table format, and provides functionality to change the subscription.

## Code Structure
The main `PlansTable` component uses several SolidJS signals and effects to manage state and side effects. It interacts with an API to fetch plans, update subscriptions, and handle user actions. The component also includes sub-components like `ActiveTag` for displaying the current plan status.

## Symbols

### PlansTable
#### Description
The main component that renders the subscription plans table and handles plan management.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| currentOrgSubPlan | OrganizationAndSubAndPlan \| null | The current organization's subscription and plan details |

#### Internal Logic
1. Fetches available plans from the API
2. Manages state for current plan, subscription, and available plans
3. Handles plan upgrades, downgrades, and cancellations
4. Renders the plans table with action buttons for each plan

### ActiveTag
#### Description
A small component that displays a tag for the current active plan or future plan start date.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| text | string | The text to display in the tag |

## Side Effects
- Fetches available plans from the API when the component mounts
- Updates the current plan and subscription when `props.currentOrgSubPlan` changes
- Makes API calls to update or cancel subscriptions based on user actions

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| solid-js | For reactive state management and component rendering |
| solid-icons | For displaying icons in the component |
| shared/types | For type definitions used in the component |
| ../formatters | For formatting currency and numbers |
| ./ShowToasts | For displaying toast notifications |
| ../types/apiTypes | For API-related type definitions |

## Error Handling
The component uses toast notifications to inform users about successful actions or errors. It also handles API errors and updates the UI accordingly.

## Performance Considerations
The component uses `createMemo` for derived state calculations, which can help optimize performance by memoizing the result of expensive computations.

## API/Interface Reference
| Endpoint | Method | Description |
|:---------|:-------|:------------|
| /stripe/plans | GET | Fetches available subscription plans |
| /stripe/checkout/setup/${selectedOrgId} | POST | Creates a Stripe setup checkout session |
| /organization/${selectedOrgId} | GET | Fetches organization details |
| /stripe/subscription/${subscriptionId} | DELETE | Cancels a subscription |
| /stripe/subscription_plan/${subscriptionId}/${planId} | PATCH | Updates a subscription plan |

This component provides a comprehensive interface for managing subscription plans, including viewing available plans, upgrading, downgrading, and canceling subscriptions. It integrates with a backend API to handle these operations and provides real-time feedback to the user through toast notifications.