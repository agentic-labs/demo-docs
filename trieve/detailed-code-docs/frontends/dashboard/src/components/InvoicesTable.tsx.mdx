---
title: "InvoicesTable.tsx"
---

## High-level description
The `InvoicesTable` component is a Solid.js component that fetches and displays a table of invoices for a selected organization. It uses the UserContext to get the selected organization and makes an API call to retrieve the invoices. The component then renders a table with invoice details, including date, status, total amount, and a link to view the invoice on Stripe.

## Code Structure
The main symbols in this code are:
1. `InvoicesTable`: The main functional component.
2. `selectedOrganization`: A memoized value derived from the UserContext.
3. `orgInvoices`: A signal that holds the fetched invoice data.
4. `createEffect`: Used to fetch invoices when the selected organization changes.

These symbols work together to fetch and display the invoice data based on the selected organization.

## Symbols

### InvoicesTable
#### Description
This is the main functional component that renders the invoices table.

#### Internal Logic
1. Retrieves the selected organization from the UserContext.
2. Fetches invoice data for the selected organization using an API call.
3. Renders a table with invoice details if invoices are available.

### selectedOrganization
#### Description
A memoized value that retrieves the currently selected organization from the UserContext.

### orgInvoices
#### Description
A signal that holds the array of fetched invoice data.

### createEffect
#### Description
An effect that runs when the selected organization changes, fetching the invoice data for that organization.

#### Internal Logic
1. Checks if a selected organization exists.
2. Makes an API call to fetch invoices for the selected organization.
3. Handles potential errors, including a 403 status which may indicate a role change.
4. Updates the `orgInvoices` signal with the fetched data.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| solid-js | Provides reactive primitives and components |
| UserContext | Provides user and organization data |
| createToast | Displays toast notifications |
| StripeInvoice | Type definition for invoice data |
| TbFileInvoice | Icon component for invoice link |
| formatDate, usdFormatter | Utility functions for formatting date and currency |

## Error Handling
The component handles a 403 error specifically, which may occur if a user's role has recently changed. It displays a toast notification in this case, prompting the user to sign out and sign back in.

## Performance Considerations
The component uses `createMemo` and `createEffect` to efficiently manage reactivity and avoid unnecessary re-renders. The API call for fetching invoices is aborted if the component is cleaned up before the request completes, preventing potential memory leaks.