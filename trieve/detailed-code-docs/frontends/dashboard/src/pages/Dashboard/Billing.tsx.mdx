---
title: "Billing.tsx"
---

## High-level description
The `Billing.tsx` file implements a billing component for a dashboard, displaying subscription plans and invoices for an organization. It fetches and displays the current organization's subscription details, available plans, and past invoices, allowing users to manage their subscription.

## Code Structure
The main `Billing` component uses several hooks and sub-components to fetch and display billing information. It interacts with the `UserContext` to get the selected organization, fetches subscription and plan data from an API, and renders `PlansTable` and `InvoicesTable` components.

## References
- `UserContext` from "../../contexts/UserContext"
- `OrganizationAndSubAndPlan` from "shared/types"
- `PlansTable` from "../../components/PlansTable"
- `createToast` from "../../components/ShowToasts"
- `InvoicesTable` from "../../components/InvoicesTable"

## Symbols

### `Billing`
#### Description
The main component that renders the billing page, including subscription plans and invoices.

#### Internal Logic
1. Retrieves the selected organization from `UserContext`.
2. Fetches the organization's subscription and plan data from the API.
3. Renders the `PlansTable` and `InvoicesTable` components.

#### Side Effects
- Fetches organization subscription and plan data from the API.
- Cleans up the fetch request on component unmount.

### `createEffect`
#### Description
A Solid.js effect hook used to fetch organization subscription and plan data when the selected organization changes.

#### Internal Logic
1. Checks if a selected organization exists.
2. Sends a fetch request to the API to get organization data.
3. Updates the `orgSubPlan` state with the fetched data.
4. Handles potential errors and displays a toast message if needed.

#### Side Effects
- Fetches data from the API.
- Updates component state.
- Potentially displays error messages.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| solid-js | Provides reactive primitives and components |
| @solidjs/router | Handles routing in the application |

## Error Handling
The component handles potential errors during the API fetch by checking the response status. If a 403 status is received, it displays an error toast suggesting the user sign out and sign back in due to potential role changes.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| `/organization/${selectedOrgId}` | GET | - | OrganizationAndSubAndPlan | Fetches organization subscription and plan data |

The component relies on the API to provide accurate and up-to-date billing information for the selected organization.