---
title: "pvc.yaml"
---

## High-level description
This code defines a Kubernetes PersistentVolumeClaim (PVC) template using Helm templating. It dynamically sets the storage size and storage class based on the environment specified in the Helm values.

## Code Structure
The code uses Helm templating to define a PVC. It uses conditional logic to set the storage class based on the environment and calculates the storage size using a ternary operator.

## Symbols
### `pvc.yaml`
#### Description
This file defines a Kubernetes PersistentVolumeClaim (PVC) template. It uses Helm templating to dynamically configure the PVC based on the provided values.

#### Inputs
This template uses values from a Helm values file. The relevant values are:

| Name | Type | Description |
|:-----|:-----|:------------|
| `.Values.environment` | string | The environment for which the PVC is being created (e.g., "local", "aws"). |
| `.Release.Name` | string | The name of the Helm release. |
| `$NAME` | string | The name of the application. This value needs to be passed to the template. |

#### Internal Logic
1. **Storage Size Calculation:**
   - A variable `$${p}storage` is defined using the `ternary` function.
   - If `.Values.environment` is "local", `$${p}storage` is set to "500Gi".
   - Otherwise, `$${p}storage` defaults to "10Gi".

2. **Storage Class Selection:**
   - An `if` condition checks if `.Values.environment` is "aws".
     - If true, `storageClassName` is set to "gp2".
     - If false, `storageClassName` is set to an empty string.

3. **PVC Definition:**
   - The template defines a PVC with the name `$NAME-pvc`.
   - Labels are added for the application name and instance.
   - `accessModes` is set to "ReadWriteOnce".
   - `storageClassName` and `storage` are set based on the calculated values.

## Dependencies
This code depends on Helm for templating and assumes deployment to a Kubernetes cluster.

## Configuration
The PVC configuration is controlled by the following values:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| `.Values.environment` | string | N/A | The target environment. Determines storage size and class. |
| `$NAME` | string | N/A | The application name. Used for naming the PVC. |

## Error Handling
This code does not implement specific error handling. Errors during template rendering or PVC creation will be handled by Helm and Kubernetes respectively. 
