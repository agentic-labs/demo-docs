---
title: "rust-tests.yml"
---

## High-level description
This GitHub Actions workflow file defines a set of jobs to run Rust-related tests and checks on pull requests that modify files in the 'server' directory. It includes formatting checks, linting with Clippy, and OpenAPI specification generation and validation.

## Code Structure
The workflow consists of three main jobs: `cargo-fmt`, `clippy_check`, and `redoc`. Each job runs on a specific Ubuntu runner and performs different tasks related to Rust code quality and documentation.

## Symbols

### Workflow
#### Description
This GitHub Actions workflow is triggered on pull requests that modify files in the 'server' directory. It uses concurrency to manage multiple workflow runs.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| github.workflow | string | The name of the current workflow |
| github.head_ref | string | The branch or tag name that triggered the workflow run |

#### Internal Logic
1. Sets up concurrency to cancel in-progress runs when a new commit is pushed.
2. Defines the trigger event as pull requests modifying files in the 'server' directory.
3. Defines three jobs: `cargo-fmt`, `clippy_check`, and `redoc`.

### Job: cargo-fmt
#### Description
This job runs the `cargo fmt` command to check Rust code formatting.

#### Internal Logic
1. Checks out the repository.
2. Updates the stable Rust toolchain.
3. Runs `cargo fmt` with the `--check` flag to verify formatting without making changes.

### Job: clippy_check
#### Description
This job runs Clippy, the Rust linter, to check for potential issues in the code.

#### Internal Logic
1. Checks out the repository.
2. Sets up caching for Rust dependencies.
3. Installs and updates Clippy and the stable Rust toolchain.
4. Runs Clippy with specific arguments and treats warnings as errors.
5. Caches the build artifacts.

### Job: redoc
#### Description
This job generates an OpenAPI specification from the Rust code and validates it using Vacuum.

#### Internal Logic
1. Checks out the repository.
2. Sets up caching for Rust dependencies.
3. Updates the stable Rust toolchain.
4. Installs Vacuum, an OpenAPI linter.
5. Generates the OpenAPI specification using a custom binary.
6. Runs Vacuum to lint the generated OpenAPI specification.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| actions/checkout@v4 | Checks out the repository |
| useblacksmith/cache@v5 | Caches Rust dependencies and build artifacts |
| clechasseur/rs-clippy-check@v3 | Runs Clippy linter |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| runs-on | string | varies | Specifies the runner for each job |
| features | string | runtime-env | Feature flag used for cargo commands |

## Error Handling
The workflow is designed to fail if any of the checks (formatting, linting, or OpenAPI validation) fail. This ensures that only code meeting the defined quality standards is merged.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| N/A | N/A | N/A | openapi.json | Generated OpenAPI specification |

This workflow generates an OpenAPI specification but does not explicitly define an API. The specification is output to `openapi.json` for validation purposes.