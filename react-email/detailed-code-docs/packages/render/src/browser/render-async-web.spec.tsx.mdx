---
title: "render-async-web.spec.tsx"
---

## High-level description
This file contains unit tests for the `renderAsync` function in a browser environment. It tests the function's ability to convert React components into HTML and plain text, handling various scenarios including Next.js 14 error stubs and different rendering options.

## Code Structure
The test suite uses Vitest and focuses on testing the `renderAsync` function from the `render-async` module. It mocks the `react-dom/server` module and tests different rendering scenarios.

## References
- `renderAsync` from "./render-async"
- `Template` from "../shared/utils/template"
- `Preview` from "../shared/utils/preview"

## Symbols

### `describe("renderAsync on the browser environment", ...)`
#### Description
This is the main test suite for the `renderAsync` function in a browser environment.

#### Internal Logic
- Sets up mocks for `react-dom/server` before each test
- Resets all mocks after each test
- Contains individual test cases for different scenarios

### `it("converts a React component into HTML with Next 14 error stubs", ...)`
#### Description
Tests the `renderAsync` function's behavior when Next.js 14 error stubs are present.

#### Internal Logic
1. Mocks `react-dom/server` to throw errors for legacy APIs
2. Calls `renderAsync` with a `Template` component
3. Asserts that the output matches the expected HTML snapshot

### `it("converts a React component into HTML", ...)`
#### Description
Tests the basic functionality of `renderAsync` in converting a React component to HTML.

#### Internal Logic
1. Calls `renderAsync` with a `Template` component
2. Asserts that the output matches the expected HTML snapshot

### `it("converts a React component into PlainText", ...)`
#### Description
Tests the `renderAsync` function's ability to convert a React component to plain text.

#### Internal Logic
1. Calls `renderAsync` with a `Template` component and `plainText: true` option
2. Asserts that the output matches the expected plain text snapshot

### `it("converts to plain text and removes reserved ID", ...)`
#### Description
Tests the `renderAsync` function's ability to convert a React component to plain text while removing reserved IDs.

#### Internal Logic
1. Calls `renderAsync` with a `Preview` component and `plainText: true` option
2. Asserts that the output matches the expected plain text snapshot, with reserved ID content removed

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| vitest | Testing framework used for running the tests |
| react-dom/server | Server-side rendering functionality (mocked in tests) |
| react-dom/server.browser | Browser-specific server-side rendering (used as a mock) |

## Error Handling
The tests include error handling scenarios, particularly for Next.js 14 error stubs. The test suite mocks `react-dom/server` to throw specific errors for legacy APIs and ensures that `renderAsync` can handle these errors gracefully.

## TODOs
There are no explicit TODOs in the code.