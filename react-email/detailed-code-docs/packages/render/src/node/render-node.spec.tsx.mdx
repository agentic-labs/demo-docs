---
title: "render-node.spec.tsx"
---

## High-level description
This file contains unit tests for the `render` function in a Node.js environment. It tests the rendering of React components to HTML and plain text, including scenarios with Next.js 14 error stubs and Suspense boundaries.

## Symbols

### `describe("render on node environments", () =&gt; { ... })`
#### Description
This is the main test suite for rendering in Node environments. It contains several test cases to verify different aspects of the rendering process.

### `it("converts a React component into HTML with Next 14 error stubs", async () =&gt; { ... })`
#### Description
This test case mocks the `react-dom/server` module to simulate Next.js 14 error stubs and verifies that the `render` function still works correctly.

#### Internal Logic
1. Mocks `react-dom/server` to throw errors for legacy rendering methods.
2. Renders a `Template` component with the `render` function.
3. Compares the output to an inline snapshot.

### `it("that it properly waits for Suepsense boundaries to resolve before resolving", async () =&gt; { ... })`
#### Description
This test case verifies that the `render` function correctly handles Suspense boundaries and waits for them to resolve before completing the rendering process.

#### Internal Logic
1. Defines an `EmailTemplate` component that uses `usePromise` to fetch content.
2. Wraps the `EmailTemplate` in a Suspense boundary.
3. Renders the component and compares the output to a snapshot.

### `it("converts a React component into HTML", async () =&gt; { ... })`
#### Description
This test case verifies that the `render` function correctly converts a React component into HTML.

#### Internal Logic
1. Renders a `Template` component with the `render` function.
2. Compares the output to an inline snapshot.

### `it("converts a React component into PlainText", async () =&gt; { ... })`
#### Description
This test case verifies that the `render` function correctly converts a React component into plain text when the `plainText` option is set to `true`.

#### Internal Logic
1. Renders a `Template` component with the `render` function, setting the `plainText` option to `true`.
2. Compares the output to an inline snapshot.

### `it("converts to plain text and removes reserved ID", async () =&gt; { ... })`
#### Description
This test case verifies that the `render` function correctly converts a component to plain text and removes elements with reserved IDs.

#### Internal Logic
1. Renders a `Preview` component with the `render` function, setting the `plainText` option to `true`.
2. Compares the output to an inline snapshot, expecting the reserved ID element to be removed.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react-promise-suspense | Used for handling asynchronous operations in React components |
| react | Used for React components and Suspense |
| ../shared/utils/template | Provides the Template component used in tests |
| ../shared/utils/preview | Provides the Preview component used in tests |
| ./render | The main render function being tested |

## References
- The `render` function from `./render` is the main subject of these tests.
- `Template` and `Preview` components from `../shared/utils/template` and `../shared/utils/preview` are used in the tests.

## Error Handling
The tests include error handling scenarios, particularly in the first test case where Next.js 14 error stubs are simulated by mocking `react-dom/server` to throw errors for legacy rendering methods.

## TODOs
There is a typo in the second test case description: "Suepsense" should be "Suspense".