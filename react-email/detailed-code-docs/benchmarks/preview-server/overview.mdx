---
title: "Overview"
---

## High-level description
The `benchmarks/preview-server` directory contains a set of benchmarking tools and results for comparing the performance of different versions of a React Email preview server. The main focus is on measuring and comparing startup time and request handling speed between a local development version and a specific canary version (2.1.7-canary.2) of the server.

## What does it do?
This directory implements a benchmarking workflow that:

1. Starts different versions of the React Email preview server (local and canary).
2. Measures server startup time.
3. Performs multiple fetch requests to test server response times.
4. Compares performance between different server versions.
5. Saves benchmark results to JSON files for analysis.

The benchmarks are designed to help developers understand performance differences between server versions, particularly focusing on startup time and request handling efficiency. This allows for identifying performance improvements or regressions between different versions of the React Email preview server.

## Entry points
The main entry points for the benchmarking process are located in the `src` directory:

1. `local-vs-2.1.7-canary.2-on-startup.ts`: This script focuses on comparing the startup performance of a local server version against the specific canary version (2.1.7-canary.2).

2. `local-vs-2.1.7-canary.2.ts`: This script compares the overall performance (including startup and request handling) between the local and canary server versions.

These scripts utilize utility functions from the `utils` subdirectory to manage server lifecycle and perform benchmarking operations.

## Key Files
1. `src/utils/run-server.ts`: Contains the `runServer` function, which starts a server instance and returns information about the running server.

2. `src/utils/run-server-and-fetch-preview-page.ts`: Defines the `runServerAndFetchPreviewPage` function, which starts a server, waits for it to be ready, fetches a preview page, and then shuts down the server.

3. `bench-results-30-iterations.json`: Contains the results of benchmark runs, including detailed performance metrics for each iteration.

4. `startup-bench-results-30-iterations.json`: Similar to the above, but specifically for startup performance benchmarks.

## Dependencies
The project relies on the following key dependencies:

1. `react-email`: The local version of the react-email library for benchmarking.
2. `react-email-canary`: A specific canary version (2.1.7-canary.2) of react-email for comparison.
3. `tinybench` (version 2.5.1): Used for running benchmarks with multiple iterations and collecting performance metrics.
4. `tsx` (version 4.7.1): Used to execute TypeScript files directly.
5. `typescript` (version 5.1.6): TypeScript compiler for development.

## Configuration
The benchmarking scripts use the following configuration:

1. Number of iterations: Both main scripts use 30 iterations for their benchmarks, which can be adjusted to balance between accuracy and execution time.

2. Server versions:
   - Local version: Uses a local development build of the server.
   - Canary version: Specifically targets version 2.1.7-canary.2 for comparison.

3. Output files: Benchmark results are saved to JSON files named "bench-results-30-iterations.json" and "startup-bench-results-30-iterations.json".

4. Node.js version: The project requires Node.js version 18.0.0 or higher.

The benchmarking process provides valuable insights into the performance characteristics of different versions of the React Email preview server. By comparing local development versions against specific canary releases, developers can track performance improvements or regressions over time, set performance targets, and make informed decisions about optimizations and release readiness.