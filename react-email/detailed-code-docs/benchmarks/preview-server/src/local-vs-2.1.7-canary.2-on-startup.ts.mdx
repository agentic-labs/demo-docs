---
title: "local-vs-2.1.7-canary.2-on-startup.ts"
---

## High-level description
This code is a benchmark script that compares the startup performance of two versions of a React Email server: a local version and a canary version (2.1.7-canary.2). It runs each server multiple times, measures the startup time, and saves the results to a JSON file.

## Code Structure
The main functionality is implemented in an immediately invoked async function. It uses the `Bench` class from the `tinybench` library to run the benchmarks and the `runServer` function from a local utility module to start the servers.

## References
- `runServer` function from "./utils/run-server"
- `Bench` class from "tinybench"

## Symbols

### Anonymous Async Function
#### Description
This is the main function of the script, which sets up and runs the benchmarks, then saves the results.

#### Internal Logic
1. Creates a new `Bench` instance with 30 iterations.
2. Adds two benchmark tests: one for the local version and one for the canary version.
3. Runs the benchmarks.
4. Writes the results to a JSON file.

### Benchmark Tests
#### Description
Two benchmark tests are defined using the `add` method of the `Bench` instance.

#### Internal Logic for each test
1. Starts a server using the `runServer` function with the appropriate CLI script path.
2. Fetches a preview page from the server.
3. Kills the server subprocess.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| path | For resolving file paths |
| tinybench | For running benchmarks |
| node:fs | For writing results to a file |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| iterations | number | 30 | Number of times each benchmark test is run |

## Performance Considerations
This script is specifically designed to measure and compare the startup performance of two different versions of a React Email server. The use of multiple iterations (30) helps to get a more accurate average performance measurement.

## Side Effects
- Starts and stops server subprocesses multiple times.
- Writes a file named "startup-bench-results-30-iterations.json" with the benchmark results.

## Error Handling
There is no explicit error handling in this script. Errors that occur during the benchmark runs or file writing operation will cause the script to fail.

## TODOs
There are no explicit TODOs in the code.