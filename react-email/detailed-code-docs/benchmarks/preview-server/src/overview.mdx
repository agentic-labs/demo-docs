---
title: "Overview"
---

## High-level description
The `benchmarks/preview-server/src` directory contains benchmark scripts and utilities for comparing the performance of different versions of a React Email preview server. It focuses on measuring startup time and request handling speed, providing a framework for performance testing and comparison.

## What does it do?
This directory implements benchmarking workflows for React Email preview servers. It:
1. Starts different versions of the server (local and canary)
2. Measures server startup time
3. Performs multiple fetch requests to test server response times
4. Compares performance between different server versions
5. Saves benchmark results to JSON files for analysis

The benchmarks are designed to help developers understand performance differences between server versions, particularly focusing on startup time and request handling efficiency.

## Entry points
The main entry points for the benchmarking process are:

1. `local-vs-2.1.7-canary.2-on-startup.ts`: This script focuses on comparing the startup performance of a local server version against a specific canary version (2.1.7-canary.2).

2. `local-vs-2.1.7-canary.2.ts`: This script compares the overall performance (including startup and request handling) between the local and canary server versions.

These scripts utilize the utility functions in the `utils` subdirectory to manage server lifecycle and perform benchmarking operations.

## Key Files
1. `utils/run-server.ts`: Contains the `runServer` function, which starts a server instance and returns information about the running server.

2. `utils/run-server-and-fetch-preview-page.ts`: Defines the `runServerAndFetchPreviewPage` function, which starts a server, waits for it to be ready, fetches a preview page, and then shuts down the server.

## Dependencies
The benchmarking scripts rely on the following external libraries:

1. `tinybench` (version not specified): Used for running benchmarks with multiple iterations and collecting performance metrics.
2. `node:fs`: Node.js built-in module for file system operations, used to write benchmark results to JSON files.
3. `path`: Node.js built-in module for handling file paths.

These dependencies were likely chosen for their simplicity and efficiency in running benchmarks and handling file operations.

## Configuration
The benchmarking scripts use the following configuration:

1. Number of iterations: Both main scripts use 30 iterations for their benchmarks, which can be adjusted to balance between accuracy and execution time.

2. Server versions:
   - Local version: Uses a local development build of the server.
   - Canary version: Specifically targets version 2.1.7-canary.2 for comparison.

3. Output file: Benchmark results are saved to a JSON file named "startup-bench-results-30-iterations.json" in the `local-vs-2.1.7-canary.2-on-startup.ts` script.

The scripts use environment variables and command-line arguments to configure the server instances, but these are not explicitly defined in the provided code snippets.

In summary, this directory provides a comprehensive set of tools for benchmarking React Email preview servers, allowing developers to compare performance between different versions and identify potential performance improvements or regressions.