---
title: "generator_test.go"
---

## High-level description
This file contains unit tests for an RPC (Remote Procedure Call) system, likely implemented using a custom framework. The tests cover various RPC patterns including synchronous requests, bi-directional streaming, server streaming, and client streaming.

## Code Structure
The main test function `TestRPC` sets up a client-server pair and runs multiple sub-tests for different RPC patterns. The `svc` struct implements the server-side logic for these RPC methods.

## Symbols

### `TestRPC`
#### Description
The main test function that sets up the RPC environment and runs sub-tests for different RPC patterns.

#### Internal Logic
1. Creates a client-server connection pair
2. Initializes the client and server
3. Runs sub-tests for different RPC patterns:
   - Synchronous Request
   - Bi-directional Stream
   - Server Stream
   - Client Stream

### `testSynchronous`
#### Description
Tests a synchronous RPC call.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| client | *Client | The RPC client |
| t | *testing.T | Testing context |

#### Internal Logic
1. Creates a request with a message and corpus
2. Calls the `Echo` method on the client
3. Asserts the response matches expected values

### `testBidirectional`
#### Description
Tests a bi-directional streaming RPC call.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| client | *Client | The RPC client |
| t | *testing.T | Testing context |

#### Internal Logic
1. Initiates a bi-directional stream
2. Sends and receives 100 messages
3. Asserts each response matches expected values

### `testServerStreaming`
#### Description
Tests a server streaming RPC call.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| client | *Client | The RPC client |
| t | *testing.T | Testing context |

#### Internal Logic
1. Initiates a server streaming call
2. Receives 10 responses from the server
3. Asserts each response matches expected values

### `testClientStreaming`
#### Description
Tests a client streaming RPC call.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| client | *Client | The RPC client |
| t | *testing.T | Testing context |

#### Internal Logic
1. Initiates a client streaming call
2. Sends 10 messages to the server
3. Receives a final response and asserts it matches expected values

### `svc` struct
#### Description
Implements the server-side logic for the RPC methods being tested.

#### Methods
1. `Echo`: Handles synchronous requests
2. `EchoStream`: Handles bi-directional streaming
3. `Testy`: Placeholder method (not implemented)
4. `Search`: Handles server streaming
5. `Upload`: Handles client streaming

Each method includes assertions to verify the correctness of incoming requests and outgoing responses.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| context | For handling request contexts |
| io | For EOF detection in streaming |
| testing | For test assertions and test running |
| github.com/loopholelabs/testing/conn/pair | For creating client-server connection pairs |
| github.com/stretchr/testify/assert | For test assertions |

This test suite comprehensively covers various RPC patterns, ensuring the correct functionality of the RPC system being tested. It uses a custom implementation for client-server communication and focuses on verifying the correctness of request-response cycles in different streaming scenarios.