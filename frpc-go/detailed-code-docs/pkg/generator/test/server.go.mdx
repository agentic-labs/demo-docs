---
title: "server.go"
---

## High-level description
This code defines a set of test methods for an RPC (Remote Procedure Call) service. It implements various RPC methods including synchronous, bi-directional streaming, server streaming, and client streaming. The code is designed to test the functionality of an Echo service and its associated message types.

## Code Structure
The code defines a `svc` struct that implements various RPC methods. These methods are used to test different aspects of the RPC service, including message handling, streaming, and error checking.

## Symbols

### `svc`
#### Description
A struct that implements the RPC service methods for testing purposes. It contains a testing.T field to perform assertions within the methods.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| t | *testing.T | Testing object for assertions |

### `Echo`
#### Description
Implements a simple echo service that receives a request and returns a response with the same message.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| _ | context.Context | Context (unused) |
| request | *Request | The incoming request |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| *Response | *Response | The echo response |
| error | error | Any error that occurred |

#### Internal Logic
1. Asserts that the incoming message is "Hello World"
2. Asserts that the request corpus is RequestUNIVERSAL
3. Returns a response with the same message and additional data

### `EchoStream`
#### Description
Implements a bi-directional streaming echo service.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| srv | *EchoStreamServer | The stream server |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| error | error | Any error that occurred |

#### Internal Logic
1. Continuously receives messages from the client
2. For each message, asserts its content and corpus
3. Sends back a response with the same message
4. Closes the stream when EOF is received

### `Testy`
#### Description
A placeholder method that panics when called.

### `Search`
#### Description
Implements a server-streaming search service.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| req | *SearchResponse | The search request |
| srv | *SearchServer | The stream server |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| error | error | Any error that occurred |

#### Internal Logic
1. Asserts that the request contains one result
2. Sends 10 responses back to the client
3. Closes the stream

### `Upload`
#### Description
Implements a client-streaming upload service.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| srv | *UploadServer | The stream server |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| error | error | Any error that occurred |

#### Internal Logic
1. Receives messages from the client until EOF
2. Counts the number of received messages
3. Asserts that 11 messages were received
4. Sends a final response and closes the stream

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| context | For handling request contexts |
| io | For EOF detection in streaming |
| testing | For running tests and assertions |
| github.com/stretchr/testify/assert | For making test assertions |

This code is primarily used for testing the RPC service implementation, ensuring that the various methods (Echo, EchoStream, Search, and Upload) behave correctly under different scenarios.