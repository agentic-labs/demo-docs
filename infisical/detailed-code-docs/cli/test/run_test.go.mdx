---
title: "run_test.go"
---

## High-level description
This file contains a set of unit tests for the "run" command of a CLI tool. The tests cover various scenarios using different authentication methods (Service Token and Universal Auth) and command options (recursive, imports, etc.). The tests execute CLI commands and use snapshot testing to verify the output.

## Symbols

### TestServiceToken_RunCmdRecursiveAndImports
#### Description
This test function verifies the behavior of the "run" command using a service token, with recursive and import options enabled.

#### Internal Logic
1. Executes the CLI command with specific arguments.
2. Checks for errors in command execution.
3. Processes the output by removing the initial part (before "INF").
4. Uses cupaloy to perform a snapshot test on the processed output.

### TestServiceToken_RunCmdWithImports
#### Description
Similar to the previous test, but without the recursive option.

### TestUniversalAuth_RunCmdRecursiveAndImports
#### Description
This test function verifies the behavior of the "run" command using Universal Auth, with recursive and import options enabled.

#### Internal Logic
1. Calls `MachineIdentityLoginCmd` to set up authentication.
2. Executes the CLI command with specific arguments, including the UA access token.
3. Checks for errors in command execution.
4. Processes the output by removing the initial part (before "INF").
5. Uses cupaloy to perform a snapshot test on the processed output.

### TestUniversalAuth_RunCmdWithImports
#### Description
Similar to the previous test, but without the recursive option.

### TestUniversalAuth_RunCmdWithoutImports
#### Description
This test function verifies the behavior of the "run" command using Universal Auth, with imports explicitly disabled.

#### Internal Logic
1. Calls `MachineIdentityLoginCmd` to set up authentication.
2. Executes the CLI command with specific arguments, including `--include-imports=false`.
3. Checks for errors in command execution.
4. Processes the output by removing the initial part (before "INF").
5. Uses cupaloy to perform a snapshot test on the processed output.

### TestServiceToken_RunCmdWithoutImports
#### Description
This test function verifies the behavior of the "run" command using a service token, with imports explicitly disabled.

#### Internal Logic
1. Executes the CLI command with specific arguments, including `--include-imports=false`.
2. Checks for errors in command execution.
3. Processes the output by removing the initial part (before "INF").
4. Uses cupaloy to perform a snapshot test on the processed output.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| bytes | Used for manipulating byte slices in output processing |
| testing | Provides testing primitives for Go tests |
| github.com/bradleyjkemp/cupaloy/v2 | Used for snapshot testing |

## Error Handling
The tests use Go's built-in testing framework for error handling. If any error occurs during the execution of the CLI command or snapshot comparison, the test fails with a descriptive error message using `t.Fatalf()`.

## Notes
1. The tests use a global `creds` object, which is not defined in this file. It likely contains authentication credentials and project information.
2. The `FORMATTED_CLI_NAME` constant is used as the name of the CLI tool being tested.
3. The `ExecuteCliCommand` and `MachineIdentityLoginCmd` functions are not defined in this file and are presumably imported from another package.
4. All tests use the `--silent` flag, which likely suppresses some output for easier testing.
5. The output processing step (removing everything before "INF") is consistent across all tests, suggesting that the initial part of the output contains variable information (like timestamps) that should be ignored in snapshot comparisons.