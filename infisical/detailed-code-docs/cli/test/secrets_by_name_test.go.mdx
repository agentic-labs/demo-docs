---
title: "secrets_by_name_test.go"
---

## High-level description
This Go file contains unit tests for the "secrets get" command of a CLI application. The tests cover various scenarios for retrieving secrets by name, including recursive retrieval, handling non-existent secrets, and dealing with imported secrets. The tests are performed using both service token and universal authentication methods.

## Code Structure
The file consists of six test functions, each testing a specific scenario of the "secrets get" command. The tests are divided into two groups: those using service token authentication and those using universal authentication. Each test executes the CLI command with specific parameters and uses snapshot testing to verify the output.

## Symbols

### TestServiceToken_GetSecretsByNameRecursive
#### Description
This function tests the recursive retrieval of secrets by name using a service token for authentication.

#### Internal Logic
1. Executes the CLI command to get secrets recursively.
2. Checks for errors in command execution.
3. Uses cupaloy to perform a snapshot test on the output.

### TestServiceToken_GetSecretsByNameWithNotFoundSecret
#### Description
This function tests the behavior of the "secrets get" command when attempting to retrieve a non-existent secret using a service token.

#### Internal Logic
1. Executes the CLI command to get secrets, including a non-existent secret.
2. Checks for errors in command execution.
3. Uses cupaloy to perform a snapshot test on the output.

### TestServiceToken_GetSecretsByNameWithImports
#### Description
This function tests the retrieval of secrets by name, including imported secrets, using a service token.

#### Internal Logic
1. Executes the CLI command to get secrets, including an imported secret.
2. Checks for errors in command execution.
3. Uses cupaloy to perform a snapshot test on the output.

### TestUniversalAuth_GetSecretsByNameRecursive
#### Description
This function tests the recursive retrieval of secrets by name using universal authentication.

#### Internal Logic
1. Performs machine identity login.
2. Executes the CLI command to get secrets recursively.
3. Checks for errors in command execution.
4. Uses cupaloy to perform a snapshot test on the output.

### TestUniversalAuth_GetSecretsByNameWithNotFoundSecret
#### Description
This function tests the behavior of the "secrets get" command when attempting to retrieve a non-existent secret using universal authentication.

#### Internal Logic
1. Performs machine identity login.
2. Executes the CLI command to get secrets, including a non-existent secret.
3. Checks for errors in command execution.
4. Uses cupaloy to perform a snapshot test on the output.

### TestUniversalAuth_GetSecretsByNameWithImports
#### Description
This function tests the retrieval of secrets by name, including imported secrets, using universal authentication.

#### Internal Logic
1. Performs machine identity login.
2. Executes the CLI command to get secrets, including an imported secret.
3. Checks for errors in command execution.
4. Uses cupaloy to perform a snapshot test on the output.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| testing | Provides testing functionality in Go |
| github.com/bradleyjkemp/cupaloy/v2 | Used for snapshot testing |

## Error Handling
The tests use Go's built-in error handling mechanism. If an error occurs during the execution of the CLI command or during snapshot comparison, the test fails with a fatal error, providing an error message.