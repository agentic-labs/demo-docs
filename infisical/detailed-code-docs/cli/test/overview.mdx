---
title: "Overview"
---

## High-level description
This directory contains a comprehensive test suite for the Infisical CLI tool. It includes tests for various functionalities such as user authentication, secret management, and command execution. The tests cover different authentication methods (Service Token, Universal Auth, and User Auth) and various command options.

## What does it do?
The test suite in this directory verifies the functionality of the Infisical CLI tool. It simulates user interactions, tests different authentication methods, and checks the behavior of various commands like exporting secrets, retrieving secrets, and running commands with different options. The tests ensure that the CLI tool behaves correctly under different scenarios, including error cases and edge conditions.

## Entry points
The main entry point for the test suite is the `main_test.go` file, which contains the `TestMain` function. This function sets up the CLI environment, performs user login and initialization before running the tests, and then exits with the appropriate code.

Other key files include:
- `helper.go`: Provides utility functions and structures for setting up and executing CLI commands during testing.
- `login_test.go`: Tests user initialization, user login, and machine identity login.
- `export_test.go`: Tests the export functionality of secrets.
- `run_test.go`: Tests the "run" command with various options.
- `secrets_test.go` and `secrets_by_name_test.go`: Test secret retrieval functionality.

## Key Files
1. `helper.go`: 
   - Defines constants, variables, and utility functions used across the test suite.
   - Provides the `ExecuteCliCommand` function for running CLI commands.
   - Sets up the CLI environment with the `SetupCli` function.

2. `login_test.go`:
   - Contains functions for simulating user initialization, login, and machine identity login.
   - Uses pseudo-terminals to interact with the CLI for login processes.

3. `export_test.go`:
   - Tests the export of secrets with and without imports using both Universal Auth and Service Token authentication.

4. `run_test.go`:
   - Tests the "run" command with various options like recursive execution and import handling.

5. `secrets_test.go` and `secrets_by_name_test.go`:
   - Test secret retrieval functionality under different scenarios and authentication methods.

## Dependencies
The test suite relies on several external libraries:
1. `github.com/bradleyjkemp/cupaloy/v2`: Used for snapshot testing across multiple test files.
2. `github.com/creack/pty`: Used in `login_test.go` for creating pseudo-terminals.
3. `github.com/stretchr/testify/assert`: Used for test assertions in `login_test.go`.

## Configuration
The test suite uses environment variables for configuration, which are accessed through the `Credentials` struct defined in `helper.go`. These include:
- Client ID and Secret
- User Access Token
- Service Token
- Project ID
- Environment Slug
- User Email and Password

The `SetupCli` function in `helper.go` ensures that these environment variables are set before running the tests.

In summary, this test directory provides a comprehensive suite of tests that cover various aspects of the Infisical CLI tool, ensuring its functionality across different authentication methods and command options. The tests are designed to be robust and cover both happy paths and error scenarios.