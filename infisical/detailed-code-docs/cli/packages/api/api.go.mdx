---
title: "api.go"
---

## High-level description
This file contains API client functions for interacting with the Infisical service. It provides methods for authentication, workspace management, secret management, and other operations related to the Infisical platform.

## Code Structure
The code consists of multiple functions that make HTTP requests to various Infisical API endpoints. Each function is responsible for a specific API call, handling the request construction, sending the request, and processing the response.

## Symbols

### `CallGetEncryptedWorkspaceKey`
#### Description
Retrieves the encrypted workspace key for a given workspace ID.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | GetEncryptedWorkspaceKeyRequest | Request containing the workspace ID |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | GetEncryptedWorkspaceKeyResponse | Response containing the encrypted workspace key |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Constructs the API endpoint URL
2. Sends a GET request to the endpoint
3. Handles any errors or unsuccessful responses
4. Returns the result or an error

### `CallGetServiceTokenDetailsV2`
#### Description
Retrieves details of a service token.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| tokenDetailsResponse | GetServiceTokenDetailsResponse | Response containing service token details |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a GET request to the service token endpoint
2. Handles any errors or unsuccessful responses
3. Returns the token details or an error

### `CallLogin1V2`
#### Description
Initiates the first step of the login process.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | GetLoginOneV2Request | Login request details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| loginOneV2Response | GetLoginOneV2Response | Response from the first login step |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a POST request to the login1 endpoint
2. Handles any errors or unsuccessful responses
3. Returns the login response or an error

### `CallVerifyMfaToken`
#### Description
Verifies a Multi-Factor Authentication (MFA) token.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | VerifyMfaTokenRequest | MFA token verification request |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| verifyMfaTokenResponse | *VerifyMfaTokenResponse | Response from MFA token verification |
| responseError | *VerifyMfaTokenErrorResponse | Error response, if verification failed |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a POST request to verify the MFA token
2. Extracts the refresh token from cookies if present
3. Handles different response scenarios (success, error, or API call failure)
4. Returns the verification response, error response, or an error

### `CallLogin2V2`
#### Description
Completes the second step of the login process.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | GetLoginTwoV2Request | Login step 2 request details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| loginTwoV2Response | GetLoginTwoV2Response | Response from the second login step |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a POST request to the login2 endpoint
2. Extracts the refresh token from cookies if present
3. Handles any errors or unsuccessful responses
4. Returns the login response or an error

### `CallGetAllOrganizations`
#### Description
Retrieves all organizations associated with the authenticated user.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgResponse | GetOrganizationsResponse | Response containing organization details |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a GET request to the organizations endpoint
2. Handles any errors or unsuccessful responses
3. Returns the organizations response or an error

### `CallSelectOrganization`
#### Description
Selects an organization for the authenticated user.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | SelectOrganizationRequest | Organization selection request |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| selectOrgResponse | SelectOrganizationResponse | Response from organization selection |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a POST request to select the organization
2. Handles any errors or unsuccessful responses
3. Returns the selection response or an error

### `CallGetAllWorkSpacesUserBelongsTo`
#### Description
Retrieves all workspaces the authenticated user belongs to.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| workSpacesResponse | GetWorkSpacesResponse | Response containing workspace details |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a GET request to the workspaces endpoint
2. Handles any errors or unsuccessful responses
3. Returns the workspaces response or an error

### `CallIsAuthenticated`
#### Description
Checks if the current user is authenticated.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| isAuthenticated | bool | True if authenticated, false otherwise |

#### Internal Logic
1. Sends a POST request to check authentication status
2. Returns true if the request is successful, false otherwise

### `CallGetNewAccessTokenWithRefreshToken`
#### Description
Obtains a new access token using a refresh token.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| refreshToken | string | Refresh token to use for obtaining a new access token |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| newAccessToken | GetNewAccessTokenWithRefreshTokenResponse | Response containing the new access token |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a POST request with the refresh token to obtain a new access token
2. Handles any errors or unsuccessful responses
3. Returns the new access token response or an error

### `CallGetFoldersV1`
#### Description
Retrieves folders for a given workspace and environment.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | GetFoldersV1Request | Request containing workspace, environment, and folder path details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| foldersResponse | GetFoldersV1Response | Response containing folder details |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Constructs a GET request with query parameters for workspace, environment, and folder path
2. Sends the request to the folders endpoint
3. Handles any errors or unsuccessful responses
4. Returns the folders response or an error

### `CallCreateFolderV1`
#### Description
Creates a new folder in a workspace.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | CreateFolderV1Request | Request containing folder creation details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| folderResponse | CreateFolderV1Response | Response containing created folder details |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a POST request to create a new folder
2. Handles any errors or unsuccessful responses
3. Returns the folder creation response or an error

### `CallDeleteFolderV1`
#### Description
Deletes a folder from a workspace.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | DeleteFolderV1Request | Request containing folder deletion details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| folderResponse | DeleteFolderV1Response | Response confirming folder deletion |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a DELETE request to remove the specified folder
2. Handles any errors or unsuccessful responses
3. Returns the folder deletion response or an error

### `CallDeleteSecretsRawV3`
#### Description
Deletes a secret from a workspace.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | DeleteSecretV3Request | Request containing secret deletion details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a DELETE request to remove the specified secret
2. Handles any errors or unsuccessful responses
3. Returns an error if the operation failed

### `CallCreateServiceToken`
#### Description
Creates a new service token.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | CreateServiceTokenRequest | Request containing service token creation details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| createServiceTokenResponse | CreateServiceTokenResponse | Response containing the created service token details |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a POST request to create a new service token
2. Handles any errors or unsuccessful responses
3. Returns the service token creation response or an error

### `CallUniversalAuthLogin`
#### Description
Performs a universal authentication login.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | UniversalAuthLoginRequest | Request containing universal auth login details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| universalAuthLoginResponse | UniversalAuthLoginResponse | Response from the universal auth login |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a POST request to perform universal auth login
2. Handles any errors or unsuccessful responses
3. Returns the login response or an error

### `CallMachineIdentityRefreshAccessToken`
#### Description
Refreshes the access token for machine identity authentication.

#### Inputs
| Name | Type | Description| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | UniversalAuthRefreshRequest | Request containing refresh token details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| universalAuthRefreshResponse | UniversalAuthRefreshResponse | Response containing the refreshed access token |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a POST request to refresh the access token
2. Handles any errors or unsuccessful responses
3. Returns the refresh response or an error

### `CallGetRawSecretsV3`
#### Description
Retrieves raw secrets for a given workspace, environment, and secret path.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | GetRawSecretsV3Request | Request containing workspace, environment, and secret path details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| getRawSecretsV3Response | GetRawSecretsV3Response | Response containing the raw secrets |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Constructs a GET request with query parameters for workspace, environment, secret path, and optional parameters
2. Sends the request to retrieve raw secrets
3. Handles any errors or unsuccessful responses, including specific error for incompatible project versions
4. Sets the ETag from the response header
5. Returns the raw secrets response or an error

### `CallFetchSingleSecretByName`
#### Description
Retrieves a single secret by its name for a given workspace, environment, and secret path.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | GetRawSecretV3ByNameRequest | Request containing secret name, workspace, environment, and secret path details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| getRawSecretV3ByNameResponse | GetRawSecretV3ByNameResponse | Response containing the single secret |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Constructs a GET request with query parameters for workspace, environment, secret path, and other options
2. Sends the request to retrieve the single secret by name
3. Handles any errors or unsuccessful responses
4. Sets the ETag from the response header
5. Returns the single secret response or an error

### `CallCreateDynamicSecretLeaseV1`
#### Description
Creates a new dynamic secret lease.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | CreateDynamicSecretLeaseV1Request | Request containing dynamic secret lease creation details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| createDynamicSecretLeaseResponse | CreateDynamicSecretLeaseV1Response | Response containing the created dynamic secret lease details |
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a POST request to create a new dynamic secret lease
2. Handles any errors or unsuccessful responses
3. Returns the dynamic secret lease creation response or an error

### `CallCreateRawSecretsV3`
#### Description
Creates a new raw secret.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | CreateRawSecretV3Request | Request containing raw secret creation details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a POST request to create a new raw secret
2. Handles any errors or unsuccessful responses
3. Returns an error if the operation failed

### `CallUpdateRawSecretsV3`
#### Description
Updates an existing raw secret.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| httpClient | *resty.Client | HTTP client for making requests |
| request | UpdateRawSecretByNameV3Request | Request containing raw secret update details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| error | error | Error, if any occurred during the API call |

#### Internal Logic
1. Sends a PATCH request to update the existing raw secret
2. Handles any errors or unsuccessful responses
3. Returns an error if the operation failed

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| fmt | String formatting and error handling |
| net/http | HTTP client and cookie handling |
| strings | String manipulation |
| github.com/Infisical/infisical-merge/packages/config | Configuration settings |
| github.com/go-resty/resty/v2 | HTTP client for making API requests |
| github.com/rs/zerolog/log | Logging |

## Constants
| Constant | Type | Value | Description |
|:---------|:-----|:------|:------------|
| USER_AGENT | string | "cli" | User agent string used in API requests |