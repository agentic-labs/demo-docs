---
title: "login.go"
---

## High-level description
This file contains the implementation of the `login` command for the Infisical CLI. It provides various authentication methods, including user login, universal auth, and several cloud provider-specific authentication methods. The code handles the login process, credential storage, and configuration management for the Infisical CLI.

## Code Structure
The main entry point is the `loginCmd` variable, which defines the `login` command. It uses different authentication handlers based on the login method specified. The code also includes helper functions for user prompts, credential management, and browser-based login.

## Symbols

### `loginCmd`
#### Description
This is the main command for the `login` functionality in the Infisical CLI. It handles different authentication methods and manages the login process.

#### Internal Logic
1. Checks for clearing self-hosted domains if specified.
2. Determines the login method and executes the appropriate authentication handler.
3. For user login, it manages the login flow, including browser-based and CLI-based login options.
4. Stores user credentials and updates the configuration file.
5. Handles MFA if enabled.

### `handleUniversalAuthLogin`
#### Description
Handles the universal auth login method using client ID and client secret.

### `handleKubernetesAuthLogin`
#### Description
Handles Kubernetes-based authentication using a machine identity ID and service account token.

### `handleAzureAuthLogin`
#### Description
Handles Azure-based authentication using a machine identity ID.

### `handleGcpIdTokenAuthLogin`
#### Description
Handles Google Cloud Platform ID token-based authentication using a machine identity ID.

### `handleGcpIamAuthLogin`
#### Description
Handles Google Cloud Platform IAM-based authentication using a machine identity ID and service account key file.

### `handleAwsIamAuthLogin`
#### Description
Handles AWS IAM-based authentication using a machine identity ID.

### `handleOidcAuthLogin`
#### Description
Handles OIDC-based authentication using a machine identity ID and JWT.

### `cliDefaultLogin`
#### Description
Manages the CLI-based login process, including credential input, MFA handling, and credential decryption.

### `browserCliLogin`
#### Description
Manages the browser-based login flow, setting up a local server to receive login credentials.

## Dependencies
The code relies on several external libraries and internal packages:
- `github.com/spf13/cobra` for CLI command structure
- `github.com/go-resty/resty/v2` for HTTP requests
- `github.com/manifoldco/promptui` for interactive prompts
- `github.com/posthog/posthog-go` for telemetry
- `github.com/rs/cors` for CORS handling
- `golang.org/x/crypto/argon2` for password hashing
- `github.com/infisical/go-sdk` for Infisical SDK integration

## Configuration
The code uses various configuration options, including:
- `INFISICAL_URL`: The URL for the Infisical API
- `INFISICAL_LOGIN_URL`: The URL for the Infisical login page
- Environment variables and command-line flags for different authentication methods

## Error Handling
The code uses a combination of error returns and the `util.HandleError` function to manage and report errors throughout the login process.

## Logging
The code uses the `github.com/rs/zerolog/log` package for debug logging throughout the login process.

This code provides a comprehensive login functionality for the Infisical CLI, supporting various authentication methods and handling different login flows, including browser-based and CLI-based options.