---
title: "create.tsx"
---

## High-level description
This code defines a React component for creating a Codefresh integration. It allows users to select a project environment, specify a secrets path, and choose a Codefresh service. The component handles form input and submission, creating the integration using the provided data.

## Code Structure
The main component `CodefreshCreateIntegrationPage` uses several hooks for data fetching and state management. It renders a form with select inputs and a button to create the integration. The component also handles loading states and redirects after successful integration creation.

## References
- `useCreateIntegration` hook from "@app/hooks/api"
- Various UI components from "../../../components/v2"
- API hooks from "../../../hooks/api/integrationAuth" and "../../../hooks/api/workspace"

## Symbols

### CodefreshCreateIntegrationPage
#### Description
This is the main functional component that renders the Codefresh integration creation form.

#### Inputs
This component doesn't take any props directly.

#### Outputs
Returns a JSX element representing the integration creation form or an empty div if data is not yet loaded.

#### Internal Logic
1. Fetches necessary data using custom hooks (workspace, integration auth, integration auth apps).
2. Manages form state using React's `useState` hooks.
3. Handles form submission through the `handleButtonClick` function.
4. Renders a form with select inputs for project environment and Codefresh service, and an input for secrets path.
5. Disables the form submission if no Codefresh services are available.

### handleButtonClick
#### Description
An asynchronous function that handles the form submission to create the integration.

#### Inputs
No direct inputs, but uses state variables from the component.

#### Internal Logic
1. Sets loading state.
2. Calls the `mutateAsync` function from `useCreateIntegration` hook with form data.
3. Redirects to the integrations page on success.
4. Handles errors by logging to console.

## Side Effects
- Uses `localStorage` to get and store project data.
- Redirects the user after successful integration creation.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react | Core React library for building the component |
| next/router | Next.js routing functionality |
| query-string | Parsing query parameters from URL |
| @app/hooks/api | Custom hook for creating integration |
| ../../../components/v2 | UI components |
| ../../../hooks/api/integrationAuth | Hooks for fetching integration auth data |
| ../../../hooks/api/workspace | Hook for fetching workspace data |

## Configuration
The component uses some configuration from `localStorage`:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| projectData.id | string | "" | The ID of the current project |

## Error Handling
Errors during integration creation are caught and logged to the console. No specific error handling UI is implemented in this component.

## API/Interface Reference
This component doesn't expose an API but interacts with several API endpoints through custom hooks:
- `useGetWorkspaceById`
- `useGetIntegrationAuthById`
- `useGetIntegrationAuthApps`
- `useCreateIntegration`

The component expects these APIs to provide data about workspaces, integration auth, and integration auth apps, and to allow creation of new integrations.