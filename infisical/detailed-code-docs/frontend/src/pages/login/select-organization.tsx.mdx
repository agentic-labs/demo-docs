---
title: "select-organization.tsx"
---

## High-level description
This code defines a React component for a login page that allows users to select an organization after logging in. It handles various scenarios, including CLI login, SAML authentication, and redirecting users based on their organization membership.

## Code Structure
The main component `LoginPage` uses several hooks and utility functions to manage user authentication, organization selection, and navigation. It interacts with the API through custom hooks and handles different login flows based on the user's context and the presence of a callback port for CLI login.

## References
- `@app/components/notifications`
- `@app/components/utilities/attemptCliLogin`
- `@app/components/v2`
- `@app/const`
- `@app/context`
- `@app/hooks/api`
- `@app/reactQuery`
- `@app/views/Login/Login.utils`

## Symbols

### `LoginPage`
#### Description
The main component that renders the organization selection page and handles the login flow.

#### Internal Logic
1. Fetches user data and organizations
2. Handles organization selection
3. Manages CLI login flow
4. Handles SAML authentication redirection
5. Renders the organization selection UI

### `LoadingScreen`
#### Description
A simple component that displays a loading spinner and message.

### `handleLogout`
#### Description
A callback function that logs out the user and redirects to the login page.

### `handleSelectOrganization`
#### Description
A callback function that handles the organization selection process, including SAML authentication and CLI login scenarios.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| organization | Organization | The selected organization object |

### `handleCliRedirect`
#### Description
A callback function that handles CLI login redirection based on the presence of an auth token and callback port.

## Side Effects
- Modifies local storage and session storage
- Navigates to different pages using Next.js router
- Sends HTTP requests to the server and CLI callback port

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react | Core React library |
| react-i18next | Internationalization |
| next | Next.js framework components |
| @fortawesome | Icon components |
| axios | HTTP client for API requests |
| date-fns | Date manipulation utilities |
| jwt-decode | JWT decoding |

## Error Handling
The code implements basic error handling, mainly through try-catch blocks and error logging. Errors during logout and organization selection are caught and logged to the console.

## API/Interface Reference
The component interacts with several API endpoints through custom hooks:
- `useGetOrganizations`: Fetches user organizations
- `useSelectOrganization`: Selects an organization
- `useLogoutUser`: Logs out the user

It also interacts with a CLI callback endpoint when handling CLI login:
```
http://127.0.0.1:${callbackPort}/
```

## TODOs
There are no explicit TODOs in the code, but potential improvements could include:
1. Enhancing error handling and user feedback
2. Refactoring the organization selection logic for better separation of concerns
3. Improving type safety, especially for decoded JWT tokens