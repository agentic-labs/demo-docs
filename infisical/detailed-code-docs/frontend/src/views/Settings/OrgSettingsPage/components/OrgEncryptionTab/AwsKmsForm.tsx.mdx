---
title: "AwsKmsForm.tsx"
---

## High-level description
This code defines a React component called `AwsKmsForm` that renders a form for adding or updating AWS KMS (Key Management Service) configurations in an organization's settings. It uses React Hook Form for form management and validation, and interacts with API hooks for adding and updating KMS configurations.

## Code Structure
The main component `AwsKmsForm` uses various form controls and hooks to manage the form state, validation, and submission. It conditionally renders different form fields based on the selected authentication mode and handles form submission by calling the appropriate API functions.

## Symbols

### `AwsKmsForm`
#### Description
A React component that renders a form for configuring AWS KMS settings.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| onCompleted | function | Callback function to be called when the form submission is completed |
| onCancel | function | Callback function to be called when the form is cancelled |
| kms | Kms (optional) | Existing KMS configuration for editing |

#### Internal Logic
1. Initializes form using `useForm` hook with default values and validation schema.
2. Uses `useOrganization` hook to get the current organization.
3. Uses `useAddExternalKms` and `useUpdateExternalKms` hooks for API interactions.
4. Renders form fields using `Controller` components from React Hook Form.
5. Handles form submission by calling `handleAddAwsKms` function.
6. Conditionally renders different form fields based on the selected authentication mode.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react-hook-form | Form state management and validation |
| @hookform/resolvers/zod | Zod resolver for form validation |
| @app/components/notifications | For creating notifications |
| @app/components/v2 | UI components |
| @app/context | For accessing organization context |
| @app/hooks/api | API hooks for KMS operations |

## Configuration
The component uses a predefined list of AWS regions (`AWS_REGIONS`) for the region selection dropdown.

## Error Handling
The component uses form validation through Zod schema and displays error messages for invalid inputs. API errors are logged to the console.

## Logging
Console errors are logged for API call failures.

## Side Effects
The component creates notifications upon successful form submission using the `createNotification` function.

## Performance Considerations
The component uses React Hook Form for efficient form state management and validation, which helps in optimizing re-renders and form performance.