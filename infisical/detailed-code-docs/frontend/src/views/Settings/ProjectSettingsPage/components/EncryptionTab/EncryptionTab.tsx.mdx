---
title: "EncryptionTab.tsx"
---

## High-level description
This code defines the `EncryptionTab` component, which is part of the project settings page in a React application. It allows users to manage the Key Management System (KMS) for encrypting project data, including options to switch between the default Infisical KMS and external KMS providers, create backups, and load backups.

## Code Structure
The code consists of three main components:
1. `BackupConfirmationModal`: A modal for creating KMS backups.
2. `LoadBackupModal`: A modal for loading KMS backups.
3. `EncryptionTab`: The main component that renders the encryption settings and manages the overall functionality.

These components work together to provide a comprehensive interface for managing project encryption settings.

## References
This code references several external libraries and custom hooks:
- React and React Hook Form
- FontAwesome icons
- Zod for schema validation
- Custom components from `@app/components/v2`
- Custom hooks from `@app/hooks` and `@app/hooks/api`
- Context providers from `@app/context`

## Symbols

### `BackupConfirmationModal`
#### Description
A modal component that allows users to generate and download a KMS backup.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| isOpen | boolean | Controls the visibility of the modal |
| onOpenChange | function | Callback to update the modal's open state |
| org | Organization | The current organization |
| workspace | Workspace | The current workspace |

#### Internal Logic
1. Uses the `fetchProjectKmsBackup` function to retrieve the backup data.
2. Creates a downloadable file using `FileSaver`.
3. Handles error cases and displays notifications.

### `LoadBackupModal`
#### Description
A modal component that allows users to upload and load a KMS backup.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| isOpen | boolean | Controls the visibility of the modal |
| onOpenChange | function | Callback to update the modal's open state |
| org | Organization | The current organization |
| workspace | Workspace | The current workspace |

#### Internal Logic
1. Manages file upload and parsing.
2. Uses the `loadKmsBackup` mutation to apply the backup.
3. Handles error cases and displays notifications.

### `EncryptionTab`
#### Description
The main component that renders the encryption settings interface.

#### Internal Logic
1. Fetches the list of external KMS providers and the active KMS for the current project.
2. Manages the form state for updating the project KMS.
3. Handles the creation and loading of KMS backups.
4. Renders the KMS selection dropdown and backup-related buttons.
5. Implements permission checks for editing KMS settings.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react-hook-form | Form state management |
| @fortawesome/react-fontawesome | Icon rendering |
| zod | Form schema validation |
| file-saver | File download functionality |

## Error Handling
The code implements error handling through try-catch blocks and displays error notifications using the `createNotification` function.

## API/Interface Reference
The component interacts with several API endpoints through custom hooks:
- `useGetExternalKmsList`: Fetches the list of external KMS providers.
- `useGetActiveProjectKms`: Retrieves the active KMS for the current project.
- `useUpdateProjectKms`: Updates the project's KMS settings.
- `useLoadProjectKmsBackup`: Loads a KMS backup.

These hooks abstract the actual API calls, providing a clean interface for data fetching and mutation.