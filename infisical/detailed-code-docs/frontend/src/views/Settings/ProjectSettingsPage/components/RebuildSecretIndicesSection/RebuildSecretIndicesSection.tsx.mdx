---
title: "RebuildSecretIndicesSection.tsx"
---

## High-level description
This code defines a React component called `RebuildSecretIndicesSection` that provides functionality to rebuild secret indices for a workspace. It includes a button that, when clicked, decrypts and updates the names of all secrets in the current workspace.

## Code Structure
The main component `RebuildSecretIndicesSection` uses several hooks and utilities to manage state, fetch data, and perform cryptographic operations. It conditionally renders based on user permissions and workspace availability.

## References
- `@app/components/notifications`
- `@app/components/utilities/cryptography/crypto`
- `@app/components/v2`
- `@app/context`
- `@app/hooks`
- `@app/hooks/api`
- `@app/hooks/api/roles/types`
- `@app/hooks/api/workspace/queries`

## Symbols

### `RebuildSecretIndicesSection`
#### Description
A functional component that renders a section for rebuilding secret indices in a workspace.

#### Inputs
This component doesn't accept any props.

#### Outputs
Returns a JSX element or null.

#### Internal Logic
1. Retrieves the current workspace and user permissions using context hooks.
2. Uses custom hooks to fetch workspace secrets and decrypt file keys.
3. Defines an `onRebuildIndices` function that:
   - Fetches encrypted secrets
   - Decrypts the file key and secret names
   - Updates the secret names using a mutation hook
   - Displays a success notification
4. Renders a button that triggers the `onRebuildIndices` function when clicked.
5. Only renders the section if the user has admin permissions.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @app/components/notifications | For creating notifications |
| @app/components/utilities/cryptography/crypto | For cryptographic operations |
| @app/components/v2 | For UI components (Button) |
| @app/context | For accessing workspace and project permission context |
| @app/hooks | For utility hooks (useToggle) |
| @app/hooks/api | For API-related hooks |

## Error Handling
The component logs errors to the console if they occur during the index rebuilding process.

## Performance Considerations
The component uses asynchronous operations and decryption, which may impact performance for large numbers of secrets. It also refetches workspace secrets, which could be optimized for larger datasets.