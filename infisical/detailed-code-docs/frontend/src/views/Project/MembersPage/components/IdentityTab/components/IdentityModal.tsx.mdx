---
title: "IdentityModal.tsx"
---

## High-level description
This code defines a React component called `IdentityModal` that allows users to add an identity to a project within a workspace. It provides a form for selecting an identity and assigning a role, with validation and error handling.

## Code Structure
The main component `IdentityModal` uses React hooks and external libraries to manage form state, API calls, and UI components. It interacts with the application's context and custom hooks for data fetching and mutations.

## Symbols

### `IdentityModal`
#### Description
A React functional component that renders a modal for adding an identity to a project.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| popUp | UsePopUpState&lt;["identity"]&gt; | State object for controlling the modal's visibility |
| handlePopUpToggle | function | Function to toggle the modal's visibility |

#### Internal Logic
1. Fetches necessary data using custom hooks (identities, roles, etc.).
2. Filters identities to show only those not already in the workspace.
3. Uses `react-hook-form` for form management and validation.
4. Handles form submission, including API call and error handling.
5. Renders either the form or a message if all identities are already added.

### `schema`
#### Description
Yup validation schema for the form data.

### `FormData`
#### Description
TypeScript type inferred from the Yup schema, representing the form's data structure.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react | Core React library |
| react-hook-form | Form state management and validation |
| next/link | Next.js link component for navigation |
| @hookform/resolvers/yup | Yup resolver for react-hook-form |
| yup | Schema validation library |
| @app/components/notifications | Custom notification component |
| @app/components/v2 | Custom UI components |
| @app/context | Application context providers |
| @app/hooks/api | Custom API hooks |
| @app/hooks/usePopUp | Custom hook for managing pop-up state |

## Error Handling
The component implements error handling in the form submission process. If an error occurs during the API call, it's logged to the console, and a notification is displayed to the user with an error message.

## Logging
The component uses `console.error` to log any errors that occur during form submission.

## Performance Considerations
The component uses `useMemo` to optimize the filtering of identity membership organizations, preventing unnecessary recalculations on re-renders.

This documentation provides a comprehensive overview of the `IdentityModal` component, its functionality, and its integration within the larger application. The component handles the complex task of adding identities to a project, including data fetching, form management, and error handling, while providing a user-friendly interface.