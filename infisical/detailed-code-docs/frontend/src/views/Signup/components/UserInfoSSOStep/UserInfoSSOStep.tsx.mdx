---
title: "UserInfoSSOStep.tsx"
---

## High-level description
This code implements the UserInfoSSOStep component, which is part of the sign-up flow for a user authentication system. It handles the final step of the SSO (Single Sign-On) signup process, where users provide their name and organization details, and the system generates cryptographic keys for secure communication.

## Code Structure
The main component `UserInfoSSOStep` uses various React hooks and utility functions to manage state, handle user input, and perform cryptographic operations. It interacts with external services for user authentication and organization management.

## References
- `@app/components/utilities/cryptography/aes-256-gcm`
- `@app/components/utilities/cryptography/crypto`
- `@app/components/utilities/saveTokenToLocalStorage`
- `@app/components/utilities/SecurityClient`
- `@app/hooks/api/auth/queries`
- `@app/hooks/api/organization/queries`
- `@app/services/ProjectService`

## Symbols

### UserInfoSSOStep
#### Description
A React component that handles the final step of the SSO signup process. It collects user information, generates cryptographic keys, and completes the account signup.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| setStep | function | Function to set the current step in the signup process |
| username | string | User's email address |
| password | string | User's password |
| setPassword | function | Function to update the password state |
| name | string | User's full name |
| providerOrganizationName | string | Organization name provided by the SSO provider |
| providerAuthToken | string (optional) | Authentication token from the SSO provider |

#### Internal Logic
1. Initializes state variables for form fields and errors.
2. Uses `useEffect` to generate a random password and set the organization name if provided.
3. Implements `signupErrorCheck` function to validate user input and perform the signup process:
   - Generates cryptographic keys using TweetNaCl.
   - Creates a verifier using JSRP.
   - Derives a key from the password using Argon2.
   - Encrypts the private key using AES-256-GCM.
   - Calls the `completeAccountSignup` API to finalize the signup process.
   - Saves tokens and keys to local storage.
   - Fetches and selects the user's organization.
   - Initializes a new project.
4. Renders form inputs for name and organization (if not provided by SSO).
5. Provides a submit button to trigger the signup process.

#### Side Effects
- Modifies local storage to store cryptographic keys and tokens.
- Makes API calls to complete the signup process and initialize the user's account.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| crypto | For generating random bytes |
| react | Core React library |
| react-i18next | For internationalization |
| jsrp | For Secure Remote Password (SRP) protocol implementation |
| tweetnacl | For generating cryptographic key pairs |
| tweetnacl-util | For encoding/decoding Base64 |

## Error Handling
The component implements basic error checking for required fields (name and organization name) and displays error messages if these fields are empty.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| /api/v3/signup/complete-account/signup | POST | CompleteAccountSignupDTO | { token: string } | Completes the account signup process |

Note: The actual API endpoint is abstracted through the `completeAccountSignup` function from the auth queries hook.