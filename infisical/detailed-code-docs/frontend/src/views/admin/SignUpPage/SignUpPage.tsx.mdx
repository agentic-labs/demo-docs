---
title: "SignUpPage.tsx"
---

## High-level description
This code defines a SignUpPage component for an admin user registration process in a React application. It implements a two-step signup flow: collecting user details and generating a backup key. The component uses form validation, API calls for user creation, and local storage for token management.

## Code Structure
The main `SignUpPage` component manages the signup process using React hooks and external libraries. It defines a form schema, handles form submission, and controls the flow between the two signup steps. The component also interacts with API hooks and utility functions for user creation and key generation.

## Symbols

### `SignUpPage`
#### Description
The main functional component that renders the signup page and manages the signup process.

#### Internal Logic
1. Initializes form handling with `react-hook-form` and Zod validation.
2. Manages the current step of the signup process using state.
3. Checks for existing user session and redirects if necessary.
4. Handles form submission, including user creation and key generation.
5. Renders different views based on the current signup step.

### `formSchema`
#### Description
Defines the validation schema for the signup form using Zod.

### `SignupSteps` (enum)
#### Description
Enumerates the steps in the signup process: `DetailsForm` and `BackupKey`.

### `handleFormSubmit`
#### Description
Asynchronous function that handles the form submission for user creation.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| { email, password, firstName, lastName } | TFormSchema | User details from the form |

#### Internal Logic
1. Generates user pass key.
2. Creates admin user via API call.
3. Sets security token and saves it to local storage.
4. Selects organization for the user.
5. Updates the signup step to backup key generation.

### `handleBackupKeyGenerate`
#### Description
Asynchronous function that generates and downloads the user's backup key.

#### Internal Logic
1. Retrieves user details from the form.
2. Generates user backup key.
3. Creates and downloads a PDF with the backup key.
4. Redirects to the admin page.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react | Core React library |
| react-hook-form | Form handling and validation |
| next/router | Routing functionality |
| @hookform/resolvers/zod | Zod resolver for react-hook-form |
| framer-motion | Animation library |
| zod | Schema validation |
| @app/components/* | Various custom components and utilities |
| @app/context | Server configuration context |
| @app/hooks/api | API hooks for user creation and organization selection |
| @app/lib/crypto | Cryptographic functions |

## Error Handling
The component uses try-catch blocks to handle errors in form submission and backup key generation. Errors are logged to the console and displayed to the user via notifications.

## TODOs
1. Rewrite token saving functionality into module functions in lib.
2. Refactor the organization data storage pattern to be URL-based instead of using local storage.