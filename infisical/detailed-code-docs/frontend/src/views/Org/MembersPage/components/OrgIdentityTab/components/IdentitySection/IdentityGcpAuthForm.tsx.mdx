---
title: "IdentityGcpAuthForm.tsx"
---

## High-level description
This code defines a React component called `IdentityGcpAuthForm` that provides a form for configuring or updating Google Cloud Platform (GCP) authentication methods for an identity. It allows users to set up either GCP ID Token Auth or GCP IAM Auth, with various configuration options such as allowed service accounts, projects, zones, and token settings.

## Code Structure
The main component `IdentityGcpAuthForm` uses React Hook Form for form management and validation. It interacts with API hooks for adding, updating, and fetching GCP auth data. The component renders form fields based on the selected auth type and handles form submission.

## Symbols

### IdentityGcpAuthForm
#### Description
A React functional component that renders a form for configuring GCP authentication methods.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| handlePopUpOpen | function | Function to open a popup |
| handlePopUpToggle | function | Function to toggle a popup |
| identityAuthMethodData | object | Data about the identity and its auth method |

#### Internal Logic
1. Uses React Hook Form for form management and validation.
2. Fetches existing GCP auth data if available.
3. Renders form fields based on the selected auth type (GCE or IAM).
4. Handles form submission by calling the appropriate API mutation (add or update).
5. Manages trusted IP addresses with a dynamic form array.
6. Implements conditional rendering and functionality based on the user's subscription status.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react-hook-form | Form state management and validation |
| @hookform/resolvers/zod | Zod schema resolver for form validation |
| zod | Schema definition and validation |
| @app/components/notifications | Notification creation |
| @app/components/v2 | UI components |
| @app/context | Organization and subscription context |
| @app/hooks/api | API hooks for GCP auth operations |

## Configuration
The form uses a Zod schema for validation with the following main options:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| type | enum | "gce" | Auth type (GCE or IAM) |
| accessTokenTTL | string | "2592000" | Access token TTL in seconds |
| accessTokenMaxTTL | string | "2592000" | Max access token TTL in seconds |
| accessTokenNumUsesLimit | string | "0" | Max number of access token uses |
| accessTokenTrustedIps | array | [{ipAddress: "0.0.0.0/0"}, {ipAddress: "::/0"}] | Trusted IP addresses |

## Error Handling
The component uses React Hook Form's built-in error handling and displays error messages next to the respective form fields. It also creates notifications for successful or failed form submissions.

## API/Interface Reference
The component interacts with the following API hooks:
| Hook | Purpose |
|:-----|:--------|
| useAddIdentityGcpAuth | Add new GCP auth configuration |
| useUpdateIdentityGcpAuth | Update existing GCP auth configuration |
| useGetIdentityGcpAuth | Fetch existing GCP auth configuration |

These hooks are used to perform CRUD operations on the GCP auth configuration for a given identity.