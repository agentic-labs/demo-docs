---
title: "IdentityModal.tsx"
---

## High-level description
This code defines a React component called `IdentityModal` that provides a form for creating or updating an identity within an organization. It uses React Hook Form for form management and validation, and integrates with API hooks for data operations.

## Code Structure
The main component `IdentityModal` uses several hooks and components to manage form state, perform API operations, and render the UI. It interacts with the organization context and uses custom hooks for API calls.

## Symbols

### IdentityModal
#### Description
A React component that renders a modal for creating or updating an identity. It manages form state, handles form submission, and interacts with API hooks for data operations.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| popUp | UsePopUpState&lt;["identity"]&gt; | State object for controlling the modal's visibility |
| handlePopUpToggle | function | Function to toggle the modal's visibility |

#### Internal Logic
1. Uses `useForm` hook to manage form state and validation.
2. Fetches organization roles using `useGetOrgRoles` hook.
3. Uses `useCreateIdentity`, `useUpdateIdentity`, and `useAddIdentityUniversalAuth` hooks for API operations.
4. Implements `onFormSubmit` function to handle form submission:
   - Updates existing identity or creates a new one based on the presence of `popUp.identity.data`.
   - Adds universal auth for newly created identities.
   - Displays success or error notifications.
5. Renders a form with input fields for name and role selection.

#### Side Effects
- Creates, updates, or adds universal auth to identities via API calls.
- Displays notifications for success or failure of operations.
- Navigates to the newly created identity page on successful creation.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| react | Core React library |
| react-hook-form | Form state management and validation |
| next/router | Routing functionality |
| @hookform/resolvers/yup | Yup resolver for form validation |
| yup | Schema validation |
| @app/components/notifications | Notification creation |
| @app/components/v2 | UI components |
| @app/context | Organization context |
| @app/hooks/api | API hooks for data operations |

## Error Handling
The component implements error handling in the `onFormSubmit` function. It catches any errors during the API calls and displays an error notification with the error message or a default message.

## API/Interface Reference
The component interacts with several API endpoints through custom hooks:
- `useGetOrgRoles`: Fetches organization roles
- `useCreateIdentity`: Creates a new identity
- `useUpdateIdentity`: Updates an existing identity
- `useAddIdentityUniversalAuth`: Adds universal auth to a newly created identity

These API calls are performed based on user actions within the form.