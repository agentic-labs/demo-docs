---
title: "mutation.ts"
---

## High-level description
This code defines React hooks for managing dynamic secret leases using the React Query library. It provides functionality for creating, renewing, and revoking dynamic secret leases, as well as handling API requests and cache invalidation.

## Code Structure
The code exports three main hooks: `useCreateDynamicSecretLease`, `useRenewDynamicSecretLease`, and `useRevokeDynamicSecretLease`. Each hook uses the `useMutation` function from React Query to handle API requests and cache updates.

## References
- `dynamicSecretLeaseKeys` from "./queries"
- Types from "./types"
- `apiRequest` from "@app/config/request"

## Symbols

### useCreateDynamicSecretLease
#### Description
A hook for creating a new dynamic secret lease.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| dto | TCreateDynamicSecretLeaseDTO | Data transfer object containing lease creation details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutation | UseMutationResult | React Query mutation result object |

#### Internal Logic
1. Sends a POST request to create a new lease
2. On success, invalidates the related query cache

### useRenewDynamicSecretLease
#### Description
A hook for renewing an existing dynamic secret lease.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| dto | TRenewDynamicSecretLeaseDTO | Data transfer object containing lease renewal details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutation | UseMutationResult | React Query mutation result object |

#### Internal Logic
1. Sends a POST request to renew the specified lease
2. On success, invalidates the related query cache

### useRevokeDynamicSecretLease
#### Description
A hook for revoking an existing dynamic secret lease.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| dto | TRevokeDynamicSecretLeaseDTO | Data transfer object containing lease revocation details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutation | UseMutationResult | React Query mutation result object |

#### Internal Logic
1. Sends a DELETE request to revoke the specified lease
2. On success, invalidates the related query cache

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @tanstack/react-query | Provides hooks for data fetching and state management |
| @app/config/request | Provides the `apiRequest` function for making API calls |

## Error Handling
The code relies on React Query's built-in error handling mechanisms. Errors from API requests will be captured and can be accessed through the mutation result object.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| /api/v1/dynamic-secrets/leases | POST | TCreateDynamicSecretLeaseDTO | { lease: TDynamicSecretLease; data: unknown } | Create a new dynamic secret lease |
| /api/v1/dynamic-secrets/leases/${leaseId}/renew | POST | TRenewDynamicSecretLeaseDTO | { lease: TDynamicSecretLease } | Renew an existing dynamic secret lease |
| /api/v1/dynamic-secrets/leases/${leaseId} | DELETE | TRevokeDynamicSecretLeaseDTO | { lease: TDynamicSecretLease } | Revoke an existing dynamic secret lease |