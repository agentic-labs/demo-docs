---
title: "queries.tsx"
---

## High-level description
This code defines React hooks for managing service tokens in a workspace. It provides functionality to fetch, create, and delete service tokens using React Query for state management and API interactions.

## Code Structure
The code is structured around three main hooks: `useGetUserWsServiceTokens`, `useCreateServiceToken`, and `useDeleteServiceToken`. These hooks utilize React Query's `useQuery` and `useMutation` to handle API requests and manage the state of service tokens.

## Symbols

### `serviceTokenKeys`
#### Description
An object that defines query keys for React Query, used to identify and manage query caches for service tokens.

#### Internal Logic
It generates a unique key for fetching all workspace service tokens based on the workspace ID.

### `fetchWorkspaceServiceTokens`
#### Description
An asynchronous function that fetches service tokens for a given workspace.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| workspaceID | string | The ID of the workspace to fetch service tokens for |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| serviceTokenData | ServiceToken[] | An array of service token objects |

### `useGetUserWsServiceTokens`
#### Description
A custom hook that fetches and returns service tokens for a given workspace.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| workspaceID | string | The ID of the workspace to fetch service tokens for |

#### Outputs
Returns a React Query result object containing the fetched service tokens and query status.

### `useCreateServiceToken`
#### Description
A custom hook that creates a new service token.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| body | CreateServiceTokenDTO | The data required to create a new service token |

#### Outputs
Returns a React Query mutation result object for creating a service token.

#### Internal Logic
- Sends a POST request to create a service token
- Appends random bytes to the returned token
- Invalidates the query cache for the affected workspace on success

### `useDeleteServiceToken`
#### Description
A custom hook that deletes a service token.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| serviceTokenId | string | The ID of the service token to delete |

#### Outputs
Returns a React Query mutation result object for deleting a service token.

#### Internal Logic
- Sends a DELETE request to remove the specified service token
- Invalidates the query cache for the affected workspace on success

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @tanstack/react-query | Provides hooks for fetching, caching, and updating asynchronous data |
| @app/config/request | Imports the `apiRequest` object for making API calls |

## TODOs
- The `useCreateServiceToken` hook is marked for deprecation with a TODO comment.

This code provides a comprehensive set of hooks for managing service tokens in a React application, utilizing React Query for efficient data fetching and state management. It handles the creation, deletion, and retrieval of service tokens while maintaining the cache integrity.