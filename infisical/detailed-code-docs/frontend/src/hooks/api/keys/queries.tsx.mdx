---
title: "queries.tsx"
---

## High-level description
This code defines React Query hooks and API functions for managing workspace keys in a frontend application. It provides functionality to fetch and upload workspace keys, utilizing React Query for efficient data fetching and state management.

## Code Structure
The code is organized into two main parts: query functions for fetching data and mutation functions for modifying data. The `useQuery` and `useMutation` hooks from React Query are used to create custom hooks that wrap these functions.

## Symbols

### `encKeyKeys`
#### Description
An object that defines query keys for React Query, specifically for getting a user's workspace key.

#### Internal Logic
It uses a function to generate a unique key based on the workspace ID.

### `fetchUserWsKey`
#### Description
An asynchronous function that fetches a user's workspace key from the API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| projectId | string | The ID of the workspace/project |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | UserWsKeyPair | The fetched workspace key pair |

### `useGetUserWsKey`
#### Description
A custom React Query hook that uses `fetchUserWsKey` to retrieve and manage the state of a user's workspace key.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| workspaceID | string | The ID of the workspace |

#### Outputs
The hook returns a query result object from React Query, containing the fetched data, loading state, and error state.

### `uploadWsKey`
#### Description
An asynchronous function that uploads a workspace key to the API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| workspaceId | string | The ID of the workspace |
| userId | string | The ID of the user |
| encryptedKey | string | The encrypted workspace key |
| nonce | string | A cryptographic nonce |

#### Outputs
The function returns the result of the API request.

### `useUploadWsKey`
#### Description
A custom React Query mutation hook that uses `uploadWsKey` to upload a workspace key and manage the mutation state.

#### Outputs
The hook returns a mutation result object from React Query, containing the mutation function and related state.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @tanstack/react-query | Provides the `useQuery` and `useMutation` hooks for data fetching and state management |
| @app/config/request | Provides the `apiRequest` object for making API calls |

## Error Handling
The code relies on React Query's built-in error handling. Errors from API requests will be captured and made available through the query and mutation result objects.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| /api/v2/workspace/:projectId/encrypted-key | GET | - | UserWsKeyPair | Fetches the user's workspace key |
| /api/v1/workspace/:workspaceId/key | POST | { key: { userId, encryptedKey, nonce } } | - | Uploads a workspace key |

This code provides a clean and efficient way to manage workspace keys in a React application, leveraging React Query for improved performance and developer experience.