---
title: "Overview"
---

## High-level description
This directory contains React hooks and TypeScript types for managing workspace keys in a frontend application. It provides functionality for fetching, uploading, and handling workspace keys, utilizing React Query for efficient data fetching and state management.

## What does it do?
The code in this directory enables the frontend application to:
1. Fetch a user's workspace key from the server
2. Upload a new workspace key to the server
3. Manage the state of these operations using React Query

These operations are crucial for implementing end-to-end encryption in the application, allowing users to securely share and access workspace data.

## Key Files
1. `index.tsx`: Serves as the main export point for the custom hooks, making them easily accessible to other parts of the application.

2. `queries.tsx`: Contains the implementation of the custom React Query hooks and API functions for fetching and uploading workspace keys.

3. `types.ts`: Defines TypeScript types for workspace key-related data structures, ensuring type safety throughout the application.

## Dependencies
The main external dependency used in this directory is `@tanstack/react-query`. This library is chosen for its efficient data fetching, caching, and state management capabilities, which are particularly useful for handling asynchronous operations like API calls.

Version information is not explicitly provided in the code snippets, but it's assumed that the application is using a recent version of React Query.

## Configuration
The code uses an `apiRequest` object imported from `@app/config/request` for making API calls. This suggests that there might be a centralized configuration for API requests elsewhere in the application.

The API endpoints used are:
- GET `/api/v2/workspace/:projectId/encrypted-key` for fetching a user's workspace key
- POST `/api/v1/workspace/:workspaceId/key` for uploading a workspace key

These endpoints might be configurable through environment variables or a central configuration file, although this is not explicitly shown in the provided code.

## Code Examples

Here's an example of how the `useGetUserWsKey` hook might be used in a React component:

```tsx
import { useGetUserWsKey } from './hooks/api/keys';

function WorkspaceKeyComponent({ workspaceId }) {
  const { data, isLoading, error } = useGetUserWsKey(workspaceId);

  if (isLoading) return &lt;div&gt;Loading...&lt;/div&gt;;
  if (error) return &lt;div&gt;Error: {error.message}&lt;/div&gt;;

  return (
    &lt;div&gt;
      &lt;h2&gt;Workspace Key&lt;/h2&gt;
      &lt;p&gt;Encrypted Key: {data.encryptedKey}&lt;/p&gt;
      &lt;p&gt;Created At: {data.createdAt}&lt;/p&gt;
    &lt;/div&gt;
  );
}
```

And here's an example of how the `useUploadWsKey` hook might be used:

```tsx
import { useUploadWsKey } from './hooks/api/keys';

function UploadKeyComponent({ workspaceId, userId }) {
  const uploadMutation = useUploadWsKey();

  const handleUpload = () =&gt; {
    const newKey = {
      userId,
      workspaceId,
      encryptedKey: 'newEncryptedKey',
      nonce: 'newNonce'
    };

    uploadMutation.mutate(newKey, {
      onSuccess: () =&gt; {
        console.log('Key uploaded successfully');
      },
      onError: (error) =&gt; {
        console.error('Failed to upload key:', error);
      }
    });
  };

  return (
    &lt;button onClick={handleUpload} disabled={uploadMutation.isLoading}&gt;
      {uploadMutation.isLoading ? 'Uploading...' : 'Upload New Key'}
    &lt;/button&gt;
  );
}
```

These examples demonstrate how the hooks can be easily integrated into React components to manage workspace key operations.

The code in this directory plays a crucial role in implementing secure key management for workspaces, which is likely a core feature of the application's end-to-end encryption system. By providing type-safe and efficient methods for key operations, it helps ensure the security and reliability of the application's data handling processes.