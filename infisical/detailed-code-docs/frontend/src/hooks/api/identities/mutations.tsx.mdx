---
title: "mutations.tsx"
---

## High-level description
This file contains React hooks for managing identity-related API operations using React Query. It provides functions for creating, updating, deleting, and fetching various types of identity authentication methods, such as Universal Auth, GCP Auth, AWS Auth, Azure Auth, Kubernetes Auth, OIDC Auth, and Token Auth.

## Code Structure
The file exports multiple custom hooks, each corresponding to a specific API operation. These hooks use the `useMutation` and `useQueryClient` functions from React Query to manage API requests and cache invalidation. The hooks are organized by authentication method and operation type (e.g., add, update, delete).

## References
- `apiRequest`: Used for making API calls
- `organizationKeys`: Used for cache invalidation
- `identitiesKeys`: Used for cache invalidation

## Symbols

### `useCreateIdentity`
#### Description
Creates a new identity.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| body | CreateIdentityDTO | Identity creation data |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| identity | Identity | Created identity object |

#### Internal Logic
1. Sends a POST request to create an identity
2. Invalidates the organization identity memberships query on success

### `useUpdateIdentity`
#### Description
Updates an existing identity.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| identityId | string | ID of the identity to update |
| name | string | New name for the identity |
| role | string | New role for the identity |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| identity | Identity | Updated identity object |

#### Internal Logic
1. Sends a PATCH request to update an identity
2. Invalidates relevant queries on success

### `useDeleteIdentity`
#### Description
Deletes an existing identity.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| identityId | string | ID of the identity to delete |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| identity | Identity | Deleted identity object |

#### Internal Logic
1. Sends a DELETE request to remove an identity
2. Invalidates the organization identity memberships query on success

### `useAddIdentityUniversalAuth`
#### Description
Adds Universal Auth to an identity.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| identityId | string | ID of the identity |
| clientSecretTrustedIps | object[] | Trusted IPs for client secret |
| accessTokenTTL | number | Access token time-to-live |
| accessTokenMaxTTL | number | Maximum access token time-to-live |
| accessTokenNumUsesLimit | number | Usage limit for access tokens |
| accessTokenTrustedIps | object[] | Trusted IPs for access tokens |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| identityUniversalAuth | IdentityUniversalAuth | Created Universal Auth object |

#### Internal Logic
1. Sends a POST request to add Universal Auth
2. Invalidates relevant queries on success

### `useUpdateIdentityUniversalAuth`
#### Description
Updates Universal Auth for an identity.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| identityId | string | ID of the identity |
| clientSecretTrustedIps | object[] | Trusted IPs for client secret |
| accessTokenTTL | number | Access token time-to-live |
| accessTokenMaxTTL | number | Maximum access token time-to-live |
| accessTokenNumUsesLimit | number | Usage limit for access tokens |
| accessTokenTrustedIps | object[] | Trusted IPs for access tokens |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| identityUniversalAuth | IdentityUniversalAuth | Updated Universal Auth object |

#### Internal Logic
1. Sends a PATCH request to update Universal Auth
2. Invalidates relevant queries on success

### `useDeleteIdentityUniversalAuth`
#### Description
Deletes Universal Auth for an identity.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| identityId | string | ID of the identity |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| identityUniversalAuth | IdentityUniversalAuth | Deleted Universal Auth object |

#### Internal Logic
1. Sends a DELETE request to remove Universal Auth
2. Invalidates relevant queries on success

(Note: The file contains many more hooks following a similar pattern for different authentication methods. For brevity, I've only detailed a few representative examples.)

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @tanstack/react-query | Provides hooks for data fetching and caching |
| @app/config/request | Provides the `apiRequest` object for making API calls |

## TODOs
- Move authentication-related hooks to `/auth`