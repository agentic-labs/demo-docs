---
title: "queries.tsx"
---

## High-level description
This code defines a set of React hooks and utility functions for managing roles and permissions in a project or organization. It uses React Query for data fetching and caching, and implements custom ability checks using the CASL library.

## Code Structure
The code is organized into several main sections:
1. Utility functions and configurations for permission matching
2. Query key definitions for React Query
3. API request functions for fetching role and permission data
4. React Query hooks for various role and permission-related operations

## Symbols

### `$glob` and `glob`
#### Description
These symbols define a custom field instruction and interpreter for glob pattern matching in permissions.

### `conditionsMatcher`
#### Description
A function that builds a MongoDB query matcher with custom glob pattern support.

### `roleQueryKeys`
#### Description
An object containing functions that generate query keys for various role-related operations.

### `getProjectRoles`
#### Description
An async function that fetches project roles from the API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| projectId | string | The ID of the project |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| roles | Array&lt;Omit&lt;TProjectRole, "permissions"&gt;&gt; | An array of project roles |

### `useGetProjectRoles`
#### Description
A React Query hook that fetches and caches project roles.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| projectSlug | string | The slug of the project |

### `useGetProjectRoleBySlug`
#### Description
A React Query hook that fetches and caches a specific project role by its slug.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| projectSlug | string | The slug of the project |
| roleSlug | string | The slug of the role |

### `getOrgRoles`
#### Description
An async function that fetches organization roles from the API and unpacks the permissions.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgId | string | The ID of the organization |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| roles | Array&lt;TOrgRole&gt; | An array of organization roles with unpacked permissions |

### `useGetOrgRoles`
#### Description
A React Query hook that fetches and caches organization roles.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgId | string | The ID of the organization |
| enable | boolean | Whether to enable the query (default: true) |

### `useGetOrgRole`
#### Description
A React Query hook that fetches and caches a specific organization role.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgId | string | The ID of the organization |
| roleId | string | The ID of the role |

### `getUserOrgPermissions`
#### Description
An async function that fetches user permissions for an organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgId | string | The ID of the organization |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| permissions | Array&lt;PackRule&lt;RawRuleOf&lt;MongoAbility&lt;OrgPermissionSet&gt;&gt;&gt;&gt; | Packed permission rules |
| membership | OrgUser | User membership information |

### `useGetUserOrgPermissions`
#### Description
A React Query hook that fetches and caches user permissions for an organization, and creates a CASL ability object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgId | string | The ID of the organization |

### `getUserProjectPermissions`
#### Description
An async function that fetches user permissions for a project.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| workspaceId | string | The ID of the workspace (project) |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| permissions | Array&lt;PackRule&lt;RawRuleOf&lt;MongoAbility&lt;OrgPermissionSet&gt;&gt;&gt;&gt; | Packed permission rules |
| membership | TProjectMembership | User project membership information |

### `useGetUserProjectPermissions`
#### Description
A React Query hook that fetches and caches user permissions for a project, and creates a CASL ability object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| workspaceId | string | The ID of the workspace (project) |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @casl/ability | Creating and managing permission abilities |
| @tanstack/react-query | Data fetching and caching |
| @ucast/mongo2js | MongoDB query interpretation |
| picomatch | Glob pattern matching |

This code provides a comprehensive set of tools for managing roles and permissions in a React application, leveraging React Query for efficient data fetching and caching, and CASL for flexible permission checking.