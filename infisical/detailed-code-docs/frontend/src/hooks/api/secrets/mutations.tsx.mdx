---
title: "mutations.tsx"
---

## High-level description
This code defines React hooks for managing secrets in a project. It provides functionality for creating, updating, deleting, and moving secrets across different environments. The hooks utilize React Query for state management and API interactions.

## Code Structure
The code exports several custom hooks that handle different operations on secrets. These hooks are built on top of React Query's `useMutation` hook and interact with an API through the `apiRequest` function. The hooks also handle query invalidation to ensure data consistency after mutations.

## Symbols

### `useCreateSecretV3`
#### Description
This hook creates a new secret in a specific environment.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| options | Object | Optional mutation options |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutationResult | Object | React Query mutation result |

#### Internal Logic
1. Calls the API to create a new secret
2. On success, invalidates relevant queries to update the UI

### `useUpdateSecretV3`
#### Description
This hook updates an existing secret in a specific environment.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| options | Object | Optional mutation options |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutationResult | Object | React Query mutation result |

#### Internal Logic
1. Calls the API to update the secret
2. On success, invalidates relevant queries to update the UI

### `useDeleteSecretV3`
#### Description
This hook deletes a secret from a specific environment.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| options | Object | Optional mutation options |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutationResult | Object | React Query mutation result |

#### Internal Logic
1. Calls the API to delete the secret
2. On success, invalidates relevant queries to update the UI

### `useCreateSecretBatch`
#### Description
This hook creates multiple secrets in a batch operation.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| options | Object | Optional mutation options |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutationResult | Object | React Query mutation result |

#### Internal Logic
1. Calls the API to create multiple secrets in a batch
2. On success, invalidates relevant queries to update the UI

### `useUpdateSecretBatch`
#### Description
This hook updates multiple secrets in a batch operation.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| options | Object | Optional mutation options |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutationResult | Object | React Query mutation result |

#### Internal Logic
1. Calls the API to update multiple secrets in a batch
2. On success, invalidates relevant queries to update the UI

### `useDeleteSecretBatch`
#### Description
This hook deletes multiple secrets in a batch operation.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| options | Object | Optional mutation options |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutationResult | Object | React Query mutation result |

#### Internal Logic
1. Calls the API to delete multiple secrets in a batch
2. On success, invalidates relevant queries to update the UI

### `useMoveSecrets`
#### Description
This hook moves secrets from one environment or path to another.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| options | Object | Optional mutation options |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutationResult | Object | React Query mutation result |

#### Internal Logic
1. Calls the API to move secrets
2. On success, invalidates relevant queries to update the UI

### `createSecret`
#### Description
This is a standalone function to create a secret without using React Query.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| dto | TCreateSecretsV3DTO | Data transfer object for creating a secret |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | Object | API response data |

### `useBackfillSecretReference`
#### Description
This hook backfills secret references for a project.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| projectId | string | The ID of the project |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mutationResult | Object | React Query mutation result |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @tanstack/react-query | Provides hooks for data fetching and state management |
| @app/config/request | Provides the `apiRequest` function for API calls |

## Error Handling
These hooks rely on React Query's built-in error handling. Errors from API calls will be captured and can be accessed through the mutation result.

## API/Interface Reference
The hooks in this file interact with the following API endpoints:
| Endpoint | Method | Description |
|:---------|:-------|:------------|
| /api/v3/secrets/raw/:secretKey | POST | Create a new secret |
| /api/v3/secrets/raw/:secretKey | PATCH | Update an existing secret |
| /api/v3/secrets/raw/:secretKey | DELETE | Delete a secret |
| /api/v3/secrets/batch/raw | POST | Create multiple secrets |
| /api/v3/secrets/batch/raw | PATCH | Update multiple secrets |
| /api/v3/secrets/batch/raw | DELETE | Delete multiple secrets |
| /api/v3/secrets/move | POST | Move secrets |
| /api/v3/secrets/backfill-secret-references | POST | Backfill secret references |