---
title: "main.go"
---

## High-level description
This code is the main entry point for a Kubernetes operator. It sets up and runs a controller manager for managing InfisicalSecret custom resources in a Kubernetes cluster. The operator uses the controller-runtime library to handle the core functionality of the Kubernetes controller.

## Code Structure
The main function sets up the controller manager with various configuration options, including metrics, health probes, and leader election. It then initializes the InfisicalSecretReconciler and adds health checks before starting the manager.

## Symbols

### `init()`
#### Description
Initializes the runtime scheme by adding the Kubernetes client-go scheme and the custom InfisicalSecret scheme.

#### Internal Logic
1. Adds the Kubernetes client-go scheme to the runtime scheme.
2. Adds the InfisicalSecret scheme to the runtime scheme.

### `main()`
#### Description
The main function that sets up and runs the Kubernetes operator.

#### Internal Logic
1. Defines and parses command-line flags for configuration.
2. Sets up logging using zap.
3. Creates a new controller manager with the parsed configuration.
4. Sets up the InfisicalSecretReconciler.
5. Adds health and readiness checks.
6. Starts the manager.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| k8s.io/client-go | Kubernetes client library |
| k8s.io/apimachinery | Kubernetes API machinery |
| sigs.k8s.io/controller-runtime | Controller runtime library |
| github.com/Infisical/infisical/k8-operator/api/v1alpha1 | Custom API definitions |
| github.com/Infisical/infisical/k8-operator/controllers | Custom controller implementations |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| metrics-bind-address | string | ":8080" | The address the metric endpoint binds to |
| health-probe-bind-address | string | ":8081" | The address the probe endpoint binds to |
| leader-elect | bool | false | Enable leader election for controller manager |

## Error Handling
The code uses the `setupLog.Error()` method to log errors and exits the program with `os.Exit(1)` in case of critical errors during setup or execution.

## Logging
The code uses the `zap` logging library from the controller-runtime package. It sets up a logger with development options and uses it throughout the application.

## TODOs
The code includes a TODO comment (kubebuilder:scaffold:imports) indicating a placeholder for additional imports that may be added by the kubebuilder tool.