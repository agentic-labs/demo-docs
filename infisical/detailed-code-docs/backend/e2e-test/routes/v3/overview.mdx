---
title: "Overview"
---

## High-level description
This directory contains end-to-end tests for the Secret V2 and V3 Architecture API endpoints. It includes two main test files: `secrets-v2.spec.ts` and `secrets.spec.ts`, which test various operations related to secret management, such as creating, reading, updating, and deleting secrets. The tests cover different authentication modes (JWT and Identity Access Token) and handle both encrypted and raw secrets.

## What does it do?
These tests simulate real-world usage of the secret management API, ensuring that:

1. Secrets can be created, read, updated, and deleted correctly.
2. Bulk operations (creating, updating, and deleting multiple secrets at once) work as expected.
3. The API handles different authentication modes properly.
4. Secrets can be managed in different paths and environments.
5. Personal secrets can be created (for JWT authentication).
6. The API correctly handles both encrypted and raw (unencrypted) secrets.
7. The system behaves correctly when end-to-end encryption is enabled or disabled.

By running these tests, developers can ensure that the secret management functionality of the application works correctly across different scenarios and configurations.

## Key Files

1. `secrets-v2.spec.ts`:
   - Tests the Secret V2 Architecture API endpoints.
   - Covers operations like creating, reading, updating, and deleting secrets in different paths.
   - Tests both JWT and Identity Access Token authentication modes.
   - Includes tests for personal secrets and bulk operations.

2. `secrets.spec.ts`:
   - Tests the Secret V3 Router functionality.
   - Covers both encrypted and raw secret operations.
   - Includes tests for different authentication modes and scenarios with end-to-end encryption enabled or disabled.
   - Tests bulk operations and secret management in different environments.

Both files use helper functions to create, delete, and retrieve secrets, making the test code more modular and easier to maintain.

## Dependencies
The test files rely on several internal dependencies:

1. `@app/db/schemas`: Provides the `SecretType` enum used in secret creation.
2. `@app/db/seed-data`: Contains `seedData1` used for test data.
3. `@app/services/auth/auth-type`: Provides the `AuthMode` enum for different authentication modes.
4. Various encryption/decryption utilities (not explicitly mentioned but used in `secrets.spec.ts`).

The tests also use Jest as the testing framework, which is evident from the use of `describe`, `it`, and `expect` functions.

## Configuration
The tests use a `testServer` for making API requests, which is likely configured elsewhere in the project. They also use predefined test data (`seedData1`) for consistency across tests.

Both test files use environment-specific configurations, such as different paths and environments for secrets. The `secrets.spec.ts` file also includes tests for scenarios where end-to-end encryption is disabled, indicating that this is a configurable option in the application.

In summary, this directory contains comprehensive end-to-end tests for the secret management API, covering various scenarios and ensuring the robustness of the secret handling functionality across different versions and configurations of the application.