---
title: "project-env.spec.ts"
---

## High-level description
This file contains end-to-end (e2e) tests for the Project Environment Router. It tests the functionality of creating, updating, deleting, and retrieving project environments through API endpoints.

## Code Structure
The code is structured as a Jest test suite with helper functions for creating and deleting project environments, followed by individual test cases for different API operations.

## Symbols

### `createProjectEnvironment`
#### Description
A helper function that creates a new project environment by sending a POST request to the API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | string | The name of the environment to create |
| slug | string | The slug of the environment to create |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| environment | object | The created environment object |

#### Internal Logic
1. Sends a POST request to create a new environment
2. Checks if the response status code is 200
3. Parses the response payload and checks for the 'environment' property
4. Returns the created environment object

### `deleteProjectEnvironment`
#### Description
A helper function that deletes a project environment by sending a DELETE request to the API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| envId | string | The ID of the environment to delete |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| environment | object | The deleted environment object |

#### Internal Logic
1. Sends a DELETE request to remove the specified environment
2. Checks if the response status code is 200
3. Parses the response payload and checks for the 'environment' property
4. Returns the deleted environment object

### `describe("Project Environment Router", ...)`
#### Description
The main test suite for the Project Environment Router.

#### Internal Logic
Contains four test cases:
1. "Get default environments"
2. "Create environment"
3. "Update environment"
4. "Delete environment"

Each test case interacts with the API and verifies the expected behavior.

### `test("Get default environments", ...)`
#### Description
Tests the retrieval of default project environments.

#### Internal Logic
1. Sends a GET request to retrieve the workspace details
2. Checks if the response status code is 200
3. Verifies the presence of default environments in the response
4. Ensures only three default environments exist

### `test("Create environment", ...)`
#### Description
Tests the creation of a new project environment.

#### Internal Logic
1. Calls `createProjectEnvironment` to create a new environment
2. Verifies the properties of the created environment
3. Deletes the created environment using `deleteProjectEnvironment`

### `test("Update environment", ...)`
#### Description
Tests the update of an existing project environment.

#### Internal Logic
1. Creates a new environment
2. Sends a PATCH request to update the environment's name, slug, and position
3. Verifies the properties of the updated environment
4. Deletes the created environment

### `test("Delete environment", ...)`
#### Description
Tests the deletion of a project environment.

#### Internal Logic
1. Creates a new environment
2. Calls `deleteProjectEnvironment` to delete the environment
3. Verifies the properties of the deleted environment

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @app/db/seed-data | Provides seed data for testing |
| @app/db/seeds/3-project | Provides default project environment data |

## Error Handling
The tests use Jest's `expect` assertions to check for expected responses and data structures. If any assertion fails, the test will fail, indicating an error in the API's behavior.