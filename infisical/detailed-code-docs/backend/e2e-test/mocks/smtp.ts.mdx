---
title: "smtp.ts"
---

## High-level description
This code defines a mock SMTP server for end-to-end testing purposes. It provides a simplified implementation of the SMTP service, allowing for the capture and storage of email data without actually sending emails during testing.

## Code Structure
The code exports a single function `mockSmtpServer` that returns an object implementing the `TSmtpService` interface. This object contains a `sendMail` method that simulates sending an email by storing the email data in memory.

## References
This code references types from `@app/services/smtp/smtp-service`, specifically `TSmtpSendMail` and `TSmtpService`.

## Symbols

### `mockSmtpServer`
#### Description
This function creates and returns a mock SMTP service that can be used for testing purposes. It simulates the behavior of sending emails by storing the email data in memory instead of actually sending them.

#### Inputs
This function takes no inputs.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| mockSmtpService | TSmtpService | An object implementing the TSmtpService interface with a `sendMail` method |

#### Internal Logic
1. Creates an empty array `storage` to store email data.
2. Returns an object with a `sendMail` method that:
   - Takes `data` of type `TSmtpSendMail` as an argument.
   - Asynchronously pushes the `data` into the `storage` array.

## Side Effects
The `mockSmtpServer` function creates a closure over the `storage` array, allowing the `sendMail` method to accumulate email data across multiple calls.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @app/services/smtp/smtp-service | Provides type definitions for SMTP service and email data |

## Notes
1. This mock implementation is useful for testing scenarios where you want to verify that emails are being "sent" without actually sending them.
2. The stored email data can be accessed and verified in tests to ensure the correct information is being sent.
3. This implementation doesn't include any method to retrieve the stored emails, which might be useful for assertions in tests. Consider adding a method to access the `storage` array if needed for testing purposes.