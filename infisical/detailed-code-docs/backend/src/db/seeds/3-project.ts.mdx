---
title: "3-project.ts"
---

## High-level description
This code is a database seeding script for a project management system. It creates initial data for projects, environments, and secret folders, as well as setting up project memberships and encryption keys for secure data handling.

## Code Structure
The main function `seed` orchestrates the seeding process, interacting with various database tables to insert initial data. It uses helper functions and constants to generate and encrypt data.

## Symbols

### `seed`
#### Description
This asynchronous function is the main entry point for seeding the database with initial project data.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | Knex instance for database operations |

#### Internal Logic
1. Deletes existing entries from Project, Environment, and SecretFolder tables.
2. Inserts a new project and sets up project membership for the seed user.
3. Retrieves user encryption keys and generates project keys.
4. Creates default environments and folders for the project.
5. Generates and stores a secret blind index for the project.

### `DEFAULT_PROJECT_ENVS`
#### Description
A constant array defining the default environments for a project.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| crypto | For generating random bytes |
| knex | For database operations |
| @app/lib/crypto | For encryption operations |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| ENCRYPTION_KEY | string | undefined | Environment variable for encryption key |

## Error Handling
The script throws errors if the user is not found or if the ENCRYPTION_KEY environment variable is missing.

## Side Effects
- Deletes all existing entries in Project, Environment, and SecretFolder tables.
- Inserts new data into multiple database tables.
- Generates and stores encrypted data.

## Performance Considerations
This script performs multiple database operations, including deletions and insertions. It may take some time to execute, especially if there's a large amount of existing data to delete.