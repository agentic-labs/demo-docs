---
title: "internal-kms.ts"
---

## High-level description
This code defines the `InternalKmsSchema` using the `zod` library to validate the structure and types of data for an internal key management system (KMS) entity. It also defines related types for database operations.

## References
- `@app/lib/zod`: Uses a custom `zodBuffer` type, likely defined in the application's library.
- `./models`: Imports `TImmutableDBKeys`, probably a type defining which database keys shouldn't be modified.

## Symbols

### `InternalKmsSchema`
#### Description
Defines the schema for validating an `InternalKms` object using `zod`. This schema ensures that the data conforms to the expected structure and types.

#### Inputs
*Not applicable. This is a schema definition, not a function.*

#### Outputs
*Not applicable. This is a schema definition, not a function.*

#### Internal Logic
- `id`: A string field representing a UUID, marked as required.
- `encryptedKey`: A buffer field validated by `zodBuffer`, marked as required.
- `encryptionAlgorithm`: A string field representing the encryption algorithm used, marked as required.
- `version`: A number field defaulting to 1, marked as required.
- `kmsKeyId`: A string field representing a UUID, marked as required.

### `TInternalKms`
#### Description
A type alias representing the inferred type of the `InternalKmsSchema`. It represents the structure of a validated `InternalKms` object.

#### Inputs
*Not applicable. This is a type alias, not a function.*

#### Outputs
*Not applicable. This is a type alias, not a function.*

### `TInternalKmsInsert`
#### Description
A type alias representing the type of data used for inserting a new `InternalKms` entry into the database. It excludes fields defined in `TImmutableDBKeys` from the `InternalKmsSchema` input type, likely preventing modification of immutable database identifiers.

#### Inputs
*Not applicable. This is a type alias, not a function.*

#### Outputs
*Not applicable. This is a type alias, not a function.*

### `TInternalKmsUpdate`
#### Description
A type alias representing the type of data used for updating an existing `InternalKms` entry in the database. It creates a partial type from `TInternalKmsInsert`, allowing only a subset of fields to be provided for update operations.

#### Inputs
*Not applicable. This is a type alias, not a function.*

#### Outputs
*Not applicable. This is a type alias, not a function.*

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| zod        | Provides schema validation for TypeScript objects. |
| @app/lib/zod | Provides a custom `zodBuffer` type for validating buffer data. |

## TODOs
- The file header mentions an automation script for generating the schema. Consider adding details about this script's location and usage to the documentation. 
