---
title: "20231218092517_secret-tag.ts"
---

## High-level description
This code defines a database migration script using Knex.js to manage changes to the database schema. Specifically, it creates a new table named "secret_tag" if it doesn't exist, defines its columns and constraints, and sets up an update trigger. It also handles the rollback by dropping the table and the trigger.

## References
- `TableName`: An enum or object defining table names used in the schema.
- `createOnUpdateTrigger`: A utility function to create a trigger that updates the `updatedAt` column on row modification.
- `dropOnUpdateTrigger`: A utility function to drop the update trigger.

## Symbols

### `up`
#### Description
This function defines the actions to perform when applying the migration. It creates the "secret_tag" table with specified columns and constraints if it doesn't exist and sets up an update trigger.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex instance connected to the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration is applied. |

#### Internal Logic
1. Checks if the "secret_tag" table already exists.
2. If not, creates the table with the following columns:
    - `id`: UUID, primary key, default value generated by the database.
    - `name`: String, not nullable.
    - `slug`: String, not nullable.
    - `color`: String, nullable.
    - `createdAt`: Timestamp, automatically managed by the database.
    - `updatedAt`: Timestamp, automatically managed by the database.
    - `createdBy`: UUID, foreign key referencing the "users" table, nullable, set to NULL on delete.
    - `projectId`: String, not nullable, foreign key referencing the "project" table, cascades delete.
3. Calls `createOnUpdateTrigger` to set up a trigger for updating the `updatedAt` column on row modification.

### `down`
#### Description
This function defines the actions to perform when rolling back the migration. It drops the "secret_tag" table if it exists and removes the update trigger.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex instance connected to the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration is rolled back. |

#### Internal Logic
1. Drops the "secret_tag" table if it exists.
2. Calls `dropOnUpdateTrigger` to remove the update trigger associated with the table.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| knex      | Provides the query builder and schema building functionalities for database interactions. |

## Error Handling
The code relies on the error handling mechanisms provided by Knex.js. Any errors during the migration process, such as failure to connect to the database or execute SQL statements, will be thrown as exceptions.
