---
title: "20240429154610_audit-log-index.ts"
---

## High-level description
This migration script manages database indexes for the `AuditLog` table. It aims to improve query performance by adding indexes on `(projectId, createdAt)` and `(orgId, createdAt)` columns during the `up` migration and removing them during the `down` migration.

## References
- `TableName`: This symbol is referenced from another file, likely containing database table names.

## Symbols
### `up`
#### Description
This asynchronous function adds indexes to the `AuditLog` table if they don't already exist. It first checks for the existence of the required columns (`orgId`, `projectId`, `createdAt`) and the table itself. If all conditions are met, it adds indexes on `(projectId, createdAt)` and `(orgId, createdAt)` columns.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | Knex instance for database interaction. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the indexes are added. |

#### Internal Logic
1. Checks if the `AuditLog` table exists.
2. Checks if `orgId`, `projectId`, and `createdAt` columns exist in the `AuditLog` table.
3. If both conditions are met, it adds indexes on `(projectId, createdAt)` and `(orgId, createdAt)` columns using `knex.schema.alterTable`.

### `down`
#### Description
This asynchronous function reverts the changes made by the `up` function. It removes the indexes added to the `AuditLog` table. It first checks for the existence of the required columns (`orgId`, `projectId`, `createdAt`) and the table itself. If all conditions are met, it drops the indexes on `(projectId, createdAt)` and `(orgId, createdAt)` columns.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | Knex instance for database interaction. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the indexes are dropped. |

#### Internal Logic
1. Checks if the `AuditLog` table exists.
2. Checks if `orgId`, `projectId`, and `createdAt` columns exist in the `AuditLog` table.
3. If both conditions are met, it drops the indexes on `(projectId, createdAt)` and `(orgId, createdAt)` columns using `knex.schema.alterTable`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| knex | Database query builder for interacting with various databases. |
