---
title: "20240626111536_integration-auth-aws-assume-role.ts"
---

## High-level description
This code defines a database migration script using Knex.js. It aims to add or remove columns related to AWS Assume Role functionality in the `IntegrationAuth` table, specifically for storing encrypted ARN, initialization vector (IV), and a tag.

## Symbols

### `up`
#### Description
This function defines the steps to apply the migration, adding new columns to the `IntegrationAuth` table if they don't already exist.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex.js instance for interacting with the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration is complete. |

#### Internal Logic
1. Checks if the `IntegrationAuth` table exists.
2. Checks if each of the columns (`awsAssumeIamRoleArnCipherText`, `awsAssumeIamRoleArnIV`, `awsAssumeIamRoleArnTag`) already exists in the table.
3. If the table exists, it alters the table schema to add the missing columns.

### `down`
#### Description
This function defines the steps to rollback the migration, removing the columns added by the `up` function from the `IntegrationAuth` table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex.js instance for interacting with the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the rollback is complete. |

#### Internal Logic
1. Checks if the `IntegrationAuth` table exists.
2. Checks if each of the columns (`awsAssumeIamRoleArnCipherText`, `awsAssumeIamRoleArnIV`, `awsAssumeIamRoleArnTag`) exists in the table.
3. If the table exists, it alters the table schema to drop the specified columns.

## References
- `TableName`: This likely refers to an enum or constant that defines the names of database tables used in the application.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| knex | Provides a connection to the database and allows for schema manipulation and data operations. |
