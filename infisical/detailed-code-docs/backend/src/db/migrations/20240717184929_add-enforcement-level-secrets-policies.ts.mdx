---
title: "20240717184929_add-enforcement-level-secrets-policies.ts"
---

## High-level description
This database migration script adds a new column named `enforcementLevel` to the `SecretApprovalPolicy` table. The column is set to be non-nullable and defaults to `EnforcementLevel.Hard`.

## Symbols

### `up`
#### Description
This function defines the actions to perform when applying the migration. It checks if the `enforcementLevel` column already exists in the `SecretApprovalPolicy` table. If not, it adds the column with the specified data type, nullability constraint, and default value.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | Knex instance for interacting with the database |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration is applied successfully |

#### Internal Logic
1. Checks if the `enforcementLevel` column exists in the `SecretApprovalPolicy` table.
2. If the column doesn't exist, it adds a new `string` column named `enforcementLevel` to the table.
    - The column is set to be `notNullable`.
    - The column has a default value of `EnforcementLevel.Hard`.

### `down`
#### Description
This function defines the actions to perform when reverting the migration. It checks if the `enforcementLevel` column exists in the `SecretApprovalPolicy` table. If it exists, it drops the column.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | Knex instance for interacting with the database |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration is reverted successfully |

#### Internal Logic
1. Checks if the `enforcementLevel` column exists in the `SecretApprovalPolicy` table.
2. If the column exists, it drops the column from the table.

## References
- `TableName`: This symbol is imported from the `../schemas` module and likely refers to an enum or object containing database table names.
- `EnforcementLevel`: This symbol is imported from the `@app/lib/types` module and likely refers to an enum defining different enforcement levels.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| knex       | Provides a connection to the database and allows for schema manipulation. |
