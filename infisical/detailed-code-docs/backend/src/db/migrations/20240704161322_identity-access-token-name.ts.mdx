---
title: "20240704161322_identity-access-token-name.ts"
---

## High-level description
This code defines a database migration script that adds a nullable "name" column to the "IdentityAccessToken" table if it doesn't already exist. It also provides a rollback function to drop the column if needed.

## References
- `TableName`: This symbol is referenced but not defined in the provided code snippet. It likely refers to an enum or object containing database table names.

## Symbols
### `up`
#### Description
This asynchronous function handles the database migration. It first checks if the "IdentityAccessToken" table exists. If it does, it further checks if the "name" column exists. If the column doesn't exist, it adds a nullable "name" column of type string to the table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex client instance for interacting with the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | void | This function does not return any value. |

#### Internal Logic
1. Checks if the "IdentityAccessToken" table exists using `knex.schema.hasTable`.
2. If the table exists, checks if the "name" column exists using `knex.schema.hasColumn`.
3. If the "name" column doesn't exist, adds it to the table as a nullable string column using `knex.schema.alterTable` and `t.string("name").nullable()`.

### `down`
#### Description
This asynchronous function handles the database migration rollback. It checks if the "IdentityAccessToken" table and the "name" column exist. If both exist, it drops the "name" column from the table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex client instance for interacting with the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | void | This function does not return any value. |

#### Internal Logic
1. Checks if the "IdentityAccessToken" table exists using `knex.schema.hasTable`.
2. If the table exists, checks if the "name" column exists using `knex.schema.hasColumn`.
3. If the "name" column exists, drops it from the table using `knex.schema.alterTable` and `t.dropColumn("name")`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| knex       | Provides a connection to the database and allows for schema manipulation and querying. |
