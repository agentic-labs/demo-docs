---
title: "20240414192520_drop-role-roleid-project-membership.ts"
---

## High-level description
This code defines a database migration script using Knex.js. It aims to drop the columns "role" and "roleId" from the "ProjectMembership" and "IdentityProjectMembership" tables during the migration up, and add them back during the migration down.

## References
- `TableName`: An enum-like object that probably defines the names of database tables.
- `ProjectMembershipRole`: An enum-like object that likely defines the possible roles for project membership.

## Symbols

### `up(knex)`
#### Description
This function defines the actions to perform when applying the migration. It drops the "role" and "roleId" columns from the "ProjectMembership" and "IdentityProjectMembership" tables if they exist.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex.js instance connected to the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration is complete. |

#### Internal Logic
1. Checks if the "role" and "roleId" columns exist in the "ProjectMembership" and "IdentityProjectMembership" tables.
2. If they exist, it uses `knex.schema.alterTable` to modify the tables and drop the columns.

### `down(knex)`
#### Description
This function defines the actions to perform when reverting the migration. It adds back the "role" and "roleId" columns to the "ProjectMembership" and "IdentityProjectMembership" tables if they don't exist.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex.js instance connected to the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration rollback is complete. |

#### Internal Logic
1. Checks if the "role" and "roleId" columns exist in the "ProjectMembership" and "IdentityProjectMembership" tables.
2. If they don't exist, it uses `knex.schema.alterTable` to modify the tables and add the columns back.
3. It sets the default value for the "role" column to `ProjectMembershipRole.Member` and creates a foreign key constraint on the "roleId" column referencing the "id" column in the "ProjectRoles" table.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| knex | Provides database query builder and migration functionality. |
