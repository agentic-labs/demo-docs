---
title: "20240730181840_add-project-data-key.ts"
---

## High-level description
This code defines a database migration script that adds a new column named `kmsSecretManagerEncryptedDataKey` to the `Project` table if it doesn't already exist. This column likely stores encrypted data keys for secrets management using a Key Management Service (KMS).

## Symbols

### `up`
#### Description
This function defines the steps to apply the migration, adding the `kmsSecretManagerEncryptedDataKey` column to the `Project` table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex client instance for interacting with the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration is complete. |

#### Internal Logic
1. Checks if the `kmsSecretManagerEncryptedDataKey` column already exists in the `Project` table.
2. If the column doesn't exist, it alters the `Project` table to add the column as a binary data type.

### `down`
#### Description
This function defines the steps to rollback the migration, removing the `kmsSecretManagerEncryptedDataKey` column from the `Project` table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex client instance for interacting with the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the rollback is complete. |

#### Internal Logic
1. Checks if the `kmsSecretManagerEncryptedDataKey` column exists in the `Project` table.
2. If the column exists, it alters the `Project` table to drop the column.

## References
- `TableName.Project`: Refers to the name of the `Project` table, likely defined in a separate file (`backend/src/db/schemas/models.ts`).

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| Knex | Provides a connection to the database and allows for schema manipulation. |
