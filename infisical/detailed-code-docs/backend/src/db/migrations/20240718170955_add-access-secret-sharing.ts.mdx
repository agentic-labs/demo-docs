---
title: "20240718170955_add-access-secret-sharing.ts"
---

## High-level description
This database migration script adds a new column named `accessType` to the `SecretSharing` table. The column is set to be non-nullable and defaults to `SecretSharingAccessType.Anyone`.

## References
- `@app/lib/types`: This reference suggests that the `SecretSharingAccessType` enum is defined in the application's library types.
- `../schemas`: This reference likely points to a file where the database schema definitions, including the `TableName` enum, are located.

## Symbols
### `up`
#### Description
This asynchronous function handles the database migration "up" operation, which adds the `accessType` column to the `SecretSharing` table if it doesn't already exist.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex instance representing the database connection. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| void |  | This function does not return any value. |

#### Internal Logic
1. Checks if the `accessType` column already exists in the `SecretSharing` table using `knex.schema.hasColumn`.
2. If the column doesn't exist, it adds the column to the table using `knex.schema.table`. The column is defined as a string, non-nullable, and defaults to `SecretSharingAccessType.Anyone`.

### `down`
#### Description
This asynchronous function handles the database migration "down" operation, which reverts the changes made by the `up` function by dropping the `accessType` column from the `SecretSharing` table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex instance representing the database connection. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| void |  | This function does not return any value. |

#### Internal Logic
1. Checks if the `accessType` column exists in the `SecretSharing` table using `knex.schema.hasColumn`.
2. If the column exists, it drops the column from the table using `knex.schema.table` and `table.dropColumn`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| knex | Used for interacting with the database and performing schema migrations. |
