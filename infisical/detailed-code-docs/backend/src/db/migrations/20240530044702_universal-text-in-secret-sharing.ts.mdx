---
title: "20240530044702_universal-text-in-secret-sharing.ts"
---

## High-level description
This database migration script modifies the `SecretSharing` table by adding an `expiresAfterViews` column and removing the `name` column. It ensures these changes are applied safely and reversibly.

## References
- `TableName`: This symbol is likely an enum or constant defining table names within the database schema.

## Symbols
### `up`
#### Description
This function defines the "up" migration, which applies changes to the database schema. In this case, it adds the `expiresAfterViews` column to the `SecretSharing` table if it doesn't exist and removes the `name` column if it exists.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex client instance for interacting with the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration is complete. |

#### Internal Logic
1. Checks if the `expiresAfterViews` and `name` columns exist in the `SecretSharing` table.
2. Alters the `SecretSharing` table:
    - Adds the `expiresAfterViews` column if it doesn't exist.
    - Drops the `name` column if it exists.

### `down`
#### Description
This function defines the "down" migration, which reverts the changes made by the "up" migration. It removes the `expiresAfterViews` column and adds back the `name` column to the `SecretSharing` table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex client instance for interacting with the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration rollback is complete. |

#### Internal Logic
1. Checks if the `expiresAfterViews` and `name` columns exist in the `SecretSharing` table.
2. Alters the `SecretSharing` table:
    - Drops the `expiresAfterViews` column if it exists.
    - Adds the `name` column (as a non-nullable string) if it doesn't exist.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| knex | Provides a query builder and schema builder for interacting with relational databases. |
