---
title: "20240626171758_add-ldap-unique-user-attribute.ts"
---

## High-level description
This code defines a database migration script using Knex.js. It aims to add a new column named `uniqueUserAttribute` to the `LdapConfig` table. The script includes both `up` and `down` functions to apply and revert the migration, respectively.

## References
- `TableName`: This symbol is referenced from another file, likely containing database table names.

## Symbols

### `up`
#### Description
This asynchronous function adds a new column `uniqueUserAttribute` to the `LdapConfig` table if it doesn't already exist.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex instance connected to the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | void | This function does not return any value. |

#### Internal Logic
1. It first checks if the column `uniqueUserAttribute` already exists in the `LdapConfig` table using `knex.schema.hasColumn`.
2. If the column doesn't exist, it alters the `LdapConfig` table using `knex.schema.alterTable` and adds a new string column named `uniqueUserAttribute`.
3. The new column is set as non-nullable (`notNullable()`) and has a default value of an empty string (`defaultTo("")`).

### `down`
#### Description
This asynchronous function reverts the changes made by the `up` function. It removes the `uniqueUserAttribute` column from the `LdapConfig` table if it exists.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex instance connected to the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | void | This function does not return any value. |

#### Internal Logic
1. It first checks if the column `uniqueUserAttribute` exists in the `LdapConfig` table using `knex.schema.hasColumn`.
2. If the column exists, it alters the `LdapConfig` table using `knex.schema.alterTable` and drops the `uniqueUserAttribute` column using `t.dropColumn`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| Knex | Provides database query builder and migration functionality. |
