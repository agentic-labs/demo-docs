---
title: "20240522193447_index-audit-logs-project-id-org-id.ts"
---

## High-level description
This database migration script aims to optimize query performance by adding indexes to the `projectId` and `orgId` columns in the `AuditLog` table. It first checks if the table and columns exist before attempting to create or drop the indexes.

## References
- `TableName`: This symbol is referenced from another file and likely defines the names of database tables used in the application.

## Symbols
### `up`
#### Description
This asynchronous function is executed when applying the migration. It checks if the `AuditLog` table and the `projectId` and `orgId` columns exist. If they do, it creates indexes on these columns to improve query performance.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex instance for interacting with the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | void | This function does not return any value. |

#### Internal Logic
1. Check if the `AuditLog` table exists in the database.
2. Check if the `projectId` and `orgId` columns exist in the `AuditLog` table.
3. If both the table and columns exist, use the `alterTable` method to modify the table schema and add indexes to the `projectId` and `orgId` columns using the `index` method.

### `down`
#### Description
This asynchronous function is executed when reverting the migration. It checks if the `AuditLog` table and the `projectId` and `orgId` columns exist. If they do, it drops the indexes from these columns.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex instance for interacting with the database. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| None | void | This function does not return any value. |

#### Internal Logic
1. Check if the `AuditLog` table exists in the database.
2. Check if the `projectId` and `orgId` columns exist in the `AuditLog` table.
3. If both the table and columns exist, use the `alterTable` method to modify the table schema and drop the indexes from the `projectId` and `orgId` columns using the `dropIndex` method.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| knex | Provides a query builder and schema builder for interacting with relational databases. |
