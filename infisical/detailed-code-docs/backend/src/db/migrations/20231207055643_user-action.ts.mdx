---
title: "20231207055643_user-action.ts"
---

## High-level description
This code defines a database migration using Knex.js to create a table named `UserAction` for storing user actions. It includes functionality for both migrating up (creating the table) and down (dropping the table).

## References
- `TableName`: This symbol is referenced from another file and is assumed to be an enum or object containing database table names.

## Symbols
### `up`
#### Description
This asynchronous function handles the database migration "up" process, which creates the `UserAction` table if it doesn't exist.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | An instance of Knex, a query builder for multiple databases. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration is complete. |

#### Internal Logic
1. **Check for Table Existence:** It first checks if the `UserAction` table already exists in the database using `knex.schema.hasTable`.
2. **Create Table:** If the table doesn't exist, it creates the `UserAction` table with the following columns:
    - `id`: A UUID primary key with a default value generated by the database.
    - `action`: A string representing the user action, marked as not nullable.
    - `created_at`, `updated_at`: Timestamp columns for tracking creation and updates.
    - `userId`: A UUID representing the user who performed the action, marked as not nullable. This column also has a foreign key constraint referencing the `id` column of the `Users` table with a cascade delete policy.

### `down`
#### Description
This asynchronous function handles the database migration "down" process, which drops the `UserAction` table if it exists.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | An instance of Knex, a query builder for multiple databases. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration is complete. |

#### Internal Logic
- **Drop Table:** It attempts to drop the `UserAction` table using `knex.schema.dropTableIfExists`, which only drops the table if it exists, preventing errors if the table is already absent.
