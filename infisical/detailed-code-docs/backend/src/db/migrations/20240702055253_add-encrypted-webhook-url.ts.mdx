---
title: "20240702055253_add-encrypted-webhook-url.ts"
---

## High-level description
This code defines a database migration script using Knex.js. It aims to add new columns to the "Webhook" table for storing encrypted webhook URLs and related information, including ciphertext, initialization vector (IV), tag, and webhook type. It also provides a rollback mechanism to revert these changes.

## References
- `TableName`: This symbol is likely an enum or constant defined in another file (`../schemas`) and is used to reference the name of the database table.
- `WebhookType`: This symbol is likely an enum or constant defined in another file (`@app/services/webhook/webhook-types`) and is used to define the default type for new webhooks.

## Symbols
### `up`
#### Description
This asynchronous function is executed when applying the migration. It checks for the existence of specific columns in the "Webhook" table and adds them if they are missing.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex.js instance providing database connection and schema building capabilities. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration is complete. |

#### Internal Logic
1. Checks if the "Webhook" table exists.
2. Checks for the existence of columns: "urlCipherText", "urlIV", "urlTag", and "type".
3. If the table exists, it alters the table schema to add the missing columns with their respective data types and default values.

### `down`
#### Description
This asynchronous function is executed when rolling back the migration. It removes the columns added by the `up` function from the "Webhook" table if they exist.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| knex | Knex | A Knex.js instance providing database connection and schema building capabilities. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise\&lt;void\&gt; | Promise | A promise that resolves when the migration rollback is complete. |

#### Internal Logic
1. Checks if the "Webhook" table exists.
2. Checks for the existence of columns: "urlCipherText", "urlIV", "urlTag", and "type".
3. If the table exists, it alters the table schema to drop the aforementioned columns if they are present.
