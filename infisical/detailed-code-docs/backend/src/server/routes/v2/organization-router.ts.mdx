---
title: "organization-router.ts"
---

## High-level description
This code defines API routes for managing organization memberships and retrieving organization-related data in the Infisical application. It handles user authentication, authorization, and interacts with the application's services to perform actions like listing, retrieving, updating, and deleting organization memberships. Additionally, it provides endpoints for fetching organization workspaces and project memberships associated with a specific organization membership.

## Code Structure
The code consists of multiple route definitions using the `server.route` method. Each route definition handles a specific HTTP method and URL pattern, defining the request schema, authentication requirements, and a handler function. The handler functions interact with the application's services to perform the requested actions and return the response.

## References
- `@app/db/schemas`: This module likely contains data schemas used for validating and serializing data related to organizations, users, memberships, etc.
- `@app/lib/api-docs`: This module likely contains API documentation strings used for describing the routes and their parameters.
- `@app/server/config/rateLimiter`: This module likely defines rate limiting configurations for the API routes.
- `@app/server/plugins/auth/verify-auth`: This module likely provides authentication middleware for verifying user access tokens.
- `@app/services/auth/auth-type`: This module likely defines authentication types and constants used for authorization.

## Symbols

### `registerOrgRouter`
#### Description
This function registers API routes related to organization management with the Fastify server. It defines routes for listing, retrieving, updating, and deleting organization memberships, as well as fetching organization workspaces and project memberships.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| server | FastifyZodProvider | An instance of the Fastify server with Zod validation plugin. |

#### Outputs
This function does not return any value.

#### Internal Logic
The function defines multiple routes using `server.route` method. Each route definition includes:
- `method`: HTTP method for the route.
- `url`: URL pattern for the route.
- `config`: Configuration options like rate limiting.
- `schema`: Zod schemas for request parameters, body, and response.
- `onRequest`: Middleware functions for authentication and authorization.
- `handler`: Asynchronous function that handles the request and returns the response.

Each handler function interacts with the application's services to perform the requested action, such as:
- `server.services.org.findAllOrgMembers`: Retrieves all members of an organization.
- `server.services.org.findAllWorkspaces`: Retrieves all workspaces within an organization.
- `server.services.org.getOrgMembership`: Retrieves a specific organization membership.
- `server.services.org.updateOrgMembership`: Updates an organization membership.
- `server.services.org.deleteOrgMembership`: Deletes an organization membership.
- `server.services.org.listProjectMembershipsByOrgMembershipId`: Lists project memberships associated with an organization membership.
- `server.services.org.createOrganization`: Creates a new organization.
- `server.services.org.deleteOrganizationById`: Deletes an organization by its ID.

## Dependencies
- `zod`: Used for request and response validation.
- `fastify`: Used for defining API routes and handling requests.
- `@app/db/schemas`: Provides data schemas for validation and serialization.
- `@app/lib/api-docs`: Provides API documentation strings.
- `@app/server/config/rateLimiter`: Provides rate limiting configurations.
- `@app/server/plugins/auth/verify-auth`: Provides authentication middleware.
- `@app/services/auth/auth-type`: Provides authentication types and constants.

## Error Handling
The code utilizes the Fastify framework's built-in error handling mechanism. If an error occurs within a handler function, it will be caught and handled by Fastify, which will return an appropriate error response to the client.

## API/Interface Reference
This code defines several API endpoints for managing organization memberships and retrieving organization-related data. Refer to the code comments and `@app/lib/api-docs` module for detailed documentation on each endpoint, including request/response formats and authentication requirements.
