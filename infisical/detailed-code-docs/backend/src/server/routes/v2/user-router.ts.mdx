---
title: "user-router.ts"
---

## High-level description
This code defines a set of API routes related to user management within the application. It handles actions such as email verification, MFA settings, user profile updates, API key management, session management, and user deletion.

## Code Structure
The code defines a single function `registerUserRouter` which takes a `FastifyZodProvider` instance as input. Inside the function, it defines multiple routes using the `server.route` method. Each route is responsible for a specific user-related action.

## References
- `@app/db/schemas`: This module likely contains the database schema definitions used for request validation and response typing.
- `@app/server/config/rateLimiter`: This module likely defines rate limiting configurations used for the API routes.
- `@app/server/plugins/auth/verify-auth`: This module likely provides an authentication middleware used to protect the routes.
- `@app/services/auth/auth-type`: This module likely defines authentication types and modes used within the application.

## Symbols

### `registerUserRouter`
#### Description
This function registers a set of API routes related to user management with the provided Fastify server instance.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| server | FastifyZodProvider | An instance of the Fastify server with Zod validation plugin. |

#### Outputs
This function does not return any value.

#### Internal Logic
The function defines multiple routes using the `server.route` method. Each route definition includes:
- `method`: HTTP method for the route.
- `url`: Route path.
- `config`: Optional configuration for the route, such as rate limiting.
- `schema`: Zod schemas for request validation and response typing.
- `preHandler`: Optional middleware functions executed before the main handler.
- `handler`: Asynchronous function that handles the request and generates the response.

Each route handler interacts with various services like `user`, `org`, `apiKey`, and `authToken` to perform the requested actions.

## Dependencies
- `zod`: Used for request validation and response typing.
- `fastify`: Used for defining the API routes and handling requests.
- `@app/db/schemas`: Provides database schema definitions.
- `@app/server/config/rateLimiter`: Provides rate limiting configurations.
- `@app/server/plugins/auth/verify-auth`: Provides authentication middleware.
- `@app/services/auth/auth-type`: Provides authentication types and modes.

## Error Handling
The code relies on the `verifyAuth` middleware for authentication and authorization. Unauthorized requests will likely result in an `UnauthorizedError` being thrown. Other errors during request processing are likely handled by Fastify's built-in error handling mechanisms.

## API/Interface Reference
This code defines a set of API endpoints for user management. Each route definition within the `registerUserRouter` function represents an API endpoint. The `schema` property of each route definition specifies the request and response formats for that endpoint. The `verifyAuth` middleware suggests that most of these endpoints require authentication.
