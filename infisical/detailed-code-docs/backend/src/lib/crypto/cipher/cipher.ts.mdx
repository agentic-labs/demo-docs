---
title: "cipher.ts"
---

## High-level description
The `symmetricCipherService` function in `cipher.ts` provides a way to encrypt and decrypt data using symmetric encryption algorithms. It takes the encryption type as input and returns an object containing two functions: `encrypt` and `decrypt`.

## Code Structure
The `symmetricCipherService` function is the main symbol in this code. It uses two helper functions, `getIvLength` and `getTagLength`, to determine the length of the initialization vector (IV) and authentication tag, respectively. The `encrypt` and `decrypt` functions are defined within `symmetricCipherService` and use the Node.js `crypto` module for encryption and decryption operations.

## References
- `SymmetricEncryption` enum from "./types"

## Symbols

### `symmetricCipherService`
#### Description
This function takes a symmetric encryption type as input and returns an object containing two functions: `encrypt` and `decrypt`, which can be used to encrypt and decrypt data using the specified algorithm.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| type | SymmetricEncryption | The type of symmetric encryption algorithm to use (e.g., 'aes-256-gcm'). |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | TSymmetricEncryptionFns | An object containing two functions: `encrypt` and `decrypt`. |

#### Internal Logic
1. **Initialization:**
   - Determines the length of the IV and authentication tag using the `getIvLength` and `getTagLength` functions.
2. **`encrypt` function:**
   - Generates a random IV.
   - Creates a cipher object using the specified encryption type, key, and IV.
   - Encrypts the input text using the cipher object.
   - Gets the authentication tag from the cipher object.
   - Concatenates the IV, encrypted text, and tag into a single buffer.
   - Returns the ciphertext blob.
3. **`decrypt` function:**
   - Extracts the IV, encrypted text, and tag from the input ciphertext blob.
   - Creates a decipher object using the specified encryption type, key, and IV.
   - Sets the authentication tag on the decipher object.
   - Decrypts the encrypted text using the decipher object.
   - Returns the decrypted text.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| crypto | Node.js built-in module for cryptographic operations. |

## Error Handling
The code does not implement specific error handling beyond the basic exceptions thrown by the `crypto` module.

## Logging
The code does not implement any logging mechanisms.
