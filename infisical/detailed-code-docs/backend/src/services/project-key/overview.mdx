---
title: "Overview"
---

## High-level description
This directory contains the implementation of a project key service for a backend application. It provides functionality for managing project keys, including uploading new keys, retrieving the latest key, and fetching public keys associated with a project. The service is designed with a focus on data access, permission checks, and type safety.

## What does it do?
The project key service handles the following main operations:

1. Uploading project keys: It allows authorized users to upload new project keys for specific receivers. This process involves permission checks and validation of the receiver's membership in the project.

2. Retrieving the latest project key: Users can fetch the most recent project key for a given project, subject to permission checks.

3. Fetching project public keys: The service can retrieve all public keys associated with a project, again with appropriate permission checks.

These operations are crucial for maintaining secure communication and data sharing within projects. The service ensures that only authorized users can perform these actions, maintaining the integrity and confidentiality of project-related encryption keys.

## Key Files

1. `project-key-dal.ts`: This file contains the Data Access Layer (DAL) for project keys. It provides functions to interact with the database for operations related to project keys, including finding the latest project key and retrieving public keys for all users in a project.

2. `project-key-service.ts`: This file implements the main service logic for project key management. It defines a factory function that creates methods for uploading project keys, getting the latest project key, and retrieving all public keys for a project.

3. `project-key-types.ts`: This file defines TypeScript types used throughout the project key service, ensuring type safety and consistency in the codebase.

## Dependencies
The project key service relies on several external libraries and internal modules:

1. Knex: Used for database queries and transactions.
2. @casl/ability: Employed for handling permission checks within the service.
3. Internal error handling modules: Provides custom error classes for specific error scenarios.
4. Internal database-related modules: Supplies types and utilities for database operations.

## Configuration
The service doesn't appear to use explicit configuration files. However, it relies on dependency injection through factory functions, allowing for flexible configuration of its components during the application's setup phase.

Key configurable aspects include:
- Database client (passed to the DAL factory)
- Permission service (injected into the main service factory)
- Project membership DAL (also injected into the main service factory)

This approach allows for easy testing and potential swapping of implementations without modifying the core service logic.

The project key service plays a crucial role in managing encryption keys within the application, ensuring secure communication and data sharing among project members while maintaining strict access controls.