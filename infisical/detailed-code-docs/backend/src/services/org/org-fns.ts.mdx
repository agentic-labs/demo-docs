---
title: "org-fns.ts"
---

## High-level description
This code defines a function `deleteOrgMembershipFn` that handles the deletion of an organization membership. It removes the user from the organization, deletes associated project memberships, project keys, user aliases, and updates the organization's member count.

## Code Structure
The main function `deleteOrgMembershipFn` takes an object with various parameters and dependencies. It uses these to perform a series of deletion operations within a database transaction.

## Symbols

### deleteOrgMembershipFn
#### Description
This asynchronous function handles the deletion of an organization membership and associated data.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgMembershipId | string | The ID of the organization membership to delete |
| orgId | string | The ID of the organization |
| orgDAL | Object | Data access layer for organization operations |
| projectMembershipDAL | Object | Data access layer for project membership operations |
| projectKeyDAL | Object | Data access layer for project key operations |
| userAliasDAL | Object | Data access layer for user alias operations |
| licenseService | Object | Service for license-related operations |
| projectUserAdditionalPrivilegeDAL | Object | Data access layer for project user additional privilege operations |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| deletedMembership | Object | The deleted organization membership object |

#### Internal Logic
1. Starts a database transaction.
2. Deletes the organization membership.
3. If the membership has a userId:
   - Deletes user aliases.
   - Deletes project user additional privileges.
   - Finds and deletes all project memberships for the user in the organization.
   - Finds and deletes all project keys for the user in the organization.
4. Updates the organization's member count.
5. Commits the transaction and returns the deleted membership.

## Side Effects
- Modifies database state by deleting various records.
- Updates the organization's member count.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @app/ee/services/license/license-service | For updating subscription org member count |
| @app/ee/services/project-user-additional-privilege/project-user-additional-privilege-dal | For deleting project user additional privileges |
| @app/services/org/org-dal | For organization-related database operations |
| @app/services/project-key/project-key-dal | For project key-related database operations |
| @app/services/project-membership/project-membership-dal | For project membership-related database operations |
| @app/services/user-alias/user-alias-dal | For user alias-related database operations |

This function is crucial for maintaining data integrity when removing a user from an organization, ensuring that all related data is properly cleaned up across multiple tables and services.