---
title: "incident-contacts-dal.ts"
---

## High-level description
This code defines a data access layer (DAL) for managing incident contacts in an organization. It provides functions to create, find, and delete incident contacts, utilizing a database client for data operations.

## Code Structure
The code exports a factory function `incidentContactDALFactory` that takes a database client as input and returns an object with methods for interacting with incident contacts. These methods include `create`, `findByOrgId`, `findOne`, and `deleteById`.

## Symbols

### `incidentContactDALFactory`
#### Description
A factory function that creates and returns an object with methods for managing incident contacts in the database.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| db | TDbClient | The database client used for executing queries |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Object | Object | An object containing methods for incident contact operations |

#### Internal Logic
The factory function creates and returns an object with four methods: `create`, `findByOrgId`, `findOne`, and `deleteById`. Each method interacts with the database using the provided `db` client.

### `create`
#### Description
Creates a new incident contact for an organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgId | string | The ID of the organization |
| email | string | The email of the incident contact |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| incidentContact | Object | The created incident contact object |

#### Internal Logic
Inserts a new record into the `IncidentContact` table and returns the created contact.

### `findByOrgId`
#### Description
Retrieves all incident contacts for a given organization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgId | string | The ID of the organization |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| incidentContacts | Array | An array of incident contact objects |

#### Internal Logic
Queries the `IncidentContact` table for all contacts associated with the given `orgId`.

### `findOne`
#### Description
Finds a single incident contact based on organization ID and additional data.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgId | string | The ID of the organization |
| data | Partial&lt;TIncidentContacts&gt; | Additional data to filter the contact |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| incidentContact | Object | The found incident contact object |

#### Internal Logic
Queries the `IncidentContact` table for a single contact matching the given `orgId` and additional `data`.

### `deleteById`
#### Description
Deletes an incident contact by its ID and organization ID.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| id | string | The ID of the incident contact |
| orgId | string | The ID of the organization |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| incidentContact | Object | The deleted incident contact object |

#### Internal Logic
Deletes a record from the `IncidentContact` table matching the given `id` and `orgId`, and returns the deleted contact.

## Error Handling
All methods wrap their database operations in try-catch blocks. If an error occurs, a `DatabaseError` is thrown with a specific name for each operation.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @app/db | Provides database client type and schema definitions |
| @app/lib/errors | Provides the DatabaseError class for error handling |

This code is part of a larger system for managing organizational data and provides a specific interface for handling incident contacts within organizations.