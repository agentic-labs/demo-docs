---
title: "Overview"
---

## High-level description
This directory contains services and data access layers (DALs) for managing project memberships in a software application. It includes functionality for adding, updating, deleting, and retrieving project memberships, as well as handling user roles and permissions within projects.

## What does it do?
The code in this directory manages the relationships between users and projects. It allows:
1. Adding users to projects, including non-end-to-end encrypted (E2EE) projects
2. Updating user roles within projects
3. Removing users from projects
4. Retrieving project membership information
5. Managing temporary project memberships
6. Handling project-specific encryption keys for users
7. Sending invitation emails to new project members

The services ensure proper authorization checks, handle database transactions, and integrate with other parts of the system such as organization management, user groups, and licensing.

## Entry points
The main entry point for this functionality is the `projectMembershipServiceFactory` in `project-membership-service.ts`. This factory function creates a service object with methods for various project membership operations. It depends on several DALs and other services, which are injected as parameters.

The data access is primarily handled through the `projectMembershipDALFactory` in `project-membership-dal.ts` and `projectUserMembershipRoleDALFactory` in `project-user-membership-role-dal.ts`. These factories create data access layer objects that interact directly with the database.

## Key Files
1. `project-membership-service.ts`: Defines the main service for project membership operations.
2. `project-membership-dal.ts`: Provides data access functions for project memberships.
3. `project-membership-fns.ts`: Contains utility functions for adding members to projects.
4. `project-membership-types.ts`: Defines TypeScript types and interfaces used throughout the module.
5. `project-user-membership-role-dal.ts`: Handles data access for user roles within projects.

## Dependencies
The code relies on several external libraries and internal modules:
- Database ORM: Knex.js (via `@app/lib/knex`)
- Authorization: @casl/ability
- Email sending: SMTP service (injected)
- Encryption: Custom encryption functions (from `@app/lib/crypto/encryption`)
- Error handling: Custom error classes (from `@app/lib/errors`)
- Configuration: Environment variables (via `@app/lib/config/env`)

## Configuration
The module uses environment variables for configuration, particularly for features like email sending. The specific configuration options are not detailed in the provided code snippets, but they likely include settings for SMTP servers, database connections, and possibly feature flags for certain functionality.

The code also references licensing and plan-related configurations, suggesting that some features may be restricted based on the user's license or subscription plan.

In summary, this directory provides a comprehensive set of services and data access layers for managing project memberships, integrating with various parts of the larger application to handle user access, roles, and project-specific functionality.