---
title: "dynamic-secret-router.ts"
---

## High-level description
This file defines a FastifyZodProvider router for handling dynamic secret operations. It includes routes for creating, updating, deleting, retrieving, and listing dynamic secrets, as well as listing leases for a specific dynamic secret. The router implements authentication, rate limiting, and input validation for each endpoint.

## Code Structure
The main function `registerDynamicSecretRouter` sets up multiple routes for different operations on dynamic secrets. Each route is defined with its HTTP method, URL, rate limit configuration, schema for request and response validation, authentication requirements, and a handler function that interacts with the `dynamicSecret` service.

## Symbols

### `registerDynamicSecretRouter`
#### Description
This async function registers multiple routes for dynamic secret operations on a FastifyZodProvider server instance.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| server | FastifyZodProvider | The server instance to register routes on |

#### Internal Logic
1. Defines routes for POST, PATCH, DELETE, and GET operations on dynamic secrets.
2. Each route includes:
   - HTTP method and URL
   - Rate limiting configuration
   - Request and response schema validation using Zod
   - Authentication verification
   - A handler function that calls the appropriate `dynamicSecret` service method

## Routes

### POST "/"
#### Description
Creates a new dynamic secret.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| projectSlug | string | Project identifier |
| provider | DynamicSecretProviderSchema | Provider configuration |
| defaultTTL | string | Default time-to-live for the secret |
| maxTTL | string | Optional maximum time-to-live |
| path | string | Path for the secret |
| environmentSlug | string | Environment identifier |
| name | string | Name of the dynamic secret |

### PATCH "/:name"
#### Description
Updates an existing dynamic secret.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | string | Name of the dynamic secret to update |
| projectSlug | string | Project identifier |
| path | string | Path for the secret |
| environmentSlug | string | Environment identifier |
| data | object | Update data including inputs, TTLs, and new name |

### DELETE "/:name"
#### Description
Deletes a dynamic secret.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | string | Name of the dynamic secret to delete |
| projectSlug | string | Project identifier |
| path | string | Path for the secret |
| environmentSlug | string | Environment identifier |
| isForced | boolean | Whether to force deletion |

### GET "/:name"
#### Description
Retrieves details of a specific dynamic secret.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | string | Name of the dynamic secret to retrieve |
| projectSlug | string | Project identifier |
| path | string | Path for the secret |
| environmentSlug | string | Environment identifier |

### GET "/"
#### Description
Lists all dynamic secrets for a given project and environment.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| projectSlug | string | Project identifier |
| path | string | Path for the secrets |
| environmentSlug | string | Environment identifier |

### GET "/:name/leases"
#### Description
Lists leases for a specific dynamic secret.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | string | Name of the dynamic secret |
| projectSlug | string | Project identifier |
| path | string | Path for the secret |
| environmentSlug | string | Environment identifier |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @sindresorhus/slugify | For slug validation |
| ms | For parsing time strings |
| zod | For schema validation |
| @app/db/schemas | For database schemas |
| @app/ee/services/dynamic-secret/providers/models | For dynamic secret provider models |
| @app/lib/api-docs | For API documentation constants |
| @app/lib/dates | For date utility functions |
| @app/lib/fn | For utility functions |
| @app/server/config/rateLimiter | For rate limiting configurations |
| @app/server/plugins/auth/verify-auth | For authentication verification |
| @app/server/routes/sanitizedSchemas | For sanitized schema definitions |
| @app/services/auth/auth-type | For authentication type definitions |

## Error Handling
Error handling is primarily managed through Zod schema validation for input parameters. Custom refinements are used for validating TTL values.

## API/Interface Reference
| Endpoint | Method | Description |
|:---------|:-------|:------------|
| / | POST | Create a new dynamic secret |
| /:name | PATCH | Update an existing dynamic secret |
| /:name | DELETE | Delete a dynamic secret |
| /:name | GET | Get details of a specific dynamic secret |
| / | GET | List all dynamic secrets |
| /:name/leases | GET | List leases for a specific dynamic secret |

All endpoints require authentication using either JWT or IDENTITY_ACCESS_TOKEN.