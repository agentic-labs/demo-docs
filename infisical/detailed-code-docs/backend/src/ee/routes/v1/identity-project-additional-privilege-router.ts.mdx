---
title: "identity-project-additional-privilege-router.ts"
---

## High-level description
This file defines a router for managing additional privileges for identities within projects. It includes routes for creating permanent and temporary privileges, updating, deleting, and retrieving privilege details. The router uses Fastify and Zod for request validation and response serialization.

## Code Structure
The file exports a single function `registerIdentityProjectAdditionalPrivilegeRouter` that sets up multiple routes on the provided Fastify server instance. Each route corresponds to a specific operation on identity project additional privileges.

## Symbols

### `registerIdentityProjectAdditionalPrivilegeRouter`
#### Description
This function registers multiple routes for managing identity project additional privileges on the provided Fastify server instance.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| server | FastifyZodProvider | The Fastify server instance to register routes on |

#### Internal Logic
1. Registers a POST route for creating permanent privileges
2. Registers a POST route for creating temporary privileges
3. Registers a PATCH route for updating privileges
4. Registers a DELETE route for deleting privileges
5. Registers a GET route for retrieving a specific privilege by slug
6. Registers a GET route for listing privileges for an identity in a project

Each route includes:
- Method and URL
- Rate limiting configuration
- Schema definition for request body, params, and response
- Authentication verification
- Handler function that calls the appropriate service method

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @casl/ability/extra | Used for packing permission rules |
| @sindresorhus/slugify | Used for creating slugs |
| ms | Used for parsing time strings |
| zod | Used for request and response schema validation |

## Error Handling
The code uses `BadRequestError` for handling cases where required data is missing. Other errors are likely handled by the Fastify framework or the called service methods.

## API/Interface Reference
| Endpoint | Method | Description |
|:---------|:-------|:------------|
| /permanent | POST | Create a permanent privilege |
| /temporary | POST | Create a temporary privilege |
| / | PATCH | Update a privilege |
| / | DELETE | Delete a privilege |
| /:privilegeSlug | GET | Retrieve a specific privilege |
| / | GET | List privileges for an identity in a project |

Each endpoint requires authentication and includes rate limiting. The request and response schemas are defined using Zod and include detailed descriptions of each field.