---
title: "rate-limit-router.ts"
---

## High-level description
This code defines a router for rate limit operations in a FastifyZod server. It provides two routes: one for retrieving the current rate limit configuration and another for updating it. Both routes are protected and require authentication and super admin privileges.

## Code Structure
The main function `registerRateLimitRouter` sets up two routes: a GET route to retrieve rate limits and a PUT route to update them. Both routes use authentication middleware and interact with a rate limit service.

## Symbols

### `registerRateLimitRouter`
#### Description
This async function registers two routes for rate limit operations on a FastifyZodProvider server.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| server | FastifyZodProvider | The server instance to register routes on |

#### Internal Logic
1. Registers a GET route to retrieve rate limits
2. Registers a PUT route to update rate limits
3. Both routes use authentication and super admin verification
4. Both routes interact with the server's rate limit service

### GET Route "/"
#### Description
Retrieves the current rate limit configuration.

#### Inputs
None (apart from authentication)

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| rateLimit | RateLimitSchema | The current rate limit configuration |

#### Internal Logic
1. Verifies authentication using JWT
2. Verifies super admin status
3. Retrieves rate limits from the rate limit service
4. Returns the rate limit configuration or throws a BadRequestError if not found

### PUT Route "/"
#### Description
Updates the rate limit configuration.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| readRateLimit | number | Read operation rate limit |
| writeRateLimit | number | Write operation rate limit |
| secretsRateLimit | number | Secrets operation rate limit |
| authRateLimit | number | Authentication operation rate limit |
| inviteUserRateLimit | number | User invitation rate limit |
| mfaRateLimit | number | Multi-factor authentication rate limit |
| publicEndpointLimit | number | Public endpoint rate limit |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| rateLimit | RateLimitSchema | The updated rate limit configuration |

#### Internal Logic
1. Verifies authentication using JWT
2. Verifies super admin status
3. Updates rate limits using the rate limit service with the provided body
4. Returns the updated rate limit configuration

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| zod | Schema validation |
| @app/db/schemas | RateLimitSchema definition |
| @app/lib/errors | BadRequestError for error handling |
| @app/server/config/rateLimiter | readLimit configuration |
| @app/server/plugins/auth/superAdmin | Super admin verification |
| @app/server/plugins/auth/verify-auth | Authentication verification |
| @app/services/auth/auth-type | AuthMode enumeration |

## Error Handling
The code uses the `BadRequestError` from `@app/lib/errors` to handle cases where the rate limit configuration doesn't exist. Other potential errors are not explicitly handled in this file but may be managed by the FastifyZod server or the authentication middleware.