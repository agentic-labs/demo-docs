---
title: "access-approval-request-fns.ts"
---

## High-level description
This code defines a function `verifyRequestedPermissions` that processes and validates permission requests. It extracts specific access types and environment details from the provided permissions, ensuring they meet certain criteria before returning a structured object with the verified information.

## Symbols

### `filterUnique`
#### Description
A helper function used to filter unique values in an array.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| value | string | The current value being processed |
| index | number | The index of the current value |
| array | string[] | The array being filtered |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | boolean | True if the value is unique, false otherwise |

#### Internal Logic
The function checks if the index of the current value is the same as its first occurrence in the array, effectively keeping only the first instance of each unique value.

### `verifyRequestedPermissions`
#### Description
The main function that verifies and processes the requested permissions.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| permissions | TVerifyPermission | An object containing the permissions to be verified |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Object | An object containing the verified environment slug, secret path, and access types |

#### Internal Logic
1. Unpacks the provided permissions using the `unpackRules` function from `@casl/ability/extra`.
2. Checks if permissions are provided, throwing an `UnauthorizedError` if not.
3. Iterates through the permissions, mapping action types to corresponding access types.
4. Extracts the environment and secret path from the first permission's conditions.
5. Validates that the environment and secret path are strings, throwing `UnauthorizedError` if not.
6. Returns an object with the verified environment slug, secret path, and unique access types.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @casl/ability/extra | Used for unpacking permission rules |
| @app/lib/errors | Provides the `UnauthorizedError` class for error handling |

## Error Handling
The function throws `UnauthorizedError` in the following cases:
- No permissions are provided
- The permission environment is not a string
- The permission path is not a string

## Notes
- The code uses TypeScript and includes several ESLint disable comments, suggesting that there might be some type-related issues or linting rules that are being bypassed.
- The `permissionSecretPath` and `permissionEnv` variables are extracted but not used within the function, which might indicate that they are used elsewhere or that there's potential for future expansion of the function's logic.