---
title: "Overview"
---

## High-level description
This directory contains the implementation of a dynamic secret lease service for a backend application. It provides functionality for managing dynamic secret leases, including creation, renewal, revocation, listing, and retrieval of lease details. The service is designed to work within a project-based system and enforces permissions and plan restrictions.

## What does it do?
The dynamic secret lease service manages the lifecycle of temporary credentials or secrets that are dynamically generated and leased to clients. Here's a breakdown of its main functionalities:

1. Creation of leases: It allows clients to request new dynamic secrets, generating temporary credentials with specified time-to-live (TTL) periods.

2. Renewal of leases: Clients can extend the lifetime of their existing leases, refreshing the credentials if necessary.

3. Revocation of leases: It provides a mechanism to revoke leases, either manually or automatically when they expire.

4. Listing and retrieval: Clients can list all leases for a specific dynamic secret or retrieve details of a particular lease.

5. Pruning: The service can clean up expired or unused dynamic secrets and their associated leases.

6. Queue management: It uses a queue system to handle lease revocations and pruning operations asynchronously.

7. Permission and plan enforcement: The service checks user permissions and plan limitations before performing operations.

## Entry points
The main entry point for this service is the `dynamic-secret-lease-service.ts` file, which exports the `dynamicSecretLeaseServiceFactory` function. This factory creates an instance of the dynamic secret lease service with all its methods.

The service interacts with several other components:

1. `dynamic-secret-lease-dal.ts`: Provides data access layer functions for interacting with the database.
2. `dynamic-secret-lease-queue.ts`: Manages the queue for lease revocations and pruning operations.
3. `dynamic-secret-lease-types.ts`: Defines TypeScript types and interfaces used throughout the service.

The data flow typically starts from the service methods, which then interact with the DAL for database operations and the queue service for asynchronous tasks. The service also communicates with external dynamic secret providers to generate and manage the actual secrets.

## Dependencies
The service relies on several external dependencies and internal modules:

1. Knex: SQL query builder for Node.js, used in the DAL.
2. Custom database schemas and types from `@app/db`.
3. Error handling utilities from `@app/lib/errors`.
4. Database utility functions from `@app/lib/knex`.
5. Queue service for managing asynchronous tasks.
6. Dynamic secret providers for different types of secrets.
7. License service for checking plan restrictions.
8. Permission service for enforcing access controls.
9. Project and folder DALs for retrieving related information.

## Configuration
The service uses configuration passed through the factory functions. Key configurable aspects include:

1. Database connection: Provided through the `db` parameter in the DAL factory.
2. Queue configuration: Set up through the `queueService` parameter in the queue service factory.
3. Dynamic secret providers: Passed as a record of provider functions to the service factory.
4. License and permission services: Injected into the main service factory for enforcing restrictions.

The service also uses environment-specific configurations, such as project slugs and environment slugs, which are passed in the DTO objects for various operations.

In summary, this dynamic secret lease service provides a robust and flexible system for managing temporary, dynamically generated secrets within a project-based environment. It ensures proper access control, handles the lifecycle of leases, and integrates with various backend systems to provide a comprehensive solution for dynamic secret management.