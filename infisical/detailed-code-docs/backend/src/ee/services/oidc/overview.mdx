---
title: "Overview"
---

## High-level description
This directory contains the implementation of OpenID Connect (OIDC) services for the backend of an application. It provides functionality for managing OIDC configurations, handling OIDC login processes, and creating authentication strategies for organizations. The code is structured to work with a database for storing OIDC configurations and includes features for encryption of sensitive data.

## What does it do?
The OIDC services in this directory enable the following functionalities:

1. OIDC Configuration Management:
   - Retrieve OIDC configurations for organizations
   - Create new OIDC configurations
   - Update existing OIDC configurations
   - Encrypt and decrypt sensitive OIDC data (like client IDs and secrets)

2. OIDC Login Process:
   - Handle user login through OIDC providers
   - Create or update user accounts based on OIDC information
   - Manage organization memberships for users

3. Authentication Strategies:
   - Generate OIDC authentication strategies for organizations
   - Support custom OIDC configurations and discovery URL-based configurations

4. Data Access:
   - Provide a data access layer for interacting with OIDC configuration data in the database

The services ensure proper permission checks, license verification, and secure handling of sensitive information throughout these processes.

## Key Files

1. `oidc-config-dal.ts`:
   - Defines the data access layer for OIDC configurations
   - Provides methods to interact with the OIDC configuration table in the database
   - Uses the `ormify` function to create an Object-Relational Mapping

2. `oidc-config-service.ts`:
   - Implements the core OIDC service functionality
   - Includes methods for OIDC login, configuration management, and authentication strategy creation
   - Handles encryption/decryption of sensitive OIDC data
   - Performs permission checks and license verification

3. `oidc-config-types.ts`:
   - Defines TypeScript types and interfaces for OIDC-related operations
   - Includes types for OIDC login, configuration retrieval, creation, and update
   - Defines an enum for OIDC configuration types (CUSTOM and DISCOVERY_URL)

## Dependencies
The OIDC services rely on several external libraries and internal modules:

1. External libraries:
   - `@casl/ability`: For permission handling
   - `jsonwebtoken`: For working with JSON Web Tokens
   - `openid-client`: For OIDC client operations

2. Internal dependencies:
   - `@app/db`: Provides database-related types and constants
   - `@app/lib/knex`: Offers the `ormify` function for database operations
   - Various internal services and data access layers for user management, organization handling, and more

## Configuration
The OIDC services use configuration data stored in the database. The configuration includes:

- Issuer URL
- Authorization endpoint
- Discovery URL (for discovery URL-based configurations)
- JWKS URI
- Token endpoint
- Userinfo endpoint
- Client ID and secret (encrypted)
- Allowed email domains
- Active status

These configurations are organization-specific and can be customized or based on a discovery URL.

The services also rely on environment variables and application settings for aspects like callback URLs and encryption keys, though these are not directly visible in the provided code snippets.

In summary, this directory provides a comprehensive implementation of OIDC services for the application, enabling secure authentication and authorization through OpenID Connect providers while maintaining flexibility and security in configuration management.