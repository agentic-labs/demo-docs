---
title: "Overview"
---

## High-level description
This directory contains code related to permission management for an enterprise edition (EE) of a software application. It includes functionality for handling organization and project permissions, SAML authentication, and service token permissions. The code is primarily written in TypeScript and uses the CASL library for defining and checking permissions.

## What does it do?
The code in this directory provides a comprehensive permission management system for the application. It handles:

1. Organization-level permissions: Defining and checking permissions for different roles within an organization (admin, member, no access).
2. Project-level permissions: Managing permissions for various roles (admin, member, viewer, no access) and actions within projects.
3. SAML authentication: Validating SAML enforcement for organizations and checking if authentication methods are SAML-based.
4. Service token permissions: Building and managing permissions for service tokens with specific scopes and allowed actions.
5. Data access layer (DAL) for permissions: Retrieving permission-related data from the database for users, identities, and service tokens.
6. Permission comparison: Comparing permission sets to determine if one set is at least as privileged as another.

The system allows for fine-grained control over what actions users, identities, and service tokens can perform within organizations and projects. It supports both predefined roles and custom roles with specific permission sets.

## Entry points
The main entry point for this permission system is the `permissionServiceFactory` function in `permission-service.ts`. This factory function creates a service object with methods for retrieving and building permissions for various actors (users, identities, service tokens) within organizations and projects.

Other important files include:
- `org-permission.ts`: Defines organization-level permissions and roles.
- `project-permission.ts`: Defines project-level permissions, actions, and roles.
- `permission-dal.ts`: Provides data access layer functions for retrieving permission-related data from the database.
- `permission-fns.ts`: Contains utility functions for SAML authentication and validation.

The flow of control typically starts with a request to check permissions, which goes through the permission service. The service then uses the DAL to retrieve relevant data from the database, builds the appropriate permission set using the CASL library, and returns the result.

## Key Files
1. `permission-service.ts`: Contains the main service factory and methods for retrieving and building permissions.
2. `org-permission.ts`: Defines organization-level permissions and roles.
3. `project-permission.ts`: Defines project-level permissions, actions, and roles.
4. `permission-dal.ts`: Provides data access layer functions for retrieving permission-related data.
5. `permission-fns.ts`: Contains utility functions for SAML authentication and validation.

## Dependencies
The main external dependency is the CASL library (@casl/ability), which is used for defining and checking permissions. The code also relies on internal dependencies from other parts of the application, such as database schemas, error handling utilities, and authentication types.

## Configuration
The code doesn't directly use configuration files or environment variables. However, it does rely on the structure of the database and the defined permission schemas. Any changes to the permission structure or database schema would require updates to this code.

In summary, this directory provides a robust and flexible permission management system for the enterprise edition of the application, handling various levels of permissions across organizations and projects, and supporting different types of actors (users, identities, service tokens) with role-based and custom permission sets.