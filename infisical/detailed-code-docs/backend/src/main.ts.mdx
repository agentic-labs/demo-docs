---
title: "main.ts"
---

## High-level description
This code is the main entry point for a backend application. It initializes various services and configurations, sets up a database connection, handles migrations, and starts a server. The application also implements graceful shutdown mechanisms and performs a bootstrap check.

## Code Structure
The code is structured as a single async function `run()` that orchestrates the initialization and startup of various components. It uses several imported functions and factories to create instances of services like database, SMTP, queue, and key store.

## Symbols

### `run`
#### Description
This asynchronous function is the main entry point of the application. It initializes all necessary components and starts the server.

#### Internal Logic
1. Initialize logger and environment configuration
2. Set up database connection
3. Handle migrations if in packaged and migration mode
4. Initialize SMTP, queue, and key store services
5. Start the main application server
6. Perform bootstrap check
7. Set up process event listeners for graceful shutdown
8. Start listening on the configured port and host

## Side Effects
- Modifies the process environment by loading `.env` file
- May exit the process in case of migration completion or failure
- Sets up process event listeners for `SIGINT` and `SIGTERM`

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| dotenv | Load environment variables from a .env file |
| path | Handle file paths |
| Various local modules | Initialize different services and components |

## Configuration
The application uses environment variables for configuration, which are loaded using `dotenv` and processed by `initEnvConfig`.

## Error Handling
- Logs errors using the initialized logger
- Exits the process with status code 1 in case of migration failure

## Logging
The application initializes a logger using `initLogger()` and uses it throughout the code for logging information and errors.

## TODOs
There are no explicit TODOs in the code.